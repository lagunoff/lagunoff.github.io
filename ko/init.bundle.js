!function(e){function t(t){for(var r,a,s=t[0],l=t[1],u=t[2],d=0,p=[];d<s.length;d++)a=s[d],o[a]&&p.push(o[a][0]),o[a]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(c&&c(t);p.length;)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={0:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;i.push([411,1]),n()}(Array(27).concat([function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(244),s=String.fromCharCode(4),l=function(){function e(e){var t=this;this.data=e,this.__=function(e,n,r,o){return function(i){var a=i?"string"==typeof i?i:i.locale:"en-US";if(!((a=a.replace(/_/,"-"))in t.data))return 1===o?e:n||e;var l=r?r+s+e:e,c=t.data[a],d=u(a)(o||1);return function(e,t){return Array.isArray(e)?t>=e.length?e[e.length-1]:e[t]:e}(c[l]||[e,n],d)}}}return e.fromPO=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function e(t){return Array.prototype.concat.apply([],t.map(function(t){return"__esModule"in t&&(t=t.default),Array.isArray(t)?e(t):[t]}))}(t);return new e(function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){var n=!1;t.locale_data&&(n=!0,t=t.locale_data.messages);var r=t[""].language||t[""].lang||t[""].locale;if(r&&"string"==typeof r)for(var o=r.replace(/_/g,"-"),i=0,a=Object.keys(t);i<a.length;i++){var s=a[i];""!==s&&(e[o]=e[o]||{},Array.isArray(t[s])?(e[o][s]=n?t[s]:t[s].slice(1),1===e[o][s].length&&(e[o][s]=e[o][s][0])):e[o][s]=t[s])}}),e}.apply(void 0,[{}].concat(r)))},e.prototype.bind=function(e){var t=this;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t.__.apply(t,n)(e)}},e}();function u(e){var t=e.split(/[_\-]/)[0];return"ru"===t||"be"===t||"bs"===t||"hr"===t||"sh"===t||"sr_ME"===t||"uk"===t?function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<12||e%100>14)?1:2}:"lt"===t?function(e){return e%10==1&&(e%100<11||e%100>19)?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2}:"ar"===t||"ars"===t?function(e){return 0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11&&e%100<=99?4:5}:"br"===t?function(e){return e%10==1&&e%100!=11&&e%100!=71&&e%100!=91?0:e%10==2&&e%100!=12&&e%100!=72&&e%100!=92?1:(e%10==3||e%10==4||e%10==9)&&(e%100<10||e%100>19)&&(e%100<70||e%100>79)&&(e%100<90||e%100>99)?2:0!=e&&e%1e6==0?3:4}:"cz"===t||"sk"===t?function(e){return 1==e?0:e>=2&&e<=4?1:2}:"cy"===t?function(e){return 0==e?0:1==e?1:2==e?2:3==e?3:6==e?4:5}:"sl"===t||"dsb"===t||"hsb"===t?function(e){return e%100==1?0:e%100==2?1:e%100==3||e%100==4?2:3}:function(e){return 1==e?0:1}}t.Translations=l,t.withGettext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var s=e[0]instanceof l?e[0]:l.fromPO.apply(l,e);return function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.makeGettext=a.default(function(e){return s.bind(e)}),e}return r(n,t),n.prototype.render=function(){var t=this.props.ctx,n=t&&t.locale||"en-US";return i.createElement(e,o({},this.props,{__:this.makeGettext(n)}))},n}(i.Component);return t.displayName="WithTranslations("+e.name+")",n(189)(t,e),t}},t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=0;return e.replace(/%(s|d)/g,function(){return t[r++]})},function(e){e.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(n){var r=0;return e(n).replace(/%(s|d)/g,function(){return t[r++]})}}}(t.deferred||(t.deferred={})),t.getPluralForm=u},,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(269);t.Decoder=r.Decoder;var o=n(270);t.Eff=o.Eff;var i=n(270);t.Cmd=i.Cmd,t.noop=i.noop,t.batch=i.batch,t.concat=i.concat;var a=n(179);t.Either=a.Either,t.Left=a.Left,t.Right=a.Right,t.success=a.success,t.failure=a.failure;var s=n(412);t.Request=s.Request,t.Response=s.Response,t.HttpError=s.HttpError,t.send=s.send;var l=n(272);t.Option=l.Option;var u=n(413);t.Lens=u.Lens,t.Prism=u.Prism;var c=n(728);t.Sub=c.default;var d=n(269);t.decode=d;var p=n(179);t.either=p;var f=n(412);t.http=f;var h=n(413);t.optics=h;var m=n(272);t.option=m;var g=n(270);t.eff=g,t.cmd=g},,,,,,,,function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(36),i=n(106),a=n(50),s=n(9),l=n(365),u=n(181),c=n(308),d=n(411);function p(e,n,i){if(n instanceof o.decode.DecoderBase)return p(e,t.expectJSON(n),i);var a={"X-Auth":e.hasOwnProperty("auth")?e.auth.auth_token:void 0,"X-Site":C.__INFO__.debugInfo&&e.xTmserverAddress?void 0:e.xSite||window.location.host,"X-Tmserver-Address":C.__INFO__.debugInfo&&e.xTmserverAddress?e.xTmserverAddress:void 0,"Content-Type":"object"==typeof i&&"object"==typeof i.body?"application/json;charset=UTF-8":void 0},s="string"==typeof i?{url:i,method:"GET",headers:a,timeout:e.timeout}:r({},i,{url:i.url,headers:r({},a,i.headers),timeout:e.timeout});return f(e,s).mapError(function(e){return{tag:"HttpError",error:e}}).chainEff(n)}t.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.config.logLevel>=e&&console.log.apply(console,t)},t.apiRequest=p;var f=c.compose(function(e){return function(n,r){var o=n.features;e:if(!o||!o.orders_end_point){var i=r.url.match(/operator_api\/v1\/orders/);if(!i)break e;var a=r.url.split("?"),s=(a[0],a[1]),l=(s||"").split("&").filter(function(e){return""!==e}).reduce(function(e,t){var n=t.split("=").map(decodeURIComponent),r=n[0],o=n[1];return e[r]=o||"",e},{});if(l.hasOwnProperty("filter[status]")){var u=l["filter[status]"];return e(n,r).mapEff(function(e){try{var n=JSON.parse(e.body);n&&Array.isArray(n.data)&&n.data.forEach(function(e){return e.id&&(t.orderStatusesCache[e.id]=u)})}finally{return e}})}}return e(n,r)}},function(e){return function(n,o){var i=n.features;e:if(!i||!i.orders_end_point){var a=o.url.match(/operator_api\/v1\/orders(\/(\w+))?/),s=void 0;if(!a)break e;if("POST"===o.method){var l="current";s=o.url.substring(0,a.index)+"operator_api/v1/"+l+"_orders"}else if(void 0!==a[1]){var l=t.orderStatusesCache[a[2]]||"current";s=o.url.substring(0,a.index)+"operator_api/v1/"+l+"_orders"+a[1]+o.url.substring(a.index+a[0].length)}else{var u=o.url.split("?"),c=(u[0],u[1]),d=(c||"").split("&").filter(function(e){return""!==e}).reduce(function(e,t){var n=t.split("=").map(decodeURIComponent),r=n[0],o=n[1];return e[r]=o||"",e},{});if(d.hasOwnProperty("filter[status]")){var l=d["filter[status]"];s=o.url.substring(0,a.index)+"operator_api/v1/"+l+"_orders"+o.url.substring(a.index+a[0].length)}}if(s)return e(n,r({},o,{url:s}))}return e(n,o)}},function(e){var t={},n=[/\/operator_api\/v1\/cities/,function(e){return/\/operator_api\/v1\/drivers/.test(e.url)&&/1000/.test(e.url)}];return function(r,i){return"GET"===i.method&&i.url in t?o.eff.success(t[i.url]):e(r,i).mapEff(function(e){return-1!==n.findIndex(function(e){return e instanceof RegExp?e.test(i.url):e(i)})&&(t[i.url]=e),e})}})(function(e,t){return o.http.send(t)});t.expectJSON=function(e){return function(t){try{var n;if(n=JSON.parse(t.body),401===t.status)return o.eff.failure({tag:"Unauthentificated"});var r=u.decoders.errors.validate(n);if("Right"===r.tag)return o.eff.failure({tag:"JsonApiError",errors:r.value.errors});if(t.status>=200||t.status<300){var a=e.validate(n).mapLeft(function(e){return{tag:"HttpError",error:{tag:"ValidationProblem",problem:e,url:t.url}}});return i.of(a)}if(401===t.status||402===t.status||403===t.status)return o.eff.failure({tag:"Unauthentificated"});var s={tag:"BadStatus",status:t.status,desc:t.statusText};return o.eff.failure({tag:"HttpError",error:s})}catch(e){return console.error(e),o.eff.failure({tag:"HttpError",error:{tag:"BadPayload",desc:"Invalid JSON"}})}}},t.expectStatus=function(e){return function(t){if(!e(t.status)){try{do{var n=null;try{n=JSON.parse(t.body)}catch(e){break}var r=u.decoders.errors.validate(n);if("Right"===r.tag)return o.eff.failure({tag:"JsonApiError",errors:r.value.errors})}while(0)}catch(e){return o.eff.failure({tag:"HttpError",error:{tag:"BadPayload",desc:"Invalid JSON"}})}return o.eff.failure({tag:"HttpError",error:{tag:"BadStatus",status:t.status,desc:t.statusText}})}return o.eff.of(null)}},t.expectStatus2xx=t.expectStatus(function(e){return e>=200&&e<300}),t.momentDecoder=o.decode.decoder(function(e){if("string"!=typeof e)return o.failure("expected string, got "+typeof e);var t=s(e);return t.isValid()?o.success(t):o.failure("invalid date")}),t.stringOrNumber=o.decode.decoder("stringOrNumber",function(e){return"string"==typeof e||"number"==typeof e?o.success(String(e)):o.failure("not a string nor a number")}),t.arrayDiff=function(e,t,n){for(var r=[],o=[],i=[],s=t.map(function(e){return[e,!1]}),l=0,u=e;l<u.length;l++){for(var c=u[l],d=!1,p=0,f=s;p<f.length;p++){var h=f[p];if(n&&h[0][n]===c[n]){d=!0,a.isEqual(c,h[0])?r.push(c):i.push(h[0]),h[1]=!0;break}if(a.isEqual(c,h[0])){d=!0,r.push(c),h[1]=!0;break}}d||o.push(c)}return{same:r,removed:o,added:s.reduce(function(e,t){var n=t[0];return!t[1]&&e.push(n),e},[]),modified:i}},t.nextUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.coordsEmpty=function(e){return!e||!e.longitude||!e.latitude},t.isNew=function(e){return""===e.id},l.JsonApiBase.prototype.getPrimary=function(e,t,n){return p(e,this.primaryDecoder(),{method:"GET",url:n?o.http.join(n,this.collectQuery()):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+this.type+"/"+t,this.collectQuery())})},l.JsonApiBase.prototype.getCollection=function(e,t,n){return void 0===t&&(t={}),p(e,this.collectionDecoder(),{method:"GET",url:n?o.http.join(n,this.collectQuery()):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+this.type,r({},t,this.collectQuery()))})},l.JsonApiBase.prototype.getTotalCollection=function(e,t,n){return void 0===t&&(t={}),p(e,o.decode.ap(this.collectionDecoder(),o.decode.at(["meta","total"],o.decode.nat),function(e,t){return[e,t]}),{method:"GET",url:n?o.http.join(n,this.collectQuery()):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+this.type,r({},t,this.collectQuery()))})},l.JsonApiBase.prototype.patchResource=function(e,n,r,i){return p(e,t.expectStatus2xx,{method:"PATCH",url:i?o.http.join(i,this.collectQuery()):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+this.type,n),body:this.patch(n,r)})},l.JsonApiBase.prototype.postResource=function(e,n,r){return p(e,t.expectStatus2xx,{method:"POST",url:r||o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+this.type),body:this.post(n)})};var h=l.JsonApiBase.prototype,m=h.post,g=h.patch;function v(e){var t=e.data;if(r(t),void 0===t.relationships)return e;for(var n in t.relationships)t.relationships[n]&&(Array.isArray(t.relationships[n].data)?t.relationships[n].data.forEach(r):null===t.relationships[n].data?t.relationships[n].data={}:r(t.relationships[n].data));return e;function r(e){e&&"string"==typeof e.id&&(e.id=function(e){var t=parseInt(e);return isNaN(t)?e:t}(e.id))}}t.coerceAllIdsToNumbers=v,l.JsonApiBase.prototype.post=function(){return v(m.apply(this,arguments))},l.JsonApiBase.prototype.patch=function(){return v(g.apply(this,arguments))},t.orderStatusesCache={},t.onFailure=function(e){return{tag:"@Error",error:e}},t.onSuccess=function(e){return function(){return{tag:"@Success",message:e}}},t.pending=function(e){return o.cmd.concat(o.cmd.of({tag:"Pending",pending:!0}),e,o.cmd.of({tag:"Pending",pending:!1}))},t.filterMap=function(e,t){return e.reduce(function(e,n){var r=t(n);return null!==r&&e.push(r),e},[])},t.makePatch=function(e,t){var n={};for(var r in e)a.isEqual(e[r],t[r])||(n[r]=t[r]);return n},t.getAt=function(e){var t=Array.isArray(e)?e:[e];return function(e){for(var n=e,r=0,o=t;r<o.length;r++){var i=o[r];if(!n.hasOwnProperty(i))return;n=n[i]}return n}},t.updateAt=function(e,t){var n=Array.isArray(e)?e:[e];return function(e){for(var o=[e],i=o[0],a=0,s=n;a<s.length;a++){var l=s[a];if(!i.hasOwnProperty(l))return e;o.push(i[l]),i=i[l]}return o.reduceRight(function(e,i,a){var s;if(a===o.length-1)return t;if(Array.isArray(i)){var l=i.slice();return l.splice(n[a],1,e),l}return r({},i,((s={})[n[a]]=e,s))},t)}};var y=n(366);t.memoize=function(e,t){return y.default(e,t||a.isEqual)};var _=n(799);t.PureComponent=_.default;var b=n(27);t.gettext=b;var C=n(245);t.tuple=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},t.compose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return e.reduceRight(function(e,t){return t(e)},t)}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(973))},,,,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(274),o=n(36),i=n(106),a=n(354),s=n(44),l=n(27),u=n(245);function c(e){switch(e.tag){case"Timeout":return f("Request timeout exceeded");case"BadUrl":return function(){return"BadUrl: "+e.desc};case"BadStatus":return function(){return"BadStatus: "+e.status+" — "+e.desc};case"BadPayload":return f("Server sent an invalid response");case"ValidationProblem":return f("Server sent invalid JSON, see the console for details");case"NetworkError":return f("Network error")}}function d(e){return null!==e.code&&t.codes.hasOwnProperty(e.code)?t.codes[e.code]:null!==e.detail&&e.detail.length?function(){return e.detail}:null!==e.title&&e.title.length?function(){return e.title}:f("Unknown error")}function p(e){switch(e.tag){case"NoItem":return f("Cache does't exist");case"SizeLimitExeeded":return f("Limit exeeded");case"InvalidPayload":return f("Invalid cache payload");case"VersionMismatch":return f("Invalid cache version")}}t.openCardOn=s.tuple("receive","answer","dont-open"),t.contextCache=new r.Cache("ctx",o.decode.record({locale:o.decode.string,gisMapType:o.decode.literals("google","yandex","openstreetmaps","2gis","bing"),oktellReconnectTimeout:o.decode.nat,disableAddressSearch:o.decode.boolean,autoAnswerTimeout:o.decode.nat,cityTabCycle:o.decode.boolean,openOrderCardOn:o.decode.literals(t.openCardOn),fullFeaturedOnURL:o.decode.boolean,goBackBehaviour:o.decode.literals("old","new")}),{version:u.__INFO__.version}),t.contextStream=new i.Subject,t.describeError=function(e){switch(e.tag){case"IncorrectLogin":return f("Incorrect login or password");case"HttpError":return c(e.error);case"Unauthentificated":return f("Invalid authentication token");case"JsonApiError":return e.errors.length?d(e.errors[0]):f("Unknown error");case"GoogleMapInitFailure":return f("Cannot initialize google maps");case"OktellError":return l.deferred.sprintf(f("Oktell error: %s"),e.message);case"MediaPermissionsRefuse":return f("Can't access media device");case"OktellDisabled":return f("Oktell is switched off");case"InvalidPhoneNumber":return l.deferred.sprintf(f("Invalid phone number %s"),e.phone);case"ApiDisabled":return f("License inactive");case"BundleInitializationError":return f("Error during application initialization");case"CacheError":return p(e.error);case"Unexpected":return function(t){return f("Unexpected error")(t)+("string"==typeof e.error?": "+e.error:"")}}},t.describeHttpError=c,t.describeJsonApiError=d,t.describeCacheError=p,t.notifyError=function(e){return o.cmd.forget(function(){return t.errorsStream.next(e)})},t.errorsStream=new i.Subject,t.notifyWarning=function(e){return a.warning(e)},t.notifySuccess=function(e){return a.success(e)};var f=l.Translations.fromPO(n(246)).__;t.codes={authentification_error:f("Invalid authentication token"),method_not_found:f("Method not found"),internal_tmserver_error:f("Internal TMServer error"),invalid_json:f("Invalid request parameters"),incorrect_login:f("Login or password is incorrect"),brigadier_access_denied:f("Access to required team lead is denied"),brigadier_not_found:f("Specified team lead not found"),driver_access_denied:f("Access to required driver is denied"),driver_not_found:f("Specified driver not found"),car_access_denied:f("Access to required car is denied"),car_not_found:f("Car not found"),order_access_denied:f("Access to required booking is denied"),order_not_found:f("Required booking not found"),crew_group_not_found:f("Required cab group not found"),crew_group_access_denied:f("Access to required cab group is denied"),car_attribute_not_found:f("Required car attribute not found"),car_attribute_access_denied:f("Access to required car attribute is denied"),patch_driver_online:f("You are trying to edit a driver that is online at the moment"),patch_driver_need_specify_car:f("A car for new cab should be specified"),patch_driver_need_specify_crew_group:f("A cab group for new cab should be specified"),driver_online:f("You are trying to delete a driver that is online at the moment"),patch_car_online:f("You are trying to edit a car that is online at the moment"),delete_car_online:f("You are trying to delete a cat that is online at the moment"),post_order_driver_has_no_crew:f("Specified driver has no cab"),post_order_driver_not_available:f("Specified driver is not available"),post_order_driver_at_break:f("Specified driver is on a break"),post_order_driver_at_order:f("Specified driver is performing a booking"),patch_driver_state_driver_locked:f("Driver is locked"),insufficient_funds:f("Insufficient funds"),NoCrewOnOrder:f("No driver on order"),driver_group_and_order_group_different:f("Driver and Crew Group mismatched"),all_licenses_are_busy:f("All licenses are busy"),driver_has_no_required_attributes:f("Driver has no required attribute"),wrong_total_cost_parts:f("Invalid cost components")}},,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(160),s=n(8),l=n(11),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e,t=this.props,n=t.classes,r=t.className,s=l(r,((e={})[n.button]="onClick"in this.props,e));return i.createElement(a.default,o({},this.props,{className:s}))},t}(i.Component);function c(e){return{button:{cursor:"pointer",color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}}}}t.default=s.default(c)(u),t.styles=c},,,,,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(305));var r=n(1069);t.Label=r.default;var o=n(1070);t.Debounce=o.default;var i=n(1071);t.BooleanField=i.default;var a=n(1072);t.MomentField=a.default;var s=n(1078);t.SelectField=s.default;var l=n(404);t.TextField=l.default;var u=n(405);t.AutoComplete=u.default;var c=n(1081);t.MultiSelect=c.default},,,,,,,,,,,,function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(36),i=n(166),a=n(44),s=n(391),l=n(207),u=n(567),c=n(187),d=n(249),p=n(642),f=n(296),h=n(50),m=n(27),g=m.Translations.fromPO(n(81)).__,v=o.decode.array(o.decode.record({code:o.decode.string,value:o.decode.any})).map(function(e){return e.reduce(function(e,t){return e[t.code]=t.value,e},{})});function y(e){return{"page[limit]":e.limit||void 0,"page[offset]":e.offset||void 0,"filter[status]":e.status,"filter[driver]":e.driver,"filter[crew_group]":e.crewGroup,"filter[finished][gte]":e.since?e.since.format():void 0,"filter[finished][lte]":e.till?e.till.format():void 0,"filter[text]":e.search||void 0,"filter[state]":e.state.length?e.state.join(","):void 0,"filter[only_my_orders]":e.only_my_orders?"true":void 0,sort:e.sort||void 0}}function _(e){for(var t=u("*",e),n=t[0],r=t[1],o=u(",",n),i=o[0],a=o[1],s=i.length-1,l=-1;s>=0&&("/"!==i[s]||-1===l);)"/"===i[s]&&-1===l&&(l=s),s--;return-1===s?{beforeCity:i,city:"",afterCity:a,comment:r}:{beforeCity:i.substring(0,s),city:i.substring(s,l+1),afterCity:a,comment:r};function u(e,t){var n=t.indexOf(e);return-1===n?[t,""]:[t.substring(0,n),t.substring(n)]}}function b(e){return""===e?e:"/"===e?e:("/"===e[0]?"":"/")+e+("/"===e[e.length-1]?"":"/")}function C(e,t){return void 0===t&&(t=!0),e.beforeCity+(t&&e.city?b(e.city)+(e.comment?" ":""):"")+function(e){return""===e||","===e[0]?e:","+e}(e.afterCity)+e.comment}t.resource=i.crud("orders",{collectionParams:y,preprocessPost:function(e){var t=e.addresses.map(function(e){var t=e.city,n=e.coordinates,o=_(e.address),i=C(r({},o,{city:t}));return n?{address:i,coordinates:n}:{address:i}}),n=r({},e,{addresses:t});n.picked_up||delete n.picked_up;n.customer||delete n.customer;return n},preprocessPatch:function(e){if(e.addresses){var t=e.addresses.map(function(e){var t=e.city,n=e.coordinates,o=_(e.address),i=C(r({},o,{city:t}));return n?{address:i,coordinates:n}:{address:i}});return r({},e,{addresses:t})}return e}},{created:a.momentDecoder.withDefault(null),finished:a.momentDecoder.withDefault(null),picked_up:a.momentDecoder.withDefault(null),phone:o.decode.string.withDefault(""),addresses:o.decode.array(s.orderAddressDecoder),cost:o.decode.record({sum:o.decode.float,cash:o.decode.float,cashless:o.decode.float,bank_card:o.decode.float,bonus:o.decode.float,total:o.decode.float,use_max_bonus:o.decode.boolean,use_max_cashless:o.decode.boolean}),driver_balance_change:o.decode.float.withDefault(null),bill:o.decode.array(o.decode.record({text:o.decode.string,value:o.decode.string,sum:o.decode.string})),logs:o.decode.array(o.decode.record({type:o.decode.string,date:a.momentDecoder,params:v})),locked:o.decode.boolean.withDefault(!1),distances:o.decode.record({city:o.decode.float,country:o.decode.float,source_country:o.decode.float}).withDefault({city:0,country:0,source_country:0}),comment:o.decode.string.withDefault(""),customer:o.decode.string.withDefault(null),hourly_order:o.decode.boolean.withDefault(!1),is_really_advance:o.decode.boolean.withDefault(!1),is_advance:o.decode.boolean.withDefault(!1),route:o.decode.array(s.coordinatesDecoder),prior_route:o.decode.array(s.coordinatesDecoder),dont_distribute:o.decode.boolean.withDefault(!1),referral_code:o.decode.string.withDefault(""),server_time_offset:o.decode.float.withDefault(0),go_back:o.decode.boolean.withDefault(!1),state:l.orderStateResource,client:u.resource.withDefault(null),driver:c.collection.resource.withDefault(null),crew_group:d.resource.resource.withDefault(null),tariff:p.resource.resource.withDefault(null),attributes:f.resource.resource.many().withDefault([]),client_employee:i.resource("client_employees",{name:o.decode.string,crew_groups_filter:i.resource("crew_groups").many().withDefault([]),default_crew_group:i.resource("crew_groups").withDefault(null)}).withDefault(null),discount_card:i.resource("discount_cards",{name:o.decode.string}).withDefault(null)}),t.primary=t.resource.omit("route","prior_route"),t.collection=t.resource.pick("finished","phone","locked","is_advance","picked_up","state","driver").extend({addresses:o.decode.array(o.decode.record({address:o.decode.string}))}),t.gisResource=t.resource.pick("addresses","phone","state"),t.routesResource=t.resource.pick("route","prior_route"),t.defaultQuery={offset:0,limit:0,search:"",driver:null,crewGroup:null,since:null,till:null,state:[],only_my_orders:!1,sort:null},t.copy=function(e,n){if((n=r({},n,{driver:null})).picked_up){var o=Date.now();n.picked_up.valueOf()<o&&(n.picked_up=void 0)}return t.primary.postResource(e,n).mapTo(null)},t.collectionParams=y,t.getOrderColor=function(e){return"accepted"===e.state.state_type?"red":"in_work"===e.state.state_type?"blue":"none"},t.describeOrderLog=function(e){switch(e.type){case"driver_accept":return e.params.hasOwnProperty("minutes")?function(t){return g("Accepted by driver")(t)+", "+m.sprintf(g("arriving in %d minute")(t),e.params.minutes)}:g("Accepted by driver");case"driver_at_place":return g("Driver on spot");case"client_inside":return g("Passenger mounted");case"order_finished":return g("Completed");case"call_to_client":return g("Call to client");case"sms_to_client":return g("Sms sent to client");default:return function(){return e.type}}},t.describeSmsStatus=function(){var e={in_process:g("Processing"),sent:g("Message sent"),delivered:g("Message delivered"),error:g("Error occurred"),outdated:g("Message outdated")};return function(t){return e[t]}}(),t.describeCallResult=function(){var e={unknown:g("Unknown"),success:g("Success"),no_answer:g("No answer"),answer:g("Answer"),missed:g("Missed"),transfered:g("Transferred"),brokeOff:g("Brokeoff"),other_useranswered:g("Another user answered")};return function(t){return e[t]}}(),t.describeCallDirection=function(){var e={outgoing:g("Outgoing"),incoming:g("Incoming")};return function(t){return e[t]}}(),t.parseAddress=_,t.stripSlashes=function(e){if(""===e)return e;var t="/"===e[0]?1:0,n="/"===e[e.length-1]?e.length-1:void 0;return e.substring(t,n)},t.addSlashes=b,t.printAddress=C,t.printSort=function(e){switch(e){case"created":return g("Oldest");case"-created":return g("Latest");case null:return g("Default")}},t.addressCoordinatesEqual=function(e,t){if(e===t)return!0;for(var n=0,r=0;n<e.length&&r<t.length;){for(var o=null,i=null;n<e.length;n++)if(!a.coordsEmpty(e[n].coordinates)){o=e[n++].coordinates;break}for(;r<t.length;r++)if(!a.coordsEmpty(t[r].coordinates)){i=t[r++].coordinates;break}if(!h.isEqual(o,i))return!1}return!0},t.blank={id:"",type:"orders",state:{id:"",name:"New",type:"order_states",state_type:"accepted",forbid_manual_set:!1},cost:{sum:0,cash:0,cashless:0,bank_card:0,bonus:0,total:0,use_max_cashless:!1,use_max_bonus:!1},bill:[],logs:[],driver:null,crew_group:null,attributes:[],picked_up:null,finished:null,phone:"",driver_balance_change:null,client:null,tariff:null,distances:{city:0,country:0,source_country:0},locked:!1,hourly_order:!1,comment:"",client_employee:null,customer:null,is_really_advance:!1,is_advance:!1,dont_distribute:!1,referral_code:"",discount_card:null,server_time_offset:0,go_back:!1}},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1091))},,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(639));var r=n(639);t.default=r.default},function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(36),i=n(181),a=n(365),s=n(44),l=n(50),u=function(){function e(e,t){this.resource=e,this.options=t}return e.prototype.getPrimary=function(e,t){var n=this.options,r=n.endpoint,i=n.resourceName,a=n.primaryUrl,l=i||this.resource.type,u=a?a(e):r?o.http.join(r,t,this.resource.collectQuery()):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+l+"/"+t,this.resource.collectQuery());return s.apiRequest(e,this.resource.primaryDecoder(),{method:"GET",url:u})},e.prototype.getCollection=function(e,t){var n=this,i=this.options,a=i.endpoint,l=i.resourceName,u=i.collectionParams,c=i.collectionUrl,d=i.defaultQuery,p=d?r({},d,t):t,f=l||this.resource.type,h=function(){return u&&p?r({},n.resource.collectQuery(),u(p)):n.resource.collectQuery()},m=c?c(e,p):a?o.http.join(a,h()):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+f,h());return s.apiRequest(e,this.resource.collectionDecoder(),{method:"GET",url:m})},e.prototype.pageCollection=function(e,t){var n=this,i=this.options,a=i.endpoint,l=i.resourceName,u=i.collectionParams,c=i.collectionUrl,d=i.defaultQuery,p=d?r({},d,t):t,f=l||this.resource.type,h=function(){return u&&p?r({},n.resource.collectQuery(),u(p)):n.resource.collectQuery()},m=c?c(e,p):a?o.http.join(a,h()):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+f,h()),g=o.decode.ap(this.resource.collectionDecoder(),o.decode.at(["meta","total"],o.decode.nat.withDefault(0)),function(e,t){return[e,t]});return s.apiRequest(e,g,{method:"GET",url:m})},e.prototype.patchResource=function(e,t,n,r){var i=this.options,a=i.endpoint,l=i.resourceName,u=i.preprocessPatch||function(e){return e},c=l||this.resource.type,d=r||(a?o.http.join(a,t):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+c+"/"+t));return s.apiRequest(e,s.expectStatus2xx,{method:"PATCH",url:d,body:this.resource.patch(t,u(n))})},e.prototype.postResource=function(e,t,n){var r=this.options,i=r.endpoint,a=r.resourceName,l=r.preprocessPost||function(e){return e},u=a||this.resource.type,c=n||i||o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+u+"/");return s.apiRequest(e,o.decode.of(""),{method:"POST",url:c,body:this.resource.post(l(t))})},e.prototype.deleteResource=function(e,t,n){var r=this.options,i=r.endpoint,a=r.resourceName||this.resource.type;return n=n||(i?o.http.join(i,t):o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/"+a+"/"+t)),s.apiRequest(e,s.expectStatus2xx,{method:"DELETE",url:n})},e.prototype.extend=function(t){return new e(this.resource.extend(t),this.options)},e.prototype.comapQuery=function(t){var n=this.resource,o=this.options;return new e(n,r({},o,{collectionParams:o.collectionParams?function(e){return o.collectionParams(t(e))}:void 0}))},e.prototype.pick=function(t){var n=Array.isArray(t)?t:Array.prototype.slice.call(arguments);return new e(new a.Related(this.resource.type,l.pick(this.resource.desc,n)),this.options)},e.prototype.omit=function(t){var n=Array.isArray(t)?t:Array.prototype.slice.call(arguments);return new e(new a.Related(this.resource.type,l.omit(this.resource.desc,n)),this.options)},e}();t.CrudResource=u,a.JsonApiBase.prototype.crud=function(e){return void 0===e&&(e={}),new u(this,e)},function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(181)),t.crud=function(e){var t=2===arguments.length?[void 0,arguments[1]]:[arguments[1],arguments[2]],n=t[0],r=t[1];return i.resource(e,r).crud(n)}},,,,,,,,,,,,,function(e,t){var n=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.map=function(e){switch(this.tag){case"Left":return this;case"Right":return new i(e(this.value))}},e.prototype.mapLeft=function(e){switch(this.tag){case"Left":return new o(e(this.value));case"Right":return this}},e.prototype.bimap=function(e,t){switch(this.tag){case"Left":return new o(e(this.value));case"Right":return new i(t(this.value))}},e.prototype.chain=function(e){switch(this.tag){case"Left":return this;case"Right":return e(this.value)}},e.prototype.fold=function(e,t){switch(this.tag){case"Left":return e(this.value);case"Right":return t(this.value)}},e.prototype.onError=function(e){switch(this.tag){case"Left":return e(this.value);case"Right":return this}},e.prototype.toNullable=function(){switch(this.tag){case"Left":return null;case"Right":return this.value}},e.prototype.isRight=function(){return"Right"===this.tag},e.prototype.isLeft=function(){return"Left"===this.tag},e}();t.EitherBase=r;var o=function(e){function t(t){var n=e.call(this)||this;return n.value=t,n.tag="Left",n}return n(t,e),t}(r);t.Left=o;var i=function(e){function t(t){var n=e.call(this)||this;return n.value=t,n.tag="Right",n}return n(t,e),t}(r);t.Right=i,t.failure=function(e){return new o(e)},t.success=function(e){return new i(e)},t.left=function(e){return new o(e)},t.right=function(e){return new i(e)},t.of=function(e){return new i(e)},t.ap=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e[e.length-1],r=[],o=0;o<e.length-1;o++){var a=e[o];switch(a.tag){case"Left":return a;case"Right":r.push(a.value)}}return new i(n.apply(void 0,r))},t.traverse=function(e,t){for(var n=[],r=0;r<e.length;r++){var o=t(e[r],r);switch(o.tag){case"Left":return o;case"Right":n.push(o.value)}}return new i(n)}},,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(563);t.decoders=r,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(365))},,,,,function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(967))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(166),i=n(44),a=n(208),s=n(391),l=n(249),u=n(295);t.defaultQuery={offset:0,limit:10,sort:[],search:"",blocked:null,stateType:null,hasCoordinates:null,attributes:[],crew_group:null},t.resource=o.crud("drivers",{collectionParams:function(e){return{sort:e.sort.length?e.sort.join(","):null,"page[offset]":e.offset||null,"page[limit]":e.limit||null,"filter[state_type]":e.stateType,"filter[blocked]":null===e.blocked?null:e.blocked?"true":"false","filter[has_coordinates]":null===e.hasCoordinates?null:e.hasCoordinates?"true":"false","filter[text]":e.search||null,"filter[attributes]":0===e.attributes.length?null:e.attributes.join(","),"filter[crew_group]":e.crew_group}},defaultQuery:t.defaultQuery},{name:r.decode.string,phones:r.decode.array(r.decode.record({number:r.decode.string,default:r.decode.boolean})),call:r.decode.string,coordinates:s.coordinatesDecoder,balance:r.decode.float,coordinates_outdated:r.decode.boolean,comment:r.decode.string,date_coordinates:i.momentDecoder,blocked:r.decode.boolean.withDefault(!1),attributes:o.resource("attributes").many().withDefault([]),available_cars:u.resource.resource.many().withDefault([]),car:u.resource.resource.withDefault(null),state:a.resource.resource,crew_group:l.resource.resource.withDefault(null),order:o.resource("orders",{addresses:r.decode.array(s.orderAddressDecoder)}).withDefault(null)}),t.collection=t.resource.pick("name","phones","call","coordinates","balance","blocked","car","state","crew_group","attributes"),t.cardResource=t.resource.omit("coordinates","balance","coordinates_outdated","date_coordinates"),t.blankResource=t.cardResource.extend({password:r.decode.string}),t.autocomplete=t.resource.pick("name"),t.hasOrderResource=t.resource.pick("order"),t.gisResource=t.resource.pick("name","coordinates","phones","call","balance","crew_group","state"),t.blank={id:"",type:"drivers",name:"",password:"",phones:[],call:"",comment:"",blocked:!1,attributes:[],available_cars:[],car:null,crew_group:null,state:{type:"driver_states",id:"",state_type:"not_available",name:"Initial"},order:null};var c=n(208);t.printStateType=c.printStateType},,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(48),l=n(113),u=n(36),c=n(106),d=n(414),p=n(99),f=n(966),h=n(971),m=n(165),g=n(307),v=n(691),y=n(690),_=n(367),b=n(1133),C=n(1134),w=n(1135),E=n(407),S=n(1139),T=n(1140),O=n(1141),A=n(693),x=n(247),k=n(144),R=n(187),I=n(1142),D=n(8),N=n(1143),P=n(308),j=n(44),L=n(207),M=n(1162),U=n(1172),F=n(1180),q=n(27),B=q.Translations.fromPO(n(161),n(697),n(186)),H={"Driver/confirmStateChange":void 0,"Car/edit":E,Settings:M},V={Main:h,Order:g,Phone:_,Driver:A,Car:E};t.update=P.compose(function(e){return function(t,n,r){for(var o=n;;){if("string"==typeof o.tag&&"@"===o.tag[0]){n=o;break}if("object"!=typeof o.action)break;o=o.action}return e(t,n,r)}},function(e){return function(t,n,r){if("@Call"===n.tag||"@Call/transfer"===n.tag||"@Call/flash"===n.tag){var i=_.sanitizePhone(n.phone);if(!i)return[r,u.cmd.of({tag:"@Error"})];n=o({},n,{phone:i})}return e(t,n,r)}},function(e){return function(n,r,o){var i=e(n,r,o),a=i[0],s=i[1],l=[s];return"Nested/card"===r.tag&&("Order"===r.type&&t(r.action.tag)||"Driver"===r.type&&t(r.action.tag)||"Car"===r.type&&t(r.action.tag))&&l.push(u.cmd.of(z("Main")({tag:"Update"}))),"@Success"===r.tag&&l.push(u.cmd.of(z("Main")({tag:"Update"}))),[a,u.cmd.batch(l)]};function t(e){return"Post/success"===e||"Patch/success"===e||"Copy/success"===e}},function(e){return function(t,n,r){switch(n.tag){case"@Call":n=z("Phone")(o({},n,{tag:"Call"}));break;case"@Call/transfer":n=z("Phone")(o({},n,{tag:"Call/transfer"}));break;case"@Call/flash":n=z("Phone")(o({},n,{tag:"Call/flash"}))}return e(t,n,r)}},function(e){return function(t,n,r){if("@Coordinates/response"===n.tag&&r.requestCoordinates){var i=n.coordinates,a=r.requestCoordinates.addressUUID;r=o({},r,{requestCoordinates:null}),n=z("Order")({tag:"Coordinates/response",coordinates:i,addressUUID:a})}return e(t,n,r)}},function(e){return function(t,n,r){return e(t,n,r)}},function(e){return function(t,n,r){var o=e(t,n,r),i=o[0],a=o[1];if("Nested/modal"===n.tag&&"Settings"===n.modal){var s=n.action;if("Patch/success"===s.tag)return[i,u.cmd.batch(a,u.cmd.of({tag:"Close"}))]}return"Nested/card"===n.tag&&n.id&&"Post/success"===n.action.tag?[i,u.cmd.batch(a,u.cmd.of({tag:"Card/close",id:n.id}))]:o}})(function(e,t,n){var r,i,s,l;switch(t.tag){case"Init":var c=[J(e,n.cards)];if(e.fromPhone){var d=K(n);n=o({},n,{cards:o({},n.cards,(r={},r[d]={type:"Order",id:d,state:null,error:null},r))});c.push(g.initFromUrl(e,e.fromPhone).perform(function(e){return{tag:"Card/error",id:d,error:e}},function(e){return{tag:"Card/init",id:d,state:e}}))}return[n,u.cmd.batch(c)];case"Card/init":var f=o({},n.cards,((i={})[t.id]=o({},n.cards[t.id],{state:t.state,error:null}),i));return[o({},n,{cards:f}),u.noop];case"Card/error":var h=o({},n.cards,((s={})[t.id]=o({},n.cards[t.id],{state:null,error:t.error}),s));return[o({},n,{cards:h}),p.notifyError(t.error)];case"Card/close":var m=a.omit(n.cards,t.id);return[o({},n,{cards:m}),u.noop];case"Ping":return[n,x.ping(e).performMaybe(function(e){return u.option.some({tag:"@Error",error:e})},function(){return u.option.none})];case"Nested/card":var v=t.id||function(e,t){for(var n in t)if(t[n].type===e)return n;return null}(t.type,n.cards);if(!v||!n.cards.hasOwnProperty(v))return[n,u.noop];if(null===n.cards[v].state)return[n,u.noop];var y=V[t.type].update(e,t.action,n.cards[v].state),_=y[0],b=y[1],C=o({},n.cards,((l={})[v]=o({},n.cards[v],{state:_}),l));return[o({},n,{cards:C}),b.mapCmd(z(t.type,v))];case"Nested/modal":if(!n.modal||n.modal.tag!==t.modal)return[n,u.noop];var w=H[t.modal].update(e,t.action,n.modal.state),S=(_=w[0],b=w[1],o({},n.modal,{state:_}));return[o({},n,{modal:S}),b.mapCmd(G(t.modal))];case"Nested/gis":var T=N.update(e,t.action,n.gisMap),O=T[0];b=T[1];return[o({},n,{gisMap:O}),b.mapCmd(W)];case"Driver/changeStatus/step2":return t.driver.order?[o({},n,{modal:{tag:"Driver/confirmStateChange",driver:t.driver,state:t.state,orderStates:t.orderStates,orderState:null}}),u.noop]:[n,R.resource.patchResource(e,t.driver.id,{state:t.state}).perform(j.onFailure,j.onSuccess(B.__("Status changed")))];case"Driver/changeStatus/step3":var I=n.modal;if(!I||"Driver/confirmStateChange"!==I.tag||!I.driver.order||!I.orderState)return[n,u.noop];var D=k.primary.patchResource(e,I.driver.order.id,{state:I.orderState}).chainEff(function(){return R.resource.patchResource(e,I.driver.id,{state:I.state})});return[o({},n,{modal:null}),D.perform(j.onFailure,j.onSuccess(B.__("Status changed")))];case"Driver/changeStatus/orderState":if(!(S=n.modal)||"Driver/confirmStateChange"!==S.tag)return[n,u.noop];var P=S.orderStates.find(function(e){return e.id===t.state})||null;return[o({},n,{modal:o({},S,{orderState:P})}),u.noop];case"Modal/init":return[o({},n,{modal:t.modal}),u.noop];case"Close":return[o({},n,{modal:null}),u.noop];case"@Error":return[n,p.notifyError(t.error)];case"@Success":return[n,p.notifySuccess(t.message)];case"@Warning":return[n,p.notifyWarning(t.message)];case"@Order/open":var U=K(n);return[Y(q={type:"Order",id:U,state:null,error:null},n),g.init(e,t.id).perform(function(e){return{tag:"Card/error",id:U,error:e}},function(e){return{tag:"Card/init",id:U,state:e}})];case"@Order/add":var F=K(n),q={type:"Order",id:F,state:null,error:null};D=t.call?g.initFromCall(e,t.call):g.initNew(e);return[Y(q,n),D.perform(function(e){return{tag:"Card/error",id:F,error:e}},function(e){return{tag:"Card/init",id:F,state:e}})];case"@Order/changeStatus":return[n,k.primary.patchResource(e,t.id,{state:t.state}).perform(j.onFailure,j.onSuccess(B.__("Status changed")))];case"@Driver/open":var $=K(n);return[Y(q={type:"Driver",id:$,state:null,error:null},n),A.initExisted(e,t.id).perform(function(e){return{tag:"Card/error",id:$,error:e}},function(e){return{tag:"Card/init",id:$,state:e}})];case"@Driver/new":var Q=K(n);return[Y(q={type:"Driver",id:Q,state:null,error:null},n),A.initBlank(e).perform(function(e){return{tag:"Card/error",id:Q,error:e}},function(e){return{tag:"Card/init",id:Q,state:e}})];case"@Car/open":var Z=K(n);return[Y(q={type:"Car",id:Z,state:null,error:null},n),E.initExisted(e,t.id).perform(function(e){return{tag:"Card/error",id:Z,error:e}},function(e){return{tag:"Card/init",id:Z,state:e}})];case"@Car/openInModal":return[n,E.initExisted(e,t.id).perform(function(e){return{tag:"@Error",error:e}},function(e){return{tag:"Modal/init",modal:{tag:"Car/edit",state:e}}})];case"@Car/add":var X=K(n);return[Y(q={type:"Car",id:X,state:null,error:null},n),E.initNew(e).perform(function(e){return{tag:"Card/error",id:X,error:e}},function(e){return{tag:"Card/init",id:X,state:e}})];case"@Driver/changeStatus":return[n,(D=R.hasOrderResource.getPrimary(e,t.id).chainEff(function(t){return(t.order?L.getCollection(e).mapEff(function(e){return e.filter(function(e){return!e.forbid_manual_set})}):u.eff.of([])).mapEff(function(e){return{orderStates:e,driver:t}})})).perform(j.onFailure,function(e){var n=e.driver,r=e.orderStates;return{tag:"Driver/changeStatus/step2",driver:n,state:t.state,orderStates:r}})];case"@Call":case"@Call/transfer":case"@Call/flash":return[n,u.noop];case"@Coordinates/request":return n.requestCoordinates&&n.requestCoordinates.addressUUID===t.addressUUID?[o({},n,{requestCoordinates:null}),u.noop]:[o({},n,{requestCoordinates:t}),u.noop];case"@Coordinates/response":return[n,u.noop];case"@Settings/open":return[n,b=M.init(e,null).perform(function(e){return{tag:"@Error",error:e}},function(e){return{tag:"Modal/init",modal:{tag:"Settings",state:e}}})];case"@Address/change":var ee=t.address,te={tag:"Modify",modifier:function(e){return o({},e,{addresses:e.addresses.map(function(e){return e.uuid===ee.uuid?ee:e})})}};return[n,u.cmd.of(z("Order")(te))]}});var z=function(e,t){return function(n){return{tag:"Nested/card",action:n,type:e,id:t}}},G=function(e){return function(t){return{tag:"Nested/modal",action:t,modal:e}}},W=function(e){return{tag:"Nested/gis",action:e}};function K(e){var t=0;for(var n in e.cards)if(e.cards.hasOwnProperty(n)){var r=parseInt(n);isNaN(r)||(t=Math.max(t,r))}return String(++t)}function Y(e,t){var n=o({},t.cards);for(var r in n)if(n.hasOwnProperty(r))switch(n[r].type){case"Order":case"Driver":case"Car":delete n[r]}return n[e.id]=e,o({},t,{cards:n})}function J(e,t){return u.cmd.batch(Object.keys(t).map(function(n){return $(e,t[n]).perform(function(e){return{tag:"Card/error",id:n,error:e}},function(e){return{tag:"Card/init",id:n,state:e}})}))}function $(e,t){switch(t.type){case"Main":return h.init(e,h.initFlags(e));case"Phone":return _.init(e)}}t.newTileId=K,t.init=function(e){return N.init(e).mapEff(function(e){return{cards:{1:{type:"Main",id:"1",state:null,error:null},2:{type:"Phone",id:"2",state:null,error:null}},modal:null,requestCoordinates:null,gisMap:e}})},t.initTiles=J,t.initTile=$;var Q=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.unlisten=null,t}return r(n,e),n.prototype.listen=function(){var e=this.props,t=e.ctx,n=e.dispatch,r=setInterval(function(){return n({tag:"Ping"})},t.pingInterval);this.unlisten=function(){return clearInterval(r)}},n.prototype.componentDidMount=function(){(0,this.props.dispatch)({tag:"Init"}),this.listen()},n.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},n.prototype.render=function(){var e=this.props,n=e.ctx,r=e.model,o=e.classes,a=e.dispatch,s=Z(r.cards),l=[];for(var u in r.cards)r.cards.hasOwnProperty(u)&&l.push(X(this.props,r.cards[u],s));return i.createElement("div",{className:o.root},i.createElement("div",{className:o.wrapper},i.createElement(N.View,{ctx:n,mode:s.gisMode,model:r.gisMap,dispatch:function(e){return a(W(e))},requestCoordinates:!!r.requestCoordinates,onCoordinatesResponse:function(e){return a({tag:"@Coordinates/response",coordinates:e})},onAddressChange:function(e){return a({tag:"@Address/change",address:e})}}),i.createElement("div",{className:o.layout},l)),i.createElement(f.default,{ctx:n,className:o.profileMenu}),i.createElement(I.default,{ctx:n,className:o.localClock}),ee(this.props),i.createElement(d.default,{to:t.dispatchStream,handler:a}))},n}(j.PureComponent);function Z(e){var t={selectedOrder:void 0,selectedDriver:void 0,selectedCar:void 0,dontIntervene:!1,currentCall:null,gisMode:{tag:"Common/init"}};for(var n in e){var r=e[n];if("Order"===r.type&&null!==r.state){var o=r.state;if(j.isNew(o.initial)?t.dontIntervene=!0:t.selectedOrder=o.initial.id,s("Common/order")){var i=g.form.get(o);t.gisMode={tag:"Common/order",order:i}}}if("Driver"===r.type&&null!==r.state){o=r.state;j.isNew(o.initial)||(t.selectedDriver=o.initial.id)}if("Car"===r.type&&null!==r.state){o=r.state;j.isNew(o.initial)||(t.selectedCar=o.initial.id)}if("Phone"===r.type&&null!==r.state&&(t.currentCall=_.currentCall(r.state)),"Main"===r.type&&null!==r.state){var a=r.state.flags;"Drivers"===a.tag&&s("Input/drivers")&&(t.gisMode={tag:"Input/drivers",active:null,query:a.flags}),"Orders"===a.tag&&s("Input/orders")&&(t.gisMode={tag:"Input/orders",query:a.flags})}}return"Input/drivers"===t.gisMode.tag&&(t.gisMode.active=t.selectedDriver||null),t;function s(e){return N.externalModePrio[e]>N.externalModePrio[t.gisMode.tag]}}function X(e,t,n){var r=e.__,o=e.ctx,a=e.dispatch,u=e.classes,c=e.theme,d=function(e,t){var n=t.spacing.unit,r=48*n,o=12*n;return"Main"===e.type?{top:n,left:n,width:r,height:"calc(100% - 16px)",zIndex:20}:"Phone"===e.type?{top:n,left:n+r+n,width:r,height:o}:{top:n+o+n,left:n+r+n,width:r,height:"calc(100% - 24px - "+o+"px)"}}(t,c);if(!t.state&&!t.error)return i.createElement(s.Paper,{key:t.id,className:u.paper,style:d},i.createElement(m.default,{pending:!0}));if(t.error)return i.createElement(s.Paper,{key:t.id,className:u.paper,style:d},i.createElement("div",{className:u.cardHeader},i.createElement("div",null," "),i.createElement(l.default,{"data-rh":r("Close"),onClick:function(){return a({tag:"Card/close",id:t.id})}},"close")),i.createElement("div",{className:u.error},i.createElement("div",null,p.describeError(t.error)(o))));switch(t.type){case"Main":return i.createElement(s.Paper,{className:u.paper,style:d,key:t.id},i.createElement(h.View,{ctx:o,model:t.state,dispatch:function(e){return a(z("Main",t.id)(e))},derivedData:n}));case"Order":return i.createElement(U.Card,{className:u.paper,key:t.id,style:d},i.createElement(U.CardHeader,{ctx:o},i.createElement(v.default,{ctx:o,model:t.state,dispatch:function(e){return a(z("Order",t.id)(e))},onClose:function(){return a({tag:"Card/close",id:t.id})}})),i.createElement(U.CardContent,null,i.createElement(g.View,{ctx:o,model:t.state,dispatch:function(e){return a(z("Order",t.id)(e))}})),i.createElement(U.CardFooter,null,i.createElement(y.default,{ctx:o,model:t.state,dispatch:function(e){return a(z("Order",t.id)(e))}})));case"Phone":return i.createElement(b.default,{card:t.state,className:u.paper,key:t.id,style:d},i.createElement(_.View,{ctx:o,model:t.state,dispatch:function(e){return a(z("Phone",t.id)(e))},dontIntervene:n.dontIntervene}));case"Driver":return i.createElement(U.Card,{className:u.paper,key:t.id,style:d},i.createElement(U.CardHeader,{ctx:o},i.createElement(C.default,{ctx:o,model:t.state,dispatch:function(e){return a(z("Driver",t.id)(e))},onClose:function(){return a({tag:"Card/close",id:t.id})}})),i.createElement(U.CardContent,null,i.createElement(A.View,{ctx:o,model:t.state,dispatch:function(e){return a(z("Driver",t.id)(e))},onClose:function(){return a({tag:"Card/close",id:t.id})},currentCall:n.currentCall})),i.createElement(U.CardFooter,null,i.createElement(w.default,{ctx:o,model:t.state,dispatch:function(e){return a(z("Driver",t.id)(e))},onClose:function(){return a({tag:"Card/close",id:t.id})}})));case"Car":return i.createElement(U.Card,{className:u.paper,key:t.id,style:d},i.createElement(U.CardHeader,{ctx:o,onClose:function(){return a({tag:"Card/close",id:t.id})}},i.createElement(S.default,{ctx:o,model:t.state})),i.createElement(U.CardContent,null,i.createElement(E.View,{ctx:o,model:t.state,dispatch:function(e){return a(z("Car",t.id)(e))}})),i.createElement(U.CardFooter,null,i.createElement(T.default,{ctx:o,model:t.state,dispatch:function(e){return a(z("Car",t.id)(e))}})))}}function ee(e){var t=e.ctx,n=e.dispatch,r=e.model,a=e.classes,l=r.modal;if(!l)return null;switch(l.tag){case"Driver/confirmStateChange":return i.createElement(F.View,o({},l,{ctx:t,onClose:function(){return n({tag:"Close"})},onConfirm:function(){return n({tag:"Driver/changeStatus/step3"})},onOrderStatusChange:function(e){return n({tag:"Driver/changeStatus/orderState",state:e})},onOrderOpen:function(e){return n({tag:"@Order/open",id:e})}}));case"Car/edit":return i.createElement(s.Dialog,{open:!0,onClose:function(){return n({tag:"Close"})},className:a.dialog},i.createElement(s.DialogTitle,null,i.createElement(S.default,{ctx:t,model:l.state,noPadding:!0})),i.createElement(s.DialogContent,null,i.createElement(E.View,{ctx:t,model:l.state,dispatch:function(e){return n(G("Car/edit")(e))},noPadding:!0})),i.createElement(s.DialogActions,{className:a.actions},i.createElement(O.default,{ctx:t,model:l.state,dispatch:function(e){return n(G("Car/edit")(e))}})));case"Settings":return i.createElement(s.Dialog,{open:!0,onClose:function(){return n({tag:"Close"})},className:a.dialog,maxWidth:"md",fullWidth:!0},i.createElement(M.View,{ctx:t,model:l.state,dispatch:function(e){return n(G("Settings")(e))},dialog:!0}))}}function te(e){var t=e.spacing.unit;return{root:{minHeight:"100%",position:"absolute",boxSizing:"border-box",width:"100%",overflow:"hidden"},profileMenu:{position:"absolute",top:2*t,right:3*t},localClock:{position:"absolute",top:8*t,right:3*t},wrapper:{position:"absolute",width:"100%",height:"100%"},paper:{position:"absolute",zIndex:10},paper2:{position:"absolute",zIndex:10,display:"flex",flexDirection:"column","& > * + *":{borderTop:"solid 1px "+e.palette.divider}},mapElement:{width:"100%",height:"100%"},layout:{top:0,height:"100%",width:"100%"},error:{display:"flex",alignItems:"center",justifyContent:"center",padding:2*t,width:"100%",height:"100%",boxSizing:"border-box","& > *:first-child":{color:e.palette.text.secondary,fontStyle:"italic"}},cardHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:t,height:7*t,"& > *:first-child":{flex:"10 10 auto"}}}}t.View=D.default(te,{withTheme:!0})(q.withGettext(n(186))(Q)),t.inspectCards=Z,t.renderModal=ee,t.dispatchStream=new c.Subject,t.dispatchExternal=function(e){return u.cmd.forget(function(){return t.dispatchStream.next(e)})},t.styles=te},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(181),i=n(27).Translations.fromPO(n(81)).__;function a(e){return t.stateTypes[e]}t.stateTypes={finished:i("Finished"),aborted:i("Aborted"),in_work:i("In work"),accepted:i("Accepted")},t.orderStateResource=o.resource("order_states",{name:r.decode.string,forbid_manual_set:r.decode.boolean.withDefault(!1),state_type:o.attr(r.decode.literals(Object.keys(t.stateTypes))).withName("type")}),t.getCollection=function(e){return t.orderStateResource.getCollection(e)},t.printStateType=a,t.printMaybeStateType=function(e){return a(e)||function(){return e}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(166),i=n(27);function a(e){switch(e){case"not_available":return t.__("Unavailable");case"waiting":return t.__("Free");case"on_break":return t.__("On a break");case"on_order":return t.__("Performing booking")}}t.__=i.Translations.fromPO(n(977)).__,t.resource=o.crud("driver_states",{name:r.decode.string,state_type:o.attr(r.decode.literals("not_available","waiting","on_order","on_break")).withName("type")}),t.printStateType=a,t.printMaybeStateType=function(e){return a(e)||function(){return e}}},,,,,function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1075))},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(8),l=n(11),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleLabelClick=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=t.props.children;a.isValidElement(r)&&"function"==typeof r.props.onClick&&r.props.onClick.apply(void 0,e)},t}return r(t,e),t.prototype.render=function(){var e,t=this.props,n=t.classes,r=t.className,s=t.label,u=t.labelClassName,c=t.children,d=t.labelPosition,p=i(t,["classes","className","label","labelClassName","children","labelPosition"]),f=l(r,n.root),h=l(u,((e={})[n.clickable]=a.isValidElement(c)&&"function"==typeof c.props.onClick,e)),m=d||"right";return a.createElement("div",o({},p,{className:f}),"right"===m&&a.createElement(a.Fragment,null,c,a.createElement("span",{className:h,onClick:this.handleLabelClick},s)),"left"===m&&a.createElement(a.Fragment,null,a.createElement("span",{className:h,onClick:this.handleLabelClick},s),c))},t}(a.Component);function c(e){return{root:{display:"inline-flex",alignItems:"center"},clickable:{cursor:"pointer",userSelect:"none"}}}t.default=s.default(c)(u),t.styles=c},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1098))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(366),o=n(50);t.default=function(e,t){return r.default(e,t||o.isEqual)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),n(351);var r=n(273);t.configDecoder=r.record({locale:r.string.withDescription("Выбор языка приложения"),operatorApi:r.string.withDescription('Адрес API бекенда КО, только хост, без /api/v1/ (например "http://armo-backend.yggdrasil.bit.nest.bitmaster.ru/")'),xSite:r.string.withDescription("Заголовок X-Site (домен КО для определения клиента)"),xTmserverAddress:r.string.withDefault(null).withDescription("Заголовок X-TMServer-Address (явно указанный адрес ТМ для отладки)"),token:r.string.withDefault(null).withDescription("Токен авторизации АПИ Кабинета Оператора"),autoAnswerTimeout:r.nat.withDefault(0).withDescription("Таймаут для автоматического подтятия трубки в телефоне"),currency:r.string.withDefault("RUB").withDescription("Валюта для форматирования сумм (ISO 4217)"),disableAddressSearch:r.boolean.withDefault(!1).withDescription("Отключить поиск адресов"),disableOktell:r.boolean.withDefault(!1).withDescription("Отключить телефон"),gisMapType:r.variants("google","yandex","openstreetmaps","2gis","bing").withDefault("yandex").withDescription("Выбор поставшика геоданных для карты"),googleMapKey:r.string.withDefault(null).withDescription("АПИ ключ для google.maps"),bingMapsKey:r.string.withDefault(null).withDescription("АПИ ключ для карт bing"),mapUpdateInterval:r.nat.withDefault(15e3).withDescription("Интервал обновления карты"),logLevel:r.nat.withDefault(2).withDescription("0-10, 0 — полное отсутствие логов, 10 — максимальное логирование"),oktellAddress:r.string.withDefault(null).withDescription("Адрес сервера октела"),oktellLogin:r.string.withDefault(null).withDescription("Логин октел-аккаунта"),oktellPassword:r.string.withDefault(null).withDescription("Пароль октел-аккаунта"),oktellReconnectTimeout:r.nat.withDefault(0).withDescription("Интервал переподключения октела"),refreshInterval:r.nat.withDefault(15e3).withDescription("Интервал обновления списков (в мс)"),pageLimit:r.nat.withDefault(10).withDescription("Размер страниц"),pingInterval:r.nat.withDefault(1e4).withDescription("Интервал отправки ping запросов"),registerExpires:r.nat.withDefault(120).withDescription("Параметр JSSIP register_expires"),timeout:r.nat.withDefault(15e3).withDescription("Таймаут выполнения http запросов"),openOrderCardOn:r.variants("dont-open","receive","answer").withDefault("dont-open").withDescription("Настройка открытие карточки заказа"),cityTabCycle:r.boolean.withDefault(!1).withDescription("Добавление поля с городом в tab-цикл"),fromPhone:r.string.withDefault(null).withDescription("Если указано это поле, КО будет инициализован с новой карточкой заказа для этого номера, см fullFeaturedOnURL"),fullFeaturedOnURL:r.boolean.withDefault(!1).withDescription("Работает только с заполеннным параметром fromPhone, если true, то вместе с формой для нового заказа открывается полнофункциональный КО"),goBackBehaviour:r.literals("old","new").withDefault(null).withDescription('Поведение чекбокса "обратно" в поле выбора адреса (старое поведение из ТМ или новое)'),screwAccessRights:r.boolean.withDefault(!1).withDescription("Отключить права доступа")}),t.default=t.configDecoder;try{t.__CONFIG__={operatorApi:"https://armo-backend.platform.taximaster.ru",xSite:"",xTmserverAddress:null,token:null,autoAnswerTimeout:0,currency:"RUB",disableAddressSearch:!1,disableOktell:!1,gisMapType:"yandex",googleMapKey:"AIzaSyCgCCeSEm5Uj377FVxJHeLyl0_FHz9o3Vg",bingMapsKey:"AtmRBddhAfdxblKPQkfXRVvSuqjpUjBhSOlV5Crk-JPAZfuaxvfxxA9zR3kDk9Rr",mapUpdateInterval:15e3,logLevel:0,oktellAddress:null,oktellLogin:null,oktellPassword:null,oktellReconnectTimeout:0,refreshInterval:15e3,pageLimit:10,pingInterval:1e4,registerExpires:120,timeout:0,openOrderCardOn:"dont-open",cityTabCycle:!1,fromPhone:null,fullFeaturedOnURL:!1,goBackBehaviour:null,screwAccessRights:!1,output:"./public",production:!0,transpileOnly:!0,preset:"development",analyzer:!1,gaTrackingID:null,debugInfo:!1}||void 0,t.__INFO__={locales:["en-US","ru-RU","de-DE","lt-LT"],version:"2.1.0",builtAt:"Fri Apr 12 2019 23:48:54 GMT+0400 (+04)",revision:"ec3d09665e1fb57704b0c833c9fd0614f8005e35",debugInfo:!1}||void 0}catch(e){}},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(800))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(106),i=n(274),a=n(44);t.authentificationDecoder=r.decode.record({id:a.stringOrNumber,auth_token:r.decode.string});var s=r.decode.record({code:r.decode.literals(3)});t.post=function(e,n,i){return a.apiRequest(e,function(e){return 404===e.status?r.eff.failure({tag:"IncorrectLogin"}):a.expectJSON(r.decode.any)(e).chainEff(function(n){if("Right"===s.validate(n).tag)return r.eff.failure({tag:"ApiDisabled"});var i=t.authentificationDecoder.validate(n).mapLeft(function(t){return{tag:"HttpError",error:{tag:"ValidationProblem",problem:t,url:e.url}}});return o.of(i)})},{method:"POST",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/login"),body:{login:n,password:i}})},t.logout=function(e){return a.apiRequest(e,a.expectStatus2xx,{method:"POST",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/logout")})},t.ping=function(e){return a.apiRequest(e,a.expectStatus2xx,{method:"POST",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/ping"),body:{}})},t.cache=new i.Cache("auth",t.authentificationDecoder),t.logoutStream=new o.Subject},,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(166);t.resource=o.crud("crew_groups",{name:r.decode.string,default:r.decode.boolean.withDefault(!1),available_to_user:r.decode.boolean.withDefault(!0),server_time_offset:r.decode.nat.withDefault(0),attributes_allowed_for_order:o.resource("attributes").many().withDefault([])})},,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(179),a={printProblem:!1},s=function(){function e(){}return e.prototype.prettyPrint=function(){var e=this;switch(e.tag){case"CustomDecoder":return"t.decoder("+JSON.stringify(e.name)+", <func>)";case"ArrayDecoder":return"t.arrray("+e.decoder.prettyPrint()+")";case"DictionaryDecoder":return"t.dict("+e.decoder.prettyPrint()+")";case"RecordDecoder":return"t.record({ "+Object.keys(e.description).map(function(t){return e.description[t].prettyPrint()}).join(", ")+" })";case"AtDecoder":return"t.at("+JSON.stringify(e.path)+", "+e.decoder.prettyPrint()+")";case"PrimitiveDecoder":return"t."+e.primitive;case"PureDecoder":return"t.of("+JSON.stringify(e.value)+")";case"ChainDecoder":return"t.chain("+e.prettyPrint()+", <func>)";case"OneOfDecoder":return"t.oneOf("+e.alternatives.map(function(e){return e.prettyPrint()}).join(", ")+")"}},e.prototype.validate=function(t,n){var r,i=!1;e.path.push(this),void 0===e.rootValue&&(e.rootValue=t,i=!0);var s=function(e,t){switch(e.tag){case"CustomDecoder":return e.validateCustom(t).mapLeft(l);case"ArrayDecoder":return e.validateArray(t).mapLeft(l);case"DictionaryDecoder":return e.validateDictionary(t).mapLeft(l);case"RecordDecoder":return e.validateRecord(t).mapLeft(l);case"AtDecoder":return e.validateAt(t).mapLeft(l);case"PrimitiveDecoder":return e.validatePrimitive(t).mapLeft(l);case"PureDecoder":return e.value.mapLeft(l);case"OneOfDecoder":return e.validateOneOf(t).mapLeft(l);case"ChainDecoder":return e.andThen(e.decoder.validate(t)).validate(t)}}(this,t);return e.path.pop(),i&&(e.rootValue=void 0),"Left"===s.tag&&(r||(r=n?o({},a,n):a)).printProblem&&R(s.value),s;function l(n){return"string"==typeof n?{value:t,rootValue:e.rootValue,decoders:e.path.slice(),message:n,path:[],extra:{}}:n}},e.prototype.map=function(e){return new m(this,function(t){return t.fold(_,function(t){return y(e(t))})})},e.prototype.chain=function(e){return new m(this,function(t){return t.fold(_,e)})},e.prototype.mapProblem=function(e){return new m(this,function(t){return t.fold(e,function(e){return e})})},e.prototype.withDefault=function(e){return new g([this,y(e)])},e.prototype.refine=function(e){return new m(this,function(t){switch(t.tag){case"Left":return new h(t);case"Right":return e(t.value)?new h(t):_("refinement failed")}})},e.path=[],e.rootValue=void 0,e}();t.DecoderBase=s;var l=function(e){function t(t,n){var r=e.call(this)||this;return r.name=t,r.validateCustom=n,r.tag="CustomDecoder",r}return r(t,e),t}(s);t.CustomDecoder=l;var u=function(e){function t(t){var n=e.call(this)||this;return n.decoder=t,n.tag="ArrayDecoder",n}return r(t,e),t.prototype.validateArray=function(e){var t=[];if(!Array.isArray(e))return i.failure("not an array");for(var n=0;n<e.length;n++){var r=this.decoder.validate(e[n]);switch(r.tag){case"Left":return r.value.path.push(n),r;case"Right":t.push(r.value)}}return i.success(t)},t}(s);t.ArrayDecoder=u;var c=function(e){function t(t){var n=e.call(this)||this;return n.decoder=t,n.tag="DictionaryDecoder",n}return r(t,e),t.prototype.validateDictionary=function(e){if(null===e)return i.failure("found null");if("object"!=typeof e)return i.failure("not an object");var t={};for(var n in e)if(e.hasOwnProperty(n)){var r=this.decoder.validate(e[n]);switch(r.tag){case"Left":return r.value.path.push(n),r;case"Right":t[n]=r.value}}return i.success(t)},t}(s);t.DictionaryDecoder=c;var d=function(e){function t(t){var n=e.call(this)||this;return n.description=t,n.tag="RecordDecoder",n}return r(t,e),t.prototype.validateRecord=function(e){if(null===e)return i.failure("found null");if("object"!=typeof e)return i.failure("not an object");var t={};for(var n in this.description)if(this.description.hasOwnProperty(n)){var r=this.description[n].validate(e[n]);switch(r.tag){case"Left":return r.value.path.push(n),r;case"Right":t[n]=r.value}}return i.success(t)},t}(s);t.RecordDecoder=d;var p=function(e){function t(t,n){var r=e.call(this)||this;return r.path=t,r.decoder=n,r.tag="AtDecoder",r}return r(t,e),t.prototype.validateAt=function(e){var t=e;for(var n in this.path){if(void 0===t||!t.hasOwnProperty(this.path[n])){t=void 0;break}t=t[this.path[n]]}return this.decoder.validate(t)},t}(s);t.AtDecoder=p;var f=function(e){function t(t){var n=e.call(this)||this;return n.primitive=t,n.tag="PrimitiveDecoder",n}return r(t,e),t.prototype.validatePrimitive=function(e){switch(this.primitive){case"null":return null===e?i.success(e):i.failure("expected null, got "+I(e));case"undefined":return void 0===e?i.success(e):i.failure("expected undefined, got "+I(e));case"string":return"string"==typeof e?i.success(e):i.failure("expected a string, got "+I(e));case"boolean":return"boolean"==typeof e?i.success(e):i.failure("expected a boolean, got "+I(e));case"any":return i.success(e);case"nat":return"number"!=typeof e?i.failure("not a number"):(0|e)===e&&e>=0?i.success(e):i.failure("not a natural number");case"int":return"number"!=typeof e?i.failure("not a number"):(0|e)===e?i.success(e):i.failure("not an integer");case"float":return"number"!=typeof e?i.failure("not a number"):i.success(e)}},t}(s);t.PrimitiveDecoder=f;var h=function(e){function t(t){var n=e.call(this)||this;return n.value=t,n.tag="PureDecoder",n}return r(t,e),t}(s);t.PureDecoder=h;var m=function(e){function t(t,n){var r=e.call(this)||this;return r.decoder=t,r.andThen=n,r.tag="ChainDecoder",r}return r(t,e),t}(s);t.ChainDecoder=m;var g=function(e){function t(t){var n=e.call(this)||this;return n.alternatives=t,n.tag="OneOfDecoder",n}return r(t,e),t.prototype.validateOneOf=function(e){for(var t=0,n=this.alternatives;t<n.length;t++){var r=n[t].validate(e);switch(r.tag){case"Left":break;case"Right":return r}}return i.failure("none of decoders succeded")},t}(s);function v(){if(1===arguments.length)return new l("custom",arguments[0]);if(2===arguments.length)return new l(arguments[0],arguments[1]);throw new TypeError("decoder: invalid number of arguments")}function y(e){return new h(i.success(e))}function _(e){return new h(i.failure(e))}function b(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return v("ap",function(t){for(var n=e[e.length-1],r=[],o=0;o<e.length-1;o++){var a=e[o].validate(t);switch(a.tag){case"Left":return a;case"Right":r.push(a.value)}}return i.success(n.apply(void 0,r))})}t.OneOfDecoder=g,t.decoder=v,t.of=y,t.fail=_,t.ap=b;var C=new f("any");t.any=C;var w=new f("string");t.string=w;var E=new f("boolean");t.boolean=E;var S=new f("null");t.null=S;var T=new f("undefined");function O(e){return new u(e)}function A(e){return new d(e)}function x(e,t){return new p(Array.isArray(e)?e:[e],t)}function k(e,t){return x(e,t)}function R(e){var t=e.decoders[e.decoders.length-1];console.log("%cValidation error: "+e.message,"color: #f00; font-size: 16px; font-weight: 600;"),console.log("%cfailed decoder:","font-weight: 600;",t.prettyPrint()),console.log("%cfailed value:","font-weight: 600;",e.value),console.log("%croot value:","font-weight: 600;",e.rootValue),console.log("%cproblem path:","font-weight: 600;",function(e){for(var t="_",n=e.length-1;n>=0;n--)/^[a-zA-Z_$][\w_$]*$/.test(""+e[n])?t+="."+e[n]:t+="["+JSON.stringify(e[n])+"]";return t}(e.path)),Object.keys(e.extra).length&&console.log("%cextra info:","font-weight: 600;",e.extra)}function I(e){return Object.prototype.toString.call(e)}t.undefined=T,t.nat=new f("nat"),t.int=new f("int"),t.float=new f("float"),t.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return new g(e)},t.array=O,t.record=A,t.record2=function(e){return new d(e)},t.record3=function(e){return new d(e)},t.d=O(A({a:O(A({b:A({c:w})}))})),t.dict=function(e){return new c(e)},t.at=x,t.date=v("date",function(e){if("string"!=typeof e)return i.failure("not a string");var t=new Date(e);return isNaN(t.getTime())?i.failure("error parsing date from string"):i.success(t)}),t.required=k,t.optional=function(e,t,n){return k(e,t).withDefault(n)},t.literals=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return v("literals",function(t){return-1!==e.indexOf(t)?i.success(t):i.failure("expected one of this literals "+JSON.stringify(e)+", got "+t)})},t.discriminateOn=function(e,t){return v("discriminateOn",function(n){return"object"==typeof n&&n?n.hasOwnProperty(e)?n[e]in t?t[n[e]].validate(n).map(function(t){var r;return o({},t,((r={})[e]=n[e],r))}):i.failure("unknown value of discriminated key "+n[e]):i.failure("expected input would have key '"+e+"'"):i.failure("expected an object")})},t.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return b.apply(void 0,e.map(function(e,t){return x(t,e)}).concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}]))},t.printProblems=R},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(179),o=n(106),i=n(106),a=n(721);function s(e){return i.of(r.success(e))}function l(){var e=arguments;return i.combineLatest(Array.apply(void 0,Array(arguments.length-1)).map(function(t,n){return e[n]}),function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.traverse(t,function(e){return e}).map(function(t){return e[e.length-1].apply(void 0,t)})})}o.Observable.prototype.map=function(e){return this.pipe(a.map(function(t){return t.map(e)}))},o.Observable.prototype.mapE=function(e){return this.pipe(a.map(e))},o.Observable.prototype.mapTo=function(e){return this.pipe(a.map(function(t){return t.map(function(){return e})}))},o.Observable.prototype.mapError=function(e){return this.pipe(a.map(function(t){return t.mapLeft(e)}))},o.Observable.prototype.mapErrorTo=function(e){return this.pipe(a.map(function(t){return t.mapLeft(function(){return e})}))},o.Observable.prototype.onError=function(e){return this.pipe(a.map(function(t){return"Left"===t.tag?e(t.value):i.of(t)}),a.combineAll(function(e){return e}))},o.Observable.prototype.chain=function(e){return this.pipe(a.map(function(t){return"Right"===t.tag?e(t.value):i.of(t)}),a.combineAll(function(e){return e}))},o.Observable.prototype.chainE=function(e){return this.pipe(a.map(e),a.combineAll(function(e){return e}))},o.Observable.prototype.chainTo=function(e){return this.pipe(a.map(function(t){return"Right"===t.tag?e:i.of(t)}),a.combineAll(function(e){return e}))},o.Observable.prototype.perform=function(e,t){return this.pipe(a.map(function(n){return r.success(n.fold(e,t))}))},o.Observable.prototype.performMaybe=function(e,t){return this.pipe(a.map(function(n){var o=n.fold(e,t);switch(o.tag){case"None":return i.NEVER;case"Some":return i.of(r.success(o.value))}}),a.combineAll(function(e){return e}))},o.Observable.prototype.performForget=function(){return this.pipe(a.map(function(e){return i.NEVER}),a.combineAll(function(e){return e}))},o.Observable.prototype.chainEff=o.Observable.prototype.chain,o.Observable.prototype.mapEff=o.Observable.prototype.map,o.Observable.prototype.mapCmd=o.Observable.prototype.map,t.failure=function(e){return i.of(r.failure(e))},t.success=s,t.of=s,t.callback=function(e){return o.Observable.create(function(t){return e(),t.next(r.success(null)),void t.complete()})},t.fromCallback=function(e){return o.Observable.create(function(t){e(function(e){return t.next(e),t.complete()})})},t.promise=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return o.Observable.create(function(n){e.apply(void 0,t).then(function(e){return n.next(e),n.complete()}).catch(function(e){return n.error(e),n.complete()})})},t.lazy=function(){var e=arguments;return o.Observable.create(function(t){var n=e[0].apply(void 0,Array(e.length-1).map(function(t,n){return e[n+1]}));t.next(n),t.complete()})},t.ap=l,t.record=function(e){var t=Object.keys(e);return l.apply(void 0,t.map(function(t){return e[t]}).concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.reduce(function(e,n,r){return e[t[r]]=n,e},{})}]))},t.traverse=function(e,t){return 0===e.length?s([]):l.apply(void 0,e.map(t).concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}]))},t.batch=function(){var e=Array.isArray(arguments[0])?arguments[0]:arguments;return i.merge.apply(void 0,e)},t.concat=function(){var e=Array.isArray(arguments[0])?arguments[0]:arguments;return i.concat.apply(void 0,e)},t.noop=new i.Observable(function(e){return e.complete()}),t.forget=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return o.Observable.create(function(n){return e.apply(void 0,t),n.complete()})}},,function(e,t){var n=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.map=function(e){switch(this.tag){case"None":return this;case"Some":return new i(e(this.value))}},e.prototype.chain=function(e){switch(this.tag){case"None":return this;case"Some":return e(this.value)}},e.prototype.unwrap=function(e,t){switch(this.tag){case"None":return e;case"Some":return t(this.value)}},e.prototype.maybe=function(e,t){return this.unwrap(e,t)},e.prototype.withDefault=function(e){return this.maybe(e,function(e){return e})},e}();t.OptionBase=r;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tag="None",t}return n(t,e),t}(r);t.None=o;var i=function(e){function t(t){var n=e.call(this)||this;return n.value=t,n.tag="Some",n}return n(t,e),t}(r);function a(e){return new i(e)}t.Some=i,t.traverse=function(e,t){for(var n=[],r=0;r<e.length;r++){var o=t(e[r],r);switch(o.tag){case"None":return o;case"Some":n.push(o.value)}}return new i(n)},t.none=new o,t.some=a,t.of=a},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(730),a=n(352),s={printProblem:!1},l=function(){function e(){}return e.prototype.prettyPrint=function(){return M(this)},e.prototype.validate=function(t,n){var r;(void 0===e.rootValue?(e.rootValue=t,e.rootDecoder=this,r=L(this,t),e.rootValue=void 0,e.rootDecoder=void 0):r=L(this,t),"Left"===r.tag)&&(o({},s,n).printProblem&&P(r.value));return r},e.prototype.map=function(e){return new g(this,function(t){return t.fold(S,function(t){return E(e(t))})})},e.prototype.mapTo=function(e){return new g(this,function(t){return t.fold(S,function(){return E(e)})})},e.prototype.chain=function(e){return new g(this,function(t){return t.fold(S,e)})},e.prototype.chainTo=function(e){return new g(this,function(t){return t.fold(S,function(){return e})})},e.prototype.mapProblem=function(e){return new g(this,function(t){return t.fold(e,function(e){return e})})},e.prototype.mapProblemTo=function(e){return new g(this,function(t){return t.fold(function(){return e},function(e){return e})})},e.prototype.withDefault=function(e){return new b(this,e)},e.prototype.refine=function(e){return new g(this,function(t){switch(t.tag){case"Left":return new m(t);case"Right":return e(t.value)?new m(t):S("refinement failed")}})},e.rootDecoder=void 0,e.rootValue=void 0,e.path=[],e}();t.DecoderBase=l;var u=function(e){function t(t,n){var r=e.call(this)||this;return r._name=t,r._validate=n,r}return r(t,e),t}(l);t.Custom=u;var c=function(e){function t(t){var n=e.call(this)||this;return n._decoder=t,n}return r(t,e),t}(l);t.ArrayDecoder=c;var d=function(e){function t(t){var n=e.call(this)||this;return n._decoder=t,n}return r(t,e),t}(l);t.Dict=d;var p=function(e){function t(t){var n=e.call(this)||this;return n._description=t,n}return r(t,e),t.prototype.extend=function(e){return new t(o({},this._description,e))},t.prototype.pick=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new t(n.reduce(function(t,n){return t[n]=e._description[n],t},{}))},t.prototype.omit=function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new t(Object.keys(this._description).reduce(function(t,r){return-1===n.indexOf(r)&&(t[r]=e._description[r]),t},{}))},t}(l);t.RecordDecoder=p;var f=function(e){function t(t,n){var r=e.call(this)||this;return r._path=t,r._decoder=n,r.tag="AtDecoder",r}return r(t,e),t}(l);t.AtDecoder=f;var h=function(e){function t(t){var n=e.call(this)||this;return n._type=t,n.tag="PrimitiveDecoder",n}return r(t,e),t}(l);t.Primitive=h;var m=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r(t,e),t}(l);t.Pure=m;var g=function(e){function t(t,n){var r=e.call(this)||this;return r._decoder=t,r._then=n,r}return r(t,e),t}(l);t.Chain=g;var v=function(e){function t(t){var n=e.call(this)||this;return n._alternatives=t,n}return r(t,e),t}(l);t.OneOf=v;var y=function(e){function t(t,n){var r=e.call(this)||this;return r._discriminator=t,r._alternatives=n,r}return r(t,e),t}(l);t.Discriminate=y;var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(l);t.ToDecoder=_;var b=function(e){function t(t,n){var r=e.call(this)||this;return r._decoder=t,r._default=n,r}return r(t,e),t.prototype.toDecoder=function(){return new v([this._decoder,E(this._default)])},t}(_);t.WithDefault=b;var C=function(e){function t(t){var n=e.call(this)||this;return n._variants=t,n}return r(t,e),t.prototype.toDecoder=function(){return new v(this._variants.map(function(e){return w(function(t){return t===e?i.Either.of(t):i.Either.failure("expected "+e+", got "+j(t))})}))},t}(_);function w(){if(1===arguments.length)return new u("custom",arguments[0]);if(2===arguments.length)return new u(arguments[0],arguments[1]);throw new TypeError("decoder: invalid number of arguments")}function E(e){return new m(i.Either.of(e))}function S(e){return new m(i.Either.failure(e))}function T(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return w("ap",function(t){for(var n=e[e.length-1],r=[],o=0;o<e.length-1;o++){var a=e[o].validate(t);switch(a.tag){case"Left":return a;case"Right":r.push(a.value)}}return i.Either.of(n.apply(void 0,r))})}t.Variants=C,t.decoder=w,t.of=E,t.fail=S,t.ap=T;var O=new h("any");t.any=O;var A=new h("string");t.string=A;var x=new h("boolean");t.boolean=x;var k=new h("null");t.null=k;var R=new h("undefined");function I(e,t){return new f(Array.isArray(e)?e:[e],t)}function D(e,t){return I(e,t)}function N(){return new C(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))}function P(e){console.log("%cValidation error: "+e.message,"color: #f00; font-size: 16px; font-weight: 600;"),console.log("%cfailed decoder:","font-weight: 600;",e.decoder.prettyPrint()),console.log("%croot decoder:","font-weight: 600;",e.rootDecoder.prettyPrint()),console.log("%cfailed value:","font-weight: 600;",e.value),console.log("%croot value:","font-weight: 600;",e.rootValue),console.log("%cproblem path:","font-weight: 600;",["_"].concat(e.path).join("."))}function j(e){return Object.prototype.toString.call(e)}function L(e,t){var n=l.path.length,r=function(){return l.path.splice(n)};if(e instanceof u){l.path.push("<custom>");var s=e._validate(t).mapLeft(x);return r(),s}if(e instanceof c){s=[];if(!Array.isArray(t))return i.Either.failure(x("not an array"));l.path.push("0");for(var b=0;b<t.length;b++){switch(l.path[l.path.length-1]=String(b),(T=L(e._decoder,t[b])).tag){case"Left":return T;case"Right":s.push(T.value)}}return r(),i.Either.of(s)}if(e instanceof d){if("object"!=typeof t)return i.Either.failure(x("not an object"));if(null===t)return i.Either.failure(x("found null"));s={};for(var C in l.path.push(""),t){if(t.hasOwnProperty(C))switch(l.path[l.path.length-1]=C,(T=L(e._decoder,t[C])).tag){case"Left":return T;case"Right":s[C]=T.value}}return r(),i.Either.of(s)}if(e instanceof p){if("object"!=typeof t)return i.Either.failure(x("not an object"));if(null===t)return i.Either.failure(x("found null"));s={};for(var C in l.path.push(""),e._description){if(l.path[l.path.length-1]=C,e._description.hasOwnProperty(C))switch((T=L(e._description[C],t[C])).tag){case"Left":return T;case"Right":s[C]=T.value}}return r(),i.Either.of(s)}if(e instanceof f){var w=t;for(var b in e._path.forEach(function(e){return l.path.push(e+"")}),e._path){if(void 0===w||!w.hasOwnProperty(e._path[b])){w=void 0;break}w=w[e._path[b]]}return r(),L(e._decoder,w)}if(e instanceof h){switch(e._type){case"null":return null===t?i.Either.of(t):i.Either.failure(x("expected null, got "+j(t)));case"undefined":return void 0===t?i.Either.of(t):i.Either.failure(x("expected undefined, got "+j(t)));case"string":return"string"==typeof t?i.Either.of(t):i.Either.failure(x("expected a string, got "+j(t)));case"boolean":return"boolean"==typeof t?i.Either.of(t):i.Either.failure(x("expected a boolean, got "+j(t)));case"any":return i.Either.of(t);case"nat":return"number"!=typeof t?i.Either.failure(x("not a number")):(0|t)===t&&t>=0?i.Either.of(t):i.Either.failure(x("not a natural number"));case"int":return"number"!=typeof t?i.Either.failure(x("not a number")):(0|t)===t?i.Either.of(t):i.Either.failure(x("not an integer"));case"float":return"number"!=typeof t?i.Either.failure(x("not a number")):i.Either.of(t)}return a.absurd(e._type)}if(e instanceof m)return e._value.mapLeft(x);if(e instanceof v){for(var E=0,S=e._alternatives;E<S.length;E++){var T;switch((T=L(S[E],t)).tag){case"Left":break;case"Right":return T}}return i.Either.failure(x("none of decoders succeded"))}if(e instanceof g){l.path.push("<chain>");s=L(e._then(L(e._decoder,t)),t);return r(),s}if(e instanceof y){var O=e._discriminator,A=e._alternatives;if("object"!=typeof t||!t)return i.Either.failure(x("expected an object"));if(!t.hasOwnProperty(O))return i.Either.failure(x("expected input would have key '"+O+"'"));if(!(t[O]in A))return i.Either.failure(x("unknown value of discriminated key "+t[O]));s=A[t[O]].validate(t).map(function(e){var n;return o({},e,((n={})[O]=t[O],n))});return r(),s}return e instanceof _?L(e.toDecoder(),t):a.absurd(e);function x(n){return"string"!=typeof n?n:{value:t,rootValue:l.rootValue,decoder:e,rootDecoder:l.rootDecoder||e,message:n,path:l.path}}}function M(e){if(e instanceof u)return"t.decoder("+JSON.stringify(e._name)+", <func>)";if(e instanceof c)return"t.array("+e._decoder.prettyPrint()+")";if(e instanceof d)return"t.dict("+e._decoder.prettyPrint()+")";if(e instanceof p)return"t.record({ "+Object.keys(e._description).map(function(t){return e._description[t].prettyPrint()}).join(", ")+" })";if(e instanceof f)return"t.at("+JSON.stringify(e._path)+", "+e._decoder.prettyPrint()+")";if(e instanceof h)return"t."+e._type;if(e instanceof m)return"t.of("+JSON.stringify(e._value)+")";if(e instanceof g)return e.prettyPrint()+".chain(<func>)";if(e instanceof v)return"t.oneOf("+e._alternatives.map(function(e){return e.prettyPrint()}).join(", ")+")";if(e instanceof C)return"t.literals("+e._variants.map(function(e){return JSON.stringify(e)}).join(", ")+")";if(e instanceof y){var t=JSON.stringify(e._discriminator),n=Object.keys(e._alternatives).map(function(t){return JSON.stringify(t)+": "+e._alternatives[t].prettyPrint()}).join(", ");return"t.discriminateOn("+JSON.stringify(t)+", "+n+")"}return e instanceof _?M(e.toDecoder()):a.absurd(e)}t.undefined=R,t.nat=new h("nat"),t.int=new h("int"),t.float=new h("float"),t.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return new v(e)},t.array=function(e){return new c(e)},t.record=function(e){return new p(e)},t.dict=function(e){return new d(e)},t.at=I,t.date=w("date",function(e){if("string"!=typeof e)return i.Either.failure("not a string");var t=new Date(e);return isNaN(t.getTime())?i.Either.failure("error parsing date from string"):i.Either.of(t)}),t.required=D,t.discriminate=function(e,t){return new y(e,t)},t.optional=function(e,t,n){return D(e,t).withDefault(n)},t.variants=N,t.literals=N,t.tuple=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return T.apply(void 0,e.map(function(e,t){return I(t,e)}).concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}]))},t.printProblems=P,t.doValidate=L,t.prettyPrint=M},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(731),i=function(){function e(e,t,n){void 0===n&&(n={}),this.name=e,this.decoder=t,this.options=n}return e.prototype.saveSync=function(e){try{var t=Date.now(),n=Date.now(),i=this.options.version||null,a=JSON.stringify({updatedAt:t,createdAt:n,version:i,payload:e});if(this.options.key){var s=new o.ModeOfOperation.ctr(this.options.key),l=o.utils.utf8.toBytes(a);a=o.utils.hex.fromBytes(s.encrypt(l))}localStorage.setItem(this.name,a)}catch(e){return r.failure({tag:"SizeLimitExeeded"})}return r.success(null)},e.prototype.save=function(e){var t=this;return r.eff.lazy(function(){return t.saveSync(e)})},e.prototype.readSync=function(){var e=this,t=localStorage.getItem(this.name);if(this.options.key&&null!==t){var n=new o.ModeOfOperation.ctr(this.options.key),i=o.utils.hex.toBytes(t);t=o.utils.utf8.fromBytes(n.decrypt(i))}if(null===t)return r.failure({tag:"NoItem"});try{var s=JSON.parse(t);return a(this.decoder).validate(s).mapLeft(function(e){return{tag:"InvalidPayload",problem:e}}).chain(function(t){var n=t.payload,o=t.version;return e.options.version&&o!=o?r.failure({tag:"VersionMismatch",expected:e.options.version,actual:o}):r.success(n)})}catch(e){return r.failure({tag:"InvalidPayload",problem:e.message})}},e.prototype.read=function(){var e=this;return r.eff.lazy(function(){return e.readSync()})},e.prototype.clearSync=function(){localStorage.removeItem(this.name)},e.prototype.clear=function(){var e=this;return r.eff.lazy(function(){return e.clearSync(),r.success(null)})},e.prototype.modifySync=function(e){var t=this.readSync();return"Left"===t.tag?t:this.saveSync(e(t.value))},e.prototype.modify=function(e){var t=this;return r.eff.lazy(function(){return t.modifySync(e)})},e}();t.Cache=i;var a=function(e){return r.decode.record({createdAt:r.decode.float,updatedAt:r.decode.float,version:r.decode.oneOf(r.decode.string,r.decode.null),payload:e})}},,,,,,,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(166),i=n(44);t.defaultQuery={offset:0,limit:10,sort:[],search:""},t.resource=o.crud("cars",{collectionParams:function(e){return{"page[offset]":e.offset||null,"page[limit]":e.limit||null,sort:e.sort.length?e.sort.join(","):null,"filter[text]":e.search||null}},defaultQuery:t.defaultQuery},{brand:r.decode.string,color:r.decode.string,plate:r.decode.string,attributes:o.resource("attributes",{name:r.decode.string}).many().withDefault([])}),t.blank={id:"",type:"cars",brand:"",color:"",plate:"",attributes:[]},t.getColors=function(e){return i.apiRequest(e,r.decode.at("data",r.decode.array(r.decode.string)),{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/car_colors")})},t.getBrands=function(e){return i.apiRequest(e,r.decode.at("data",r.decode.array(r.decode.string)),{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/car_brands")})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(166);t.resource=o.crud("attributes",{name:r.decode.string,scopes:r.decode.array(r.decode.string),order_access_control:r.decode.boolean.withDefault(!1)}),t.hasScope=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){for(var n=0,r=e;n<r.length;n++)for(var o=r[n],i=0,a=t.scopes;i<a.length;i++){if(o===a[i])return!0}return!1}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(50),l=n(382),u=n(8),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={anchor:null},t.handleMenuToggle=function(e){e.stopPropagation(),t.setState({anchor:t.state.anchor?null:e.currentTarget})},t.handleItemClick=s.memoize(function(e){return function(n){n.stopPropagation();var r=t.props.onItemSelect;r&&r(e),t.setState({anchor:null})}}),t}return r(t,e),t.prototype.renderItems=function(){var e=this,t=this.props,n=t.items,r=t.renderItem,i=t.renderItemProps;return n.map(function(t){return a.cloneElement(r(o({},i,{item:t})),{onClick:e.handleItemClick(t)})})},t.prototype.render=function(){var e=this.props,t=e.children,n=(e.items,e.onSelect,e.classes,e.renderItemProps,i(e,["children","items","onSelect","classes","renderItemProps"])),r=this.state.anchor;return a.createElement(a.Fragment,null,a.cloneElement(t,{onClick:this.handleMenuToggle}),a.createElement(l.default,o({},n,{open:null!==r,anchorEl:r||void 0,onClose:this.handleMenuToggle}),null!==r&&this.renderItems()))},t}(a.Component);function d(e){return{}}t.default=function(e){var t=u.default(d)(c);return function(n){return a.createElement(t,o({},n,{renderItem:e}))}},t.styles=d},,,,,,,,function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(244),i=n(50);t.default=function(e){function t(e,t){return i.isEqual(e.initial,t)?r({},e,{modified:null}):r({},e,{modified:t})}function n(e){return e.modified||e.initial}return r({},e,{createZoom:function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=t.props,i=o.dispatch,l=o.ctx,u=t.props.model.modified||t.props.model.initial,c=e.validate?e.validate(u,t):{},d=e.disabled?e.disabled(u,t):{},p=s(n,c);return{ctx:l,value:s(n,u),error:"function"==typeof p&&l?p(l):p,disabled:s(n,d),onValueChange:a(n,function(e,t){return void 0===t&&(t=[]),i({tag:"Change",value:e,at:t})})}}},set:t,get:n,modify:function(e,r){return t(e,r(n(e)))}})};var a=o.default(function(e,t){return function(n,r){void 0===r&&(r=[]),t&&t(n,e.concat(r))}}),s=o.default(function(e,t){for(var n=t,r=0,o=e;r<o.length;r++){var i=o[r];if("object"!=typeof n||null===n)return n;n=n[i]}return n})},,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(36),s=n(272),l=n(50),u=n(44),c=n(8),d=n(48),p=n(44),f=n(144),h=n(207),m=n(187),g=n(296),v=n(249),y=n(642),_=n(369),b=n(1109),C=n(1110),w=n(1111),E=n(99),S=n(1112),T=n(1113),O=n(1114),A=n(1116),x=n(1117),k=n(1118),R=n(1123),I=n(9),D=n(406),N=n(308),P=n(214),j=n(184),L=n(106),M=n(132),U=n(27),F=n(1124),q=n(305),B=n(689),H=U.Translations.fromPO(n(213),n(246),n(81));function V(e){return z(e,o({},f.blank,{created:I(),addresses:[{address:"",city:"",coordinates:null,uuid:p.nextUUID()},{address:"",city:"",coordinates:null,uuid:p.nextUUID()}]}),!0)}function z(e,t,n){return a.eff.ap(v.resource.getCollection(e),g.resource.getCollection(e).mapEff(function(e){return e.filter(g.hasScope("order"))}),y.resource.getCollection(e),w.getCollection(e),h.getCollection(e).mapEff(function(e){return e.filter(function(e){return!e.forbid_manual_set})}),function(e,r,i,a,s){var l=n&&te(t,e)||t.crew_group,u=o({},t,{cost:o({},t.cost),crew_group:l,route:[],prior_route:[],send_cost:!0});return u.cost.total=u.cost.total||u.cost.sum,u.client&&u.client.use_cashless_by_default&&(u.cost.use_max_cashless=!0),{initial:u,modified:null,pending:!1,attributes:r,crewGroups:e,tariffs:i,cities:a,clientCandidate:null,states:s}})}function G(e,n){return!0!==t.form.disabled(n.model.initial,{props:{ctx:e}})&&l.isEmpty(t.form.validate(t.form.get(n.model),{props:n}))?""===n.model.initial.id?{tag:"Post"}:{tag:"Patch"}:null}function W(e,t){for(var n in t)if(t[n].order_access_control){var r=!1;for(var o in e.attributes)if(t[n].id===e.attributes[o].id){r=!0;break}if(!r)return!1}return!0}t.init=function(e,t){return f.primary.getPrimary(e,t).chainEff(function(t){return z(e,t,!1)})},t.initNew=V,t.initFromUrl=function(e,t){return _.phoneInfo(e,t).chain(function(t){return V(e).chain(X(e,B.applyUrlParameters(t)))})},t.initFromCall=function(e,t){return V(e).chain(Z(e,function(e){return function(n){var r=t.phone,i=e.crewGroups.find(function(e){return e.id==t.crewGroup})||n.crew_group,a=t.attributes,s=n.addresses.map(function(e){return o({},e,{city:t.city})});return(n=o({},n,{addresses:s,crew_group:i,route:[],prior_route:[]})).phone=r.phone,n.server_time_offset=i?i.server_time_offset:0,r.client&&(n.client=r.client,n.phone=r.phone,a=l.union(a,r.client.attributes.map(function(e){return e.id})),n.client_employee=r.client_employee),n.attributes=e.attributes.filter(function(e){return void 0!==a.find(function(t){return e.id==t})}),n}}))},t.update=N.compose(function(e){return function(t,n,r){var o=e(t,n,r);return o}},function(e){return function(t,n,r){switch(n.tag){case"Reset":return[o({},r,{modified:null}),a.noop];default:return e(t,n,r)}}},function(e){return function(n,r,i){var a=e(n,r,i),s=a[0],l=a[1],u=[i,s].map(t.form.get),c=u[0],d=u[1];if(c.client!==d.client||c.client_employee!==d.client_employee){var p=ee(s);if(!d.crew_group||d.crew_group&&-1===p.indexOf(d.crew_group.id))return[t.form.modify(s,function(e){return o({},e,{crew_group:te(d,s.crewGroups),driver:null})}),l]}return a}},function(e){return function(n,r,i){var s=e(n,r,i),u=s[0],c=s[1],d=[i,u].map(t.form.get),p=d[0],f=d[1];if("Routes/success"===r.tag)return s;if(p===f)return s;if(p.client!==f.client)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!1}))];if(p.crew_group!==f.crew_group)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!1}))];if(p.picked_up!==f.picked_up)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!1}))];if(p.driver!==f.driver)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!0}))];if(p.attributes!==f.attributes)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!0}))];if(p.distances!==f.distances)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!0}))];if(p.prior_route!==f.prior_route)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!0}))];if(p.hourly_order!==f.hourly_order)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!0}))];if("old"===n.goBackBehaviour&&p.go_back!==f.go_back)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!0}))];if(p.tariff!==f.tariff){var h=l.isEqual(p.tariff,f.tariff)||!f.tariff?p.hourly_order:f.tariff.hourly_order,m=o({},f,{hourly_order:h}),g=t.form.set(u,m);return"Cost/update/success"===r.tag?[g,a.noop]:[g,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!1,withTariff:!0}))]}if("Change"===r.tag){var v=(Array.isArray(r.at)?r.at:[r.at])[0];if("cost"===v&&p.cost.sum!==f.cost.sum)return[u,a.cmd.batch(c,a.cmd.of({tag:"Cost/update",order:f,withSum:!0,withTariff:!0}))]}return s}},function(e){return function(n,r,i){var a=e(n,r,i),s=a[0],l=a[1],u=[i,s].map(t.form.get),c=u[0],d=u[1];return c.driver===d.driver?a:[t.form.modify(s,function(e){return o({},e,{crew_group:d.driver?d.crew_group:e.crew_group})}),l]}},function(e){return function(r,i,l){var u=e(r,i,l),c=u[0],d=u[1],h=[l,c].map(t.form.get),m=h[0],g=h[1];if(m===g)return u;var v=[d];if(m.phone!==g.phone){g.phone&&v.push(_.phoneInfo(r,g.phone).performMaybe(function(){return s.none},function(e){return s.some({tag:"Phone/search/success",info:e})})),c=t.form.modify(c,function(e){return o({},e,{client:null})})}if(m.client!==g.client){c=o({},t.form.modify(c,function(e){var t=e.client,n=e.cost;t&&t.use_cashless_by_default&&(n=o({},n,{use_max_cashless:!0}),S.mutateCost(n,t));var r=e.client_employee&&t&&t.client_employees.find(function(t){return t.id==e.client_employee.id})||null,i=c.attributes.filter(function(n){return void 0!==e.attributes.find(function(e){return e.id==n.id})||t&&void 0!==t.attributes.find(function(e){return e.id==n.id})});return o({},e,t?{cost:n,client_employee:r,attributes:i}:{cost:n,client_employee:null})})),g.client&&g.client!==c.clientCandidate&&(c.clientCandidate=null)}if(m.client_employee!==g.client_employee&&(c=t.form.modify(c,function(e){return o({},e,{customer:g.client_employee?g.client_employee.name:null})})),m.crew_group!==g.crew_group){var y=g.crew_group&&g.driver&&g.driver.crew_group&&g.driver.crew_group.id===g.crew_group.id?g.driver:null,b=m.crew_group?m.crew_group.server_time_offset:0,C=g.crew_group?g.crew_group.server_time_offset:0,w=C-b,E=0===w?g.picked_up:g.picked_up?g.picked_up.clone().add(-w,"hours"):g.picked_up,T=g.crew_group?g.crew_group.server_time_offset:0;c=t.form.modify(c,function(e){return o({},e,{driver:y,picked_up:E,server_time_offset:T})})}if(m.attributes!==g.attributes&&g.driver&&!W(g.driver,g.attributes)&&(c=t.form.modify(c,function(e){return o({},e,{driver:null})})),m.picked_up!==g.picked_up&&r.tmSettings.make_advance_if_before_order_minutes>0)if(g.picked_up){var O=n(g.picked_up)-n(I()),A=O>=r.tmSettings.make_advance_if_before_order_minutes;c=t.form.modify(c,function(e){return o({},e,{is_advance:A})})}else c=t.form.modify(c,function(e){return o({},e,{is_advance:!1})});if(m.discount_card!==g.discount_card&&g.discount_card&&g.referral_code&&(c=t.form.modify(c,function(e){return o({},e,{referral_code:""})})),m.referral_code!==g.referral_code&&g.referral_code&&g.discount_card&&(c=t.form.modify(c,function(e){return o({},e,{discount_card:null})})),!f.addressCoordinatesEqual(m.addresses,g.addresses)){var x=g.addresses.reduce(function(e,t){return p.coordsEmpty(t.coordinates)?e:e+1},0);x<2?c=t.form.modify(c,function(e){return o({},e,{distances:{city:0,country:0,source_country:0},prior_route:[],route:[]})}):v.push(a.cmd.of({tag:"Distance/update"}))}return[c,a.cmd.batch(v)]};function n(e){return Math.floor(e.valueOf()/6e4)}})(function(e,n,r){var i=H.__;switch(n.tag){case"Pending":return[o({},r,{pending:n.pending}),a.noop];case"Routes":var s=function(e){return{tag:"Routes/success",routes:e}};return[r,f.routesResource.getPrimary(e,r.initial.id).perform(p.onFailure,s)];case"Routes/success":var u=r.initial;return[o({},r,{initial:o({},u,n.routes)}),a.noop];case"Post":s=function(){return{tag:"Post/success"}};var c=t.form.get(r),d=e.settings.extra_attributes.map(function(e){return{id:e,type:"attributes",name:"Extra attribute"}}),h=l.uniqBy(c.attributes.concat(d),"id"),m=o({},c,{attributes:h});return c.send_cost||delete m.cost,[r,p.pending(f.resource.postResource(e,m).perform(p.onFailure,s))];case"Post/success":return[r,E.notifySuccess(i("Item created"))];case"Patch":if(!r.modified)return[r,a.noop];var g=t.form.get(r),v=Object.keys(r.initial).reduce(function(e,t){return!l.isEqual(r.initial[t],g[t])&&(e[t]=g[t]),e},{});s=function(){return{tag:"Patch/success"}};return[r,p.pending(f.resource.patchResource(e,r.initial.id,v).perform(p.onFailure,s))];case"Patch/success":u=t.form.get(r);return[o({},r,{initial:u,modified:null}),E.notifySuccess(i("Item updated"))];case"Copy":c=t.form.get(r),s=function(){return{tag:"Copy/success"}};return[r,p.pending(f.copy(e,c).perform(p.onFailure,s))];case"Copy/success":return[r,E.notifySuccess(i("Order copied"))];case"Reset":return[o({},r,{modified:null}),a.noop];case"Commit":return[o({},r,{initial:r.modified||r.initial,modified:null}),a.noop];case"Change":return!0===t.form.disabled(r.initial,{props:{ctx:e}})?[r,a.noop]:[t.form.modify(r,p.updateAt(n.at,n.value)),a.noop];case"Modify":var y=n.modifier;return!0===t.form.disabled(r.initial,{props:{ctx:e}})?[r,a.noop]:[t.form.modify(r,y),a.noop];case"Phone/search/success":var _=n.info,w=_.client,T=_.client_employee;return!w||!w.password||r.initial.client&&r.initial.client.id===w.id?[t.form.modify(r,function(e){return o({},e,{client:w,client_employee:T})}),a.noop]:[o({},r,{clientCandidate:w}),a.noop];case"Distance/update":s=function(e){return{tag:"Distance/update/success",routes:e}};var O=(x=t.form.get(r)).addresses.map(function(e){return o({},e,{address:e.address||"Empty address"})});return[r,p.pending(b.post(e,{addresses:O}).perform(function(e){return{tag:"Distance/update/failure",error:e}},s))];case"Distance/update/success":y=function(e){return o({},e,{prior_route:n.routes.route,distances:n.routes.distances,route:[]})};return[t.form.modify(r,y),a.noop];case"Distance/update/failure":y=function(e){return o({},e,{prior_route:[],distances:{city:0,country:0,source_country:0},route:[]})};return[t.form.modify(r,y),a.noop];case"Cost/update":var A={addresses:n.order.addresses,attributes:n.order.attributes.map(function(e){return e.id}),distances:n.order.distances,picked_up:n.order.picked_up};n.order.tariff&&n.withTariff&&(A.tariff=n.order.tariff.id),n.order.driver&&(A.driver=n.order.driver.id),n.order.crew_group&&(A.crewGroup=n.order.crew_group.id),n.order.client&&(A.client=n.order.client.id),n.order.hourly_order&&(A.hourly_order=n.order.hourly_order),n.withSum&&n.order.cost.sum&&(A.sum=n.order.cost.sum),"old"===e.goBackBehaviour&&(A.go_back=n.order.go_back);s=function(e){return{tag:"Cost/update/success",value:e}};return[r,p.pending(C.getCosts(e,A).perform(p.onFailure,s))];case"Cost/update/success":y=function(e){var t=n.value,i=t.sum,a=t.total,s=null;n.value.tariff&&(s=r.tariffs.find(function(e){return e.id==n.value.tariff.id})||s);var l=o({},e.cost,{sum:i,total:a});return S.mutateCost(l,e.client||void 0),o({},e,{cost:l,tariff:s})};return[t.form.modify(r,y),a.noop];case"Coordinates/response":y=function(e){var t=e.addresses.map(function(e){var t=n.coordinates,r={latitude:t[0],longitude:t[1]};return e.uuid===n.addressUUID?o({},e,{coordinates:r}):e});return o({},e,{addresses:t})};return[t.form.modify(r,y),a.noop];case"Cost/sumChange":c=t.form.get(r);var x=o({},c,{cost:o({},c.cost,{sum:n.value})});return[t.form.set(r,c),a.cmd.of({tag:"Cost/update",order:x,withSum:!0,withTariff:!0})]}}),t.submitAction=G,t.driverSatisfies=W;var K=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.rootEl=null,n.zoom=t.form.createZoom(n),n.handleDriverOpen=function(){var e=n.props,r=e.dispatch,o=e.model,i=t.form.get(o).driver;i&&r({tag:"@Driver/open",id:i.id})},n.handleKeyDown=function(e){var t=n.props,r=t.ctx,o=t.dispatch;if(13===e.keyCode&&e.ctrlKey){var i=G(r,n.props);i&&o(i)}var a="123456789".indexOf(e.key||e.char||"x");e.altKey&&a>=0&&n.rootEl&&(e.preventDefault(),n.focusFormGroup(a))},n.handleCoordinatesRequest=function(e){(0,n.props.dispatch)({tag:"@Coordinates/request",addressUUID:e.uuid})},n.acSourceCrewGroups=u.memoize(function(e,t){return t.length?e.filter(function(e){return e.available_to_user&&-1!==t.indexOf(e.id)}):e.filter(function(e){return e.available_to_user})}),n.acSourceTariffs=u.memoize(function(e){return e}),n.acSourceDrivers=u.memoize(function(e,t,n){return{pageCollection:function(r,i){var a=e.map(function(e){return e.id}),s=t?t.id:null,l=n?null:"waiting";return m.collection.pageCollection(r,o({},m.defaultQuery,i,{attributes:a,crew_group:s,stateType:l,blocked:!1}))}}}),n.renderDriverItem=function(e){return function(t){return t?i.createElement(d.MenuItem,{key:t.id},i.createElement(d.ListItemText,{primary:"#"+t.call+" — "+t.name,secondary:t.car?t.car.color+" "+t.car.brand+" "+t.car.plate:e("No primary car")})):i.createElement(d.MenuItem,{key:"null"},i.createElement(d.ListItemText,{primary:e("Not selected")}))}},n.renderAttribute=function(e,r){var o=n.props.model,a=t.form.get(o),s=a.crew_group&&a.crew_group.attributes_allowed_for_order,l=!!s&&(!!s.length&&!s.find(function(t){return t.id==e.id}));return i.createElement(d.MenuItem,{key:e.id,disableRipple:!0,disabled:l},i.createElement(j.default,{disableRipple:!0,checked:r,disabled:l,readOnly:l}),i.createElement(d.ListItemText,{primary:e.name}))},n.renderCrewGroup=function(e){var t=n.props.model,r=ee(t),o=0!==r.length&&-1===r.indexOf(e.id);return i.createElement(d.MenuItem,{key:e.id,disableRipple:!0,disabled:o},i.createElement(d.ListItemText,{primary:e.name}))},n.attributesSource=u.memoize(function(e,t){return t&&t.attributes_allowed_for_order.length?e.filter(function(e){return!!t.attributes_allowed_for_order.find(function(t){return t.id==e.id})}):e}),n}return r(n,e),n.prototype.componentDidMount=function(){var e=this.props,n=e.dispatch,r=e.model;if(this.initialFocus(),p.isNew(r.initial)){var o=t.form.get(r);n({tag:"Cost/update",order:o,withSum:!1,withTariff:!!o.tariff})}else n({tag:"Routes"})},n.prototype.initialFocus=function(){var e=this.props,n=e.ctx,r=e.model;!0!==t.form.disabled(r.initial,{props:{ctx:n}})&&(r.initial.phone?this.focusFormGroup(1):this.focusFormGroup(0))},n.prototype.focusFormGroup=function(e){if(this.rootEl){var t=this.props.classes,n=this.rootEl.querySelectorAll("."+function(e){return e.replace("(","\\(").replace(")","\\)")}(t.group));if(!(e>=n.length)){var r=n[e].querySelector("[data-focus-target]")||n[e].querySelector("input");r&&r.focus()}}},n.prototype.renderCallDriverButton=function(e,t,n){var r=t.dispatch,o=t.call,a=e.phones.find(function(e){return e.default})||e.phones[0];if(!a||o&&o.phone===a.number)return i.createElement(d.Button,{size:"small",disabled:!0},i.createElement(d.Icon,null,"phone"),"  ",n("Call"));var s=a.number;return o?i.createElement("div",null,i.createElement(d.Button,{size:"small",onClick:function(){return r({tag:"@Call/transfer",phone:s})}},i.createElement(d.Icon,null,"swap_horiz"),"  ",n("Transfer")),i.createElement(d.Button,{size:"small",onClick:function(){return r({tag:"@Call/flash",phone:s})}},i.createElement(d.Icon,null,"call"),"  ",n("Flash"))):i.createElement(d.Button,{size:"small",onClick:function(){return r({tag:"@Call",phone:s})}},i.createElement(d.Icon,null,"phone"),"  ",n("Call"))},n.prototype.renderPrimaryCar=function(e,t){var n=this.props.classes,r=function(){if(0==e.attributes.length)return t("No attributes");var n=l.take(e.attributes,5).map(function(e){return e.name}).join(", ");return e.attributes.length>5?n+"…":n}();return i.createElement(d.ListItem,{className:n.driverCar},i.createElement(d.ListItemAvatar,null,i.createElement(d.Avatar,null,i.createElement(d.Icon,null,"directions_car"))),i.createElement(d.ListItemText,{primary:e.color+" "+e.brand+" "+e.plate,secondary:r}))},n.prototype.render=function(){var e=this,n=this.props,r=n.__,s=n.ctx,l=n.dispatch,u=n.model,c=n.call,p=n.classes,f=this.zoom,h=t.form.get(u);return i.createElement("div",{ref:function(t){return e.rootEl=t},className:p.root},i.createElement(T.default,{className:p.group,number:1,hideTitle:!0},i.createElement(k.default,o({},f("phone"),{ctx:s,currentCall:c})),i.createElement(R.default,{ctx:s,needPasswordConfirmation:!!u.clientCandidate,valueClient:h.client||u.clientCandidate,valueClientEmployee:h.client_employee,valueCustomer:h.customer,onClientChange:function(e){return l({tag:"Change",at:"client",value:e})},onClientEmployeeChange:function(e){return l({tag:"Change",at:"client_employee",value:e})},onCustomerChange:function(e){return l({tag:"Change",at:"customer",value:e})}})),i.createElement(T.default,{className:p.group,number:2},i.createElement(M.Debounce,null,i.createElement(O.default,o({},f("addresses"),{ctx:s,cities:u.cities,crewGroup:h.crew_group?h.crew_group.id:void 0,onCoordinatesRequest:this.handleCoordinatesRequest,goBack:h.go_back,onGoBackChange:function(e){return l({tag:"Change",at:"go_back",value:e})}})))),i.createElement(T.default,{className:p.group,number:3},i.createElement(A.default,o({},f("picked_up"),{ctx:s,serverTimeOffset:h.server_time_offset,className:p.pickedUp,required:""!==h.id,readOnly:!1,isAdvance:h.is_advance,onAdvanceChange:function(e){return l({tag:"Change",at:"is_advance",value:e})}})),i.createElement("div",null,i.createElement(M.Label,null,r("Attributes")),i.createElement(M.MultiSelect,o({},f("attributes"),{ctx:s,source:this.attributesSource(u.attributes,h.crew_group),printItem:Y,renderItem:this.renderAttribute,placeholder:r("Select attributes")}))),i.createElement("div",null,i.createElement(M.Label,null,r("Comment")),i.createElement(M.TextField,o({},f("comment"),{className:p.comment,Input:"textarea",fullWidth:!0})))),i.createElement(T.default,{className:p.group,number:4},i.createElement("div",null,i.createElement(M.Label,null,r("Cab group")),i.createElement(M.AutoComplete,o({},f("crew_group"),{printItem:Y,renderItem:this.renderCrewGroup,source:this.acSourceCrewGroups(u.crewGroups,ee(u)),placeholder:r("Not selected")}))),i.createElement("div",null,i.createElement(M.Label,null,r("Driver")),i.createElement(M.AutoComplete,o({},f("driver"),{printItem:J,renderItem:this.renderDriverItem(r),source:this.acSourceDrivers(h.attributes,h.crew_group||void 0,h.is_advance),placeholder:r("Not selected")}))),h.driver?i.createElement("div",null,h.driver.car?this.renderPrimaryCar(h.driver.car,r):null,i.createElement("div",{className:p.driverActions},i.createElement("div",null,this.renderCallDriverButton(h.driver,this.props,r)),i.createElement("div",null,i.createElement(d.Button,{size:"small",onClick:this.handleDriverOpen},i.createElement(d.Icon,null,"arrow_forward"),"  ",r("Open"))))):null,i.createElement("div",null,i.createElement(M.Label,null,r("Tariff")),i.createElement(M.AutoComplete,o({},f("tariff"),{printItem:Y,source:this.acSourceTariffs(u.tariffs),placeholder:r("Not selected")})),i.createElement("div",{className:p.checkboxes},i.createElement(P.default,{label:r("Distribute")},i.createElement(j.default,{checked:!h.dont_distribute,onClick:function(e){return l({tag:"Change",at:"dont_distribute",value:!h.dont_distribute})}})),s.features.hourly_orders&&i.createElement(P.default,{label:r("Hourly order")},i.createElement(j.default,{checked:h.hourly_order,onClick:function(e){return l({tag:"Change",at:"hourly_order",value:!h.hourly_order})}}))))),i.createElement(T.default,{className:p.group,number:5},i.createElement(S.default,o({},f("cost"),{ctx:s,client:h.client,currencyFormatter:D.currencyFormatter(s),onChangeSum:function(e){return l({tag:"Cost/sumChange",value:e})},send_cost:h.send_cost,onSendCostChange:function(e){return l({tag:"Change",at:"send_cost",value:e})}})),i.createElement(F.default,o({},f(),{ctx:s}))),!function(e){return 0===e.city&&0===e.country&&0===e.source_country}(h.distances)&&i.createElement("div",{className:p.distancesWrapper},i.createElement(M.Label,null,r("Distances")),i.createElement("table",{className:p.distances},i.createElement("tbody",null,!!h.distances.city&&i.createElement("tr",null,i.createElement("td",null,r("City")),i.createElement("td",null,U.sprintf(r("%s km"),ne(h.distances.city)))),!!h.distances.country&&i.createElement("tr",null,i.createElement("td",null,r("Country")),i.createElement("td",null,U.sprintf(r("%s km"),ne(h.distances.country)))),!!h.distances.source_country&&i.createElement("tr",null,i.createElement("td",null,r("Before pickup")),i.createElement("td",null,U.sprintf(r("%s km"),ne(h.distances.source_country))))))),""!==u.initial.id&&!!h.bill.length&&i.createElement("div",null,i.createElement(x.default,{ctx:s,bill:h.bill})),i.createElement(a.Sub,{to:document.body,event:"keydown",handler:this.handleKeyDown}))},n}(p.PureComponent);function Y(e){return e?e.name:""}function J(e){return e?"#"+e.call+" — "+e.name:""}function $(e){var t=e.spacing.unit;return{root:{padding:[0,2*t,2*t,2*t],overflow:"hidden"},group:{"& + &":{marginTop:2*t},"& > * + *":{marginTop:2*t}},attributes:{"& > *:first-child + *":{width:"100%"}},pickedUp:{},flash:{},driver:{"& input":{boxSizing:"border-box",paddingRight:74,height:"calc(1em + 16px)"}},driverCar:{paddingLeft:0,paddingRight:0},driverActions:{display:"flex","& > *:first-child":{flex:"10 10 100%",marginLeft:-t},"& > *:first-child + *":{flex:"0 0 auto",marginRight:-t}},header:{padding:[0,2*t],display:"flex",alignItems:"center",height:7*t,"& h2":{fontWeight:400,fontSize:22,margin:0}},total:{display:"flex",flexDirection:"row",alignItems:"center",minWidth:0,justifyContent:"flex-end","& label":{color:e.palette.text.secondary,fontSize:11,lineHeight:1.15,flex:"0 10 0%",textAlign:"right"}},cost:{whiteSpace:"nowrap",fontSize:22,overflow:"hidden",textOverflow:"ellipsis",marginRight:t},checkboxes:{display:"flex",flexDirection:"row",justifyContent:"space-between","& > *:first-child":{marginLeft:1.5*-t}},actionsWrapper:{flex:"0 0 auto",display:"flex",position:"relative",padding:[t,2*t,t,t],width:"100%",boxSizing:"border-box",justifyContent:"space-between","& > div":{display:"flex",flexDirection:"row",minWidth:0}},sendCostCheckbox:{width:4*t,height:4*t,"& svg":{width:"0.8em",height:"0.8em",color:e.palette.text.secondary}},costDisabled:{color:e.palette.text.disabled},distances:{marginTop:.5*t,borderCollapse:"collapse","& td:first-child":{color:e.palette.text.secondary,paddingRight:2*t}},distancesWrapper:{marginTop:t}}}function Q(e,n,r){return new L.Observable(function(o){var i=n;!function(n,r,o,i){var a=[i],s=function(o){if("Right"===o.tag){var i=t.update(e,o.value,n()),u=i[0],c=i[1];r(u),a.push(c),c.subscribe(s,function(e){return console.error("error",e)},l(c))}},l=function(e){return function(){var t=a.indexOf(e);-1!==t&&(a.splice(t,1),0===a.length&&o())}};i.subscribe(s,function(e){return console.error("error",e)},l(i))}(function(){return i},function(e){i=e},function(){return o.next(a.either.success(i)),o.complete()},r)})}function Z(e,n){return function(e){return a.eff.of(t.form.modify(e,n(e)))}}function X(e,n){return function(e){return a.eff.of(t.form.modify(e,n(e)))}}t.View=c.default($)(U.withGettext(H)(K)),t.form=q.default({validate:function(e,t){var n=H.__,r=t.props.model.initial,o={},i=""!==r.id&&""===r.phone,a=""!==r.id&&null===r.tariff;return e.phone||i||(o.phone=n("Cannot be empty")),e.tariff||a||(o.tariff=n("Cannot be empty")),e.addresses.length<2&&(o.addresses=n("Should be at least two addresses")),e.addresses.length>=2&&!e.addresses[0].address&&p.coordsEmpty(e.addresses[0].coordinates)&&(o.addresses=n("Enter pick-up address")),""===e.id||e.picked_up||(o.picked_up=n("Cannot be empty")),o},disabled:function(e,t){var n=t.props.ctx.profile.access_rights;return"finished"===e.state.state_type||"aborted"===e.state.state_type||!n.orders_edit||{driver:!n.order_edit_crew,cost:!n.order_edit_cost,referral_code:!p.isNew(e)}}}),t.styles=$,t.commandToEff=Q,t.modifyForm=Z,t.modifyNoLoop=X;var ee=u.memoize(function(e){var n=t.form.get(e);return n.client_employee?n.client_employee.crew_groups_filter.map(function(e){return e.id}):n.client?n.client.crew_groups_filter.map(function(e){return e.id}):[]});function te(e,t){var n;if(e.client_employee&&e.client_employee.default_crew_group&&(n=t.find(function(t){return t.id==e.client_employee.default_crew_group.id})))return n;if(e.client&&e.client.default_crew_group&&(n=t.find(function(t){return t.id==e.client.default_crew_group.id})))return n;if(e.client&&e.client.client_group&&e.client.client_group.default_crew_group&&(n=t.find(function(t){return t.id==e.client.client_group.default_crew_group.id})))return n;return t.find(function(e){return e.default})||null}function ne(e){return+e.toFixed(2)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(273),i=n(50),a=n(352),s=n(273);function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return{tag:"Concat",sources:e}}function u(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=1===t.length?t[0]:l.apply(void 0,t);if("Cli"===r.tag){for(var o={},i=0;i<r.args.length;i++){var s="--".length+r.prefix.length,d=r.args[i].substr(s),p=-1===d.indexOf("=")?[d,r.args[++i]||""]:r.args[i].split("="),f=p[0],h=p[1];e._description.hasOwnProperty(f)&&(o[f]=c(e._description[f],h))}return o}return"Location/search"===r.tag?o=("?"===r.value[0]?r.value.substr(1):r.value).split("&").map(function(e){return e.split("=")}).reduce(function(t,n){var o=n[0],i=n[1],a=r.transformKey(decodeURIComponent(o));return e._description.hasOwnProperty(a)?(t[a]=c(e._description[a],decodeURIComponent(i)),t):t},{}):"JSON"===r.tag?r.value:"Concat"===r.tag?Object.assign.apply(Object,[{}].concat(r.sources.map(function(t){return u(e,t)}))):a.absurd(r)}function c(e,t){if(e instanceof o.ArrayDecoder)return t.split(", ").map(function(t){return c(e._decoder,t)});if(e instanceof o.Dict)try{return JSON.parse(t)}catch(e){return t}if(e instanceof o.RecordDecoder)try{return JSON.parse(t)}catch(e){return t}if(e instanceof o.Primitive){if("string"===e._type)return t;if("boolean"===e._type)return!("false"===t||"0"===t);if("undefined"===e._type)return;return"null"===e._type?null:"any"===e._type?t:"nat"===e._type?Number(t):"int"===e._type?Number(t):"float"===e._type?Number(t):a.absurd(e._type)}if(e instanceof o.OneOf)throw new Error("[config-reader] OneOf is not supported");if(e instanceof o.Discriminate)try{return JSON.parse(t)}catch(e){return t}if(e instanceof o.Pure)return t;if(e instanceof o.ToDecoder)return e instanceof s.WithDefault?c(e._decoder,t):e instanceof o.Variants?t:c(e.toDecoder(),t);if(e instanceof o.Custom)throw new Error("[config-reader]: CustomDecoder is not supported");if(e instanceof o.AtDecoder)throw new Error("[config-reader]: AtDecoder is not supported");if(e instanceof o.Chain)throw new Error("[config-reader]: ChainDecoder is not supported");return a.absurd(e)}t.cli=function(e,t){return void 0===t&&(t=""),{tag:"Cli",args:e,prefix:t}},t.queryString=function(e,t){return void 0===t&&(t=i.camelCase),{tag:"Location/search",value:e,transformKey:t}},t.json=function(e){return{tag:"JSON",value:e}},t.concat=l,t.validate=function(e,t){return t.validate(u(t,e))},t.merge=u,t.fromString=c;var d=function(e){function t(t,n){var r=e.call(this)||this;return r._decoder=t,r._description=n,r}return r(t,e),t.prototype.toDecoder=function(){return this._decoder},t}(o.ToDecoder);t.ConfigDescription=d,t.configInfo=function(e,t){return void 0===t&&(t=""),Object.keys(e._description).reduce(function(t,r){return t[r]=n(e._description[r]),t},{});function n(e){if(e instanceof o.ArrayDecoder)return{type:"Array<"+n(e._decoder).type+">"};if(e instanceof o.Dict)return{type:"Record<string, "+n(e._decoder).type+">"};if(e instanceof o.RecordDecoder)return{type:"Record<string, unknown>"};if(e instanceof o.Primitive)return"string"===e._type?{type:"string"}:"boolean"===e._type?{type:"boolean"}:"undefined"===e._type?{type:"undefined"}:"null"===e._type?{type:"null"}:"any"===e._type?{type:"any"}:"nat"===e._type?{type:"number"}:"int"===e._type?{type:"number"}:"float"===e._type?{type:"number"}:a.absurd(e._type);if(e instanceof o.OneOf)return{type:e._alternatives.map(n).map(function(e){return e.type}).join("|")};if(e instanceof o.Discriminate)return{type:Object.keys(e._alternatives).map(function(t){return n(e._alternatives[t]).type}).join("|")};if(e instanceof o.Pure)return{type:JSON.stringify(e._value)};if(e instanceof o.ToDecoder){if(e instanceof s.WithDefault){var t=n(e._decoder);return t.default=e._default,t}if(e instanceof o.Variants)return{type:e._variants.map(function(e){return"string"==typeof e?e:JSON.stringify(e)}).join("|")};var r=n(e.toDecoder());return e instanceof d&&(r.description=e._description),r}if(e instanceof o.Custom)throw new Error("[config-reader]: CustomDecoder is not supported");if(e instanceof o.AtDecoder)throw new Error("[config-reader]: AtDecoder is not supported");if(e instanceof o.Chain)throw new Error("[config-reader]: ChainDecoder is not supported");return a.absurd(e)}},o.DecoderBase.prototype.withDescription=function(e){return new d(this,e)},o.DecoderBase.prototype.validateConfigs=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.validate(u.apply(void 0,[this].concat(e)))}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.literal=function(e){return e},t.absurd=function(e){throw new Error("absurd: unreachable code")}},,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(415));var r=n(415);t.default=r.default},,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),a=n(36),s=n(563),l=n(179),u=function(){function e(){}return e.prototype.withDefault=function(e){return new f(e,this)},e.prototype.many=function(){return new p(this)},e.prototype.collectFlags=function(){var e={fields:{},include:{}};for(var t in this.desc)this.desc.hasOwnProperty(t)&&n(e,[],this.type,t,this.desc[t]);return e;function n(e,t,r,o,i){switch(i.tag){case"Attr":return e.fields[r]=e.fields[r]||{},void(e.fields[r][o]=!0);case"Related":for(var a in e.fields[r]=e.fields[r]||{},e.fields[r][o]=!0,e.include[t.concat(o).join(".")]=!0,i.desc)i.desc.hasOwnProperty(a)&&n(e,t.concat(o),i.type,a,i.desc[a]);return;case"RelatedMany":for(var a in e.fields[r]=e.fields[r]||{},e.fields[r][o]=!0,e.include[t.concat(o).join(".")]=!0,i.child.desc)i.child.desc.hasOwnProperty(a)&&n(e,t.concat(o),i.child.type,a,i.child.desc[a]);return;case"WithDefault":return void n(e,t,r,o,i.child);case"WithName":return void n(e,t,r,i.name,i.child)}}},e.prototype.collectQuery=function(){var e=this.collectFlags(),t=e.fields,n=e.include,r={include:Object.keys(n).join(",")||void 0};for(var o in t)r["fields["+o+"]"]=Object.keys(t[o]).join(",")||void 0;return r},e.prototype.validate=function(e,t){if(t.type!==this.type)return a.failure("invalid resource type: "+t.type+", expected "+this.type);var n={id:t.id,type:t.type};for(var r in this.desc)if(this.desc.hasOwnProperty(r)){var o=u(r,this.desc[r],e,t);if(o instanceof l.Left)return o;n[r]=o.value}return a.success(n);function u(e,t,n,r){switch(t.tag){case"Attr":var o=r.attributes;return null===o?a.failure("resource "+r.type+"#"+r.id+" doesn't have any attributes"):t.decoder.validate(o[e]);case"Related":return i.isEmpty(t.desc)?s.relatedLinkage(r,e):s.related(n,r,e).chain(function(e){return t.validate(n,e)});case"RelatedMany":return s.relatedCollection(n,r,e).chain(function(e){return a.either.traverse(e,function(e){return t.child.validate(n,e)})});case"WithDefault":var c=t.child;switch(c.tag){case"Related":return i.isEmpty(c.desc)?s.relatedLinkage(r,e).fold(function(){return a.success(t.defaultValue)},a.success):s.related(n,r,e).fold(function(){return a.success(t.defaultValue)},function(e){return c.validate(n,e)});case"RelatedMany":return s.relatedCollection(n,r,e).fold(function(){return a.success(t.defaultValue)},function(e){return a.either.traverse(e,function(e){return c.child.validate(n,e)})})}var d=u(e,t.child,n,r);return d instanceof l.Right?d:a.success(t.defaultValue);case"WithName":return u(t.name,t.child,n,r)}}},e.prototype.post=function(e){var t={type:this.type},n={},r={};for(var o in this.desc)this.desc.hasOwnProperty(o)&&a(o,o,this.desc[o]);return i.isEmpty(n)||(t.attributes=n),i.isEmpty(r)||(t.relationships=r),{data:t};function a(t,o,s){switch(s.tag){case"Attr":return void(n[o]=e[t]);case"Related":return void(r[o]={data:{type:e[t].type,id:e[t].id}});case"RelatedMany":return void(r[o]={data:e[t].map(function(e){return{type:e.type,id:e.id}})});case"WithDefault":return void(i.isEqual(e[t],s.defaultValue)||a(t,o,s.child));case"WithName":return void a(t,s.name,s.child)}}},e.prototype.patch=function(e,t){var n={type:this.type,id:e},r={},o={};for(var a in t)this.desc.hasOwnProperty(a)&&s(a,a,this.desc[a]);return i.isEmpty(r)||(n.attributes=r),i.isEmpty(o)||(n.relationships=o),{data:n};function s(e,n,a){switch(a.tag){case"Attr":return void(r[n]=t[e]);case"Related":return void(o[n]={data:{type:t[e].type,id:t[e].id}});case"RelatedMany":return void(o[n]={data:t[e].map(function(e){return{type:e.type,id:e.id}})});case"WithDefault":if(i.isEqual(t[e],a.defaultValue))switch(a.child.tag){case"Attr":return void(r[n]=a.defaultValue);case"Related":return void(o[n]={data:null});case"RelatedMany":return void(o[n]={data:[]});default:return void console.warn("invalid tag nested inside WithDefault "+a.child.tag)}return void s(e,n,a.child);case"WithName":return void s(e,a.name,a.child)}}},e.prototype.primaryDecoder=function(){var e=this;return a.decode.decoder("primary",function(t){return s.document.validate(t).chain(function(t){return s.primary(t).chain(function(n){return e.validate(t,n)})})})},e.prototype.collectionDecoder=function(){var e=this;return a.decode.decoder("collection",function(t){return s.document.validate(t).chain(function(t){return function(e){return Array.isArray(e.data)?a.success(e.data):a.failure("jsonapi document doesn't contain collection of resorces")}(t).chain(function(n){return a.either.traverse(n,function(n){return e.validate(t,n)})})})})},e.prototype.extend=function(e){var t=o({},this.desc);if(e)for(var n in e)e.hasOwnProperty(n)&&(e[n]instanceof a.decode.DecoderBase?t[n]=new c(e[n]):t[n]=e[n]);return new d(this.type,t)},e.prototype.withName=function(e){return new h(e,this)},e}();t.JsonApiBase=u;var c=function(e){function t(t){var n=e.call(this)||this;return n.decoder=t,n.tag="Attr",n}return r(t,e),t}(u);t.Attr=c;var d=function(e){function t(t,n){var r=e.call(this)||this;return r.type=t,r.desc=n,r.tag="Related",r}return r(t,e),t}(u);t.Related=d;var p=function(e){function t(t){var n=e.call(this)||this;return n.child=t,n.tag="RelatedMany",n}return r(t,e),t}(u);t.RelatedMany=p;var f=function(e){function t(t,n){var r=e.call(this)||this;return r.defaultValue=t,r.child=n,r.tag="WithDefault",r}return r(t,e),t}(u);t.WithDefault=f;var h=function(e){function t(t,n){var r=e.call(this)||this;return r.name=t,r.child=n,r.tag="WithName",r}return r(t,e),t}(u);t.WithName=h,t.resource=function(e,t){var n={};if(t)for(var r in t)t.hasOwnProperty(r)&&(t[r]instanceof a.decode.DecoderBase?n[r]=new c(t[r]):n[r]=t[r]);return new d(e,n)},t.attr=function(e){return new c(e)}},,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(36),s=n(272),l=n(274),u=n(205),c=n(160),d=n(159),p=n(164),f=n(99),h=n(27),m=n(142),g=n(369),v=n(839),y=n(840),_=n(8),b=n(11),C=n(841),w=n(206),E=n(165),S=n(44);n(568),n(1185),n(1186),t.translations=h.Translations.fromPO(n(688));var T=n(1189);t.update=function(e,n,r){var i=t.translations.__;switch(n.tag){case"!Init":return[n.state,a.noop];case"!Pending":return[o({},r,{pending:n.pending}),a.noop];case"!Reconnect":return[r,function(e){return a.cmd.concat(a.cmd.of({tag:"!Pending",pending:!0}),e,a.cmd.of({tag:"!Pending",pending:!1}))}(("Connected"===r.tag?C.oktellDisconnect:a.eff.of(null)).chainEff(function(){return A(o({},e,{disableOktell:!1}))}).perform(S.onFailure,function(e){return{tag:"!Init",state:e}}))]}return"Connected"===r.tag&&function(e){return"!"!==e.tag[0]}(n)?function(t,n){switch(t.tag){case"Disconnect":return[{tag:"Disconnected",pending:n.pending},C.oktellDisconnect.performForget()];case"Disconnected":case"ConnectionClose":case"ErrorConnection":return[{tag:"Disconnected",pending:n.pending},a.noop];case"RingStart":var r=a.batch([a.cmd.of({tag:"Info",props:t.props,phones:t.abonents.map(function(e){return e.phone})}),t.props.dontIntervene?f.notifyWarning(i("Complete the form in order to answer the phone call")):a.noop]),u=k(n.queue,t.abonents.map(function(e){return{status:"ringing",phone:e.phone,guid:e.guid,xmlMeta:e.name}})),c=t.abonents.reduce(function(e,t){return e[t.guid]=t.name,e},o({},n.xmlMetas));return[o({},n,{queue:u,xmlMetas:c}),r];case"RingStop":return[o({},n,{queue:n.queue.filter(function(e){return"ringing"!==e.status||void 0===t.abonents.find(function(t){return t.guid===e.guid})})}),a.noop];case"CallStart":return[o({},n,{queue:k(n.queue,t.abonents.map(function(e){return{status:"calling",phone:e.phone,guid:e.guid,xmlMeta:e.name}}))}),a.cmd.of({tag:"Info",phones:t.abonents.map(function(e){return e.phone})})];case"CallStop":return[o({},n,{queue:n.queue.filter(function(e){return"calling"!==e.status||void 0===t.abonents.find(function(t){return t.guid===e.guid})})}),a.noop];case"TalkStart":return[o({},n,{queue:k(n.queue,t.abonents.map(function(e){return{status:"talking",phone:e.phone,guid:e.guid,xmlMeta:e.name}}))}),a.noop];case"TalkStop":return[o({},n,{queue:n.queue.filter(function(e){return"talking"!==e.status&&"holding"!==e.status||void 0===t.abonents.find(function(t){return t.guid===e.guid})})}),a.noop];case"Answer":var d=function(){return{tag:"Answer/success",phone:t.phone}};return[n,C.oktellAnswer(t.phone).perform(S.onFailure,d)];case"Answer/success":var p=n.info[t.phone];if(p&&!p.driver&&"answer"===e.openOrderCardOn){if(!p.client)return[n,l(n,p)];if(!p.current_order)return[n,l(n,p)];if(p.current_order)return[n,w.dispatchExternal({tag:"@Order/open",id:p.current_order.id})]}return[n,a.noop];case"EndCall":return[n,C.oktellEndCall(t.phone).performForget()];case"DTMF":for(var h=0;h<n.dtmf.length&&n.dtmf[h]===t.value[h];h++);var m=t.value.substring(h);return[o({},n,{dtmf:t.value}),C.oktellDtmf(m).performForget()];case"AuxillaryPhone":return[o({},n,{auxillary:t.value}),a.noop];case"Phone":var v=R(t.value);return[o({},n,{phone:null!==v?v:""}),a.noop];case"Call":var d=function(){return{tag:"Call/success"}};return[n,C.oktellCall(t.phone).perform(S.onFailure,d)];case"Call/success":return[o({},n,{phone:"",dtmf:"",auxillary:""}),a.noop];case"Call/transfer":var d=function(){return s.none},y=o({},n,{phone:"",dtmf:"",auxillary:""});return[y,C.oktellTransfer(t.phone).performMaybe(function(e){return s.some({tag:"@Error",error:e})},d)];case"Hold":var h=n.queue.findIndex(function(e){return"talking"===e.status});if(h<0)return[n,a.noop];var _=n.queue.slice();return _.splice(h,1,o({},_[h],{status:"holding"})),[o({},n,{queue:_}),C.oktellHold.performForget()];case"Resume":return[n,C.oktellResume.performForget()];case"Call/flash":return[o({},n,{phone:"",dtmf:"",auxillary:""}),C.oktellFlash(t.phone).performForget()];case"Info":var d=function(e){return{tag:"Info/success",props:t.props,infos:e,phones:t.phones}};return[n,function(e,t){return a.eff.traverse(t,function(t){return g.phoneInfo(e,t)}).mapEff(function(e){return e.reduce(function(e,t){return e.push([t.phone,t]),e},[])})}(e,t.phones).perform(function(e){return{tag:"Info/failure",error:e}},d)];case"Info/failure":return[n,f.notifyError(t.error)];case"Info/success":var p=o({},n.info);for(var b in t.infos)p[t.infos[b][0]]=t.infos[b][1];var E=[],T=t.props;if(t.infos[0]&&T&&!T.dontIntervene&&"receive"===e.openOrderCardOn){var O=t.infos[0],v=O[0],A=O[1];A.client?(A.current_order||E.push(l(n,A)),A.current_order&&E.push(w.dispatchExternal({tag:"@Order/open",id:A.current_order.id}))):A.driver?A.current_order&&E.push(w.dispatchExternal({tag:"@Driver/open",id:A.current_order.id})):E.push(l(n,A))}return t.phones[0]&&T&&!T.dontIntervene&&e.settings.auto_answer_call&&E.push(a.cmd.of({tag:"Answer",phone:t.phones[0]}).delay(e.autoAnswerTimeout||0)),[o({},n,{info:p}),a.batch(E)]}}(n,r):"Connected"!==r.tag&&"Call"===n.tag?[r,f.notifyWarning(i("Phone is disconnected"))]:[r,a.noop];function l(e,t){var n=e.queue.find(function(e){return e.phone===t.phone}),r=n?I(n.xmlMeta):{crewGroup:null,attributes:[],city:""},o=r.crewGroup,i=r.attributes,a=r.city;return w.dispatchExternal({tag:"@Order/add",call:{phone:t,crewGroup:o,attributes:i,city:a}})}};var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rootEl=null,t.timerId=null,t.waitTillCallCompletes=null,t.handleReconnect=function(){var e=t.props,n=e.dispatch,r=e.ctx.oktellReconnectTimeout,o=t.props.model;if("Connected"===o.tag){var i=function(){n({tag:"!Reconnect"}),t.timerId=setTimeout(t.handleReconnect,Math.max(r,5e3))};x(o)?t.waitTillCallCompletes=i:i()}},t.handleDisconnect=function(e){console.log(" ---\x3e disconnected"),t.props.dispatch({tag:"Disconnected",reason:e})},t.handleConnectionClose=function(){console.log(" ---\x3e connectionClose"),t.props.dispatch({tag:"ConnectionClose"})},t.handleErrorConnection=function(e){console.log(" ---\x3e errorConnection",e),t.props.dispatch({tag:"ErrorConnection",error:e})},t.handleReadyStart=function(e){console.log(" ---\x3e readyStart",e)},t.handleReadyStop=function(e){console.log(" ---\x3e readyStop",e)},t.handleRingStart=function(e){console.log(" ---\x3e ringStart",e),t.props.dispatch({tag:"RingStart",abonents:e,props:t.props})},t.handleRingStop=function(e){console.log(" ---\x3e ringStop",e),t.props.dispatch({tag:"RingStop",abonents:e})},t.handleBackRingStart=function(e){console.log(" ---\x3e backRingStart",e)},t.handleBackRingStop=function(e){console.log(" ---\x3e backRingStop",e)},t.handleCallStart=function(e){console.log(" ---\x3e callStart",e),t.props.dispatch({tag:"CallStart",abonents:e})},t.handleCallStop=function(e){console.log(" ---\x3e callStop",e),t.props.dispatch({tag:"CallStop",abonents:e})},t.handleTalkStart=function(e){console.log(" ---\x3e talkStart",e),t.props.dispatch({tag:"TalkStart",abonents:e})},t.handleTalkStop=function(e){console.log(" ---\x3e talkStop",e),t.props.dispatch({tag:"TalkStop",abonents:e})},t.handleKeyDown=function(e){var n=t.props,r=n.dispatch,o=n.model;if("Disconnected"!==o.tag){if(e.altKey&&("Enter"===e.key||"q"===e.key)){var i=x(o);if(null===i&&o.phone)return void r({tag:"Call",phone:o.phone});if(null===i)return;switch(i.status){case"ringing":return void r({tag:"Answer",phone:i.phone});case"talking":return void r({tag:"Hold"});case"holding":return void r({tag:"Resume"})}}if(!e.altKey||","!==e.key&&"z"!==e.key)if(!e.altKey||"="!==e.key&&"w"!==e.key)if(!e.altKey||"-"!==e.key&&"e"!==e.key)if(e.altKey&&"x"===e.key&&t.rootEl){var a=t.rootEl.querySelector("input");a&&a.focus()}else;else o.auxillary&&r({tag:"Call/flash",phone:o.auxillary});else o.auxillary&&r({tag:"Call/transfer",phone:o.auxillary});else r({tag:"EndCall"})}},t.handleOrderNew=function(e,t){return function(){if(e){var n="queue"in t?t.queue.find(function(t){return t.phone===e.phone}):null,r="Connected"===t.tag&&n?t.xmlMetas[n.guid]:n?n.xmlMeta:null,o=r?I(r):{crewGroup:null,attributes:[],city:""},i=o.crewGroup,a=o.attributes,s=o.city;w.dispatchExternal({tag:"@Order/add",call:{phone:e,crewGroup:i,attributes:a,city:s}}).subscribe()}else w.dispatchExternal({tag:"@Order/add"}).subscribe()}},t.handleOrderOpen=function(e){return function(){e&&w.dispatchExternal({tag:"@Order/open",id:e.id}).subscribe()}},t.handleDriverOpen=function(e){return function(){e&&w.dispatchExternal({tag:"@Driver/open",id:e.id}).subscribe()}},t}return r(t,e),t.prototype.componentDidMount=function(){this.listen()},t.prototype.componentWillUnmount=function(){C.oktellDisconnect.subscribe(),this.unlisten()},t.prototype.timerIsRunning=function(e){return e.ctx.oktellReconnectTimeout>0&&"Connected"===e.model.tag},t.prototype.componentWillReceiveProps=function(e){this.timerIsRunning(this.props)&&!this.timerIsRunning(e)&&this.timerId&&clearTimeout(this.timerId),!this.timerIsRunning(this.props)&&this.timerIsRunning(e)&&(this.timerId=setTimeout(this.handleReconnect,Math.max(e.ctx.oktellReconnectTimeout,5e3)));e:if(this.waitTillCallCompletes){var t=e.model;if("Connected"!==t.tag)break e;x(t)||(this.waitTillCallCompletes(),this.waitTillCallCompletes=null)}},t.prototype.listen=function(){oktell.on("disconnect",this.handleDisconnect),oktell.on("connectError",this.handleConnectionClose),oktell.on("errorConnection",this.handleErrorConnection),oktell.on("readyStart",this.handleReadyStart),oktell.on("readyStop",this.handleReadyStop),oktell.on("ringStart",this.handleRingStart),oktell.on("ringStop",this.handleRingStop),oktell.on("backRingStart",this.handleBackRingStart),oktell.on("backRingStop",this.handleBackRingStop),oktell.on("callStart",this.handleCallStart),oktell.on("callStop",this.handleCallStop),oktell.on("talkStart",this.handleTalkStart),oktell.on("talkStop",this.handleTalkStop),this.timerIsRunning(this.props)&&(this.timerId=setTimeout(this.handleReconnect,Math.max(this.props.ctx.oktellReconnectTimeout,5e3)))},t.prototype.unlisten=function(){oktell.off("disconnect",this.handleDisconnect),oktell.off("connectError",this.handleConnectionClose),oktell.off("errorConnection",this.handleErrorConnection),oktell.off("readyStart",this.handleReadyStart),oktell.off("readyStop",this.handleReadyStop),oktell.off("ringStart",this.handleRingStart),oktell.off("ringStop",this.handleRingStop),oktell.off("backRingStart",this.handleBackRingStart),oktell.off("backRingStop",this.handleBackRingStop),oktell.off("callStart",this.handleCallStart),oktell.off("callStop",this.handleCallStop),oktell.off("talkStart",this.handleTalkStart),oktell.off("talkStop",this.handleTalkStop),this.timerId&&clearTimeout(this.timerId)},t.prototype.renderDisconnected=function(e){var t=this.props,n=t.classes,r=t.__;return i.createElement(i.Fragment,null,i.createElement("div",{className:n.top},i.createElement("div",{className:n.phoneDisconnected},i.createElement("span",null,r("Phone disconnected")))),i.createElement("div",{className:n.bottom},i.createElement("div",null,this.renderDisconnect()),i.createElement("div",null,this.renderButtons(null))))},t.prototype.renderConnected=function(e){var t=this.props,n=t.classes,r=t.dispatch,o=t.__,s=x(e),l=s&&e.info.hasOwnProperty(s.phone)?e.info[s.phone]:null;return i.createElement(i.Fragment,null,i.createElement("div",{className:n.top},function(t){if(!t)return i.createElement("div",{className:n.ready},i.createElement("div",null,i.createElement(u.default,{className:n.endCall,disabled:!0},i.createElement(c.default,{"data-rh":o("End call"),"data-rh-at":"bottom"},"call_end"))),i.createElement(p.default,{className:n.input,value:e.phone,placeholder:o("Phone number"),onChange:function(e){return r({tag:"Phone",value:e.target.value})},disableUnderline:!0}),i.createElement("div",null,i.createElement(u.default,{className:n.connect,onClick:function(){return r({tag:"Call",phone:e.phone})},disabled:!e.phone.length},i.createElement(c.default,{"data-rh":o("Call"),"data-rh-at":"bottom"},"call"))));switch(t.status){case"ringing":return i.createElement("div",{className:n.ringing},i.createElement(u.default,{className:n.endCall,onMouseDown:function(e){return e.preventDefault(),r({tag:"EndCall",phone:t.phone})}},i.createElement(c.default,{"data-rh":o("Dismiss"),"data-rh-at":"bottom"},"call_end")),i.createElement("div",{className:n.talkingPhone},t.phone),i.createElement(u.default,{className:n.answer,onMouseDown:function(e){return e.preventDefault(),r({tag:"Answer",phone:t.phone})}},i.createElement(c.default,{"data-rh":o("Answer to the call"),"data-rh-at":"bottom"},"ring_volume")));case"talking":return i.createElement("div",{className:n.talking},i.createElement("div",null,i.createElement(u.default,{className:n.endCall,onMouseDown:function(e){return e.preventDefault(),r({tag:"EndCall"})}},i.createElement(c.default,{"data-rh":o("End call"),"data-rh-at":"bottom"},"call_end"))),i.createElement("div",{className:n.talkingPhone},t.phone),i.createElement(p.default,{className:n.input,value:e.auxillary,onChange:function(e){return r({tag:"AuxillaryPhone",value:e.target.value})},placeholder:o("DTMF"),disableUnderline:!0}),i.createElement("div",{className:n.buttons},i.createElement(u.default,{className:n.transfer,disabled:!e.auxillary,onClick:e.auxillary?function(){return r({tag:"Call/transfer",phone:e.auxillary})}:void 0},i.createElement(c.default,{"data-rh":o("Call/transfer"),"data-rh-at":"bottom"},"swap_horiz")),i.createElement(u.default,{className:n.hold,onClick:function(){return r({tag:"Hold"})},"data-rh":o("Hold"),"data-rh-at":"bottom"},i.createElement(c.default,null,"pause_circle_outline")),i.createElement(u.default,{className:n.flash,disabled:!e.auxillary,onClick:e.auxillary?function(){return r({tag:"Call/flash",phone:e.auxillary})}:void 0},i.createElement(c.default,{"data-rh":o("Call/flash"),"data-rh-at":"bottom"},"call"))));case"holding":return i.createElement("div",{className:n.talking},i.createElement("div",null,i.createElement(u.default,{disabled:!0},i.createElement(c.default,{"data-rh":o("End call"),"data-rh-at":"bottom"},"call_end"))),i.createElement("div",{className:n.talkingPhone},t.phone),i.createElement(p.default,{className:n.input,placeholder:o("DTMF"),disableUnderline:!0,disabled:!0}),i.createElement("div",{className:n.buttons},i.createElement(u.default,{className:n.transfer,disabled:!e.auxillary,onClick:e.auxillary?function(){return r({tag:"Call/transfer",phone:e.auxillary})}:void 0},i.createElement(c.default,{"data-rh":o("Call/transfer"),"data-rh-at":"bottom"},"swap_horiz")),i.createElement(u.default,{className:n.hold,onClick:function(){return r({tag:"Resume"})},"data-rh":o("Hold"),"data-rh-at":"bottom"},i.createElement(c.default,null,"pause_circle_filled")),i.createElement(u.default,{className:n.flash,disabled:!e.auxillary,onClick:e.auxillary?function(){return r({tag:"Call/flash",phone:e.auxillary})}:void 0},i.createElement(c.default,{"data-rh":o("Call/flash"),"data-rh-at":"bottom"},"call"))));case"calling":return i.createElement("div",{className:n.ready},i.createElement("div",null,i.createElement(u.default,{className:n.endCall,onMouseDown:function(e){return e.preventDefault(),r({tag:"EndCall"})}},i.createElement(c.default,{"data-rh":o("End call"),"data-rh-at":"bottom"},"call_end"))),i.createElement(p.default,{className:n.input,value:t.phone,placeholder:o("Phone number"),onChange:function(e){return r({tag:"Phone",value:e.target.value})},disableUnderline:!0,disabled:!0}),i.createElement("div",null,i.createElement(u.default,{disabled:!0,className:n.connect},i.createElement(c.default,{"data-rh":o("Call"),"data-rh-at":"bottom"},"call"))))}}(s)),i.createElement("div",{className:n.bottom},i.createElement("div",null,l&&function(e){return e.client?i.createElement("div",{className:n.info},i.createElement("label",null,o("Customer")),i.createElement("span",null,""+e.client.name)):e.driver?i.createElement("div",{className:n.info},i.createElement("label",null,o("Driver")),i.createElement("span",null,"#"+e.driver.call+" — "+e.driver.name)):i.createElement("div",{className:n.info},i.createElement("label",null,o("Unknown number")))}(l),!l&&this.renderDisconnect()),i.createElement("div",null,this.renderButtons(l))),i.createElement(a.Sub,{to:document.body,event:"keydown",handler:this.handleKeyDown}),i.createElement(v.default,{url:T,play:null!==s&&"ringing"===s.status}),i.createElement(y.default,{play:null!==s&&"ringing"===s.status}))},t.prototype.renderButtons=function(e){var t=this.props,n=t.model,r=t.ctx,o=t.__;if(!e)return i.createElement(d.default,{onClick:this.handleOrderNew(e,n),variant:"raised",color:"primary",size:"small"},o("New booking"));if(e.client){var a=e.current_order?this.handleOrderOpen(e.current_order):this.handleOrderNew(e,n),s=e.current_order?o("Open booking"):o("New booking"),l=!e.current_order&&!r.profile.access_rights.orders_add;return i.createElement(d.default,{onClick:a,variant:"raised",color:"primary",size:"small",disabled:l},s)}if(e.driver){a=e.current_order?this.handleOrderOpen(e.current_order):this.handleDriverOpen(e.driver),s=e.current_order?o("Open booking"):o("Open driver");return i.createElement(d.default,{onClick:a,variant:"raised",color:"primary",size:"small"},s)}return i.createElement(d.default,{onClick:this.handleOrderNew(e,n),variant:"raised",color:"primary",size:"small"},o("New booking"))},t.prototype.renderDisconnect=function(){var e=this.props,t=e.model,n=e.dispatch,r=e.__;return"Disconnected"===t.tag?i.createElement(u.default,{onClick:function(){return n({tag:"!Reconnect"})}},i.createElement(c.default,{"data-rh":r("Connect")},"phone_paused")):i.createElement(u.default,{onClick:function(){return n({tag:"Disconnect"})}},i.createElement(c.default,{"data-rh":r("Disconnect")},"phone_paused"))},t.prototype.render=function(){var e=this,t=this.props,n=t.model,r=t.classes,o=t.className,a=b(r.root,o),s="Disconnected"===n.tag?this.renderDisconnected(n):this.renderConnected(n);return i.createElement("div",{className:a,ref:function(t){return e.rootEl=t}},s,i.createElement(E.default,{pending:n.pending}))},t}(i.Component);function A(e){if(e.disableOktell)return a.eff.success({tag:"Disconnected"});var t=a.eff.fromCallback(function(e){oktellVoice.createUserMedia(function(){return e(a.success(null))},function(){return e(a.failure({tag:"MediaPermissionsRefuse"}))})}),n=e.oktellAddress||e.settings.oktell_address,r=e.oktellLogin,o=e.oktellPassword,i=e.registerExpires||void 0;if(!r||!o)return a.eff.success({tag:"Disconnected"});var s={oktellVoice:!0,url:n,login:r,password:o,register_expires:i};return a.eff.ap(t,C.oktellConnect(s),function(){return{tag:"Connected",queue:[],dtmf:"",phone:"",auxillary:"",info:{},pending:!1,xmlMetas:{}}}).onError(function(e){return f.notifyError(e).subscribe(),a.eff.of({tag:"Disconnected"})})}function x(e){if("Connected"!==e.tag)return null;var t=e.queue.find(function(e){return"ringing"===e.status});if(t)return t;var n=e.queue.find(function(e){return"calling"===e.status});if(n)return n;var r=e.queue.find(function(e){return"talking"===e.status});if(r)return r;var o=e.queue.find(function(e){return"holding"===e.status});return o||null}function k(e,t){for(var n=e.slice(),r=0;r<t.length;r++){for(var o=-1,i=0;i<e.length;i++)if(e[i].guid===t[r].guid){o=i;break}o<0?n.push(t[r]):n.splice(o,1,t[r])}return n}function R(e){var t=e.split("").reduce(function(e,t){return function(e){return/[\d*#]/.test(e)}(t)&&(e+=t),e},"").substr(0,31);return t.length>0?t:null}function I(e){for(var t=(new DOMParser).parseFromString(e,"text/xml"),n=t.querySelector("cg"),r=t.querySelectorAll("op i"),o=n?Number(n.textContent):NaN,i=isNaN(o)?null:String(o),a=t.querySelector("ct"),s=a&&a.textContent||"",l=[],u=0;u<r.length;u++){var c=r.item(u).textContent;c&&l.push(c)}return{crewGroup:i,attributes:l,city:s}}t.View=_.default(N)(h.withGettext(t.translations)(O)),t.init=A,t.shouldVibrate=function(e){var t="Connected"===e.tag?x(e):null;return!!t&&("ringing"===t.status||"calling"===t.status)},t.currentCall=x,t.sanitizePhone=R;var D=a.decode.record({login:a.decode.string,password:a.decode.string});function N(e){var t=e.spacing.unit;return{root:{display:"flex",flexDirection:"column",height:"100%","& $talking, $ready, $ringing, $calling":{display:"flex",alignItems:"center","& $input":{flex:"10 10 100%"}},"& > * + *":{borderTop:"solid 1px "+e.palette.divider}},bottom:{flex:"10 10 100%",display:"flex",alignItems:"center",padding:[0,t,0,0],"& > *:first-child":{flex:"10 10 100%"},"& button":{whiteSpace:"nowrap"}},top:{flex:"0 0 48px"},info:{"& label":{margin:[0,2*t],color:e.palette.text.secondary,"&:after":{content:":"}}},talking:{},calling:{},ringing:{"& > *:first-child + *":{flex:"10 10 100%"}},ready:{},input:{"&, & input":{textAlign:"right"}},buttons:{display:"flex"},flash:{color:m.yellow[200]},endCall:{color:m.red[200]},connect:{color:m.teal[200]},answer:{color:m.teal[200]},disconnected:{height:"100%",padding:2*t,alignItems:"center",justifyContent:"center",display:"flex","& a":{color:e.palette.primary.main}},phoneDisconnected:{display:"flex",alignItems:"center",justifyContent:"center",color:e.palette.text.secondary,fontStyle:"italic",height:"100%"}}}t.oktellCache=new l.Cache("oktell",D,{key:[198,221,242,55,170,125,86,249,157,15,240,131,122,167,114,233]}),t.styles=N},,function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(36),i=n(181),a=n(44),s=n(567),l=o.decode.ap(o.decode.required(["data","0","attributes","number"],o.decode.string),o.decode.optional(["data","0","relationships","driver"],u("drivers"),null),o.decode.optional(["data","0","relationships","client"],u("clients"),null),o.decode.optional(["data","0","relationships","client_employee"],u("client_employees"),null),o.decode.optional(["data","0","relationships","current_order"],u("orders"),null),function(e,t,n,r,o){return{phone:e,driver:t,client:n,client_employee:r,current_order:o}});function u(e){return o.decode.at("data",o.decode.record({id:a.stringOrNumber,type:o.decode.literals(e)}))}t.driverResource=i.resource("drivers",{name:o.decode.string,call:o.decode.string}),t.phoneInfo=function(e,n){var i={phone:n,driver:null,client:null,client_employee:null,current_order:null};return a.apiRequest(e,l,{method:"GET",url:o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/phones",{"filter[number]":n})}).onError(function(e){return o.eff.of(i)}).chainEff(function(n){return o.eff.ap(n.driver?t.driverResource.getPrimary(e,n.driver.id).onError(function(e){return o.eff.of(null)}):o.eff.of(null),n.client?s.resource.getPrimary(e,n.client.id).onError(function(e){return o.eff.of(null)}):o.eff.of(null),function(e,t){var o=n.client_employee&&t&&t.client_employees.find(function(e){return e.id==n.client_employee.id})||null;return r({},n,{driver:e,client:t,client_employee:o})})})}},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(44),i=n(144);t.coordinatesDecoder=r.decode.decoder(function(e){return e&&0!==e.latitude&&0!==e.longitude?"number"==typeof e.latitude&&"number"==typeof e.longitude?r.success(e):r.failure("Invalid coordinates"):r.success(null)});var a=r.decode.record({kind:r.decode.literals("street","point","house"),city:r.decode.string,point:r.decode.string,street:r.decode.string.withDefault(""),house:r.decode.string.withDefault(""),coordinates:t.coordinatesDecoder}),s=r.decode.at("data",r.decode.array(r.decode.at("attributes",a))),l=r.decode.ap(r.decode.at("data",r.decode.array(r.decode.at("attributes",a))),r.decode.at(["meta","total"],r.decode.nat.withDefault(0)),function(e,t){return[e,t]});t.orderAddressDecoder=r.decode.record({address:r.decode.string,coordinates:t.coordinatesDecoder.withDefault(null)}).map(function(e){var t=e.coordinates,n=i.parseAddress(e.address),r=i.printAddress(n,!1);return{city:i.stripSlashes(n.city),address:r,coordinates:t,uuid:o.nextUUID()}}),t.getCollection=function(e,t){var n={"filter[text]":t.text||void 0,"filter[crew_group]":t.crewGroup||void 0,"filter[city]":t.city||void 0,"page[limit]":t.limit||void 0,"page[offset]":t.offset||void 0,"filter[search_place]":t.searchPlaces.join(",")};return o.apiRequest(e,s,{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/addresses",n)})},t.pageCollection=function(e,t){var n={"filter[text]":t.text||void 0,"filter[crew_group]":t.crewGroup||void 0,"filter[city]":t.city||void 0,"page[limit]":t.limit||void 0,"page[offset]":t.offset||void 0,"filter[search_place]":t.searchPlaces.join(",")};return o.apiRequest(e,l,{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/addresses",n)})}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(982),a=n(159),s=n(8),l=n(11),u=n(27),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rewind=null,t.timerId=null,t.loop=function(){t.props.action()},t.handlePassRewinder=function(e){t.rewind=e},t}return r(t,e),t.prototype.componentDidMount=function(){this.props.fireOnMount?this.loop():this.timerId=setTimeout(this.loop,this.props.duration)},t.prototype.componentWillUnmount=function(){this.timerId&&(clearTimeout(this.timerId),this.timerId=null)},t.prototype.componentWillReceiveProps=function(e){this.props.listRef!==e.listRef&&(this.timerId&&clearTimeout(this.timerId),this.timerId=setTimeout(this.loop,e.duration),this.rewind&&this.rewind())},t.prototype.render=function(){var e=this.props,t=e.__,n=e.className,r=e.classes,s=e.duration,u=e.action,c=l(n,r.root);return o.createElement(a.default,{onClick:u,className:c,size:"small"},t("Refresh"),"  ",o.createElement(i.default,{className:r.circle,duration:s,onPassRewinder:this.handlePassRewinder}))},t}(o.Component);function d(e){return{root:{position:"relative","&:after":{content:'""',display:"block",position:"absolute",width:"100%",height:"100%",top:0,left:0,transition:"background-color 250ms, box-shadow, 250ms",zIndex:1e3},"&:hover":{backgroundColor:"transparent"},"&:hover:after":{backgroundColor:""+e.palette.divider}},circle:{background:""+e.palette.grey[200]}}}t.default=s.default(d)(u.withGettext(n(81))(c)),t.styles=d},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(160),s=n(73),l=n(8),u=n(27),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unlisten=null,t.handleKeyDown=function(e){"ArrowRight"===e.key&&e.ctrlKey&&t.handleRight(),"ArrowLeft"===e.key&&e.ctrlKey&&t.handleLeft(),"ArrowUp"===e.key&&e.ctrlKey&&t.handleUp(),"ArrowDown"===e.key&&e.ctrlKey&&t.handleDown()},t.handleLeft=function(){var e=t.props,n=e.offset,r=e.limit,o=e.onOffsetChange,i=e.onGotoPrev;if(!(n<=0)){i&&i();var a=Math.max(n-r,0);n!==a&&o&&o(a)}},t.handleRight=function(){var e=t.props,n=e.offset,r=e.limit,o=e.onOffsetChange,i=e.onGotoNext,a=n+r;a>=e.total||(i&&i(),n!==a&&o&&o(a))},t.handleUp=function(){var e=t.props,n=e.offset,r=e.limit,o=e.total,i=e.onOffsetChange,a=o%r==0?o-r:Math.floor(o/r)*r;n!==a&&i&&i(a)},t.handleDown=function(){var e=t.props,n=e.offset,r=e.onOffsetChange;0!==n&&r&&r(0)},t}return r(t,e),t.prototype.componentDidMount=function(){!0===this.props.listenKeyboard&&this.listenKeyboard()},t.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},t.prototype.componentWillReceiveProps=function(e){this.props.listenKeyboard&&!e.listenKeyboard&&this.unlisten&&this.unlisten(),!this.props.listenKeyboard&&e.listenKeyboard&&this.listenKeyboard()},t.prototype.listenKeyboard=function(){var e=this;window.addEventListener("keydown",this.handleKeyDown),this.unlisten=function(){return window.removeEventListener("keydown",e.handleKeyDown)}},t.prototype.render=function(){var e=this.props,t=e.__,n=e.className,r=e.limit,s=e.offset,l=e.total,c=e.reactHint,d=e.listenKeyboard,p=e.classes,f=s+r>=l,h=s<=0,m=s+r>l?l:s+r,g=i(p.root,n),v=i(p.button,h?p.disabled:void 0),y=i(p.button,f?p.disabled:void 0),_=u.sprintf(t("<b>%d</b>&ndash;<b>%d</b> of <b>%d</b>","<b>%d</b>&ndash;<b>%d</b> of <b>%d</b>",void 0,l),s+1,m,l),b=c&&d?t("Go back (CTRL+LEFT)"):void 0,C=c&&d?t("Go forward (CTRL+RIGHT)"):void 0;return o.createElement("div",{className:g},o.createElement("span",{dangerouslySetInnerHTML:{__html:_},className:p.claim}),o.createElement("div",{className:p.navigationGroup},o.createElement("span",{className:v,onClick:this.handleLeft,"data-rh":b},o.createElement(a.default,null,"navigate_before")),o.createElement("span",{className:y,onClick:this.handleRight,"data-rh":C},o.createElement(a.default,null,"navigate_next"))))},t}(o.Component);function d(e){return{root:{display:"flex",flexDirection:"row",alignItems:"center"},navigationGroup:{boxShadow:"0 1px 6px rgba(0,0,0,.12),0 1px 4px rgba(0,0,0,.12)",background:"white",borderRadius:2,display:"flex",flexDirection:"row",alignItems:"center",tratatata:"",marginLeft:2*e.spacing.unit,"& > * + *":{borderLeft:"solid 1px "+e.palette.divider},"& > *:first-child":{borderLeft:"none",borderTopLeftRadius:2,borderBottomLeftRadius:2},"& > *:last-child":{borderTopRightRadius:2,borderBottomRightRadius:2}},claim:{fontSize:14,color:e.palette.text.primary,"& b":{fontWeight:500}},button:{height:36,width:36,textAlign:"center",background:"white",color:e.palette.text.secondary,userSelect:"none",cursor:"pointer","&:hover":{background:s.fade(e.palette.text.primary,.1),color:e.palette.text.primary},"& > *":{display:"inline-block",verticalAlign:"middle"},"&:after":{content:'""',display:"inline-block",verticalAlign:"middle",width:.1,height:"100%"}},disabled:{background:"white !important",color:e.palette.text.secondary+" !important",cursor:"not-allowed !important"}}}t.default=l.default(d)(u.withGettext(n(983))(c)),t.styles=d},,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),l=n(8),u=n(11),c=n(27),d=n(1073),p=n(1074),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={type:null},t.handleChange=function(e){var n=t.props,r=n.onValueChange,o=n.filter,i=n.regexFilter;o&&!o(e.target.value)||i&&!i.test(e.target.value)||r&&r(e.target.value)},t.handleSwitchPassword=function(){var e=t.state.type;t.setState({type:"password"===e?"text":"password"})},t}return r(t,e),t.getDerivedStateFromProps=function(e,t){return"password-switch"===e.type&&null===t.type?{type:"password"}:"password-switch"!==e.type&&null!==t.type?{type:null}:null},t.prototype.render=function(){var e,t,n=this.props,r=n.__,i=n.ctx,l=n.classes,c=n.fullWidth,f=n.error,h=n.inputProps,m=n.onBlur,g=(n.onChange,n.onFocus),v=n.value,y=n.beginAdornment,_=n.endAdornment,b=n.className,C=n.disabled,w=n.onKeyDown,E=n.type,S=n.Input,T=n.placeholder,O=a(n,["__","ctx","classes","fullWidth","error","inputProps","onBlur","onChange","onFocus","value","beginAdornment","endAdornment","className","disabled","onKeyDown","type","Input","placeholder"]),A=u(b,l.root,((e={})[l.disabled]=C,e[l.error]=f,e[l.textarea]="textarea"===S,e[l.fullWidth]=c,e)),x=u(l.input,((t={})[l.error]=f,t)),k=S||"input",R="password-switch"!==E?_:s.createElement(s.Fragment,null,_,s.createElement("span",{className:l.eye,onClick:this.handleSwitchPassword,dangerouslySetInnerHTML:{__html:"password"===this.state.type?d:p},"data-rh":"password"===this.state.type?r("Show password"):r("Hide password")}));return s.createElement("div",o({},O,{className:A}),y,s.createElement(k,o({placeholder:T},h,{type:"password-switch"===E?this.state.type:E,className:x,onChange:this.handleChange,value:v||"",disabled:C,onFocus:g,onBlur:m,onKeyDown:w,"data-rh-at":"right","data-rh":"string"==typeof f||"function"==typeof f?"string"==typeof f?f:f(i):void 0})),R)},t=i([l.default(h)],t)}(s.Component);function h(e){var t=e.spacing.unit;return{root:{height:4*t,boxSizing:"border-box",display:"inline-flex",alignItems:"center",background:"rgba(0,0,0,0.04)",borderRadius:3,position:"relative",paddingRight:.5*t,"&$error":{background:"rgba(255,0,0,0.08)","& .material-icons":{color:"rgba(255,0,0,0.54)"}},"& .material-icons":{fontSize:18}},disabled:{cursor:"not-allowed"},input:{padding:[t,t],outline:"none",border:"none",background:"none",flex:"10 10 auto",height:"100%",width:"100%",boxSizing:"border-box",fontSize:14,color:e.palette.text.primary,"&[disabled]":{color:e.palette.text.disabled,cursor:"not-allowed"},"&:after":{content:'""',position:"absolute",display:"block",width:"100%",height:0},"&:focus:after":{background:e.palette.primary.main,height:2},"&$error:after":{background:e.palette.error.main},"& + *":{marginLeft:-t},"&::placeholder":{fontStyle:"italic",fontSize:14},"&$error::placeholder":{color:"rgba(255,0,0,0.54)"}},textarea:{height:"auto",width:"100%",padding:0,"& textarea":{padding:t}},eye:{width:22},error:{},fullWidth:{width:"100%"}}}t.TextField=f,t.default=c.withGettext(n(213))(f)},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),l=n(54),u=n(1079),c=n(404),d=n(48),p=n(681),f=n(8),h=n(1080),m=n(106),g=n(244),v=n(50),y=n(11),_=n(27),b=n(73),C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=o({},h.init(),{value:null}),t.debounceTimer=null,t.subscription=null,t.paperPrevScroll=null,t.paperEl=null,t.dispatch=function(e){var n=t.props,r=n.ctx,i=n.openOnFocus,a=n.openOnClick,s=n.source,l=o({},r,{options:{openOnFocus:i,openOnClick:a,source:s}});t.setState(function(n){var r=h.update(l,e,n),o=r[0];return r[1].subscribe(function(e){return"Right"===e.tag&&t.dispatch(e.value)}),o})},t.handleValueChange=function(e){var n=t.props.debounce||500;t.setState({value:e}),t.debounceTimer&&clearTimeout(t.debounceTimer),e||!t.props.nonNull&&t.handleSuggestionSelect("null"in t.props?t.props.null:null),t.debounceTimer=setTimeout(function(){return t.debounceTimer=null,t.dispatch({tag:"Search",value:e})},n)},t.handleChange=function(e){t.handleValueChange(e.target.value)},t.handleFocus=function(e){t.dispatch({tag:"Focus"}),t.props.onFocus&&e&&t.props.onFocus(e)},t.handleBlur=function(e){t.dispatch({tag:"Blur"}),t.setState({value:null}),t.props.onBlur&&e&&t.props.onBlur(e)},t.handleClick=function(e){t.dispatch({tag:"Click"})},t.handleToggleVisibility=function(){t.state.open?t.dispatch({tag:"Close"}):t.dispatch({tag:"Open"})},t.handleKeyDown=function(e){switch(e.key){case"ArrowDown":!t.state.open&&t.dispatch({tag:"Open"})}},t.handleSuggestionSelect=function(e){var n=t.props,r=n.keepOpenAfterSelect,o=n.onValueChange,i=n.disabled;t.setState({value:null}),!r&&t.dispatch({tag:"Blur"}),!i&&o&&o(e)},t.handleVisibilityChnage=function(e){e?t.dispatch({tag:"Open"}):t.dispatch({tag:"Close"})},t.handleCloseClick=function(e){e.stopPropagation(),t.setState({value:null}),!t.props.nonNull&&t.handleSuggestionSelect("null"in t.props?t.props.null:null)},t.getValue=function(){var e=t.props.printItem;if(null!==t.state.value)return t.state.value;var n=t.props.value;return(e||String)(n)||""},t.endAdornment=g.default(function(e,n,r){return s.createElement(s.Fragment,null,s.createElement(p.default,{onClick:n?void 0:t.handleToggleVisibility},"arrow_drop_down"),!e&&s.createElement(p.default,{onClick:n?void 0:t.handleCloseClick,"data-rh":r("Clear")},"close"))}),t.childrenProps=function(){var e=t.props,n=e.nonNull,r=e.disabled,i=e.__;return o({},v.pick(t.props,"disabled","error","fullWidth","placeholder","ctx"),{value:t.getValue(),onValueChange:r?void 0:t.handleValueChange,onChange:r?void 0:t.handleChange,onFocus:r?void 0:t.handleFocus,onBlur:r?void 0:t.handleBlur,onKeyDown:r?void 0:t.handleKeyDown,onClick:r?void 0:t.handleClick,endAdornment:t.endAdornment(!!n,!!r,i)})},t.handleSeeMore=function(e){e.preventDefault(),e.stopPropagation(),t.paperEl=e.currentTarget.parentElement.parentElement,t.paperPrevScroll=t.paperEl.scrollTop,t.dispatch({tag:"More"})},t}return r(t,e),t.prototype.componentDidMount=function(){this.anchorEl=l.findDOMNode(this)},t.prototype.componentDidUpdate=function(){this.paperEl&&this.paperPrevScroll&&this.paperEl.scrollTop!==this.paperPrevScroll&&(this.paperEl.scrollTo(0,this.paperPrevScroll),this.paperEl=null,this.paperPrevScroll=null)},t.prototype.componentWillReceiveProps=function(e){e.observable!==this.props.observable&&this.listen(e)},t.prototype.componentWillUnmount=function(){this.unlisten(),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)},t.prototype.listen=function(e){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),e.observable&&(this.subscription=e.observable.subscribe(this.dispatch))},t.prototype.unlisten=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)},t.prototype.renderSeeMoreLink=function(){var e=this.props,t=e.__,n=e.classes,r=this.state,o=r.total,i=r.query,a=i.limit,l=i.offset;return 0!==o&&a+l>=o?null:s.createElement(d.ListItem,{className:n.seeMore},s.createElement("a",{href:"javascript://void 0",onMouseDown:this.handleSeeMore},t("See more")))},t.prototype.render=function(){var e,t=this.props,n=t.className,r=t.fullWidth,i=t.children,l=t.ctx,d=(t.source,t.debounce,t.renderItem),p=t.printItem,f=(t.openOnFocus,t.openOnClick,t.suggestionProps),h=(t.keepOpenAfterSelect,t.textFieldProps),m=t.classes,g=t.anchorEl,v=t.observable,_=a(t,["className","fullWidth","children","ctx","source","debounce","renderItem","printItem","openOnFocus","openOnClick","suggestionProps","keepOpenAfterSelect","textFieldProps","classes","anchorEl","observable"]),b=this.state,C=b.suggestions,w=b.open,E=b.pending,S=y(m.root,n,((e={})[m.fullWidth]=r,e));return s.createElement("div",o({},_,{className:S}),!v&&(i?s.cloneElement(i,this.childrenProps()):s.createElement(c.default,o({},this.childrenProps(),h))),s.createElement(u.default,o({},f,{pending:E,ctx:l,anchorEl:g||this.anchorEl||void 0,open:w,suggestions:C,renderSuggestion:d||p,onSelect:this.handleSuggestionSelect,onVisibilityChange:this.handleVisibilityChnage,after:this.renderSeeMoreLink()})))},t.defaultProps={openOnFocus:!0,openOnClick:!0,fullWidth:!0,printItem:function(e){return e?String(e):""}},t=i([f.default(E),_.withGettext(n(213))],t)}(s.Component);t.default=C;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.observable=new m.Subject,t.debounceTimer=null,t.handleValueChange=function(e){var n=t.props.children.props.onValueChange,r=t.props.debounce||500;t.debounceTimer&&clearTimeout(t.debounceTimer),t.debounceTimer=setTimeout(function(){return t.debounceTimer=null,t.observable.next({tag:"Search",value:e})},r),n&&n(e)},t.handleFocus=function(e){var n=t.props.children.props.onFocus;t.observable.next({tag:"Focus"}),n&&n(e)},t.handleBlur=function(e){var n=t.props.children.props.onBlur;t.observable.next({tag:"Blur"}),n&&n(e)},t.handleKeyDown=function(e){var n=t.props.children.props.onKeyDown;switch(e.key){case"ArrowDown":t.observable.next({tag:"Open"})}n&&n(e)},t}return r(t,e),t.prototype.componentWillUnmount=function(){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)},t.prototype.render=function(){return s.cloneElement(this.props.children,{onValueChange:this.handleValueChange,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown})},t}(s.Component);function E(e){var t=e.spacing.unit,n={color:e.palette.primary.main,textDecoration:"none","&:hover":{color:b.fade(e.palette.primary.main,.75)},"&:active":{color:e.palette.error.main}};return{root:{"& > div":{position:"relative"}},fullWidth:{width:"100%"},seeMore:{marginBottom:-t,"& a":o({display:"block",width:"100%",height:"100%",textAlign:"center"},n)}}}t.CreateObservable=w,t.styles=E},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(50);t.currencyFormatter=r.memoize(function(e){var t=e.locale,n=e.currency;if("RUB"===n&&"ru-RU"===t){var r=new Intl.NumberFormat(t,{style:"decimal",minimumFractionDigits:0});return function(e){return r.format(e)+" руб"}}var o=new Intl.NumberFormat(t,{currency:n,style:"currency",minimumFractionDigits:0});return function(e){return o.format(e)}})},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(36),s=n(295),l=n(296),u=n(44),c=n(99),d=n(8),p=n(132),f=n(305),h=n(27),m=n(11),g=h.Translations.fromPO(n(246),n(213),n(215));t.initExisted=function(e,t){return a.eff.ap(s.resource.getPrimary(e,t),l.resource.getCollection(e).mapEff(function(e){return e.filter(l.hasScope("car"))}),s.getColors(e),s.getBrands(e),function(e,t,n,r){return{initial:e,modified:null,attributes:t,pending:!1,colors:n,brands:r}})},t.initNew=function(e){return a.eff.ap(l.resource.getCollection(e).mapEff(function(e){return e.filter(l.hasScope("car"))}),s.getColors(e),s.getBrands(e),function(e,t,n){return{initial:s.blank,modified:null,attributes:e,pending:!1,colors:t,brands:n}})},t.update=function(e,n,r){var i=g.__;switch(n.tag){case"Pending":return[o({},r,{pending:n.pending}),a.noop];case"Reset":case"Reset":return[o({},r,{modified:null}),a.noop];case"Change":return[t.form.modify(r,u.updateAt(n.at,n.value)),a.noop];case"Post":var l=function(){return{tag:"Post/success"}},d=t.form.get(r);return[r,u.pending(s.resource.postResource(e,d).perform(u.onFailure,l))];case"Post/success":return[r,c.notifySuccess(i("Item created"))];case"Patch":if(!r.modified)return[r,a.noop];var p=u.makePatch(r.initial,r.modified);return l=function(){return{tag:"Patch/success"}},[r,u.pending(s.resource.patchResource(e,r.initial.id,p).perform(u.onFailure,l))];case"Patch/success":var f=t.form.get(r);return[o({},r,{initial:f,modified:null}),c.notifySuccess(i("Item changed"))];case"Delete":return l=function(){return{tag:"Delete/success"}},[r,u.pending(s.resource.deleteResource(e,r.initial.id).perform(u.onFailure,l))];case"Delete/success":return[r,c.notifySuccess(i("Item deleted"))]}};var v=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.zoom=t.form.createZoom(n),n}return r(n,e),n.prototype.render=function(){var e,t=this.props,n=t.model,r=t.classes,a=t.className,s=t.noPadding,l=t.__,u=this.zoom,c=m(a,r.root,((e={})[r.noPadding]=s,e));return i.createElement("div",{key:"form",className:c},i.createElement("div",null,i.createElement(p.Label,null,l("Color")),i.createElement(p.AutoComplete,o({},u("color"),{source:n.colors,nonNull:!0,textFieldProps:{fullWidth:!0}}))),i.createElement("div",null,i.createElement(p.Label,null,l("Brand")),i.createElement(p.AutoComplete,o({},u("brand"),{source:n.brands,nonNull:!0,textFieldProps:{fullWidth:!0}}))),i.createElement("div",null,i.createElement(p.Label,null,l("Plate")),i.createElement(p.TextField,o({},u("plate"),{fullWidth:!0}))),i.createElement("div",null,i.createElement(p.Label,null,l("Attributes")),i.createElement(p.MultiSelect,o({},u("attributes"),{source:n.attributes,textFieldProps:{placeholder:l("Choose attributes"),fullWidth:!0},printItem:function(e){return e?e.name:""},isEqual:function(e,t){return e.id===t.id}}))))},n}(u.PureComponent);function y(e){var t=e.spacing.unit;return{root:{padding:[0,2*t,2*t,2*t],"& > * + *":{marginTop:t}},buttons:{flex:"0 0 auto",display:"flex",width:"100%",boxSizing:"border-box",padding:[t,2*t,t,t],justifyContent:"space-between"},dialogButtons:{flex:"0 0 auto",display:"flex",width:"100%",boxSizing:"border-box",justifyContent:"space-between"},noPadding:{padding:0,height:"initial"}}}t.View=d.default(y)(h.withGettext(n(215))(v)),t.isReadOnly=function(e,t){return!1},t.form=f.default({validate:function(e){var t={};return e.color||(t.color=g.__("Cannot be empty")),e.brand||(t.brand=g.__("Cannot be empty")),t},disabled:function(e,t){var n=t.props.ctx;return u.isNew(e)?!n.profile.access_rights.cars_add:!n.profile.access_rights.cars_edit}}),t.styles=y},,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(54),s=n(36),l=n(414),u=n(729),c=n(351),d=n(273),p=n(99),f=n(247),h=n(9);n(804),n(364);var m=n(806),g=n(822),v=n(823),y=n(824),_=n(825),b=n(354),C=n(354),w=n(565),E=n(827),S=n(275),T=n(566),O=S.create({plugins:T.default().plugins}),A=n(367),x=n(1190),k=n(206),R=n(689),I=n(1199),D=n(143),N=n(245),P=I(i),j=n(564);h.tz.add(j),n(1200),n(1246),n(1252);var L=N.default.validateConfigs(c.json({locale:M(),xSite:location.hostname}),c.json(N.__CONFIG__),c.json(p.contextCache.readSync().fold(function(){return{}},function(e){return e})),c.queryString(location.search));function M(e,t){var n=window.navigator.languages.slice();for(var r in window.navigator.language&&n.unshift(window.navigator.language),t&&t.locale&&n.unshift(t.locale.replace(/_/g,"-")),e&&null!==e.locale&&n.unshift(e.locale),n){var o=u.lookupLocale(n[r],N.__INFO__.locales);if(o)return o}return"en-US"}t.config="Right"===L.tag?L.value:function(){throw d.printProblems(L.value),new Error("Invalid configuration")}(),function(){var e="font-weight: 600",t="font-weight: initial";(console.info||console.log).bind(console)("You are running the app version %c%s%c, built at %c%s%c, revision %c%s%c",e,N.__INFO__.version,t,e,N.__INFO__.builtAt,t,e,N.__INFO__.revision,t)}();var U=f.cache.read().onError(function(e){return t.config.token?s.eff.of({id:"",auth_token:t.config.token}):s.eff.failure(e)});var F={Operator:k,Login:x,OnlyOrderCard:R};function q(){return A.oktellCache.read().onError(function(){return s.eff.of({login:t.config.oktellLogin,password:t.config.oktellPassword})}).chainEff(function(e){return U.chainEff(function(n){var r=o({},t.config,{auth:n});return s.eff.ap(g.get(r),y.get(r),v.get(r),_.get(r),function(e,t,n,r){return{settings:e,profile:t,features:n,tmSettings:r}}).chainEff(function(r){var i=M(t.config,r.settings);h.locale(i),r.settings.timezone&&h.tz.setDefault(r.settings.timezone);var a=null===t.config.goBackBehaviour?r.tmSettings.back_order_change_route?"new":"old":t.config.goBackBehaviour;return s.eff.of(o({},t.config,r,{locale:i,auth:n,gisMapType:t.config.gisMapType,currency:r.settings.currency,oktellLogin:e.login,oktellPassword:e.password,goBackBehaviour:a}))})}).onError(function(e){var n=M(t.config);return h.locale(n),s.eff.of(o({},t.config,{locale:n}))})}).chainEff(function(e){return"auth"in e&&e.auth?e.fromPhone&&!e.fullFeaturedOnURL?R.init(e,e.fromPhone).mapEff(function(t){return{tag:"OnlyOrderCard",ctx:e,state:t}}):k.init(e).mapEff(function(t){return{tag:"Operator",ctx:e,state:t}}):s.eff.of({tag:"Login",ctx:e,state:x.init})})}var B=function(e){return function(t){return{tag:"Nested/application",application:e,action:t}}};function H(e,t){var n,r=function(e){return{tag:"Error",error:e}};switch(e.tag){case"Init":return[o({},t,{application:e.application}),s.noop];case"Logout":if("FatalError"==t.application.tag)return[t,s.noop];var i=function(e){return{tag:"Init",application:e}};return[t,a=s.cmd.batch(f.cache.clear().performForget(),f.logout(t.application.ctx).performForget(),q().perform(r,i))];case"Login":i=function(e){return{tag:"Init",application:e}};var a=s.cmd.batch([f.cache.save(e.auth).performForget(),A.oktellCache.save({login:e.login,password:e.password}).performForget(),q().perform(r,i)]);return[function(e){var t=e.application;return"Login"===t.tag?o({},e,{application:o({},t,{state:o({},t.state,{pending:!0})})}):e}(t),a];case"RefreshToken":return"FatalError"==t.application.tag?[t,s.noop]:t.application.ctx.auth?[o({},t,{application:o({},t.application,{ctx:o({},t.application.ctx,(n={},n.auth=e.auth,n))})}),s.noop]:[t,s.noop];case"Context/next":return"FatalError"==t.application.tag?[t,s.noop]:t.application.ctx?[o({},t,{application:o({},t.application,{ctx:e.ctx})}),s.cmd.forget(function(){return h.locale(e.ctx.locale)})]:[t,s.noop];case"Nested/application":if("Login"===e.application&&"Submit/success"===e.action.tag){var l=t.application.state.modified||t.application.state.initial,u=l.login,c=l.password;return[t,s.cmd.of({tag:"Login",auth:e.action.payload,login:u,password:c})]}if(e.application!==t.application.tag||"FatalError"===t.application.tag)return[t,s.noop];var d=F[t.application.tag].update(t.application.ctx,e.action,t.application.state),m=d[0];a=d[1];return[o({},t,{application:o({},t.application,{state:m})}),a.mapCmd(B(e.application))];case"Error":var g=b.error(p.describeError(e.error));if("Unauthentificated"===e.error.tag){i=function(e){return{tag:"Init",application:e}};return[t,f.cache.clear().chainEff(q).perform(r,i)]}if("HttpError"===e.error.tag&&"ValidationProblem"===e.error.error.tag){var v=e.error.error,y=v.problem,_=v.url;return[t,s.cmd.batch(s.cmd.forget(function(){return s.decode.printProblems(y)}),s.cmd.forget(function(){return console.log("%cProblem response:","font-weight: 600;",_)}),g)]}return[t,s.cmd.batch(s.cmd.forget(function(){return console.error(e.error)}),g)]}}t.update=H;var V=function(e){function t(t){var n=e.call(this,t)||this;return n.dispatch=function(e){var t=H(e,n.nextState),r=t[0],o=t[1];n.nextState!==r?(n.nextState=r,n.setState(r)):n.nextState=r,o.subscribe(function(e){return"Right"===e.tag&&n.dispatch(e.value)})},n.state=t,n.nextState=t,n}return r(t,e),t.prototype.componentDidMount=function(){"FatalError"===this.props.application.tag&&this.dispatch({tag:"Error",error:this.props.application.error})},t.prototype.renderApplication=function(e){var t=this;switch(e.tag){case"Login":return i.createElement(x.View,{ctx:e.ctx,model:e.state,dispatch:function(n){return t.dispatch(B(e.tag)(n))}});case"Operator":return i.createElement(k.View,{ctx:e.ctx,model:e.state,dispatch:function(n){return t.dispatch(B(e.tag)(n))}});case"OnlyOrderCard":return i.createElement(R.View,{ctx:e.ctx,model:e.state,dispatch:function(n){return t.dispatch(B(e.tag)(n))}});case"FatalError":return i.createElement("div",null,i.createElement("h2",{style:{textAlign:"center",padding:16,fontWeight:500,fontSize:22}},"Sorry, an error occurred :("),i.createElement("p",{style:{textAlign:"center",padding:16,fontSize:16}},p.describeError(e.error)(null)))}},t.prototype.render=function(){var e=this,t=(this.nextState||this.state).application;return i.createElement(i.Fragment,null,this.renderApplication(t),i.createElement(l.default,{to:f.logoutStream,handler:function(){return e.dispatch({tag:"Logout"})}}),i.createElement(l.default,{to:p.errorsStream,handler:function(t){return e.dispatch({tag:"Error",error:t})}}),i.createElement(l.default,{to:p.contextStream,handler:function(t){return e.dispatch({tag:"Context/next",ctx:t})}}),i.createElement(P,{events:!0,delay:100}),"FatalError"!==t.tag&&i.createElement(C.default,{ctx:t.ctx}))},t}(i.Component);t.View=D.withStyles(Y)(V);var z=["app","spinner"].map(function(e){return document.getElementById(e)}),G=z[0],W=z[1];function K(e){return a.render(i.createElement(E.default,{jss:O},i.createElement(w.default,{theme:m.theme},i.createElement(t.View,{application:e}))),document.getElementById("app"),function(){G.style.display="initial",W.parentNode&&W.parentNode.removeChild(W)})}function Y(e){var t=e.spacing.unit;return{"@global":{"html, body, #app":{height:"100%",margin:0,fontSize:16},"body, body *":{fontFamily:"Roboto, serif"},body:{overflowX:"hidden"},".material-icons":{fontSize:22},"[data-desktop-input]":{width:"100%","& > *:before":{backgroundColor:"rgba(0,0,0,0.0)"},"& > div:first-child, & > label + div":{background:"rgba(0,0,0,0.06)"},"& input, & textarea":{width:"100%",paddingLeft:t,paddingRight:t,boxSizing:"border-box"}},"*::-webkit-scrollbar":{width:5,backgroundColor:"#ddd"},"*::-webkit-scrollbar-thumb":{background:"rgba(0, 0, 0, 0.4)"}}}}q().subscribe(function(e){"Left"===e.tag?K({tag:"FatalError",error:e.value}):K(e.value)}),t.styles=Y},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(106),o=n(270),i=n(179);function a(e){return r.Observable.create(function(t){var n=new XMLHttpRequest;n.addEventListener("error",function(){return t.next(i.failure({tag:"NetworkError"})),t.complete()}),n.addEventListener("timeout",function(){return t.next(i.failure({tag:"Timeout"})),t.complete()}),n.addEventListener("load",function(){t.next(i.success({url:n.responseURL,status:n.status,statusText:n.statusText,headers:function(e){var t={},n=e.split("\r\n");for(var r in n){var o=n[r].indexOf(": ");if(!(o<0)){var i=n[r].substring(0,o),a=n[r].substring(o+2);t[i]=a}}return t}(n.getAllResponseHeaders()),body:n.response||n.responseText})),t.complete()});try{n.open(e.method,e.url,!0)}catch(n){t.next(i.failure({tag:"BadUrl",desc:e.url})),t.complete()}if(e.timeout&&(n.timeout=e.timeout),void 0!==e.withCredentials&&(n.withCredentials=e.withCredentials),void 0!==e.headers)for(var r in e.headers)if(e.headers.hasOwnProperty(r)){var o=e.headers[r];null!=o&&n.setRequestHeader(r,String(o))}var a="[object Object]"===Object.prototype.toString.apply(e.body)?JSON.stringify(e.body):e.body;return n.send(a),function(){return n.abort()}})}function s(e,t){if(""===e)return t;if(""===t)return e;var n=e.length&&"/"===e[e.length-1],r=t.length&&"/"===t[0];return n&&r?e.substring(0,e.length-1)+t:n||r?e+t:e+"/"+t}t.send=a,t.get=function(e,t){return a(Object.assign({},t,{method:"GET",url:e}))},t.post=function(e,t){return a(Object.assign({},t,{method:"POST",url:e}))},t.expectJSON=function(e){return function(t){if(""===t.body)return o.failure({tag:"BadPayload",desc:"empty body"});var n=null;try{n=JSON.parse(t.body)}catch(e){return o.failure({tag:"BadPayload",desc:"invalid json"})}return r.of(e.validate(n).mapLeft(function(e){return{tag:"ValidationProblem",problem:e,url:t.url}}))}},t.handleBadStatus=function(e,t){return function(n){if(n.status<400)return o.success(n);var r=null;try{r=JSON.parse(n.body)}catch(e){return o.failure(t({tag:"BadPayload",desc:"invalid json"}))}var i=e.validate(r).fold(function(e){return t({tag:"BadStatus",status:n.status,desc:n.statusText})},function(e){return e});return o.failure(i)}},t.join=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="",r={},o="";for(var i in e){var a=e[i];"string"==typeof a?n=s(n,a):Object.assign(r,a)}for(var l in r)if(r.hasOwnProperty(l)&&void 0!==r[l]&&null!==r[l])if(Array.isArray(r[l]))for(var u=0,c=r[l];u<c.length;u++){var d=c[u];void 0!==r[l]&&null!==r[l]&&(o+=(o?"&":"")+encodeURIComponent(l)+"="+encodeURIComponent(d))}else o+=(o?"&":"")+encodeURIComponent(l)+"="+encodeURIComponent(r[l]);return o?n+"?"+o:n}},function(e,t){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.get=e,this.set=t}return e.fromProp=function(t){return new e(function(e){return e[t]},function(e,r){var o;return n({},r,((o={})[t]=e,o))})},e.prototype.modify=function(e,t){return this.set(e,t(this.get(e)))},e.prototype.compose=function(t){var n=this;return new e(function(e){return t.get(n.get(e))},function(e,r){return n.set(e,t.set(n.get(e),r))})},e}();t.Lens=r,t.lens=function(e,t){return new r(e,t)};var o=function(){return function(e,t){this.match=e,this.build=t}}();t.Prism=o},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(106),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unlisten=null,t.handler=function(e){t.props.handler(e)},t}return r(t,e),t.prototype.componentDidMount=function(){this.listen(this.props)},t.prototype.componentWillReceiveProps=function(e){this.props.to!==e.to&&(this.unlisten&&this.unlisten.unsubscribe(),this.listen(e))},t.prototype.componentWillUnmount=function(){this.unlisten&&(this.unlisten.unsubscribe(),this.unlisten=null)},t.prototype.listen=function(e){var t=this,n=e.to,r=e.event;if(n instanceof i.Observable)this.unlisten=n.subscribe(this.handler);else{if(!r)throw new Error("Sub: unspecified `event`");n.addEventListener(r,this.handler),this.unlisten={unsubscribe:function(){return n.removeEventListener(r,t.handler)},closed:!0}}},t.prototype.render=function(){return null},t}(o.Component);t.default=a},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(36),a=n(106),s=n(416),l=n(159),u=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={notifications:[]},t.handleClose=function(){if(0!==t.state.notifications.length){var e=t.state.notifications.slice();e.splice(0,1),t.setState({notifications:e})}},t.handleNotification=function(e){var n=t.state.notifications.slice();n.push([Date.now(),e]),t.setState({notifications:n})},t}return r(n,e),n.prototype.componentDidMount=function(){this.subscription=t.notificationStream.subscribe(this.handleNotification)},n.prototype.componentWillUnmount=function(){this.subscription&&this.subscription.unsubscribe()},n.prototype.render=function(){var e=this.props.ctx,t=this.state.notifications.length>0,n=t?this.state.notifications[0][1].message:void 0;return o.createElement(s.default,{key:this.state.notifications.length?this.state.notifications[0][0]:void 0,open:t,autoHideDuration:1e4,action:o.createElement(l.default,{color:"primary",size:"small",onClick:this.handleClose},"OK"),message:n?n(e):void 0,onClose:this.handleClose})},n}(o.Component);t.default=u,t.notificationStream=new a.Subject,t.notify=function(e){return i.cmd.forget(function(){return t.notificationStream.next(e)})},t.error=function(e){return t.notify({tag:"error",message:e})},t.warning=function(e){return t.notify({tag:"warning",message:e})},t.success=function(e){return t.notify({tag:"success",message:e})}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(269),o=n(269),i=n(179);function a(e){return o.decoder("jsonapi.tolerantDict",function(t){if("[object Object]"!==Object.prototype.toString.call(t))return i.failure("not an object");var n={};for(var r in t)if(t.hasOwnProperty(r)){var o=e.validate(t[r]);switch(o.tag){case"Left":continue;case"Right":n[r]=o.value}}return i.success(n)})}t.stringOrNumber=o.decoder("stringOrNumber",function(e){return"string"==typeof e||"number"==typeof e?i.success(String(e)):i.failure("not a string nor a number")}),t.identifier=r.ap(o.required("id",t.stringOrNumber),o.required("type",r.string),o.optional("meta",a(r.any),null),function(e,t,n){return{id:e,type:t,meta:n}}),t.linkage=r.oneOf(r.null,t.identifier,r.array(t.identifier)),t.link=r.oneOf(r.string,r.ap(o.required("href",r.string),o.optional("meta",a(r.any),null),function(e,t){return{href:e,meta:t}})),t.relationship=r.ap(o.required("data",t.linkage),o.optional("meta",a(r.any),null),o.optional("links",a(t.link),null),function(e,t,n){return{data:e,meta:t,links:n}}),t.resource=r.ap(o.required("id",t.stringOrNumber),o.required("type",r.string),o.optional("attributes",a(r.any),null),o.optional("relationships",a(t.relationship),null),o.optional("meta",a(r.any),null),function(e,t,n,r,o){return{id:e,type:t,attributes:n,relationships:r,meta:o}}),t.jsonapi=o.required("version",r.string).map(function(e){return{version:e}}),t.document=r.ap(o.optional("data",r.oneOf(t.resource,r.array(t.resource),r.null),void 0),o.optional("meta",a(r.any),null),o.optional("included",r.array(t.resource),null),o.optional("jsonapi",t.jsonapi,null),o.optional("links",a(t.link),null),function(e,t,n,r,o){return{data:e,meta:t,included:n,jsonapi:r,links:o}}),t.errorObject=r.ap(o.optional("id",r.string,null),o.optional("links",a(t.link),null),o.optional("status",t.stringOrNumber,null),o.optional("code",r.string,null),o.optional("title",r.string,null),o.optional("detail",r.string,null),o.optional("details",r.string,null),o.optional("source",r.record({pointer:r.string,parameter:r.string}),null),function(e,t,n,r,o,i,a,s){return{id:e,links:t,status:n,code:r,title:o,detail:i||a,source:s}}),t.errors=r.ap(o.required("errors",r.array(t.errorObject)),o.optional("meta",a(r.any),null),o.optional("jsonapi",t.jsonapi,null),o.optional("links",a(t.link),null),function(e,t,n,r){return{errors:e,meta:t,jsonapi:n,links:r}}),t.attributes=function(e,t){return t.validate(e.attributes)},t.primary=function(e){return"[object Object]"===Object.prototype.toString.call(e.data)?i.success(e.data):i.failure("jsonapi.primary: jsonapi document doesn't contain primary resorce")},t.collection=function(e){return Array.isArray(e.data)?i.success(e.data):i.failure("jsonapi.collection: jsonapi document doesn't contain collection of resorces")},t.meta=function(e,t){return t.validate(e.meta)},t.related=function(e,t,n){if(e.included&&t.relationships&&t.relationships[n]){var r=t.relationships[n];if(null!==r.data&&!Array.isArray(r.data)){var o=r.data,a=o.id,s=o.type,l=e.included.find(function(e){return e.id===a&&e.type===s});return l?i.success(l):i.failure("jsonapi.related: cannot find related resource "+n+" -> '"+s+"', #"+a+" for '"+t.type+"', #"+t.id)}}return i.failure("jsonapi.related: cannot find related resource "+n+" for '"+t.type+"', #"+t.id)},t.relatedCollection=function(e,t,n){if(e.included&&t.relationships&&t.relationships[n]){var r=t.relationships[n];if(Array.isArray(r.data)){var o=[],a=function(t){var a=r.data[t],s=a.id,l=a.type,u=e.included.find(function(e){return e.id===s&&e.type===l});if(!u)return{value:i.failure("jsonapi.relatedCollection: cannot find related resource '"+n+"', id: "+s)};o.push(u)};for(var s in r.data){var l=a(s);if("object"==typeof l)return l.value}return i.success(o)}}return i.failure("jsonapi.relatedCollection: cannot find related resource '"+n+"' for '"+t.type+"', #"+t.id)},t.relatedLinkage=function(e,t){if(e.relationships&&e.relationships[t]){var n=e.relationships[t];return null===n.data||Array.isArray(n.data)?i.failure("jsonapi.relatedLinkage: cannot find relationship '"+t+"' for "+e.type+"#"+e.id):i.success(n.data)}return i.failure("relatedLinkage: trying to access relationship '"+t+"' on "+e.type+"#"+e.id+": resource doesn't have relationships")},t.relatedLinkageCollection=function(e,t){if(e.relationships&&e.relationships[t]){var n=e.relationships[t];return Array.isArray(n.data)?i.success(n.data):i.failure("relatedLinkageCollection: cannot find relationship '"+t+"' for "+e.type+"#"+e.id)}return i.failure("relatedLinkageCollection: trying to access relationship '"+t+"' on "+e.type+"#"+e.id+": resource doesn't have relationships")},t.tolerantDict=a},,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(181);t.resource=o.resource("clients",{name:r.decode.string,bonus_balance:r.decode.float.withDefault(0),cashless_balance:r.decode.float.withDefault(0),max_bonus_can_use:r.decode.float.withDefault(0),max_cashless_can_use:r.decode.float.withDefault(0),use_cashless_by_default:r.decode.boolean.withDefault(!1),password:r.decode.string.map(function(e){return e.toLowerCase()}).withDefault(null),use_crew_groups_filter:r.decode.boolean.withDefault(!1),client_group:o.resource("client_groups",{name:r.decode.string,create_order_not_to_employees:r.decode.boolean.withDefault(!1),default_crew_group:o.resource("crew_groups").withDefault(null),crew_groups_filter:o.resource("crew_groups").many().withDefault([])}).withDefault(null),attributes:o.resource("attributes").many().withDefault([]),client_employees:o.resource("client_employees",{name:r.decode.string,default_crew_group:o.resource("crew_groups").withDefault(null),crew_groups_filter:o.resource("crew_groups").many().withDefault([])}).many().withDefault([]),default_crew_group:o.resource("crew_groups").withDefault(null),crew_groups_filter:o.resource("crew_groups").many().withDefault([])}),t.getPrimary=function(e,n){return t.resource.getPrimary(e,n)}},function(e,t){Oktell=function(){var e=!1,t="",n=function(){if(e){var n=new Date,r=n.getFullYear()+"-"+(n.getMonth()<10?"0":"")+n.getMonth()+"-"+(n.getDate()<10?"0":"")+n.getDate(),o=(n.getHours()<10?"0":"")+n.getHours()+":"+(n.getMinutes()<10?"0":"")+n.getMinutes()+":"+(n.getSeconds()<10?"0":"")+n.getSeconds()+":"+(n.getMilliseconds()+1e3).toString().substr(1);t+=r+" "+o+" | ",args=["Oktell.js "+o+" |"];for(var i=0,a=arguments.length;i<a;i++)t+=("object"==typeof arguments[i]?JSON.stringify(arguments[i]):arguments[i])+" | ",args.push(arguments[i]);t+="\n\n";try{console.log.apply(console,args||[])}catch(t){e=!1}}},r=function(e){var t,n,r,o,i,a,s,l,u,c,d,p=function(e,t){return e<<t|e>>>32-t},f=function(e,t){var n,r,o,i,a;return o=2147483648&e,i=2147483648&t,a=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(r=1073741824&t)?2147483648^a^o^i:n|r?1073741824&a?3221225472^a^o^i:1073741824^a^o^i:a^o^i},h=function(e,t,n,r,o,i,a){return e=f(e,f(f(function(e,t,n){return e&t|~e&n}(t,n,r),o),a)),f(p(e,i),t)},m=function(e,t,n,r,o,i,a){return e=f(e,f(f(function(e,t,n){return e&n|t&~n}(t,n,r),o),a)),f(p(e,i),t)},g=function(e,t,n,r,o,i,a){return e=f(e,f(f(function(e,t,n){return e^t^n}(t,n,r),o),a)),f(p(e,i),t)},v=function(e,t,n,r,o,i,a){return e=f(e,f(f(function(e,t,n){return t^(e|~n)}(t,n,r),o),a)),f(p(e,i),t)},y=function(e){var t,n="",r="";for(t=0;t<=3;t++)n+=(r="0"+(e>>>8*t&255).toString(16)).substr(r.length-2,2);return n};for(l=1732584193,u=4023233417,c=2562383102,d=271733878,t=(n=function(e){for(var t,n=e.length,r=n+8,o=16*((r-r%64)/64+1),i=new Array(o-1),a=0,s=0;s<n;)a=s%4*8,i[t=(s-s%4)/4]=i[t]|e.charCodeAt(s)<<a,s++;return a=s%4*8,i[t=(s-s%4)/4]=i[t]|128<<a,i[o-2]=n<<3,i[o-1]=n>>>29,i}(e)).length,r=0;r<t;r+=16)o=l,i=u,a=c,s=d,u=v(u=v(u=v(u=v(u=g(u=g(u=g(u=g(u=m(u=m(u=m(u=m(u=h(u=h(u=h(u=h(u,c=h(c,d=h(d,l=h(l,u,c,d,n[r+0],7,3614090360),u,c,n[r+1],12,3905402710),l,u,n[r+2],17,606105819),d,l,n[r+3],22,3250441966),c=h(c,d=h(d,l=h(l,u,c,d,n[r+4],7,4118548399),u,c,n[r+5],12,1200080426),l,u,n[r+6],17,2821735955),d,l,n[r+7],22,4249261313),c=h(c,d=h(d,l=h(l,u,c,d,n[r+8],7,1770035416),u,c,n[r+9],12,2336552879),l,u,n[r+10],17,4294925233),d,l,n[r+11],22,2304563134),c=h(c,d=h(d,l=h(l,u,c,d,n[r+12],7,1804603682),u,c,n[r+13],12,4254626195),l,u,n[r+14],17,2792965006),d,l,n[r+15],22,1236535329),c=m(c,d=m(d,l=m(l,u,c,d,n[r+1],5,4129170786),u,c,n[r+6],9,3225465664),l,u,n[r+11],14,643717713),d,l,n[r+0],20,3921069994),c=m(c,d=m(d,l=m(l,u,c,d,n[r+5],5,3593408605),u,c,n[r+10],9,38016083),l,u,n[r+15],14,3634488961),d,l,n[r+4],20,3889429448),c=m(c,d=m(d,l=m(l,u,c,d,n[r+9],5,568446438),u,c,n[r+14],9,3275163606),l,u,n[r+3],14,4107603335),d,l,n[r+8],20,1163531501),c=m(c,d=m(d,l=m(l,u,c,d,n[r+13],5,2850285829),u,c,n[r+2],9,4243563512),l,u,n[r+7],14,1735328473),d,l,n[r+12],20,2368359562),c=g(c,d=g(d,l=g(l,u,c,d,n[r+5],4,4294588738),u,c,n[r+8],11,2272392833),l,u,n[r+11],16,1839030562),d,l,n[r+14],23,4259657740),c=g(c,d=g(d,l=g(l,u,c,d,n[r+1],4,2763975236),u,c,n[r+4],11,1272893353),l,u,n[r+7],16,4139469664),d,l,n[r+10],23,3200236656),c=g(c,d=g(d,l=g(l,u,c,d,n[r+13],4,681279174),u,c,n[r+0],11,3936430074),l,u,n[r+3],16,3572445317),d,l,n[r+6],23,76029189),c=g(c,d=g(d,l=g(l,u,c,d,n[r+9],4,3654602809),u,c,n[r+12],11,3873151461),l,u,n[r+15],16,530742520),d,l,n[r+2],23,3299628645),c=v(c,d=v(d,l=v(l,u,c,d,n[r+0],6,4096336452),u,c,n[r+7],10,1126891415),l,u,n[r+14],15,2878612391),d,l,n[r+5],21,4237533241),c=v(c,d=v(d,l=v(l,u,c,d,n[r+12],6,1700485571),u,c,n[r+3],10,2399980690),l,u,n[r+10],15,4293915773),d,l,n[r+1],21,2240044497),c=v(c,d=v(d,l=v(l,u,c,d,n[r+8],6,1873313359),u,c,n[r+15],10,4264355552),l,u,n[r+6],15,2734768916),d,l,n[r+13],21,1309151649),c=v(c,d=v(d,l=v(l,u,c,d,n[r+4],6,4149444226),u,c,n[r+11],10,3174756917),l,u,n[r+2],15,718787259),d,l,n[r+9],21,3951481745),l=f(l,o),u=f(u,i),c=f(c,a),d=f(d,s);return(y(l)+y(u)+y(c)+y(d)).toLowerCase()},o=function(e){for(var t="",n=0,r=0;r<e.length;r++)(n=e.charCodeAt(r))>127?n>1024&&(1025==n?n=1016:1105==n&&(n=1032),t+=String.fromCharCode(n-848)):t+=e.charAt(r);return t},i=function(e){var t,n,r,o,i,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,u=0,c=[];if(!e)return e;e+="";do{t=(a=s.indexOf(e.charAt(l++))<<18|s.indexOf(e.charAt(l++))<<12|(o=s.indexOf(e.charAt(l++)))<<6|(i=s.indexOf(e.charAt(l++))))>>16&255,n=a>>8&255,r=255&a,c[u++]=64==o?String.fromCharCode(t):64==i?String.fromCharCode(t,n):String.fromCharCode(t,n,r)}while(l<e.length);return function(e){var t=[],n=0,r=0,o=0,i=0,a=0;for(e+="";n<e.length;)(o=e.charCodeAt(n))<128?(t[r++]=String.fromCharCode(o),n++):o>191&&o<224?(i=e.charCodeAt(n+1),t[r++]=String.fromCharCode((31&o)<<6|63&i),n+=2):(i=e.charCodeAt(n+1),a=e.charCodeAt(n+2),t[r++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&a),n+=3);return t.join("")}(c.join(""))},a=function(e){var t=Array.prototype.slice.call(arguments,1);return d(t,function(t,n){d(t,function(n,r){t.hasOwnProperty(r)&&(e[r]=n)})}),e},s=function(e){return Array.isArray?Array.isArray(e):"[object Array]"==Object.prototype.toString.call(e)},l=function(e,t){if(t)return JSON.parse(JSON.stringify(e));var n={};for(var r in e)e.hasOwnProperty(r)&&("object"==typeof e[r]?n[r]=l(e[r],!1):n[r]=e[r]);return n},u=function(e){if(s(e=e||[]))return e.length;if(e===Object(e)){if(Object.keys)return Object.keys(e).length;var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}return!1},c={},d=function(e,t,n){if(null!=e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;r<o;r++)if(r in e&&t.call(n,e[r],r,e)===c)return}else for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t.call(n,e[i],i,e)===c)return},p=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},f=function(e){if(!e)return"";for(var t=(e=e.toString().split(";").join(",")).split(","),n=0;n<t.length;n++){t[n]=p(t[n]);var r="",o="",i="";if(""!=t[n]){if(-1!=t[n].indexOf("(")){var a,s=t[n].split("(");r=p(s[0]),s=s[1].split(")"),o=p(s[0]),-1==(a=(a=(a=p(s[1])).replace(/(.?[0-9]) ([0-9].?)/gi,"$1-$2")).replace(/(.?[0-9]) ([0-9].?)/gi,"$1-$2")).indexOf("-")&&(s=[a.split(" ")[0],a.split(" ").slice(1).join(" ")],a=p(s[0]),i=p(s[1]),5==a.length&&(a=a.substr(0,3)+"-"+a.substr(3,2)),6==a.length&&(a=a.substr(0,2)+"-"+a.substr(2,2)+"-"+a.substr(4,2)),7==a.length&&(a=a.substr(0,3)+"-"+a.substr(3,2)+"-"+a.substr(5,2)),""!=i&&(a+=" "+i))}else{s=[(a=(a=(a=t[n].split("+").join("")).replace(/(.?[0-9]) ([0-9].?)/gi,"$1-$2")).replace(/(.?[0-9]) ([0-9].?)/gi,"$1-$2")).split(" ")[0],a.split(" ").slice(1).join(" ")];a=(a=(a=p(s[0])).split("-").join("")).split("—").join(""),i=p(s[1]),5==a.length?a=a.substr(0,3)+"-"+a.substr(3,2):6==a.length?a=a.substr(0,2)+"-"+a.substr(2,2)+"-"+a.substr(4,2):7==a.length?a=a.substr(0,3)+"-"+a.substr(3,2)+"-"+a.substr(5,2):9==a.length?(o=a.substr(0,3),a=a.substr(3,2)+"-"+a.substr(5,2)+"-"+a.substr(7,2)):10==a.length?(o=a.substr(0,3),a=a.substr(3,3)+"-"+a.substr(6,2)+"-"+a.substr(8,2)):11==a.length?(r=a.substr(0,1),o=a.substr(1,3),a=a.substr(4,3)+"-"+a.substr(7,2)+"-"+a.substr(9,2)):12==a.length?(r=a.substr(0,2),o=a.substr(2,3),a=a.substr(5,3)+"-"+a.substr(8,2)+"-"+a.substr(10,2)):13==a.length?(r=a.substr(0,3),o=a.substr(3,3),a=a.substr(6,3)+"-"+a.substr(9,2)+"-"+a.substr(11,2)):14==a.length&&(r=a.substr(0,4),o=a.substr(4,3),a=a.substr(7,3)+"-"+a.substr(10,2)+"-"+a.substr(12,2)),""!=i&&(a+=" "+i)}"8"==r&&(r="+7"),"+"!=r[0]&&""!=r&&(r="+"+r);var l=[];""!=r&&l.push(r),""!=o&&l.push("("+o+")"),""!=a&&l.push(a),t[n]=l.join(" ")}}return e=t.join(", ")},h=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},m=function(e){if("object"==typeof e){var t="";return d(e,function(e,n){t+="&"+n+"="+e.toString()}),t}return!1},g=function(e){return!!("string"==typeof e&&e.match(/[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}/)||32==e.length&&e.match(/[a-zA-Z0-9]{32}/))},v=function(e){"function"==typeof e&&e.apply(void 0,Array.prototype.slice.call(arguments,1))},y=function(e,t,n){if(arguments.length>1&&"[object Object]"!==String(t)){if(n=a({},n),null==t&&(n.expires=-1),"number"==typeof n.expires){var r=n.expires,o=n.expires=new Date;o.setSeconds(o.getSeconds()+r)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",n.raw?t:encodeURIComponent(t),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}var i,s=(n=t||{}).raw?function(e){return e}:decodeURIComponent;return(i=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?s(i[1]):null},_=/\s+/,b=function(e){if("string"==typeof e)e=e.replace(/,/g," ").split(_);else{if(!(s(e)&&e.length>0))return!1;for(var t=[],n=0;n<e.length;n++){var r=e[n];r&&"string"==typeof r&&t.push(r)}eventsNames=t}return e},C={on:function(e,t,n){if(!(e=b(e))||"function"!=typeof t)return!1;var r=this._callbacks||(this._callbacks={});return d(e,function(e,o){if("string"!=typeof e)return c;(r[e]||(r[e]=[])).push({callback:t,context:n})}),!0},off:function(e,t){var n=this._callbacks||(this._callbacks={});if(e){if(!(e=b(e)))return!1;d(e,"function"==typeof t?function(e){"string"==typeof e&&d(n[e],function(r,o){r&&r.callback===t&&delete n[e][o]})}:function(e){delete n[e]})}else n={};return!0},trigger:function(e){e=b(e);var t=this._callbacks||(this._callbacks={});if(!e)return!1;var n=Array.prototype.slice.call(arguments,1),r=t.all;return d(e,function(e){var o=t[e];if(o&&d(o,function(e){e&&"function"==typeof e.callback&&e.callback.apply(e.context||void 0,n)}),r){var i=[e].concat(n);d(r,function(e){e&&"function"==typeof e.callback&&e.callback.apply(e.context||void 0,i)})}}),!0}},w=function(e,t,r,o,l){var u,p={},f=/^ws[s]{0,1}:\/\/\S+$/i,h=this,m=!1,g=!1,y={},_={},C={},w={},E={dynamic:["executemethod","cancelmethod"],dynamicwaitabort:["executemethodwaitaborted"],chat:["chatmessageviewed","chatmessage","chatmemberremoved","chatmemberadded","chatnamechanged","chatcreated"],dlgcard:["dlgcard_showreserve","dlgcard_showconfirm","dlgcard_showformstop","dlgcard_showformdialog","dlgcard_closeall","dlgcard_closereserve","dlgcard_closeformreturnvalues","dlgcard_closeformreturncomment"]};h.setQueryDelayMin(r),h.setQueryDelayMax(o);var S=function(e,t,n){},T=function(e,t,n){},O=!1,A=function(e){if(O)e.close();else{O=!0,u=e;var t=Math.random().toString();u.onmessage=function(n){var r=JSON.parse(n.data),o=function(e){h.ws=e,e.onmessage=R,e.onclose=S,e.onerror=T,k()};if("websocketredirect"==r[0]){var i=new WebSocket(e.url.replace("ws://","wss://").replace(":4066",":443"),"json");i.onopen=function(){o(i)}}else r[1]&&r[1].qid==t&&o(e)},u.send(JSON.stringify(["ping",{qid:t}]))}};h.n_connect=function(){for(var t,n=function(e){if(!s(e))return!1;for(var t="https:"==location.protocol,n=[],r=e.length;l<r;l++){if("string"!=typeof e[l])return!1;if(f.text(e[l]))n.push(e[l]);else{var o=e[l].split(":"),i=o[0],a=o[1];a||(a=80,n.push(i+":4066")),"443"==a&&(t=!0),n.push(i+":"+a)}}var l,u=t?"wss://":"ws//";for(r=n.length;l<r;l++)f.text(e[l])||(n[l]=u+n[l])}(e),r=n.length;t<r;t++)setTimeout(function(){var e=new WebSocket(n[t],"json");e.onopen=function(){A(e)},e.onerror=function(){},e.onclose=function(){}},1)},h.url=e;var x=function(){g||(g=!0,h.trigger("errorConnection"))},k=function(){m=!0,"function"==typeof l&&(n("success connect to "+u.url),l(u.url))},R=function(e){var t=JSON.parse(e.data);D(t);var n=!1;if("multipart"==t[0]){var r=_[t[1]["message-id"]];if(r||(r={packetcount:t[1].packetcount,content:[],value:""},_[t[1]["message-id"]]=r),r.content[parseInt(t[1].packetnumber)]=t[1].content.toString(),r.content.length==r.packetcount){for(var o=0;o<r.content.length;o++)r.value=""+r.value+i(r.content[o]);n=!0}}if(("multipart"!=t[0]||"multipart"==t[0]&&n)&&(n&&(t=JSON.parse(_[t[1]["message-id"]].value)),"function"==typeof y[t[1].qid])){var a=y[t[1].qid];delete y[t[1].qid];var s=t[1];void 0===s.result&&(s.result=1),a(t[1])}},I=function(){m?g||h.trigger("connectionClose"):x(),w={}};h.multiConnect=function(){s(e)||(e=[e]),n("Multi connect start",e);var r=0;e=e.slice(0,10),d(e,function(o,i){setTimeout(function(){try{p[o]=new WebSocket(o,"json"),n("trying to connect "+o),p[o].onopen=function(){p[o].wasOpened=!0;var e=Math.random().toString();p[o].send(JSON.stringify(["ping",{qid:e}])),p[o].onmessage=function(t){if(m)return!1;var r=JSON.parse(t.data),i=function(){h.url=o,h.wsUrl=u=p[o],u.onmessage=R,u.onclose=I,k()};if("websocketredirect"==r[0]){var a=o.replace(/^ws:\/\//,"wss://").replace(/:[0-9]{1,5}/,":443");n("redirect to secure websocket, trying to connect "+a),p[o].close(),o=a;var s=new WebSocket(o,"json");s.onopen=function(){if(m)return!1;i()},p[o]=s}else r[1]&&r[1].qid==e&&i()}},setTimeout(function(){(1!=h.getWebSocketState(p[o])&&!p[o].wasOpened||h.url!=o)&&(h.disconnect(p[o]),++r==e.length&&(r=-999,x()))},t)}catch(t){return++r==e.length&&(r=-999,h.trigger("errorConnection",t)),c}},1)})},h.connect=function(){g=!1;try{n("trying to connect "+e),u=new WebSocket("ws://"+e,"json"),setTimeout(function(){0==h.getWebSocketState()&&(h.disconnect(),x())},t)}catch(e){return h.trigger("errorConnection",e),!1}u.onopen=k,u.onmessage=R,u.onclose=I},h.send=function(e,t,n){JSON.parse(e);if("function"==typeof n&&(y[t]=n),h.delayMin>0){var r=h.delayMin;return o&&(r=Math.round(Math.random()*Math.abs(h.delayMax-h.delayMin)+h.delayMin)),setTimeout(function(){u.send(e)},r),!0}return u.send(e)},h.sendOktell=function(e,t,n){t=t||{};var r=new Array;r.push(e),t.qid=Math.random().toString(),r.push(t),!1===h.send(JSON.stringify(r),r[1].qid,n)&&v(n,{result:0,errormsg:"websocket send error"})},h.execProc=function(e,t,n){var r=["execpredefineddbstoredproc",a({qid:Math.random().toString(),procedure:e},t)];h.send(JSON.stringify(r),r[1].qid,function(e){var t=[];if(1==e.result&&0==e.errorcode)for(var r=0;r<e.dataset.length;r++){var o=[];t.push(o);for(var i=[],a=0;a<e.dataset[r][0].length;a++)i.push(e.dataset[r][0][a]);for(var s=1;s<e.dataset[r].length;s++){for(var l={},u=0;u<i.length;u++)l[i[u]]=e.dataset[r][s][u];o.push(l)}}else t=!1;v(n,t,e.dataset)})},h.bindOktellEvent=function(e,t){return!(!(e=b(e))||"function"!=typeof t)&&(d(e,function(e){C[e]||(C[e]=[]),C[e].push(t)}),h.sendOktellEventSubscription(e),!0)};var D=function(e){C&&C[e[0]]&&(n("<<< EVENT "+e[0],e[1]),d(C[e[0]],function(t){v(t,e[1])}))};h.sendOktellEventSubscription=function(e,t){var r=this;if(!(e=b(e)))return!1;var o=[];d(e,function(e){w[e]||(o.push(e),s(E[e])&&r.sendOktellEventSubscription(E[e],!0)),t&&(w[e]=!0)}),!t&&o.length&&(n("===> Event subscription",o),r.sendOktell("subscribeevent",{eventmethod:o},function(e){n("<=== Event subscribtion result: "+e.result,o),d(o,function(e){w[e]=!0})}))},h.unbindOktellEvent=function(e,t){if(e){if(!(e=b(e)))return!1;t="function"==typeof t&&t;for(var n=0;n<e.length;n++){var r=e[n];t?d(C[r],function(e,n){e===t&&delete C[r][n]}):delete C[r]}}else C={};return!0},h.reSendOktellEventSubscribtions=function(){var e=[];d(w,function(t,n){t&&e.push(n)}),e.length&&h.sendOktell("subscribeevent",{eventmethod:e},function(e){})},h.disconnect=function(e){(e=e||u).close();var t=h.getWebSocketState(e);return 3==t||2==t},h.getWebSocketState=function(e){return(e=e||u)?e.readyState:void 0}};w.prototype.setQueryDelayMin=function(e){(e=parseInt(e))&&(this.delayMin=e)},w.prototype.setQueryDelayMax=function(e){(e=parseInt(e))&&(this.delayMax=e)},a(w.prototype,C);var E=function(i){var p,_,E,S,T,O=this,A=!1,x=[],k={openTimeout:1e4,queryTimeout:2e4,queueInterval:5e3,oktellVoice:!1},R=!1,I={redirectNumber:void 0,allowedProcedures:{}},D={getmyuserinfo:{v:120327,critical:!0},getversion:{v:120112,critical:!0},pbxmakeflash:{v:120725},getextendedlineinfo:{v:120112,critical:!0},getflashedabonentinfo:{v:120112,critical:!0},saveredirectrules:{v:120725},deleteredirectrules:{v:120725},getredirectrules:{v:120725},pbxmaketransfer:{v:120725},triggercustomevent:{v:120725},getallusernumbers:{v:120920},cc_getlunchtypes:{v:130101},pbxanswercall:{v:131218}},N={},P={},j={},L={},M=!1,U=function(e,t,n){O[e]||"function"!=typeof t||(O[e]=function(){return t.apply(n||O,arguments)})},F=function(e){return void 0!==e&&(A=!!e),A},q=a({},C),B=function(){return!(!p||1!=p.getWebSocketState())},H=function(e,t){if(void 0===e||!u(t))return!1;e=parseInt(e);var n="";return d(t,function(t,r){t==e&&(n=r.toLowerCase())}),n},V=function(e){if(!e||"string"!=typeof e&&"number"!=typeof e&&!s(e))return!1;"string"!=typeof e&&"number"!=typeof e||(e=[e.toString()]);var t=!0;return d(e,function(e){if("string"!=typeof e)return t=!1,c}),!!t&&e},z=function(e){return!(I.oktellDated&&D[e]&&I.oktellDated<D[e].v)},G={10:"critical ws method not supported by this version of Oktell server",11:"error loading version info",12:"websocket connection closed",13:"disconnected by user",14:"can't login using oktell.connect"},W=function(e,t){return{code:e,message:G[e]+" "+(t||"")||""}},K={1000:"something goes wrong",1101:"method not supported by current Oktell version",1102:"server didnt understand method or response timeout",1103:"error execute method",1104:"bad method for execute",1105:"error execute stored procedure",1106:"bad params",1200:"cant connect to server",1201:"error websocket connection",1202:"error loginpass",1203:"oktell version too old",1204:"using oktell desktop client",1205:"error url",1206:"error loading version info",1207:"error loading phone state",1209:"error loading user state",1210:"error loading user info",1211:"login failure",1212:"error connect using session",1213:"no password or session",1214:"max online users count reached, license limitation",1215:"oktell service is not available",2001:"user state - disconnected",2002:"phone not connected",2101:"user has hold call and is talking now",2102:"user in conference now",2103:"phone state not valid for call",2104:"user state - busy",2105:"calling number is talking with us",2106:"bad number",2107:"error autocall method call",2108:"error user or phone state for call",2201:"no numbers to invite",2202:"cant build conference from current call",2203:"no number to create conference",2204:"error conference method call",2205:"bad user or phone state for creating conference",2206:"cant invite hold abonent",2207:"error inviting",2208:"cant create conference while in callcenter in break",2301:"error transfer method call",2302:"bad user or phone state for transfer",2303:"nothing to transfer",2304:"bad number for transfer",2401:"error toggle method executing",2402:"nothing to toggle, no hold",2501:"not in conference",2502:"server retunred error while enabling ghost mode",2503:"bad ghost mode",2504:"bad userId or number",2505:"error rigths",2506:"user is not in ghost mode",2507:"cant change ghost mode of this user",2601:"bad flash mode",2602:"error while exec flash method",2701:"error while loading user queue",2801:"wrong old password",2802:"incorrect new password",2803:"error while exec changepassword method on server",2901:"incorrect state",2902:"phone probably does not support intercom calls",3001:"error while getting temp pass",3002:"aborted in beforeRequest callback function"},Y=function(e,t,r){e=parseInt(e);var o=a(r||{},{result:!1,errorCode:e,errorMessage:(K[e]?K[e]:"")+(t?t.toString():"")});return n("ERROR "+e+" "+o.errorMessage,o),o},J=function(e){var t=a(e||{},{result:!0});return n("SUCCESS ",t),t},$=function(e,t,n,r){return e?J(t):Y(n,r,t)},Q=function(e,t,r){var o="function"==typeof t?t:r;if(B())if(z(e)){t=u(t)?t:{};t=a({userlogin:I.login},t);if("function"==typeof o)var i=setTimeout(function(){n("error timer for method "+e),v(o,Y(1102,": "+e))},k.queryTimeout);p.sendOktell(e,t,function(t){clearTimeout(i),n("<<<< "+e,t),v(o,t)}),n(">>>> "+e,t)}else v(o,Y(1101," "+e)),D[e].critical&&ue(W(10),e);else v(o,Y(1201))};U("exec",function(e,t,r){var o="function"==typeof t?t:r;if(e)if(I.allowedProcedures[e.toLowerCase()]){var i={userid:I.userid,userlogin:I.login,inputparams:t||{}};n(">>>> "+e,i),p.execProc(e,i,function(t,r){var i={result:!1};t&&(i.result=!0,i.datasets=t,i.datasetsRaw=r),n("<<<< "+e,i),v(o,$(i.result,i,1105," "+e))})}else o?Q(e,t,function(t){var n=t.errorCode?$(t.result,t,t.errorCode):$(t.result,t,1103," "+e);v(o,n)}):Q(e,t);else v(o,Y(1104))});var Z=a({sendCustomBinding:function(){if(this._subscribed)return!1;this._subscribed=!0;var e=this;p.bindOktellEvent("customevent",function(t){t&&t.eventname&&e.trigger(t.eventname,t.eventparam)})},triggerCustomEvent:function(e,t,n,r){Q("triggercustomevent",{userid:I.userid,userlogin:I.login,eventname:e,eventparam:n,recipients:t,sendback:r?1:"0"})}},C);U("triggerCustomEvent",Z.triggerCustomEvent,Z),U("offCustomEvent",Z.off,Z),U("onCustomEvent",Z.on,Z);var X=function(e){return!!e&&((e=e.toString())&&P[e]&&P[e].id?P[e].controlledByMe:!(!j[e]||!j[e].userObj)&&j[e].userObj.controlledByMe)},ee=function(){if(I.currentUrl&&I.oktellWebServerPort){var e=I.currentUrl.match(/^wss/)?"https://":"http://",t=I.currentUrl.match(/wss?:\/\/([^\s\/:]+)/)[1];return port="",("https://"==e&&"443"!=O.getMyInfo().oktellWebServerPort||"http://"==e&&"80"!=O.getMyInfo().oktellWebServerPort)&&(port=":"+O.getMyInfo().oktellWebServerPort),e+t+port}return!1},te=function(e,t){e&&(N[e]={time:(new Date).getTime(),callback:t})},ne=function(e,t){Q("gettemphttppass",{responsetowebsock:!!e},function(e){e.result?v(t,J(e)):v(t,Y(1103," gettemphttppass",e))})};U("setUserAvatar",function(e,t){if(e){var n=e.toString().split(".");n.length<2||-1==["jpg","gif","png","jpeg"].indexOf(n[n.length-1])||Q("setmyuserphoto",{filepath:e},function(e){v(t,$(e.result,{},1103," setmyuserphoto"))})}});U("getUserAvatar",function(e){Q("getuserphoto",{mode:"page"},function(t){if(t.result){var n=ee();I.avatarLink=t.link?n+t.link32x32:k.defaultAvatar||"",I.avatarLink32x32=t.link32x32?n+t.link32x32:k.defaultAvatar32x32||"",I.avatarLink96x96=t.link96x96?n+t.link96x96:k.defaultAvatar64x64||"",v(e,J({avatarLink:I.avatarLink,avatarLink32x32:I.avatarLink32x32,avatarLink96x96:I.avatarLink96x96}))}else v(e,Y(1103," getuserphoto"))})});var re=function(e,t){var n=Math.random().toString().replace(".",""),r="_oktelljs_user_avatar_frame_"+n,o="_oktelljs_user_avatar_form_"+n,i="_oktelljs_user_profile_select_file_"+n,a=e.accept;delete e.accept,a?(s(a)||(a=[a]),a='accept="'+a.join(",")+'"'):a="";var l=document.createElement("iframe");l.id=r,l.name=r,l.width=0,l.height=0,document.body.appendChild(l);var u=document.createElement("form");u.id=o,u.style.display="none",u.target=r,u.enctype="multipart/form-data",u.action="",u.method="post",document.body.appendChild(u);var c=document.createElement("input");c.style.visibility="hidden",c.type="file",c.id=i,c.name="file",c.accept=a,u.appendChild(c);var d=function(e){var n;(n=document.getElementById(r)).parentNode.removeChild(n),(n=document.getElementById(o)).parentNode.removeChild(n),v(t,e)};c.onchange=function(){var t=c.value;if(t){var n=t.replace("\\","/").split("/");n=n[n.length-1],"function"!=typeof beforeRequest||!1!==beforeRequest(J({fileName:n}))?ne(!0,function(t){t.result?(u.action=ee()+"/upload?temppass="+t.password+"&"+m(e),te(t.password,function(e){var t=/uploadfilesresult count="1"[\s\S]+?path="([\s\S]+?)"/.exec(e);if(!t||!t[1])return!1;t=t[1].replace(/\\/g,"/"),d(J({path:t}))}),u.submit()):d(Y(3001))}):d(Y(3002))}},c.click()};U("uploadFile",function(e,t,n){var r=window.$||window.jQuery||void 0;if(!r)return re.apply(O,arguments);var o=e.accept;delete e.accept,o?(s(o)||(o=[o]),o='accept="'+o.join(",")+'"'):o="";var i=Math.random().toString().replace(".",""),a="_oktelljs_user_avatar_frame_"+i,l="_oktelljs_user_avatar_form_"+i,u="_oktelljs_user_profile_select_file_"+i;r("body").append('<iframe width="0" height="0" id="'+a+'" name="'+a+'"></iframe>'),r("body").append('<form enctype="multipart/form-data" target="'+a+'" id="'+l+'" action="" method="post"><input style="visibility: hidden;" type="file" '+o+' name="file" id="'+u+'" /></form>');var c=function(e){r("#"+l).remove(),r("#"+a).remove(),v(t,e)};r("#"+u).change(function(t){var o=r(t.currentTarget).val();if(o){var i=o.replace("/","\\").split("\\");i=i[i.length-1],"function"!=typeof n||!1!==n(J({fileName:i}))?ne(!0,function(t){t.result?(r("#"+l).attr("action",ee()+"/upload?temppass="+t.password+m(e)),te(t.password,function(e){var t=/uploadfilesresult count="1"[\s\S]+?path="([\s\S]+?)"/.exec(e);if(!t||!t[1])return!1;t=t[1].replace(/\\/g,"/"),c(J({path:t}))}),r("#"+l).submit()):c(Y(3001))}):c(Y(3002))}}),r("#"+u).click()});var oe=function(){function e(e,t){var n=this;n.oktell=e,n.server=t,n.currentMethods={},n.methodTimers={},n.onExecuteMethod=function(t){if(!t.executionid)return!1;n.currentMethods[t.executionid]=!0,e.trigger("")},n.onCancelMethod=function(e){if(!e.executionid)return!1;delete n.currentMethods[e.executionid]},n.onExecuteMethodWaitAborted=function(e){if(!e.executionid)return!1;n.currentMethods[e.executionid]=!0,n.methodTimers[e.executionid]=setTimeout(function(){delete n.currentMethods[e.executionid]},e.waitresponsems)}}return e.prototype.init=function(e){this.server.bindOktellEvent("dynamic",function(){}),this.server.bindOktellEvent("dynamicwaitabort",function(){}),this.server.bindOktellEvent("executemethod",this.onExecuteMethod,this),this.server.bindOktellEvent("cancelmethod",this.onCancelMethod,this),this.server.bindOktellEvent("executemethodwaitaborted",this.onExecuteMethodWaitAborted,this)},e.prototype.sendMethodResult=function(e,t){if(!this.currentMethods[e])return!1;delete this.currentMethods[e],Q("methodresult",{executionid:e,outputparameters:t||{}})},e.prototype.reset=function(){for(var e in this.currentMethods={},this.methodTimers)this.methodTimers.hasOwnProperty(e)&&clearTimeout(this.methodTimers[e]);this.server.unbindOktellEvent("executemethod",this.onExecuteMethod),this.server.unbindOktellEvent("cancelmethod",this.onCancelMethod),this.server.unbindOktellEvent("executemethodwaitaborted",this.onExecuteMethodWaitAborted)},e}();a(oe.prototype,C);new oe;var ie=a({},C,{_stateId:0,states:{DISCONNECTED:0,READY:1,BREAK:2,OFF:3,BUSY:5,RESERVED:6,NOPHONE:7},webStates:{READY:1,DND:2,REDIRECT:3,BREAK:4},onCallCenter:0,_onRedirect:!1,_status:0,_webStateId:0,onBreak:0,breakReasons:{},loadBreakReasons:function(e){var t=this;Q("cc_getlunchtypes",{},function(n){n.result&&d(n.items,function(e){t.breakReasons[e.id.toString()]=e}),v(e,$(n.result,n,1103," cc_getlunchtypes"))})},getStateStr:function(e){return H(void 0===e?this._stateId:parseInt(e),this.states)},getWebStateStr:function(e){return H(void 0===e?this._webStateId:parseInt(e),this.webStates)},state:function(e){return e=parseInt(e),this.getStateStr(e)&&this._stateId!==e&&(n("SET USER STATE "+e+" "+this.getStateStr(e)),this._stateId=e,this.trigger("userStateChange",this._stateId)),this._stateId},changeStates:function(e,t,n){if(e=this.webStates[e.toString().toUpperCase()]||parseInt(e),!this.getWebStateStr(e))return!1;if(e==this._webStateId&&!this.setAfterBusy||!B())return!1;var r=this.state();switch(e){case 1:r==this.states.BUSY?this.setAfterBusy=this.webStates.READY:Q("setuserstate",{userstateid:1});break;case 2:r==this.states.BUSY?this.setAfterBusy=this.webStates.DND:r!=this.states.READY&&r!=this.states.BREAK&&r!=this.states.OFF||Q("setuserstate",{userstateid:3});break;case 3:if(!this.getRedirectNumber())return!1;this.enableUserRedirectState(!0);break;case 4:if(this.onCallCenter){var o={userstateid:2};n&&(this.breakReasons[n]?o.lunchreasonid=n:o.lunchreasonmsg=n),Q("setuserstate",o)}}return this.webState(e,t),!0},webState:function(e,t){if(void 0!==e&&this.getWebStateStr(e)&&this._webStateId!=e){n("SET WEB STATE "+this.getWebStateStr(e));var r=this.getWebStateStr(this._webStateId);this._webStateId=e,t||O.trigger("statusChange",this.getWebStateStr(this._webStateId),r)}return this._webStateId},onRedirect:function(e){return void 0!==e&&(e=!!e,this._onRedirect!==e&&(this._onRedirect=e,q.trigger("userOnRedirectChanged",this._onRedirect))),this._onRedirect},loadState:function(e){var t=this;Q("getuserstate",{},function(n){n.result&&t.saveStatesFromServer(n),v(e,$(n.result,n,1103," getuserstate"))})},callCenterState:function(e){return void 0!==e&&(e=!!e,this.onCallCenter!==e&&(this.onCallCenter=e,O.trigger("callCenterStateChange",this.onCallCenter))),this.onCallCenter},saveStatesFromServer:function(e){this.callCenterState(e.oncallcenter),this.onBreak=e.onlunch,this.onRedirect(e.onredirect);var t=this.webState(),n=this.state();if(this.state(e.userstateid),t==this.webStates.DND&&this.setAfterBusy==this.webStates.DND&&5==n&&1==e.userstateid)return this.setAfterBusy=!1,void this.changeStates(this.webStates.DND,!0);this.setWebStateFromUserState()},setUserStateBusy:function(){this.state(5)},getUserRedirectId:function(){return r(I.userid.toLocaleLowerCase()+I.userid.toLocaleLowerCase()).toLowerCase()},getRedirectNumber:function(){return I.redirectNumber?I.redirectNumber:void 0},setRedirectNumber:function(e){return I.redirectNumber=e||void 0,I.redirectNumber},checkUserRedirect:function(e){var t=this;Q("getredirectrules",{},function(n){n.result&&(n.redirectrules&&n.redirectrules.length>0&&d(n.redirectrules,function(e){e.id.replace(/-/g,"").toLowerCase()==t.getUserRedirectId()&&t.setRedirectNumber(e.destinationnumber)}));v(e,$(n.result,n,1103," getredirectrules"))})},saveUserRedirect:function(e,t){var n=this;return e?Q("saveredirectrules",{redirectrule:{id:n.getUserRedirectId(),caption:"Переадресация сохраненная из веб-октела. Действует постоянно.",description:"Переадресация сохраненная из веб-октела. Действует постоянно.",priority:1,userid:I.userid,isenabled:!0,allowcascade:!0,state:2,destinationnumber:e,onlyforredirectstate:!0,definesources:!1}},function(r){r.result&&n.setRedirectNumber(e),v(t,$(r.result,r,1103," saveredirectrules"))}):Q("deleteredirectrules",{ids:[this.getUserRedirectId()]},function(e){e.result&&(n.setRedirectNumber(void 0),n.webState()==n.webStates.REDIRECT&&n.changeStates(n.webStates.READY)),v(t,$(e.result,e,1103," deleteredirectrules"))}),!0},enableUserRedirectState:function(e){Q("setuserstate",{onredirect:!!e})},setWebStateFromUserState:function(){if(this.onRedirect())this.webState(this.webStates.REDIRECT);else switch(this.state()){case 1:this.webState(this.webStates.READY);break;case 2:this.webState(this.webStates.BREAK);break;case 3:this.webState(this.webStates.DND);break;case 5:this.onBreak&&this.onCallCenter?this.webState(this.webStates.BREAK):this.webState(this.webStates.READY);break;case 7:this.webState(this.webStates.READY)}}});U("setRedirectNumber",ie.saveUserRedirect,ie),U("getStatus",ie.getWebStateStr,ie),U("setStatus",ie.changeStates,ie),U("setUserStateBusy",ie.setUserStateBusy,ie);var ae={_conferenceInfo:{},_oktellDatedWithConfNumber:140929,_holdNumber:!1,_conferenceId:!1,abonentList:{},queueList:{},answerCheckTimeout:3e3,_talkLength:0,_talkTimer:!1,sip:!1,sipActive:!1,sipHasRTCSession:!1,_notRoutingIvrState:!1,currentSessionData:{},intercomSupport:null,states:{DISCONNECTED:-1,READY:0,BACKCALL:1,CALL:2,RING:3,BACKRING:4,TALK:5},setSipPhone:function(e){var t=this;t.sip=e,t.sip.on("connect",function(){t.sipActive=!0}),t.sip.on("disconnect",function(){t.sipHasRTCSession=!1,t.sipActive=!1}),t.sip.on("ringStart",function(e,t){O.trigger("webrtcRingStart",e,t)}),t.sip.on("RTCSessionFailed",function(){}),t.sip.on("RTCSessionStarted",function(){t.sipHasRTCSession=!0,O.trigger("")}),t.sip.on("RTCSessionEnded",function(){t.sipHasRTCSession=!1,t.loadStates()}),t.sip.on("RTCSessionFailed",function(){t.sipHasRTCSession=!1}),t.sip.on("sessionClose",function(){t.sipHasRTCSession=!1,t.loadStates()})},notRoutingIvrState:function(e){return void 0!==e&&Boolean(e)!==this._notRoutingIvrState&&(this._notRoutingIvrState=Boolean(e)),this._notRoutingIvrState},answer:function(e){var t,n,r,o=this;o.sipActive?(o.sip.answer(),v(e,J())):!1===o.intercomSupport?v(e,Y(2902)):o.state()==o.states.RING||o.state()==o.states.BACKRING?(Q("pbxanswercall"),r=function(){clearInterval(t),clearTimeout(checkTimer),v(e,$(o.intercomSupport,{},2902))},n=function(){return o.intercomSupport=o.state()==o.states.TALK||o.state()==o.states.CALL},t=setInterval(function(){n()&&r()},50),checkTimer=setTimeout(function(){r()},o.answerCheckTimeout)):v(e,Y(2901))},setConferenceInfo:function(e){this._conferenceInfo="object"==typeof e?e:{}},getConferenceInfo:function(){return this._conferenceInfo||{}},clearHold:function(){return this.setHold(!1),!0},setHold:function(e){var t=this.getHoldInfo();if(void 0!==e&&(e.userid&&e.userid!=this._holdNumber||e.number&&e.number!=this._holdNumber||e.conferenceid&&e.conferenceid!=this._holdNumber)){var n=this._holdAbonent;this._holdNumber=e.conferenceid?e.conferenceid:e.userid?e.userid:e.number,this._holdAbonent=e.conferenceid?{isConference:!0,conferenceId:e.conferenceid,conferenceName:e.conferencename,conferenceRoom:e.conferenceroom}:this.createAbonent(e);var r=!1;(n&&n.key!=this._holdAbonent.key||!this._holdAbonent)&&(r=!0,O.trigger("holdAbonentLeave",l(n))),n&&this._holdAbonent&&this._holdAbonent.key&&n.key&&this._holdAbonent.key==n.key||(r=!0,O.trigger("holdAbonentEnter",l(this._holdAbonent)));var o=this.getHoldInfo();return(t.hasHold!=o.hasHold||r)&&O.trigger("holdStateChange",l(o)),!0}if(!1===e){this._holdAbonent&&O.trigger("holdAbonentLeave",l(this._holdAbonent)),this._holdAbonent=void 0;var i=this._holdNumber;this._holdNumber=!1,i!==this._holdNumber&&O.trigger("holdStateChange",l(this.getHoldInfo()))}return!1},getHoldInfo:function(){var e={hasHold:!!this._holdNumber};return e.hasHold&&(this._holdAbonent&&this._holdAbonent.isConference?a(e,l(this._holdAbonent)):(e.isConference=!1,e.abonent=l(this._holdAbonent))),e},conferenceId:function(e,t){if(void 0!==e&&e!=this._conferenceId){var n=this._conferenceId;this._conferenceId=e,n&&Q("confhandleevent",{conferenceid:n,eventtype:"competitors",handle:!1}),this._conferenceId?(Q("confhandleevent",{conferenceid:this._conferenceId,eventtype:"competitors",handle:!0}),t||this.loadConferenceInfo()):this.setConferenceInfo(!1)}return this._conferenceId},isConfCreator:function(e){return void 0!==e&&(this._isConfCreator=!!e),this._isConfCreator},getStateStr:function(e){return H(void 0===e?this._stateId:parseInt(e),this.states)},apiGetStateStr:function(e){var t=void 0===e?this.state():parseInt(e);return t==this.states.BACKCALL&&(t=this.states.CALL),this.getStateStr(t)},state:function(e,t,r){if(e=parseInt(e),this.getStateStr(e)&&(r||e!=this._stateId)){var o=this.apiGetStateStr(e),i=this._stateId,a=this.apiGetStateStr(i);n("CHANGE STATE FROM "+this.getStateStr(this._stateId)+" TO "+this.getStateStr(e),this.getAbonents(!0),t),this._stateId=e,e!==this.states.READY&&e!==this.states.DISCONNECTED||(this.removeAbonents(),this.conferenceId(!1),this.isConfCreator(!1),e===this.states.DISCONNECTED&&this.clearHold()),O.trigger("stateChange",o,a);var s=this.getAbonents(!0);switch(0==s.length&&(s=t),i){case this.states.READY:O.trigger("readyStop",t);break;case this.states.RING:O.trigger("ringStop",t);break;case this.states.BACKRING:O.trigger("backRingStop",t);break;case this.states.CALL:case this.states.BACKCALL:O.trigger("callStop",t);break;case this.states.TALK:O.trigger("talkStop",t)}switch(this._stateId){case this.states.READY:O.trigger("readyStart",s);break;case this.states.RING:O.trigger("ringStart",s);break;case this.states.BACKRING:O.trigger("backRingStart",s);break;case this.states.CALL:case this.states.BACKCALL:O.trigger("callStart",s);break;case this.states.TALK:O.trigger("talkStart",s)}}return this._stateId},loadFlashInfo:function(e){var t=this;Q("getflashedabonentinfo",{},function(n){n.result&&(n.containsflashed&&n.abonent?t.setHold(n.abonent):t.clearHold()),v(e,$(n.result,n,1103," getflashedabonentinfo"))})},loadStates:function(e,t){var r=this;if(t=t||{},a(r.currentSessionData,t),!B())return!1;Q("getextendedlineinfo",{},function(t){var o=function(){v(e,$(t.result,t,1103," getextendedlineinfo"))};if(n("getextendedlineinfo result and that.currentSessionData",t,r.currentSessionData),t.result){var i=r.state(),a=(r.getHoldInfo(),r.getAbonents(!0)),s=(a&&a[0],function(){n("setStateFromResultData");r.getHoldInfo();var e=r.getAbonents(!0);e&&e[0];if(r.currentSessionData.isAutoCall&&!t.abonent.isautocall&&i==r.states.READY)r.state(r.states.BACKRING,a);else if(t.abonent.isautocall)r.currentSessionData.isAutoCall=!1,r.state(r.states.BACKCALL,a);else if(t.abonent.isringing)"acm_callback"==t.abonent.direction||i==r.states.BACKRING?r.state(r.states.BACKRING,a):r.state(r.states.RING,a);else if(!r.currentSessionData.isAutoCall&&(t.abonent.iscommutated||t.abonent.iswaitinginflash||t.abonent.isconference)||"lsCommutated"==t.linestatestr&&t.abonent.isivr&&!t.abonent.isroutingivr){r.startTalkTimer(parseInt(t.timertalklensec)||0);var o=r.currentSessionData.commStopped;r.currentSessionData.commStopped=!1,r.state(r.states.TALK,a,o)}else t.abonent.extline||t.abonent.number?(r.currentSessionData.isAutoCall=!1,r.state(r.states.CALL,a)):"lsDisconnected"==t.linestatestr?r.state(r.states.DISCONNECTED):i==r.states.TALK&&r.sipHasRTCSession||"lsReserved"!=t.linestatestr&&(r.currentSessionData={},r.state(r.states.READY,a))});t.isflashing&&t.flashed?r.setHold(t.flashed):r.setHold(!1),t.abonent?t.abonent.conferenceid?(r.conferenceId(t.abonent.conferenceid,!0),r.loadConferenceInfo(function(){s(),o()})):(t.abonent.chainId=t.chainid,r.setAbonent(t.abonent,i==r.states.TALK&&r.sipHasRTCSession||t.abonent.isivr||r.currentSessionData.isAutoCall),r.conferenceId(!1),s(),o()):o()}else o()})},loadConferenceInfo:function(e){var t=this;Q("getconferenceinfo",{conferenceid:this.conferenceId()},function(n){t.setConfAbonentList(n.competitors),t.setConferenceInfo(n.conference),v(e,$(n.result,n,1103," getconferencecompetitors"))})},createAbonent:function(e){var t=e.competitorid||e.number||e.userid||e.callerid||"00000000-0000-0000-0000-000000000000"!=e.chainId&&e.chainId;if(!t&&e.isivr&&(t=h()),t){var n=new function(){};return a(n,{key:t,guid:e.competitorid||e.userid,isIvr:e.isivr,ivrName:e.ivrname||void 0,isConferenceCompetitor:!!e.competitorid,conferenceId:this.conferenceId(),isConferenceCreator:!(!e.competitorid||!e.iscreator)||void 0,isConferenceDirector:!(!e.competitorid||!e.isdirector)||void 0,isConferenceGhost:!(!e.competitorid||!e.isghost)||void 0,isConferenceGhostMajor:!(!e.competitorid||!e.isghostmajor)||void 0,isConferenceHidden:!(!e.competitorid||!e.ishidden)||void 0,isExternal:!!e.isextline,chainId:e.chainId,phone:e.number?e.number.toString():e.calledid?e.callerid.toString():void 0,phoneFormatted:e.number?f(e.number.toString()):void 0,name:e.simplename||e.username||e.name||e.caption||e.userlogin||e.number||e.ivrname,isUser:!!e.userid,user:{id:e.userid||void 0,name:e.username||void 0,login:e.userlogin||void 0,comment:e.comment||void 0},isClient:void 0,client:{id:void 0,name:void 0},line:{id:void 0,number:void 0}}),n}return!1},setAbonent:function(e,t){var n;u(this.abonentList)&&d(this.abonentList,function(e,t){n=t});var r=this.abonentList[n];this.abonentList={};var o=e?this.createAbonent(e):void 0;return o?(this.abonentList[o.key]=o,o.key!=n&&(O.trigger("abonentListChange",this.getAbonents()),O.trigger("abonentsChange",this.getAbonents(!0)))):r&&t?this.abonentList[n]=r:n&&(O.trigger("abonentListChange",this.getAbonents()),O.trigger("abonentsChange",this.getAbonents(!0))),this.abonentList},setConfAbonentList:function(e){var t={},n=this;e&&s(e)&&d(e,function(e){if((!n.getConferenceInfo().isghost||n.getConferenceInfo().isghost&&(e.isghost||e.userid==I.userid||e.number==I.number))&&(t[e.competitorid]=!0,!n.abonentList[e.competitorid])){var r=n.createAbonent(e);n.abonentList[r.key]=r,n.conferenceId()&&n.state()==n.states.TALK&&O.trigger("conferenceAbonentEnter",n.abonentList[r.key])}});var r=n.getAbonents();return d(r,function(e,r){t[r]||n.removeAbonents(r)}),O.trigger("abonentListChange",n.getAbonents()),O.trigger("abonentsChange",n.getAbonents(!0)),!0},getAbonents:function(e){var t=e?[]:{};return d(this.abonentList,function(n,r){e?t.push(l(n)):t[r]=l(n)}),t},isAbonent:function(e,t){if(!e)return!1;if(t=t||this.getAbonents(),u(t)){t.key&&(t=[t]);var n=!1;return d(t,function(t){if(t.guid&&t.guid==e||t.user&&t.user.id&&t.user.id==e||t.client&&t.client.id&&t.client.id==e||t.phone&&t.phone==e)return n=l(t),c}),n}return!1},removeConfAbonents:function(){var e=this;d(e.abonentList,function(t,n){e.conferenceId()&&e.state()==e.states.TALK&&t.isConferenceCompetitor&&O.trigger("conferenceAbonentLeave",t),delete e.abonentList[n]})},removeAbonents:function(e){var t=this;if(e&&t.abonentList[e])t.conferenceId()&&t.state()==t.states.TALK&&t.abonentList[e].isConferenceCompetitor&&O.trigger("conferenceAbonentLeave",t.abonentList[e]),delete t.abonentList[e],O.trigger("abonentListChange",t.getAbonents()),O.trigger("abonentsChange",t.getAbonents(!0));else{if(void 0!==e||!u(t.abonentList))return!1;d(t.abonentList,function(e,n){t.conferenceId()&&t.state()==t.states.TALK&&e.isConferenceCompetitor&&O.trigger("conferenceAbonentLeave",e),delete t.abonentList[n]}),t.abonentList={}}return O.trigger("abonentListChange",t.getAbonents()),O.trigger("abonentsChange",t.getAbonents(!0)),!0},makeCall:function(e,t,r,o){var i;if(e||(i=2106),ie.state()==ie.states.DISCONNECTED&&(i=2001),this.state()==this.states.DISCONNECTED&&(i=2002),this.getHoldInfo().hasHold&&this.state()==this.states.TALK&&(i=2101),this.conferenceId()&&(i=2102),-1!=[this.states.BACKCALL,this.states.BACKRING,this.states.CALL,this.states.RING].indexOf(this.state())&&(i=2103," ("+this.getStateStr()+")"),this.state()!=this.states.READY||ie.state()!=ie.states.BUSY||this.getHoldInfo().hasHold||(i=2104),i)return v(o,Y(i)),!1;if(this.isAbonent(e))return v(o,Y(2105)),!1;if(this.state()==this.states.READY&&this.sipActive&&!t){this.state()==this.states.TALK&&this.sip.hold(),this.sip.call(e);P[e],j[e]||L[e];v(o,J())}else{if(this.state()!=this.states.READY&&this.state()!=this.states.TALK)return n("error call, unknown state"),v(o,Y(2108)),!1;this.acmCall(e,t,r,function(e){v(o,$(e.result,e,2107))})}},acmCall:function(e,t,n,r){if(n=-1!==["abonent","user"].indexOf(n)?n:"user",!e)return!1;var o={sequence:t?"user":n,intercom:!!t||void 0};o.number=e.toString(),Q("pbxautocallstart",o,function(e){v(r,e)})},toggleHold:function(e){this.getHoldInfo().hasHold?(this.makeFlash("switch"),v(e,J())):v(e,Y(2402))},makeFlash:function(e){Q("pbxmakeflash",{mode:-1!=["abort","switch","next"].indexOf(e)?e:void 0})},conference:function(e,t){var n=this;e=V(e),ie.state()==ie.states.BREAK?v(t,Y(2208)):n.state()==n.states.TALK?n.conferenceId()&&e?n.inviteToConf(n.conferenceId(),e,t):n.conferenceId()||(e?n.callToConf(function(r){r.result?n.inviteToConf(n.conferenceId(),e,t):v(t,Y(2202))}):n.callToConf(t)):n.state()==n.states.READY&&!n.conferenceId()&&e?n.createConf(e,t):v(t,Y(2205))},callToConf:function(e){var t=this;t.buildConfFromCommCallback=e,t.buildConfFromCommTimer=setTimeout(function(){v(t.buildConfFromCommCallback,Y(2202)),t.buildConfFromCommCallback=void 0},2e3),Q("buildconferencefromcommutation")},createConf:function(e,t){var n=this,r=h(),o=Math.round(1e4*Math.random()),i=[{userlogin:I.login}];e=V(e),s(e)&&d(e,function(e){g(e)?i.push({userid:e}):I.oktellDated>=n._oktellDatedWithConfNumber?i.push({number:e}):i.push({intnumber:e})}),u(i)>1?Q("createnewconference",{conference:{id:r,room:o,name:"",description:"",accessmode:"free",isselector:!1,record:!0,recordrights:"selected",everyonecaninvite:!0,canvieweachother:!0},competitors:i},function(e){1==e.result?n.conferenceId(r,!0):n.conferenceId(!1),v(t,$(e.result,e,2204))}):v(t,Y(2203))},inviteToConf:function(e,t,n){e||v(n,!1);var r=this;t=V(t);var o,i=[],a=r.getHoldInfo().abonent||{};s(t)&&d(t,function(e){"string"==typeof e&&""!==e&&(r.isAbonent(e,a)?o=e:g(e)?i.push({userid:e}):i.push({number:e}))});var l=function(){Q("invitetoconference",{conferenceid:e,competitors:i},function(e){v(n,$(e.result,e,2202))})};if(0!=u(i)||o)if(o){if(e!=r.conferenceId())return void v(n,Y(2206));Q("checkcanconnecttogathertoconference",{},function(e){e.canconnecttogather?(Q("connecttogathertoconference"),0!=u(i)?l():v(n,J())):v(n,Y(2206))})}else 0!=u(i)?l():v(n,Y(2207));else v(n,Y(2201))},endCall:function(e){var t=this;e=V(e);var n=!1,r=!1;e&&d(e,function(e){!n&&t.isAbonent(e)&&(n=!0),r||e!=I.number&&e!=I.userid||(r=!0)}),e?t.getHoldInfo().hasHold&&(r||!t.conferenceId()&&n)?t.makeFlash("abort"):(n||r)&&(t.state()==t.states.TALK?t.conferenceId()?t.kickConfAbonent(t.conferenceId(),e):t.abortCall():t.state()==t.states.BACKCALL?t.abortAcmCall():t.state()==t.states.CALL?t.abortCall():t.state()!=t.states.RING&&t.state()!=t.states.BACKRING||t.declineCall()):t.state()==t.states.TALK||t.state()==t.states.CALL||t.getHoldInfo().hasHold?t.abortCall():t.state()==t.states.BACKCALL?t.abortAcmCall():t.state()!=t.states.RING&&t.state()!=t.states.BACKRING||t.declineCall()},abortCall:function(){Q("pbxabortcall")},declineCall:function(){Q("pbxdeclinecall")},kickConfAbonent:function(e,t){t=V(t);var n=this;Q("getconferencecompetitors",{conferenceid:e},function(r){for(var o,i={},a={},s=!1,l=0,u=r.competitorlist.length;l<u;l++)i[r.competitorlist[l].number]=r.competitorlist[l].competitorid,a[r.competitorlist[l].userid]=r.competitorlist[l].competitorid;d(t,function(t){(o=i[t]||a[t]||"")&&(!t||t!=I.number&&t!=I.userid?Q("confdisconnectcompetitor",{conferenceid:e,competitor:{competitorid:o}}):s=!0)}),s&&n.exitConf(e)})},abortAcmCall:function(e){Q("pbxautocallabort")},exitConf:function(e){Q("exitconference",{conferenceid:e})},makeTransfer:function(e,t){Q("pbxmaketransfer",{transferto:e?e+"":""}),v(t,J())},transfer:function(e,t){e||v(t,Y(2304)),this.state()==this.states.TALK?this.getHoldInfo().hasHold?!e||this.isAbonent(e,this.getHoldInfo().abonent||{})?(this.endCall(void 0),v(t,J())):this.makeTransfer(e,t):e?this.makeTransfer(e,t):v(t,Y(2302)):v(t,Y(2303))},ghost:function(e,t,n){var r=this,o=function(e){r.loadConferenceInfo(v(n,e))};if(!(e=P[e]&&P[e].id||j[e]&&j[e].userid))return v(o,Y(2504)),!1;if(-1==["monitor","conference","help"].indexOf(t=t||"monitor"))return v(o,Y(2503)),!1;if(r.state()==r.states.READY)Q("attachasghost",{ghostedid:e},function(e){e.result?t&&"monitor"!=t?setTimeout(function(){r.conferenceId()&&r.changeGhostMode(t,o)},500):v(o,J()):52710==e.error?v(o,Y(2505)):v(o,Y(2502))});else{var i=r.isAbonent(I.userid),a=r.conferenceId();if(!i||!a||!r.getConferenceInfo().isghost)return v(o,Y(2506)),!1;var s=r.isAbonent(e);if(!s)return v(o,Y(2507)),!1;s.isConferenceGhostMajor||"help"!=t&&"monitor"!=t?Q("confsetghostmode",{conferenceid:a,ghostmode:t},function(e){e.result,v(o,$(e.result,{},2502))}):Q("confsetvoiceparams",{conferenceid:a,competitor:{competitorid:s.guid,ghosthelp:"help"==t}},function(e){e.result,v(o,$(e.result,{},2502))})}},queue:function(e){var t=this;Q("getcurrentqueue",{},function(n){if(n.result){var r={},o=[],i=!1;s(n.queue)&&u(n.queue)>0&&d(n.queue,function(e){ab=t.createAbonent(e),r[ab.key]=ab,o.push(ab),t.queueList[ab.key]||t.isAbonent(ab.key)||(t.queueList[ab.key]=ab,O.trigger("queueAbonentEnter",ab),i=!0)}),d(t.queueList,function(e,n){r[n]||(O.trigger("queueAbonentLeave",e),delete t.queueList[n],i=!0)}),i&&O.trigger("queueChange",o),v(e,J({queue:o}))}else v(e,Y(2701))})},startTalkTimer:function(e){var t=this;t.clearTalkTimer(!0),t._talkLength=Date.now()-1e3*(parseInt(e)||0),t.triggerTalkTimeEvent(),t._talkTimer=setInterval(function(){t.triggerTalkTimeEvent()},1e3)},triggerTalkTimeEvent:function(){if(!1!==this._talkLength){var e=this.getCurrentTalkLength();O.trigger("talkTimer",e,this.formatTime(e))}else O.trigger("talkTimer",!1)},getCurrentTalkLength:function(){return Math.floor((Date.now()-this._talkLength)/1e3)},clearTalkTimer:function(e){clearInterval(this._talkTimer),this._talkLength=!1,e||this.triggerTalkTimeEvent()},formatTime:function(e){var t=e,n=Math.floor(t/3600),r=Math.floor(t/60)%60,o=t%60;return(n?n+":":"")+(r<10?"0"+r:r)+":"+(o<10?"0"+o:o)},talkLength:function(e){if(!1===this._talkLength)return"";var t=this.getCurrentTalkLength();return e?this.formatTime(t):t},dtmf:function(e){return!(!this.sipActive||"string"!=typeof e||!e.match(/^[0-9\*#]{1}$/))&&this.sip.dtmf(e)},hold:function(){this.sipActive?this.sip.hold():(this.state()==this.states.TALK||this.getHoldInfo().hasHold)&&this.makeFlash("switch")},resume:function(){this.getHoldInfo().hasHold&&this.sipActive&&this.sip.resume()}};a(ae,C),U("isAbonent",ae.isAbonent,ae),U("conferenceId",ae.conferenceId,ae),U("getHoldInfo",ae.getHoldInfo,ae),U("endCall",ae.endCall,ae),U("conference",ae.conference,ae),U("transfer",ae.transfer,ae),U("toggle",ae.toggleHold,ae),U("getState",ae.apiGetStateStr,ae),U("getQueue",ae.queue,ae),U("getTalkLength",ae.talkLength,ae),U("answer",ae.answer,ae),U("dtmf",ae.dtmf,ae),U("hold",ae.hold,ae),U("resume",ae.resume,ae);var se={"-":{}};se[ae.states.DISCONNECTED]={},se[ae.states.BACKCALL]={endCall:1},se[ae.states.BACKRING]={endCall:1,answer:1},se[ae.states.CALL]={endCall:1,conference:1,call:1,intercom:1,transfer:1},se[ae.states.READY]={conference:1,call:1,intercom:1,ghostListen:1,ghostHelp:1,ghostConference:1,transfer:1,toggle:1,endCall:1,resume:1},se[ae.states.RING]={endCall:1,answer:1},se[ae.states.TALK]={endCall:1,conference:1,call:1,resume:1,hold:1,intercom:1,toggle:1,transfer:1,ghostListen:1,ghostHelp:1,ghostConference:1};var le={"-":{}};le[ie.states.DISCONNECTED]={},le[ie.states.READY]={endCall:1,conference:1,call:1,intercom:1,toggle:1,transfer:1,resume:1,ghostListen:1,ghostHelp:1,ghostConference:1,resume:1},le[ie.states.BREAK]={endCall:1,call:1,intercom:1,toggle:1,transfer:1,ghostListen:1,resume:1,ghostHelp:1,ghostConference:1},le[ie.states.OFF]={endCall:1,conference:1,call:1,intercom:1,toggle:1,transfer:1,resume:1,ghostListen:1,ghostHelp:1,ghostConference:1},le[ie.states.BUSY]={answer:1,endCall:1,conference:1,call:1,intercom:1,toggle:1,transfer:1,resume:1,hold:1,ghostListen:1,ghostHelp:1,ghostConference:1},le[ie.states.RESERVED]={},le[ie.states.NOPHONE]={};U("getPhoneActions",function(e){var t=new function(){var e=[],t=ae.state();t="number"==typeof t?t:"-";var n=ie.state()||"-";n="number"==typeof n?n:"-",this.push=function(){d(arguments,function(r){se[t][r]&&le[n][r]&&e.push(r)})},this.getActions=function(){return e}};if(!e||!B())return t.getActions();P[e]&&P[e].number&&!j[e]&&!L[e]&&(e=P[e].number);var n=I.userid==e||I.number==e,r=ae.isAbonent(e,ae.getHoldInfo().abonent||{}),o=P[e]||j[e]||L[e];o&&o.numberObj&&(o=o.numberObj);var i=ae.isAbonent(e)||o&&o.number&&ae.isAbonent(o.number),a=ae.isAbonent(e,ae.queueList)||o&&o.number&&ae.isAbonent(o.number,ae.queueList),s=ae.getHoldInfo().hasHold,l=!!ae.conferenceId(),u=(l&&i&&i.isConferenceCreator,l&&ae.isAbonent(I.userid)),c=l&&u&&u.isConferenceCreator,p=ae.state(),f=ae.intercomSupport;return a||(n?p!=ae.states.DISCONNECTED&&p!=ae.states.READY&&(p!=ae.states.RING&&p!=ae.states.BACKRING||!ae.sipActive&&!1===f||t.push("answer"),t.push("endCall")):(!o||o&&void 0!==o.state&&0!=o.state)&&(r?ae.sipActive&&ae.sip&&"function"==typeof ae.sip.isOnHold&&ae.sip.isOnHold()?t.push("resume"):t.push("toggle","endCall"):i?i&&(p!=ae.states.RING&&p!=ae.states.BACKRING||!ae.sipActive&&!1===f||t.push("answer"),l?c&&t.push("endCall"):(t.push("endCall"),ae.sipActive&&!s&&t.push("hold"),o&&2==o.state||t.push("conference")),ae.getConferenceInfo().isghost&&X(e)&&t.push("ghostListen","ghostHelp","ghostConference")):(l?(o&&2==o.state||t.push("conference"),t.push("transfer")):!s&&p==ae.states.TALK||p==ae.states.READY?(t.push("call"),p==ae.states.TALK&&t.push("transfer"),o&&2==o.state||t.push("conference"),t.push("intercom")):s&&p==ae.states.TALK&&t.push("transfer"),o&&5==o.state&&p==ae.states.READY&&X(e)&&t.push("ghostListen","ghostHelp","ghostConference")))),t.getActions()}),startQueueTimer=function(e){clearInterval(E),E=setInterval(function(){B()&&ae.queue()},e)};U("connect",function(t,i){if(O.trigger("connecting"),B())return!0;var l=!1;a(k,t=t||{}),e=k.debugMode,S=!1,k.oktellVoice&&(!0===k.oktellVoice.isOktellVoice?S=k.oktellVoice:window.oktellVoice&&!0===window.oktellVoice.isOktellVoice&&(S=window.oktellVoice));var u=y("___oktellsessionid")||localStorage&&localStorage.___oktellsessionid;u||void 0===t.password||null===t.password?(k.password=void 0,k.Password=void 0):(k.password=r(o(t.password.toString().toLowerCase())),k.Password=r(o(t.password.toString())));var c=/^w[s]{1,2}:\/\/\S+$/,f=/:[0-9]{1,5}$/,h=function(e){if(c.test(e))return e;var t="https:"==location.protocol,n=t?":443":":80",r=t?"wss://":"ws://";return f.test(e)?r+e:r+e+n};if("string"==typeof k.url&&(k.url=[k.url]),!s(k.url))return v(k.callback,Y(1205)),O.trigger("connectError",Y(1205)),!1;for(var m=[],g=0,b=k.url.length;g<b;g++)"string"==typeof k.url[g]&&m.push(h(k.url[g]));k.url=m,I.url=k.url,I.login=k.login,I.defaultAvatar=k.defaultAvatar,I.defaultAvatar32x32=k.defaultAvatar32x32,I.defaultAvatar64x64=k.defaultAvatar64x64;if(!u&&(void 0===k.password||null===k.password))return v(k.callback,Y(1213)),O.trigger("connectError",Y(1213)),!1;(p=new w(k.url,k.openTimeout,k.queryDelayMin,k.queryDelayMax,function(r){l=!1,I.currentUrl=p.url,Q("login",{Password:k.Password,password:k.password,sessionid:u||void 0,showid:1,usewebrtc:!!S,workplace:k.workplace||void 0,expires:k.expires||void 0},function(o){l=!0;var i=function(e){return Y(a,"",{serverErrorMessage:o.errormsg,serverErrorCode:o.error})};if(o.error||o.errormsg){var a=1e3;50093==o.error?a=1204:50025==o.error?a=1214:"Service not available"==o.errormsg?a=1215:"Wrong login/pass combination"==o.errormsg?(y("___oktellsessionid",null),localStorage&&delete localStorage.___oktellsessionid,a=1202):"Bad request. Session does not exist"!=o.errormsg&&"Bad request. Invalid session user"!=o.errormsg||(y("___oktellsessionid",null),localStorage&&delete localStorage.___oktellsessionid,a=1212),v(k.callback,i()),O.trigger("connectError",i()),ue(14)}else 1==o.result?(clearInterval(_),_=setInterval(function(){B()&&p.sendOktell("ping")},15e3),startQueueTimer(k.queueInterval),ae.queue(),Z.sendCustomBinding(),p.bindOktellEvent("userstatechanged",function(e){ie.saveStatesFromServer(e)}),S&&setTimeout(function(){(T=S.connect({login:o.sipuser,password:o.sippass,server:r.replace(/w[s]{1,2}:\/\//,"").replace("/","").split(":")[0]+":"+o.sipport,useWSS:o.sipsecure,debugMode:e,register_expires:t.register_expires}))&&(T.on("connect",function(){R=!0,O.trigger("webphoneConnect")}),T.on("all",function(e){n("Oktell webphone event: "+e,arguments)}),T.on("disconnect",function(){R=!0,O.trigger("webphoneDisconnect")}),ae.setSipPhone(T))},200),I.userid=o.userid,I.sessionId=o.sessionid,I.sessionId&&(y("___oktellsessionid",I.sessionId,{expires:k.expires}),localStorage&&(localStorage.___oktellsessionid=I.sessionId)),Q("getversion",{showalloweddbstoredprocs:1},function(e){e.result?(I.oktellDated=e.version.dated,I.oktellBuild=e.version.build,I.oktellDated<140918&&/2\.11\.[0-9]{4}\.[0-9]{5}/g.test(I.oktellBuild)&&(I.oktellBuild="2.11.1."+I.oktellDated),I.allowedProcedures=e.alloweddbstoredprocs||{},I.oktellWebServerPort=e.version.webserverport,I.oktellWebServerLink=ee(),z("pbxanswercall")||(ae.intercomSupport=!1),Q("getmyuserinfo",{},function(e){e.result?(I.number=e.mainpbxnumber,I.username=e.username,I.hasline=e.hasline,I.lineid=e.lineid,I.linenumber=e.linenumber,I.isoperator=e.isoperator,ie.loadBreakReasons(function(e){ie.loadState(function(e){e?ie.checkUserRedirect(function(e){!function(e){Q("getpbxnumbers",{mode:"full"},function(t){t.result&&t.numbers&&d(t.numbers,function(e){j[e.number]=e,L[e.id]=j[e.number]}),v(e)})}(function(){p.bindOktellEvent("pbxnumberstatechanged",function(e){for(var t=0;t<e.numbers.length;t++){var n=j[e.numbers[t].num];n&&(n.state=e.numbers[t].numstateid)}}),function(e){Q("getallusernumbers",{fillsubordinates:!0},function(t){t.result&&t.users?(d(t.users,function(e){P[e.id]={id:e.id,name:e.name,number:e.main||void 0,numbers:e.nums||[],controlledByMe:!!e.sub},P[e.id].numberObj=j[P[e.id].number]||void 0,P[e.id].numberObj&&(P[e.id].numberObj.userid=e.id,P[e.id].numberObj.userObj=P[e.id])}),Q("getalluserphotolink",{mode:"page"},function(t){if(t.result){var n=ee();d(t.links,function(e){var t=e.id==I.userid?I:P[e.id];t&&(t.avatarLink=e.link?n+e.link32x32:k.defaultAvatar||"",t.avatarLink32x32=e.link32x32?n+e.link32x32:k.defaultAvatar32x32||"",t.avatarLink96x96=e.link96x96?n+e.link96x96:k.defaultAvatar64x64||"")})}v(e)})):v(e)})}(function(){ae.loadStates(function(e){if(e){l=!1,q.trigger("login"),p.bindOktellEvent("httpresponsecopy",function(e){if("200 OK"==e.response){var t=e.password,n=e.content;N[t]&&"function"==typeof N[t].callback&&N[t].callback(n)}}),v(k.callback,J()),F(!0);for(var t=0;t<x.length;t++){var n=x[t];n&&n.eventName&&n.callback&&!n.binded&&(n.binded=!0,p.bindOktellEvent(n.eventName,n.callback))}O.trigger("connect")}else v(k.callback,i()),O.trigger("connectError",i()),ue(14)})})})}):(v(k.callback,i()),O.trigger("connectError",i()),ue(14))})})):(v(k.callback,i()),O.trigger("connectError",i()),ue(14))})):(v(k.callback,i()),O.trigger("connectError",i()),ue(11))})):(v(k.callback,i()),O.trigger("connectError",i()),ue(14))})})).on("errorConnection",function(e){O.trigger("connectError",Y(1200)),v(k.callback,Y(1200))}),p.on("connectionClose",function(){M?(M=!1,ue(13)):l||ue(12)}),p.multiConnect(),e&&(I.server=p)});var ue=function(e,t){F(!1);for(var n=0;n<x.length;n++){x[n].binded=!1}return T&&T.disconnect&&T.disconnect(),B()?(y("___oktellsessionid",null),localStorage&&delete localStorage.___oktellsessionid,M=!0,ie.state(0),ae.state(ae.states.DISCONNECTED),Q("logout")):("number"==typeof e&&(e=W(e)),t||O.trigger("disconnect",e)),!0};U("removeUserSession",function(){return y("___oktellsessionid",null),!0}),ie.on("userStateChange",function(e){setTimeout(function(){ae.loadStates()},400),5==e||(7==e?ae.state(ae.states.DISCONNECTED):ae.loadStates())}),q.on("login",function(){p.bindOktellEvent("linestatechanged",function(e){setTimeout(function(){ae.loadStates()},500)}),p.bindOktellEvent("flashstatechanged",function(e){setTimeout(function(){ae.loadStates()},500)}),p.bindOktellEvent("confcompositionchanged",function(e){e.eventinfo.conferenceid==ae.conferenceId()&&(ae.setConfAbonentList(e.eventinfo.competitorlist),ae.loadStates())}),p.bindOktellEvent("phoneevent_acmcallstarted",function(e){ae.loadStates(null,{isAutoCall:!0})}),p.bindOktellEvent("phoneevent_acmcallstopped",function(e){setTimeout(function(){ae.loadStates()},700)}),p.bindOktellEvent("phoneevent_ringstarted",function(e){ae.loadStates(function(e){ae.conferenceId()&&ae.loadConferenceInfo()},!1)}),p.bindOktellEvent("phoneevent_ringstopped",function(e){ae.loadStates()}),p.bindOktellEvent("phoneevent_ivrstarted",function(e){!1===e.isroutingivr?ae.notRoutingIvrState(!0):!0===e.isroutingivr&&ae.state()==ae.states.READY&&ae.loadStates()}),p.bindOktellEvent("phoneevent_commstarted",function(e){ae.startTalkTimer(0),ae.currentSessionData.commStarted=!0,e.isconference?(ae.buildConfFromCommCallback&&(ae.isConfCreator(!0),clearTimeout(ae.buildConfFromCommTimer)),ae.conferenceId(e.confid),ae.loadConferenceInfo(function(){ae.loadStates(function(){ae.buildConfFromCommCallback&&(v(ae.buildConfFromCommCallback,J()),ae.buildConfFromCommCallback=void 0)})})):setTimeout(function(){ae.loadStates(function(){})},700)}),p.bindOktellEvent("phoneevent_commstopped",function(e){ae.clearTalkTimer(),ae.currentSessionData.commStopped=!0,setTimeout(function(){ae.loadStates(function(){})},700)}),ie.loadBreakReasons()}),O.disconnect=function(e){return ue(13,e)},O.getAbonents=function(){return ae.getAbonents(!0)},O.call=function(e,t,n){ae.makeCall(e,!1,"string"==typeof t?t:"","function"==typeof t?t:n)},O.onNativeEvent=function(e,t){!function(e,t){e=b(e),evObjs=[];for(var n=0;n<e.length;n++){for(var r=e[n],o=!1,i=0;i<x.length;i++){var a=x[i];if(a&&a.eventName==r&&a.callback===t){o=!0;break}}if(o)e[n]=void 0;else{var s={eventName:r,callback:t};x.push(s),evObjs.push(s)}}if(F()){for(n=0;n<evObjs.length;n++)evObjs[n].binded=!0;p.bindOktellEvent(e,t)}}(e,t)},O.offNativeEvent=function(e,t){!function(e,t){if(e){if(!(e=b(e)))return!1;t="function"==typeof t&&t;for(var n=0;n<e.length;n++)for(var r=e[n],o=0;o<x.length;o++){var i=x[o];i&&i.eventName==r&&(t&&i.callback===t||!t)&&(x[o]=void 0)}}else x=[];p&&p.unbindOktellEvent(e,t)}(e,t)},O.getMyInfo=function(){return l(I)},O.intercom=function(e,t){ae.makeCall(e,!0,"",t)},O.ghostListen=function(e,t){ae.ghost(e,"monitor",t)},O.ghostHelp=function(e,t){ae.ghost(e,"help",t)},O.ghostConference=function(e,t){ae.ghost(e,"conference",t)},O.getUsers=function(){var e={};return d(P,function(t){e[t.id]=t}),e},O.getNumbers=function(){var e={};return d(j,function(t){e[t.number]=t}),e},O.getLunchReasons=O.getBreakReasons=function(){return l(ie.breakReasons)||{}},O.getLog=function(){return t},U("formatPhone",f,void 0),O.inCallCenter=function(){return ie.callCenterState()},O.webphoneIsActive=function(){return R},O.changePassword=function(e,t,n){"string"==typeof e&&e?(e=r(o(e)),t=r(o(t)),O.exec("changepassword",{newpwdmd5:e,oldpwdmd5:t},function(e){e.result?v(n,J({result:!0})):"old password is wrong"==e.errormsg?v(n,Y(2801)):v(n,Y(2803))})):v(n,Y(2802))},O.config=function(t){if(!t)return!1;void 0!==t.debugMode&&(e=Boolean(t.debugMode)),void 0!==t.queryDelayMin&&(p?p.setQueryDelayMin(t.queryDelayMin):k.queryDelayMin=t.queryDelayMin),void 0!==t.queryDelayMax&&(p?p.setQueryDelayMax(t.queryDelayMax):k.queryDelayMax=t.queryDelayMax),void 0!==t.queueInterval&&parseInt(t.queueInterval)&&startQueueTimer(parseInt(t.queueInterval)),void 0!==t.queryTimeout&&parseInt(t.queryTimeout)&&(k.queryTimeout=parseInt(t.queryTimeout))},O.version="1.7.2"};return a(E.prototype,C),E}(),window.oktell=new Oktell},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(11),s=n(73),l=n(372),u=n(8);function c(e){return{root:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,width:"100%",height:"100%",background:s.fade(e.palette.background.paper,.57),zIndex:1e3,visibility:"hidden","&$pending":{visibility:"visible"}},pending:{}}}t.default=u.default(c)(function(e){var t,n=e.classes,s=e.className,u=o(e,["classes","className"]),c=a(n.root,s,((t={})[n.pending]=e.pending,t));return i.createElement("div",r({},u,{className:c}),e.pending&&i.createElement(l.default,null))}),t.styles=c},function(e,t){function n(e,t){if(e.length!==t.length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.cmpPtr=n,t.default=function(e,t){void 0===t&&(t=n);var r=null,o=void 0;return function(){var n=r&&t(r,arguments)?o:e.apply(this,arguments);return o=n,r=arguments,n}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(48),a=n(73),s=n(142),l=n(144),u=n(8),c=n(11),d=n(297),p=n(206),f=n(9),h=n(27),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.now=f().startOf("day"),t.handleClientClick=function(e){e.preventDefault(),e.stopPropagation()},t.handleDriverClick=function(e){e.preventDefault(),e.stopPropagation();var n=t.props.value;n.driver&&p.dispatchStream.next({tag:"@Driver/open",id:n.driver.id})},t.chunk={listItem:function(e){var n,r=t.props,a=r.value,s=r.selected,u=r.showMenu,d=r.states,p=r.onStateChange,f=r.onClick,h=r.className,m=r.classes,y=c(h,m.root,m[l.getOrderColor(a)],((n={})[m.selected]=s,n)),_=t.chunk.secondary(e);return o.createElement(i.ListItem,{className:y,onClick:f},o.createElement(i.ListItemText,{className:m.itemText,primary:g(e,a),secondary:_}),a.locked&&o.createElement(i.Icon,{className:m.locked,color:"action","data-rh":e("Order is being edited by another user")},"lock"),o.createElement("div",{className:m.moreWrapper},u&&o.createElement(v,{items:d||[],onItemSelect:p,renderItemProps:{classes:m}},o.createElement(i.Icon,{className:m.more,"data-rh":e("Change status")},"more_vert"))))},primary:function(e){var n=t.props.value;return(n.is_advance?e("[Preliminary]")+" ":"")+"#"+n.id+", "+n.addresses.map(function(e){return e.address}).filter(function(e){return!!e}).join(" → ")},secondary:function(e){var n=t.props,r=n.value,a=n.classes,s=n.ctx,l=[r.state.name].filter(function(e){return!!e}).join(", "),u=function(e,t,n){var r=t.picked_up;if(!r)return null;var o=function(e,t){return(e.valueOf()-t.valueOf())/864e5}(n,r.clone().startOf("day"));return 0===o?e("Today")+", "+r.format("LT"):1===o?e("Yesterday")+", "+r.format("LT"):r.format("LT")+" "+function(e){return"en-GB"===s.locale?e.format("DD.MM.YYYY"):e.format("L")}(r)}(e,r,t.now);return o.createElement(o.Fragment,null,l,o.createElement("div",{className:a.iconTitles},u&&o.createElement("span",{"data-rh":e("Picked up time")},o.createElement(i.Icon,null,"access_time"),u),r.driver?o.createElement("a",{href:"#","data-rh":e("Driver"),onClick:t.handleDriverClick},o.createElement(i.Icon,null,"directions_car"),"#",r.driver.call," ",r.driver.name):void 0))}},t}return r(t,e),t.prototype.render=function(){var e=this,t=this.props.__;return(Array.isArray(this.props.chunks)?this.props.chunks:[this.props.chunks]).map(function(n){return e.chunk[n](t)})},t.defaultProps={chunks:["listItem"]},t}(o.Component);function g(e,t){return(t.is_advance?e("[Preliminary]")+" ":"")+"#"+t.id+", "+t.addresses.map(function(e){return e.address}).filter(function(e){return!!e}).join(" → ")}t.default=u.default(y)(h.withGettext(n(81))(m)),t.renderPrimary=g,t.renderSecondary=function(e,t){};var v=d.default(function(e){return o.createElement(i.MenuItem,{key:e.item.id,className:c(e.classes.menuItem,e.classes[function(e){return"accepted"===e.state_type?"red":"in_work"===e.state_type?"blue":"none"}(e.item)])},e.item.name)});function y(e){var t=e.spacing.unit;return{root:{cursor:"default",userSelect:"none",position:"relative",padding:[1.5*t,.5*t,1.5*t,2*t],"& h3":{lineHeight:"1.15",fontSize:14},"&:hover":{background:a.fade(e.palette.text.primary,.05)},"&$selected":{background:a.fade(e.palette.text.primary,.1)},"&:before":{content:'""',display:"block",height:"calc(100% - 4px)",width:4,background:"transparent",position:"absolute",left:0,top:2}},itemText:{"& > *:first-child":{lineHeight:1.15}},locked:{flex:"0 0 auto"},menuItem:{"&:before":{content:'""',display:"block",height:"calc(100% - 4px)",width:4,background:"transparent",position:"absolute",left:0,top:2}},blue:{"&:before":{background:s.blue[500]}},red:{"&:before":{background:s.red[500]}},yellow:{"&:before":{background:s.amber.A700}},moreWrapper:{height:"100%",display:"flex",alignItems:"center",top:0},more:{color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}},iconTitles:{marginTop:-7,marginLeft:-2,width:"calc(100% + "+3*t+"px)",display:"flex","& > *":{whiteSpace:"nowrap",color:e.palette.text.secondary,"&:hover":{textDecoration:"none"},"& > *:first-child":{bottom:-6,position:"relative",fontSize:22,marginRight:.5*t}},"& > a":{textDecoration:"underline"},"& > * + *":{marginLeft:2*t},"& > *:last-child":{overflow:"hidden",textOverflow:"ellipsis"}},selected:{}}}t.styles=y},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(166);t.resource=o.crud("tariffs",{name:r.decode.string,active:r.decode.boolean.withDefault(!1),hourly_order:r.decode.boolean.withDefault(!1)})},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(11),l=n(73),u=n(8),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spinner=null,t.filler=null,t.mask=null,t.rewind=function(){var e=t,n=e.spinner,r=e.filler,o=e.mask;if(null!==n&&null!==r&&null!==o){var i=[n,r,o],a=i.map(function(e){return e.style.animation});i.forEach(function(e){e.style.MozAnimation=e.style.WebkitAnimation=e.style.animation="none"}),i.forEach(function(e){return e.offsetWidth}),i.forEach(function(e,t){e.style.MozAnimation=e.style.WebkitAnimation=e.style.animation=a[t]})}},t}return r(t,e),t.getStyles=function(e){var t="rota "+e+"ms linear 1",n="opa "+e+"ms steps(1,end) 1 reverse",r="opa "+e+"ms steps(1,end) 1";return{spinner:{MozAnimation:t,WebkitAnimation:t,OebkitAnimation:t,animation:t},filler:{MozAnimation:n,WebkitAnimation:n,OAnimation:n,animation:n},mask:{MozAnimation:r,WebkitAnimation:r,OAnimation:r,animation:r}}},t.prototype.componentDidMount=function(){this.props.onPassRewinder&&this.props.onPassRewinder(this.rewind)},t.prototype.componentWillUnmount=function(){this.props.onPassRewinder&&this.props.onPassRewinder(null)},t.prototype.render=function(){var e=this,n=this.props,r=(n.duration,n.classes),l=n.className,u=i(n,["duration","classes","className"]),c=s(r.root,l),d=t.getStyles(this.props.duration||1e3);return a.createElement("div",o({},u,{className:c}),a.createElement("div",{className:r.spinner,style:d.spinner,ref:function(t){return e.spinner=t}}),a.createElement("div",{className:r.filler,style:d.filler,ref:function(t){return e.filler=t}}),a.createElement("div",{className:r.mask,style:d.mask,ref:function(t){return e.mask=t}}))},t}(a.Component);function d(e){var t={width:"50%",height:"100%",transformOrigin:"100% 50%",position:"absolute",background:l.lighten("#000",.7)};return{root:{position:"relative",display:"inline-block",background:"white",width:"1.5em",height:"1.5em",boxSizing:"border-box","& *":{boxSizing:"border-box"}},spinner:o({},t,{borderRadius:"100% 0 0 100% / 50% 0 0 50%",zIndex:200,borderRight:"none"}),filler:o({},t,{borderRadius:"0 100% 100% 0 / 0 50% 50% 0",left:"50%",opacity:0,zIndex:100,borderLeft:"none"}),mask:{width:"50%",height:"100%",position:"absolute",background:"inherit",opacity:1,zIndex:300},rotaClass:{animation:"rota 100ms linear infinite"},opaClass:{animation:"opa 100ms linear infinite"},"@keyframes rota":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}},"@keyframes opa":{"0%":{opacity:1},"50%":{opacity:0},"100%":{opacity:0}}}}t.default=u.default(d)(c),t.styles=d},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(164),l=n(113),u=n(11),c=n(8),d=n(645),p=n(27);function f(e){return a.createElement(s.default,o({},e,{onChange:function(t){return e.onValueChange&&e.onValueChange(t.target.value)}}))}var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClear=function(){var e=t.props.onValueChange;e&&e("")},t}return r(t,e),t.prototype.render=function(){var e,t=this.props,n=t.__,r=(t.ctx,t.className),s=t.classes,c=t.value,p=i(t,["__","ctx","className","classes","value"]),h=u(r,s.root),m=!!c,g=u("material-icons",s.icon,((e={})[s.visible]=m,e));return a.createElement(d.default,{debounce:500},a.createElement(f,o({},p,{className:h,value:c,disableUnderline:!0,placeholder:n("Search"),startAdornment:a.createElement(l.default,{color:"disabled"},"search"),endAdornment:a.createElement(l.default,{className:g,onClick:this.handleClear},"close")})))},t.muiName="SearchField",t}(a.Component);function m(e){var t=e.spacing.unit;return{root:{display:"inline-flex",alignItems:"center","& input::placeholder":{fontStyle:"italic"}},icon:{color:e.palette.text.secondary,marginLeft:t,marginRight:t,cursor:"pointer",visibility:"hidden","&:hover":{color:e.palette.text.primary},"&$visible":{visibility:"visible"}},visible:{}}}t.default=c.default(m)(p.withGettext(n(647))(h)),t.styles=m},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(54),a=n(646),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={value:void 0,open:!1},t.debounceTimerId=null,t.notifyChange=function(e){void 0!==t.props.prism?t.props.prism.match(e).fold(function(e){t.setState({value:e})},function(e){void 0!==t.state.value&&t.setState({value:void 0})}):t.props.children.props.onValueChange&&t.props.children.props.onValueChange(e)},t.handleValueChange=function(e){t.props.filter&&!t.props.filter(e)||(t.props.debounce?(t.debounceTimerId&&clearTimeout(t.debounceTimerId),t.setState({value:e}),t.debounceTask=function(){var n=t.props.waitForNextValue;t.notifyChange(e),n||t.setState({value:void 0}),t.debounceTimerId&&(t.debounceTimerId=null)},t.debounceTimerId=setTimeout(t.debounceTask,t.props.debounce)):t.notifyChange(e))},t.handleFocus=function(e){t.setState({open:!0}),t.props.children.props.onFocus&&t.props.children.props.onFocus(e)},t.handleBlur=function(e){t.setState({open:!1,value:void 0}),t.debounceTimerId&&(clearTimeout(t.debounceTimerId),t.debounceTask&&t.debounceTask(),t.debounceTimerId=null),t.props.children.props.onBlur&&t.props.children.props.onBlur(e)},t.handleClick=function(e){t.state.open||t.setState({open:!0})},t.handleSuggestionSelect=function(e){var n=e.props.value,r=i.findDOMNode(t);if(r instanceof Element){var o=r.querySelector("input");if(o){var a=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").set,s=new Event("input",{bubbles:!0});a.call(o,n),o.dispatchEvent(s),t.setState({open:!1})}}},t.handleSuggestionVisibilityChnage=function(e){t.setState({open:e})},t.getValue=function(){var e=t.props.children.props.value;return void 0!==t.state.value?t.state.value:void 0!==t.props.prism?"string"==typeof e?t.props.prism.build(e):"":e},t}return r(t,e),t.prototype.componentWillReceiveProps=function(e){var t=this.props.children.props.value,n=e.children.props.value;this.props.waitForNextValue&&t!==n&&void 0!==this.state.value&&this.setState({value:void 0})},t.prototype.componentDidMount=function(){var e=i.findDOMNode(this);e instanceof Element&&(this.inputEl=e.querySelector("input"))},t.prototype.render=function(){var e=this.props,t=e.children,n=e.withSuggestions,r=this.state.open,i=o.cloneElement(t,{value:this.getValue(),onBlur:this.handleBlur,onFocus:this.handleFocus,onValueChange:this.handleValueChange,onClick:this.handleClick});return o.createElement(o.Fragment,null,i,n&&o.createElement(a.default,{anchorEl:this.inputEl||void 0,open:r,suggestions:n,renderSuggestion:function(e){return e},onSelect:this.handleSuggestionSelect,onVisibilityChange:this.handleSuggestionVisibilityChnage}))},t}(o.Component);t.default=s},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(54),s=n(50),l=n(48),u=n(8),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={selected:0},t.paperEl=null,t.unlisten=null,t.handleKeyDown=function(e){var n=t.props,r=n.suggestions,o=n.onVisibilityChange,i=n.onSelect,a=n.keepOpenAfterSelect;switch(e.key){case"ArrowDown":t.state.selected<r.length-1&&t.setHovered(t.state.selected+1);break;case"ArrowUp":t.state.selected>0&&t.setHovered(t.state.selected-1);break;case"Enter":if(e.stopPropagation(),e.preventDefault(),t.state.selected>=r.length)break;i&&i(r[t.state.selected]),!a&&o&&o(!1)}},t.handleSuggestionClick=s.memoize(function(e){return function(n){var r=t.props,o=r.suggestions,i=r.onSelect,a=r.onVisibilityChange,s=r.keepOpenAfterSelect;n.stopPropagation(),n.preventDefault(),e>=o.length||(i&&i(o[e]),!s&&a&&a(!1))}}),t.handleClose=function(){var e=t.props.onVisibilityChange;e&&e(!1)},t.handlePaperRef=function(e){var n=t.props.anchorEl;if(e&&n){t.paperEl=a.findDOMNode(e);var r=t.props.marginThreshold||8,o=window.innerHeight-r,i=t.paperEl.getBoundingClientRect(),s=n.getBoundingClientRect(),l=i.height,u=s.bottom+4;u+l>o&&s.top-window.scrollY-l-8>r&&(u=s.top-8-l),t.paperEl.style.top=u+"px",t.paperEl.style.left=s.left+"px"}},t}return r(t,e),t.prototype.componentDidMount=function(){this.props.open&&this.listen()},t.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},t.prototype.componentWillReceiveProps=function(e){e.open&&!this.props.open&&this.listen(),!e.open&&this.props.open&&(this.setHovered(0),this.unlisten&&this.unlisten()),e.suggestions!==this.props.suggestions&&this.setHovered(0)},t.prototype.componentDidUpdate=function(e){e.suggestions!==this.props.suggestions&&this.paperEl&&this.handlePaperRef(this.paperEl)},t.prototype.listen=function(){var e=this;document.body.addEventListener("keydown",this.handleKeyDown),this.unlisten=function(){document.body.removeEventListener("keydown",e.handleKeyDown),e.unlisten=null}},t.prototype.setHovered=function(e){var t=this;this.setState({selected:e},function(){if(t.paperEl){var e=t.paperEl.querySelector("[data-is-selected=true]");if(e){var n=e.parentNode,r=n.getBoundingClientRect();e.offsetTop-n.scrollTop>=.8*r.height?n.scrollTop=e.offsetTop-.8*r.height:e.offsetTop-n.scrollTop<.1*r.height&&(n.scrollTop=e.offsetTop-.1*r.height)}}})},t.prototype.renderSuggestions=function(){var e=this,t=this.props,n=t.suggestions,r=t.renderSuggestion,o=this.state.selected;return n.map(function(t,n){var a=r?r(t):String(t);return"string"==typeof a?i.createElement(l.MenuItem,{key:n,selected:o===n,onMouseDown:e.handleSuggestionClick(n),"data-is-selected":o===n},a):i.cloneElement(a,{key:n,onMouseDown:function(t){e.handleSuggestionClick(n)(t),a.props.onClick&&a.props.onClick()},selected:o===n,"data-is-selected":o===n})})},t.prototype.render=function(){var e=this.props,t=e.classes,n=e.open,r={ref:this.handlePaperRef,className:t.paper};return i.createElement(l.Modal,{open:!!n,BackdropProps:{invisible:!0,onMouseDown:function(e){e.preventDefault()}},onClose:this.handleClose,disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0},i.createElement(l.Paper,o({},r),i.createElement(l.MenuList,{className:t.menu},this.renderSuggestions())))},t}(i.Component);function d(e){return{paper:{position:"absolute",zIndex:9e3},menu:{maxHeight:300,overflowY:"auto"}}}t.Suggestions=c,t.default=u.default(d)(c),t.styles=d},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(989))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(160),s=n(8),l=n(11),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e,t=this.props,n=t.classes,r=t.className,s=l(r,((e={})[n.button]="onClick"in this.props,e));return i.createElement(a.default,o({},this.props,{className:s}))},t}(i.Component);function c(e){return{button:{cursor:"pointer",color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}}}}t.default=s.default(c)(u),t.styles=c},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(48),a=n(8),s=n(214),l=n(11),u=n(27),c=n(73),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.open,r=e.searchField,a=e.className,u=e.classes,c=e.onReset,d=e.children,p=e.onVisibilityChange,f=l(u.root,a);return o.createElement("div",{className:f},o.createElement("div",{className:u.searchWrapper},r,o.createElement(s.default,{className:u.switch,label:t("Toggle filter"),labelPosition:"left",labelClassName:u.label},o.createElement(i.Switch,{onChange:function(){return p&&p(!n)},onClick:function(){return p&&p(!n)},checked:n||!1}))),o.createElement(i.Collapse,{in:n},o.createElement("div",{className:u.items},d)),c&&o.createElement("div",{className:u.resetFilters},o.createElement("a",{href:"javascript://void 0",onClick:c},t("Reset filter")),o.createElement(i.Icon,null,"close")))},t}(o.Component);function p(e){var t=e.spacing.unit,n={color:e.palette.primary.main,textDecoration:"none",borderBottom:"dotted 1px "+e.palette.primary.main,fontSize:13,"&:hover":{color:c.fade(e.palette.primary.main,.75),borderColor:c.fade(e.palette.primary.main,.75)},"&:active":{color:e.palette.error.main,borderColor:e.palette.error.main}};return{root:{display:"flex",flexDirection:"column"},searchWrapper:{display:"flex",flexDirection:"row",flex:"0 0 auto",overflow:"hidden",padding:[0,2*t,0,2*t],borderBottom:"solid 1px "+e.palette.divider,"& > *:first-child":{minWidth:0}},searchField:{marginTop:0,alignItems:"center",flex:"10 10 auto",overflow:"hidden"},items:{borderBottom:"solid 1px "+e.palette.divider,"& > *":{padding:[t,2*t]}},switch:{marginRight:-t-5},label:{lineHeight:1.15,fontSize:14,textAlign:"right",whiteSpace:"nowrap"},resetFilters:{textAlign:"center",paddingTop:.5*t,paddingBottom:t,display:"flex",alignItems:"center",justifyContent:"center","& a":n,"& .material-icons":{fontSize:16,marginLeft:2,marginTop:3}}}}t.default=u.withGettext(n(647))(a.default(p)(d)),t.styles=p},,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(54),l=n(640),u=n(294),c=n(113),d=n(646),p=n(8),f=n(11),h=function(e){function t(t){var n=e.call(this,t)||this;n.inputEl=null,n.findInputRef=function(e){var t=null;if(e instanceof a.Component&&(t=s.findDOMNode(e)),e instanceof Element&&(t=e),t)if("input"!==t.tagName.toLowerCase()){var r=t.querySelector("[class*=root]");if(r)n.inputEl=r;else{var o=t.querySelector("input");o&&(n.inputEl=o)}}else n.inputEl=t},n.handleInput=function(e){var t=n.props,r=t.onClear,o=t.limit,i=t.disableAutoComplete,a=e.target.value,s={search:a,limit:o||0,offset:0};""===a?(n.setState({open:!1,offset:0,search:"",total:0,items:[]}),r&&r()):!i&&n.query(s)},n.handleFocus=function(e){n.setState({focused:!0},function(){return n.props.showOnFocus&&n.query(n.makeQuery())})},n.handleBlur=function(e){n.state.focused&&n.setState({focused:!1,open:!1,search:""})},n.handleClick=function(e){e.preventDefault(),e.stopPropagation(),"input"===e.target.tagName.toLowerCase()&&!n.state.open&&n.query(n.makeQuery())},n.handleInputKeyDown=function(e){"ArrowDown"!==e.key||n.state.open||n.query(n.makeQuery())},n.handleVisibilityChange=function(e){n.setState({open:e})},n.handleClickDropDown=function(e){n.query(n.makeQuery())},n.handleSelect=function(e){n.props.onSelect&&n.props.onSelect(e),n.setState({offset:0,search:""})};var r=t.source,o=r&&"Static"===r.tag?r.items.length:0,i=r&&"Static"===r.tag?r.items:[];return n.state={open:!1,offset:0,search:"",total:o,items:i,focused:!1},n}return r(t,e),t.prototype.getSource=function(e){var t=this.props,n=t.source,r=t.sourceSync,o=t.sourceAsync,i=t.sourceStatic;return n||(r?{tag:"Sync",query:r}:o?{tag:"Async",query:o}:i?{tag:"Static",items:i}:null)},t.prototype.query=function(e){var t=this,n=this.getSource(this.props);if(n)switch(n.tag){case"Async":var r=function(e){},o=function(n){var r=n[0],o=n[1],i=r.length>0&&t.state.focused;t.setState({items:r,total:o,offset:e.offset,search:e.search,open:i}),t.props.feelingLucky&&!t.isFocused()&&r.length>0&&t.handleSelect(r[0])};n.query(e).subscribe(function(e){return e.fold(r,o)});break;case"Sync":var i=n.query(e),a=i[0],s=i[1];this.setState({items:a,total:s,offset:e.offset,search:e.search,open:0!==a.length});break;case"Static":this.setState({items:n.items,total:n.items.length,offset:e.offset,search:e.search,open:0!==n.items.length})}},t.prototype.inputProps=function(){var e=this.props,t=e.print,n=e.value,r=e.disabled,i=e.inputProps,a=this.state.search;return o({inputRef:this.findInputRef,value:""!==a?a:(t||String)(n),onChange:!r&&this.handleInput,onFocus:!r&&this.handleFocus,onBlur:!r&&this.handleBlur,onClick:!r&&this.handleClick,onKeyDown:!r&&this.handleInputKeyDown,fullWidth:!0,InputProps:{endAdornment:this.renderButtons()},disabled:r},i)},t.prototype.isFocused=function(){return!!this.inputEl&&(this.inputEl===document.activeElement||this.inputEl.contains(document.activeElement))},t.prototype.makeQuery=function(){return{search:this.state.search,limit:this.props.limit||0,offset:this.state.offset}},t.prototype.renderButtons=function(){var e=this.props,t=e.buttons,n=e.onClear,r=e.isEmpty,o=e.value,i=e.onClose,s=r?r(o):null===o,l=a.createElement(c.default,{onClick:this.handleClickDropDown},"arrow_drop_down"),u=!n||i||s?null:a.createElement(c.default,{onClick:n},"close"),d=i?a.createElement(c.default,{onClick:i},"close"):null;return a.createElement(a.Fragment,null,t,u,d,l)},t.prototype.render=function(){var e=this.props,t=e.className,n=e.renderSuggestion,r=e.renderInput,i=e.print,s=e.classes,l=e.suggestionProps,c=this.state,p=c.open,h=c.items,m=f(t,s.root);return a.createElement("div",{className:m},r?r(this.inputProps()):a.createElement(u.default,o({},this.inputProps())),a.createElement(d.default,o({anchorEl:this.inputEl?this.inputEl:void 0,open:p,suggestions:h,renderSuggestion:n||i,onSelect:this.handleSelect,onVisibilityChange:this.handleVisibilityChange},l)))},t=i([p.default(g)],t)}(a.Component);function m(e,t){var n=t.toLowerCase();e=e.toLowerCase();for(var r=0,o=0;o<t.length;o++)n[o]===e[r]&&(r+=1);return r===e.length}function g(e){return{root:{position:"relative"},icons:{position:"absolute",top:15,right:0,display:"flex","& > *":{cursor:"pointer",color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}}},menu:{maxHeight:300}}}t.AutoComplete=h,t.default=h,t.fromArray=function(e,t){return{tag:"Sync",query:l.default(function(n){var r=n.offset,o=n.limit,i=n.search;if(r>=e.length)return[[],e.length];if(""===i)return[e.slice(r<0?0:r,o||void 0),e.length];var a=e.filter(function(e){var n=function(e){return t?t(e):Object.prototype.toString.call(e)}(e);return n&&m(i,n)});return[a.slice(r<0?0:r,o>0?o:void 0),a.length]})}},t.fuzzyFilter=m,t.styles=g},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1102))},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1105))},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(113),a=n(206),s=n(27),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCall=function(){var e=t.props.phone;a.dispatchStream.next({tag:"@Call",phone:e})},t.handleTransfer=function(){var e=t.props.phone;a.dispatchStream.next({tag:"@Call/transfer",phone:e})},t.handleFlash=function(){var e=t.props.phone;a.dispatchStream.next({tag:"@Call/transfer",phone:e})},t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.phone,n=e.currentCall,r=e.__;return""===t?null:n&&n.phone===t?null:n?o.createElement(o.Fragment,null,n.phone!==t&&o.createElement(i.default,{"data-rh":r("Transfer call"),onClick:this.handleTransfer},"swap_horiz"),o.createElement(i.default,{"data-rh":r("Call"),onClick:this.handleFlash},"call")):o.createElement(i.default,{"data-rh":r("Call"),onClick:this.handleCall},"call")},t}(o.Component);t.default=s.withGettext(n(688))(l)},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1119))},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(36),s=n(99),l=n(8),u=n(307),c=n(690),d=n(691),p=n(144),f=n(44),h=n(247),m=n(369),g=n(308),v=n(307),y=n(48),_=n(165),b=n(641),C=n(113),w=n(1130),E=n(27);function S(e){return function(t){return function(n){var r=x("tariff","crew_group","attributes"),i=r.attributes?r.attributes.split(",").map(function(e){return e.trim()}):[],a=r.tariff&&t.tariffs.find(function(e){return e.id==r.tariff.trim()})||n.tariff,s=r.crew_group&&t.crewGroups.find(function(e){return e.id==r.crew_group.trim()})||n.crew_group,l=f.filterMap(i,function(e){return t.attributes.find(function(t){return t.id==e})||null});return o({},n,{phone:e.phone,client:e.client,client_employee:e.client_employee,tariff:a,crew_group:s,attributes:l})}}}t.init=function(e,t){return m.phoneInfo(e,t).chain(function(t){return t.current_order?p.collection.getPrimary(e,t.current_order.id).mapEff(function(e){return{step:{tag:"FoundExistedOrder",order:e},pending:!1,info:t,prevStep:null}}):u.initNew(e).chain(v.modifyNoLoop(e,S(t))).mapEff(function(e){return{step:{tag:"Order",model:e},pending:!1,info:t,prevStep:null}})})},t.applyUrlParameters=S,t.update=g.compose(function(e){return function(t,n,r){for(var o=n;;){if("string"==typeof o.tag&&"@"===o.tag[0]){n=o;break}if("object"!=typeof o.action)break;o=o.action}return e(t,n,r)}})(function(e,t,n){switch(t.tag){case"Pending":return[o({},n,{pending:t.pending}),a.noop];case"Ping":var r=function(){return a.option.none};return[n,h.ping(e).performMaybe(function(e){return a.option.some({tag:"@Error",error:e})},r)];case"OpenExisting":if("FoundExistedOrder"!==n.step.tag)return[n,a.noop];r=function(e){return{tag:"Step/set",step:e}};var i=u.init(e,n.step.order.id).mapEff(function(e){return{tag:"Order",model:e}}).perform(f.onFailure,r);return[n,f.pending(i)];case"OpenNew":r=function(e){return{tag:"Step/set",step:e}},i=u.initNew(e).chain(v.modifyNoLoop(e,S(n.info))).mapEff(function(e){return{tag:"Order",model:e}}).perform(f.onFailure,r);return[n,f.pending(i)];case"Step/set":return[function(e,t){var n=e.step;return o({},e,{prevStep:n,step:t})}(n,t.step),a.noop];case"GoBack":var l=n.prevStep||n.step;return[o({},n,{step:l,prevStep:null}),a.noop];case"Nested/order":if(!("model"in n.step))return[n,a.noop];var c=u.update(e,t.action,n.step.model),d=c[0];i=c[1];return[o({},n,{step:o({},n.step,{model:d})}),i.map(T)];case"@Error":return[n,s.notifyError(t.error)];case"@Success":return[n,s.notifySuccess(t.message)];case"@Warning":return[n,s.notifyWarning(t.message)];default:return function(e,t,n){return[n,a.noop]}(0,0,n)}});var T=function(e){return{tag:"Nested/order",action:e}},O=function(e){return function(t){return e(T(t))}},A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.unlisten=null,t}return r(t,e),t.prototype.componentDidMount=function(){this.listen()},t.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},t.prototype.listen=function(){var e=this.props,t=e.ctx,n=e.dispatch,r=setInterval(function(){return n({tag:"Ping"})},t.pingInterval);this.unlisten=function(){return clearInterval(r)}},t.prototype.renderStep=function(e){var t=this.props,n=t.__,r=t.ctx,o=t.dispatch,a=t.classes,s=t.model;switch(e.tag){case"Order":return i.createElement(i.Fragment,null,i.createElement("div",{className:a.cardHeader},i.createElement("div",null,s.prevStep&&i.createElement(C.default,{"data-rh":n("Go back"),className:a.goBackIcon,onClick:function(){return o({tag:"GoBack"})}},"chevron_left")),i.createElement(d.default,{ctx:r,model:e.model,dispatch:O(o)})),i.createElement(u.View,{ctx:r,model:e.model,dispatch:O(o)}),i.createElement(c.default,{ctx:r,model:e.model,dispatch:O(o)}));case"OrderCreated":return i.createElement("div",null,n("Order created"),", ",i.createElement("a",{href:"javascript://void 0"},n("create an order")));case"FoundExistedOrder":return i.createElement("div",null,i.createElement(y.DialogTitle,null,n("Found existing order")),i.createElement(b.default,{ctx:r,value:e.order,onClick:function(){return o({tag:"OpenExisting"})}}),i.createElement("div",null),i.createElement("div",{className:a.buttons},i.createElement(y.Button,{size:"small",onClick:function(){return o({tag:"OpenNew"})}},n("create new order")),i.createElement(y.Button,{size:"small",onClick:function(){return o({tag:"OpenExisting"})}},n("open existing"))))}},t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.model,o=r.pending,a=r.step,s=e.ctx;return i.createElement("div",{className:n.root},i.createElement("div",{className:n.toolbar},i.createElement(w.default,{ctx:s,title:t("Operator Workstation"),company:s.settings.taxi_title})),i.createElement(y.Paper,{className:n.paper},this.renderStep(a)),i.createElement(_.default,{pending:o}))},t}(i.Component);function x(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return("?"===location.search[0]?location.search.substr(1):location.search).split("&").map(function(e){return e.split("=")}).reduce(function(t,n){var r=n[0],o=n[1],i=decodeURIComponent(r).match(/^order\[([^\]]+)\]$/);return null===i?t:(-1!==e.indexOf(i[1])&&(t[i[1]]=decodeURIComponent(o)),t)},{})}function k(e){var t=e.spacing.unit;return{root:{width:"100%",minHeight:"70%",display:"flex",flexDirection:"column",justifyContent:"center",paddingTop:7*t},paper:{maxWidth:50*t,margin:[2*t,"auto"]},buttons:{borderTop:"solid 1px "+e.palette.divider,padding:[t,t],display:"flex",flexDirection:"row",justifyContent:"space-between"},cardHeader:{display:"flex",flexDirection:"row",alignItems:"center"},goBackIcon:{fontSize:"32px !important",marginLeft:10},toolbar:{height:7*t,borderBottom:"solid 1px "+e.palette.divider,background:"white",position:"absolute",top:0,width:"100%",alignItems:"center",display:"flex"}}}t.View=l.default(k)(E.withGettext(n(692),n(186))(A)),t.readOrderParameters=x,t.styles=k},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(50),a=n(8),s=n(48),l=n(44),u=n(184),c=n(27),d=n(165),p=n(11),f=n(307),h=n(406),m=c.Translations.fromPO(n(246),n(81)),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e,t=this.props.__,n=this.props,r=n.ctx,a=n.model,l=n.dispatch,c=n.classes,m=n.model,g=m.pending,v=null!==m.modified,y=f.form.get(a),_=f.form.disabled(y,this),b=f.form.validate(y,this),C=i.isEmpty(b);if(!0===_)return o.createElement("div",{className:c.empty},o.createElement("span",null,a.initial.locked?t("Order is being edited by another user"):t("Cannot edit this order")));var w=f.submitAction(r,this.props),E=p(c.cost,((e={})[c.costDisabled]=!y.send_cost,e));return o.createElement("div",{className:c.actionsWrapper},o.createElement(s.Button,{size:"small",disabled:!v,onClick:function(){return l({tag:"Reset"})}},t("Reset")),o.createElement("div",null,o.createElement("div",{className:c.total},o.createElement("label",null,t("Send cost")),o.createElement(u.default,{disableRipple:!0,className:c.sendCostCheckbox,checked:y.send_cost,onChange:function(){return l({tag:"Change",at:"send_cost",value:!y.send_cost})}}),o.createElement("span",{className:E},h.currencyFormatter(r)(y.cost.total))),o.createElement(s.Button,{variant:"raised",size:"small",color:"primary",disabled:!C||!v||g,onClick:function(){return w&&l(w)}},t("Save"))),o.createElement(d.default,{pending:g}))},t}(l.PureComponent);function v(e){var t=e.spacing.unit;return{total:{display:"flex",flexDirection:"row",alignItems:"center",minWidth:0,justifyContent:"flex-end","& label":{color:e.palette.text.secondary,fontSize:11,lineHeight:1.15,flex:"0 10 0%",textAlign:"right"}},cost:{whiteSpace:"nowrap",fontSize:22,overflow:"hidden",textOverflow:"ellipsis",marginRight:t},actionsWrapper:{flex:"0 0 auto",display:"flex",position:"relative",padding:[t,2*t,t,t],width:"100%",boxSizing:"border-box",justifyContent:"space-between","& > div":{display:"flex",flexDirection:"row",minWidth:0}},sendCostCheckbox:{width:4*t,height:4*t,"& svg":{width:"0.8em",height:"0.8em",color:e.palette.text.secondary}},costDisabled:{color:e.palette.text.disabled},empty:{fontStyle:"italic",color:e.palette.text.secondary,textAlign:"center"}}}t.default=a.default(v)(c.withGettext(m)(g)),t.styles=v},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(48),l=n(113),u=n(142),c=n(11),d=n(8),p=n(1126),f=n(27),h=n(297),m=n(144),g=n(1129),v=n(44),y=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCopyOrder=function(){(0,t.props.dispatch)({tag:"Copy"})},t.handleStatusChange=function(e){var n=t.props;(0,n.dispatch)({tag:"@Order/changeStatus",id:n.model.initial.id,state:e})},t}return r(n,e),n.prototype.render=function(){var e=this.props,n=e.__,r=e.classes,i=e.ctx,s=e.model.states,u=e.model,d=c(r.root),h=c(r.status,r[m.getOrderColor(u.initial)]),y=v.isNew(u.initial)?n("New order"):f.sprintf(n("Order #%s"),u.initial.id),b=u.initial.state.name,C="finished"===u.initial.state.state_type||"aborted"===u.initial.state.state_type;return v.isNew(u.initial)?a.createElement("div",{className:d},a.createElement("div",{className:r.title},a.createElement("div",{className:r.header},a.createElement("div",null,a.createElement("h2",{className:r.title},y)),a.createElement("div",{className:r.icons},a.createElement(l.default,{className:r.close,"data-rh":n("Close"),onClick:this.props.onClose},"close"))))):a.createElement("div",{className:d},a.createElement("div",{className:r.header},a.createElement("div",null,a.createElement("h2",{className:r.title},y),a.createElement("div",{className:h},b)),a.createElement("div",{className:r.icons},a.createElement(p.default,{ctx:i,Confirmation:t.CopyConfirmation},a.createElement(l.default,{onClick:this.handleCopyOrder,"data-rh":n("Copy")},"content_copy")),a.createElement(g.default,o({},this.props)),!C&&a.createElement(_,{items:s,onItemSelect:this.handleStatusChange,renderItemProps:{classes:r}},a.createElement(l.default,{className:r.moreIcon,"data-rh":n("Change status")},"more_vert")),a.createElement(l.default,{className:r.close,"data-rh":n("Close"),onClick:this.props.onClose},"close"))))},n}(a.PureComponent);t.default=d.default(b)(f.withGettext(n(81))(y));var _=h.default(function(e){return a.createElement(s.MenuItem,{key:e.item.id,className:c(e.classes.menuItem,e.classes[function(e){return"accepted"===e.state_type?"red":"in_work"===e.state_type?"blue":"none"}(e.item)])},e.item.name)});function b(e){var t=e.spacing.unit;return{root:{display:"flex",flexDirection:"column",width:"100%","& > * + *":{borderTop:"solid 1px "+e.palette.divider}},header:{display:"flex",alignItems:"center",flex:"0 0 auto",height:54,boxSizing:"border-box",paddingLeft:2*t,paddingRight:2*t-4,justifyContent:"space-between",width:"100%"},title:o({},e.typography.title,{marginTop:0,marginBottom:2}),icons:{display:"flex",alignItems:"center","& > * + *":{marginLeft:t},"& > *":{color:e.palette.text.secondary,cursor:"pointer","&:hover":{color:e.palette.text.primary}}},moreIcon:{marginLeft:.5*t,marginRight:.5*-t},status:{fontSize:16,"&$blue":{color:u.blue[500]},"&$red":{color:u.red[500]},"&$yellow":{color:u.amber.A700},"&$none":{color:e.palette.text.secondary}},menuItem:{"&:before":{content:'""',display:"block",height:"calc(100% - 4px)",width:4,background:"transparent",position:"absolute",left:0,top:2}},blue:{"&:before":{background:u.blue[500]}},red:{"&:before":{background:u.red[500]}},yellow:{"&:before":{background:u.amber.A700}},formWrapper:{flex:"10 10 100%",overflow:"hidden",overflowY:"auto"},actionsWrapper:{flex:"0 0 auto",display:"flex",padding:[t,2*t,t,t],background:e.palette.grey[200],"& > *:first-child":{flexGrow:10},"& > *:first-child + *":{flexGrow:0,display:"flex",alignItems:"center","& > * + *":{marginLeft:2*t}}},cantEditWrapper:{flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"center",padding:t+"px "+2*t+"px",background:e.palette.background.default,minHeight:36,textAlign:"center"},cantEditTitle:{fontStyle:"italic"},none:{},dialog:{maxWidth:450,height:"80%"},events:{},eventItem:{width:"100%",borderCollapse:"collapse","& + &":{marginTop:2*t},"& th":{textAlign:"left"},"& td:first-child":{padding:[0,2*t],textAlign:"right",color:e.palette.text.secondary,minWidth:11*t},"& td:first-child + *":{width:"80%"}},item:{height:"auto"},menuTitle:o({},e.typography.caption,{display:"block",fontWeight:600,padding:t+"px "+2*t+"px"}),total:{position:"relative","& > *:first-child + *":{"& span":{fontSize:26},"& label":{marginRight:t,color:e.palette.text.secondary,textTransform:"capitalize","&:after":{content:'":"'}}}}}}t.CopyConfirmation=d.default(b)(f.withGettext(n(81))(function(e){var t=e.__,n=(e.ctx,e.classes,e.onConfirm),r=i(e,["__","ctx","classes","onConfirm"]);return a.createElement(s.Dialog,o({},r),a.createElement(s.DialogTitle,null,t("Confirm the action")),a.createElement(s.DialogContent,null,a.createElement("p",null,t("New order will be created with the same fields except for the driver, which will be emptied. Continue?"))),a.createElement(s.DialogActions,null,a.createElement(s.Button,{onClick:r.onClose},t("Cancel")),a.createElement(s.Button,{onClick:n,color:"primary"},t("Confirm"))))})),t.styles=b},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1131))},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(36),s=n(99),l=n(48),u=n(73),c=n(187),d=n(249),p=n(296),f=n(142),h=n(44),m=n(8),g=n(1136),v=n(208),y=n(44),_=n(132),b=n(687),C=n(27),w=n(305),E=n(1138),S=C.Translations.fromPO(n(246),n(213),n(161));function T(e,t){return a.eff.ap(d.resource.getCollection(e),p.resource.getCollection(e).mapEff(function(e){return e.filter(p.hasScope("driver"))}),v.resource.getCollection(e),function(e,n,r){return{initial:function(e){return e.car?-1!==e.available_cars.findIndex(function(t){return t.id===e.car.id})?e:o({},e,{available_cars:[e.car].concat(e.available_cars)}):e}(t),modified:null,meta:{},crewGroups:e,attributes:n,states:r,pending:!1}})}t.init=T,t.initExisted=function(e,t){return c.cardResource.getPrimary(e,t).chain(function(t){return T(e,t)})},t.initBlank=function(e){return T(e,c.blank)},t.update=h.compose(function(e){return function(n,r,i){var a=e(n,r,i),s=a[0],l=a[1],u=t.form.get(i),c=t.form.get(s);e:if(u.available_cars!==c.available_cars){var d=c.car;if(!d){if(!c.available_cars.length)break e;return[t.form.modify(s,function(e){return o({},e,{car:c.available_cars[0]})}),l]}var p=c.available_cars.findIndex(function(e){return e.id==d.id});if(-1===p)return[t.form.modify(s,function(e){return o({},e,{car:c.available_cars[0]||null})}),l]}return a}})(function(e,n,r){var i=S.__;switch(n.tag){case"Pending":return[o({},r,{pending:n.pending}),a.noop];case"Reset":case"Reset":return[o({},r,{modified:null}),a.noop];case"Change":return[t.form.modify(r,y.updateAt(n.at,n.value)),a.noop];case"Cars/setMain":return[t.form.modify(r,function(e){var t=e.available_cars.find(function(e){return e.id==n.id})||e.car;return o({},e,{car:t})}),a.noop];case"Post":var l=function(){return{tag:"Post/success"}},u=t.form.get(r);return[r,y.pending(c.blankResource.postResource(e,u).perform(y.onFailure,l))];case"Post/success":return[r,s.notifySuccess(i("Item created"))];case"Patch":if(!r.modified)return[r,a.noop];var d=h.makePatch(r.initial,r.modified);return l=function(){return{tag:"Patch/success"}},[r,y.pending(c.cardResource.patchResource(e,r.initial.id,d).perform(y.onFailure,l))];case"Patch/success":var p=t.form.get(r);return[o({},r,{initial:p,modified:null}),s.notifySuccess(i("Item changed"))];case"Delete":return l=function(){return{tag:"Delete/success"}},[r,y.pending(c.cardResource.deleteResource(e,r.initial.id).perform(y.onFailure,l))];case"Delete/success":return[r,s.notifySuccess(i("Item deleted"))]}});var O=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.zoom=t.form.createZoom(n),n.handleOpenOrder=function(){var e=n.props,r=e.model,o=e.dispatch,i=t.form.get(r);i.order&&o({tag:"@Order/open",id:i.order.id})},n.handleOnChange=function(e){return function(t){(0,n.props.dispatch)({tag:"Change",at:e,value:t.target.value})}},n.zoomDefaultPhone=function(){var e=n.props,r=e.model,o=e.dispatch,i=t.form.get(r);return{value:E.default(i.phones,function(e){return e.default?e.number:void 0})||"",onValueChange:function(e){var t=i.phones.findIndex(function(e){return!!e.default});o(-1===t?{tag:"Change",value:[{default:!0,number:e}],at:"phones"}:{tag:"Change",value:{default:!0,number:e},at:["phones",t]})}}},n.renderPhoneAdornment=function(){var e=n.props,r=e.ctx,o=e.currentCall,a=e.model,s=t.form.get(a),l=s.phones.find(function(e){return e.default})||s.phones[0],u=l?l.number:"";return i.createElement(b.default,{ctx:r,phone:u,currentCall:o})},n}return r(n,e),n.prototype.renderCallDriverButton=function(e){var n=this.props,r=n.dispatch,o=n.currentCall,a=n.model,s=t.form.get(a),u=s.phones.find(function(e){return e.default})||s.phones[0];if(!u||o&&o.phone===u.number)return i.createElement(l.Button,{color:"primary",key:"call",size:"small",disabled:!0},i.createElement(l.Icon,null,"phone"),"  ",e("Call"));var c=u.number;return o?i.createElement(i.Fragment,null,i.createElement(l.Button,{color:"primary",key:"transfer",size:"small",onClick:function(){return r({tag:"@Call/transfer",phone:c})}},i.createElement(l.Icon,null,"swap_horiz"),"  ",e("Transfer")),i.createElement(l.Button,{color:"primary",key:"flash",size:"small",onClick:function(){return r({tag:"@Call/flash",phone:c})}},i.createElement(l.Icon,null,"call"),"  ",e("Flash"))):i.createElement(l.Button,{color:"primary",key:"call",size:"small",onClick:function(){return r({tag:"@Call",phone:c})}},i.createElement(l.Icon,null,"phone"),"  ",e("Call"))},n.prototype.render=function(){var e=this.props,n=e.__,r=e.ctx,a=e.model,s=e.classes,u=e.dispatch,c=this.zoom,p=t.form.get(a),f=this.renderCallDriverButton(n);return i.createElement("div",{className:s.root},i.createElement("div",{className:s.buttons},f,p.order&&i.createElement(l.Button,{color:"primary",key:"order",size:"small",onClick:this.handleOpenOrder},i.createElement(l.Icon,null,"arrow_forward"),"  ",n("Open order"))),p.order&&i.createElement("div",{className:s.order},n("Driver is on an order")),i.createElement("div",null,i.createElement(_.Label,null,n("Full name")),i.createElement(_.TextField,o({},c("name"),{fullWidth:!0}))),""===p.id&&i.createElement("div",null,i.createElement(_.Label,null,n("Password")),i.createElement(_.TextField,o({},c("password"),{fullWidth:!0}))),i.createElement("div",null,i.createElement(_.Label,null,n("Phone number")),i.createElement(_.TextField,o({},this.zoomDefaultPhone(),{fullWidth:!0,endAdornment:this.renderPhoneAdornment()}))),i.createElement("div",null,i.createElement(_.Label,null,n("Cab group")),i.createElement(_.AutoComplete,o({},c("crew_group"),{source:d.resource,printItem:function(e){return e?e.name:""},textFieldProps:{fullWidth:!0}}))),i.createElement("div",null,i.createElement(_.Label,null,n("Comment")),i.createElement(_.TextField,o({},c("comment"),{fullWidth:!0}))),i.createElement(g.default,o({},c("available_cars"),{className:s.cars,ctx:r,mainID:p.car?p.car.id:void 0,onMainIDChange:function(e){return u({tag:"Cars/setMain",id:e})},onCarClick:function(e){var t=e.id;return u({tag:"@Car/openInModal",id:t})}})))},n}(h.PureComponent);function A(e){var t=e.spacing.unit;return{root:{padding:[0,2*t,2*t,2*t],"& [role=zoom]":{marginBottom:2*t}},group:{"&+&":{marginTop:2*t}},submit:{display:"none"},buttons:{display:"flex",padding:[t,0],marginLeft:-t,marginBottom:t},order:{padding:[0,2*t],margin:[t,0],fontSize:14,fontWeight:600,color:u.fade(f.red[500],.57),marginRight:t,textAlign:"center"},cars:{marginLeft:2*-t,marginTop:2*t,width:"calc(100% + "+4*t+"px)"}}}t.View=m.default(A)(C.withGettext(S)(O)),t.form=w.default({validate:function(e){var t=S.__,n={};return e.name||(n.name=t("Cannot be empty")),e.crew_group||(n.crew_group=t("Cannot be empty")),e.available_cars.length||(n.available_cars=t("Cannot be empty")),n},disabled:function(e,t){return!t.props.ctx.profile.access_rights.drivers_edit}}),t.styles=A},,function(e,t,n){e.exports=n.p+"c94cf19bf5cfcaac0fc456cf77c499ba.svg"},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1163))},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1181))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(106),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handler=function(e){t.props.handler(e)},t}return r(t,e),t.prototype.componentDidMount=function(){this.listen(this.props)},t.prototype.componentWillReceiveProps=function(e){this.props.to!==e.to&&(this.unlisten&&this.unlisten(),this.listen(e))},t.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},t.prototype.listen=function(e){var t=this,n=e.to,r=e.event;if(i.isObservable(n)){var o=n.subscribe(this.handler);this.unlisten=function(){return o.unsubscribe()}}else{if(!r)throw new Error("Sub: unspecified `event`");n.addEventListener(r,this.handler),this.unlisten=function(){return n.removeEventListener(r,t.handler)}}},t.prototype.render=function(){return null},t}(o.Component);t.default=a},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeLocale=function(e){return e.replace(/(.+)_/g,"$1-")},t.lookupLocale=function(e,t){if(-1!==t.findIndex(function(t){return t===e}))return e;var n=e.split("-"),r=t.find(function(e){return e.startsWith(n[0])});return void 0!==r?r:void 0}},function(e,t){var n=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.map=function(e){switch(this.tag){case"Left":return this;case"Right":return new i(e(this.value))}},e.prototype.mapTo=function(e){switch(this.tag){case"Left":return this;case"Right":return new i(e)}},e.prototype.mapLeft=function(e){switch(this.tag){case"Left":return new o(e(this.value));case"Right":return this}},e.prototype.mapLeftTo=function(e){switch(this.tag){case"Left":return new o(e);case"Right":return this}},e.prototype.bimap=function(e,t){switch(this.tag){case"Left":return new o(e(this.value));case"Right":return new i(t(this.value))}},e.prototype.chain=function(e){switch(this.tag){case"Left":return this;case"Right":return e(this.value)}},e.prototype.chainTo=function(e){switch(this.tag){case"Left":return this;case"Right":return e}},e.prototype.fold=function(e,t){switch(this.tag){case"Left":return e(this.value);case"Right":return t(this.value)}},e.prototype.onError=function(e){switch(this.tag){case"Left":return e(this.value);case"Right":return this}},e.prototype.onErrorTo=function(e){switch(this.tag){case"Left":return e;case"Right":return this}},e.prototype.toNullable=function(){switch(this.tag){case"Left":return null;case"Right":return this.value}},e.prototype.isRight=function(){return"Right"===this.tag},e.prototype.isLeft=function(){return"Left"===this.tag},e}();t.EitherBase=r;var o=function(e){function t(t){var n=e.call(this)||this;return n.value=t,n.tag="Left",n}return n(t,e),t}(r);t.Left=o;var i=function(e){function t(t){var n=e.call(this)||this;return n.value=t,n.tag="Right",n}return n(t,e),t}(r);function a(e){return new o(e)}function s(e){return new i(e)}function l(e){return new o(e)}function u(e){return new i(e)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e[e.length-1],r=[],o=0;o<e.length-1;o++){var a=e[o];switch(a.tag){case"Left":return a;case"Right":r.push(a.value)}}return new i(n.apply(void 0,r))}function d(e,t){for(var n=[],r=0;r<e.length;r++){var o=t?t(e[r],r):e[r];switch(o.tag){case"Left":return o;case"Right":n.push(o.value)}}return new i(n)}t.Right=i,t.failure=a,t.success=s,t.left=l,t.right=function(e){return new i(e)},t.of=u,t.ap=c,t.traverse=d,t.Either={Left:o,Right:i,failure:a,success:s,left:l,of:u,ap:c,traverse:d}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r={"./af":441,"./af.js":441,"./ar":442,"./ar-dz":443,"./ar-dz.js":443,"./ar-kw":444,"./ar-kw.js":444,"./ar-ly":445,"./ar-ly.js":445,"./ar-ma":446,"./ar-ma.js":446,"./ar-sa":447,"./ar-sa.js":447,"./ar-tn":448,"./ar-tn.js":448,"./ar.js":442,"./az":449,"./az.js":449,"./be":450,"./be.js":450,"./bg":451,"./bg.js":451,"./bm":452,"./bm.js":452,"./bn":453,"./bn.js":453,"./bo":454,"./bo.js":454,"./br":455,"./br.js":455,"./bs":456,"./bs.js":456,"./ca":457,"./ca.js":457,"./cs":458,"./cs.js":458,"./cv":459,"./cv.js":459,"./cy":460,"./cy.js":460,"./da":461,"./da.js":461,"./de":462,"./de-at":463,"./de-at.js":463,"./de-ch":464,"./de-ch.js":464,"./de.js":462,"./dv":465,"./dv.js":465,"./el":466,"./el.js":466,"./en-au":467,"./en-au.js":467,"./en-ca":468,"./en-ca.js":468,"./en-gb":469,"./en-gb.js":469,"./en-ie":470,"./en-ie.js":470,"./en-il":471,"./en-il.js":471,"./en-nz":472,"./en-nz.js":472,"./eo":473,"./eo.js":473,"./es":474,"./es-do":475,"./es-do.js":475,"./es-us":476,"./es-us.js":476,"./es.js":474,"./et":477,"./et.js":477,"./eu":478,"./eu.js":478,"./fa":479,"./fa.js":479,"./fi":480,"./fi.js":480,"./fo":481,"./fo.js":481,"./fr":482,"./fr-ca":483,"./fr-ca.js":483,"./fr-ch":484,"./fr-ch.js":484,"./fr.js":482,"./fy":485,"./fy.js":485,"./gd":486,"./gd.js":486,"./gl":487,"./gl.js":487,"./gom-latn":488,"./gom-latn.js":488,"./gu":489,"./gu.js":489,"./he":490,"./he.js":490,"./hi":491,"./hi.js":491,"./hr":492,"./hr.js":492,"./hu":493,"./hu.js":493,"./hy-am":494,"./hy-am.js":494,"./id":495,"./id.js":495,"./is":496,"./is.js":496,"./it":497,"./it.js":497,"./ja":498,"./ja.js":498,"./jv":499,"./jv.js":499,"./ka":500,"./ka.js":500,"./kk":501,"./kk.js":501,"./km":502,"./km.js":502,"./kn":503,"./kn.js":503,"./ko":504,"./ko.js":504,"./ky":505,"./ky.js":505,"./lb":506,"./lb.js":506,"./lo":507,"./lo.js":507,"./lt":508,"./lt.js":508,"./lv":509,"./lv.js":509,"./me":510,"./me.js":510,"./mi":511,"./mi.js":511,"./mk":512,"./mk.js":512,"./ml":513,"./ml.js":513,"./mn":514,"./mn.js":514,"./mr":515,"./mr.js":515,"./ms":516,"./ms-my":517,"./ms-my.js":517,"./ms.js":516,"./mt":518,"./mt.js":518,"./my":519,"./my.js":519,"./nb":520,"./nb.js":520,"./ne":521,"./ne.js":521,"./nl":522,"./nl-be":523,"./nl-be.js":523,"./nl.js":522,"./nn":524,"./nn.js":524,"./pa-in":525,"./pa-in.js":525,"./pl":526,"./pl.js":526,"./pt":527,"./pt-br":528,"./pt-br.js":528,"./pt.js":527,"./ro":529,"./ro.js":529,"./ru":364,"./ru.js":364,"./sd":530,"./sd.js":530,"./se":531,"./se.js":531,"./si":532,"./si.js":532,"./sk":533,"./sk.js":533,"./sl":534,"./sl.js":534,"./sq":535,"./sq.js":535,"./sr":536,"./sr-cyrl":537,"./sr-cyrl.js":537,"./sr.js":536,"./ss":538,"./ss.js":538,"./sv":539,"./sv.js":539,"./sw":540,"./sw.js":540,"./ta":541,"./ta.js":541,"./te":542,"./te.js":542,"./tet":543,"./tet.js":543,"./tg":544,"./tg.js":544,"./th":545,"./th.js":545,"./tl-ph":546,"./tl-ph.js":546,"./tlh":547,"./tlh.js":547,"./tr":548,"./tr.js":548,"./tzl":549,"./tzl.js":549,"./tzm":550,"./tzm-latn":551,"./tzm-latn.js":551,"./tzm.js":550,"./ug-cn":552,"./ug-cn.js":552,"./uk":553,"./uk.js":553,"./ur":554,"./ur.js":554,"./uz":555,"./uz-latn":556,"./uz-latn.js":556,"./uz.js":555,"./vi":557,"./vi.js":557,"./x-pseudo":558,"./x-pseudo.js":558,"./yo":559,"./yo.js":559,"./zh-cn":560,"./zh-cn.js":560,"./zh-hk":561,"./zh-hk.js":561,"./zh-tw":562,"./zh-tw.js":562};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=798},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.shouldComponentUpdate=function(e,t){var n=this.props,r=this.state;return!i(n,e)||!i(r,t)},t}(n(1).Component);function i(e,t){if("object"!=typeof e||"object"!=typeof t||!e||!t)return e===t;for(var n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];if(!(o in t))return!1;if(("function"!=typeof e[o]||"function"!=typeof t[o])&&e[o]!==t[o])return!1}return!0}t.default=o},function(e,t,n){var r={"./de.po":801,"./lt.po":802,"./ru.po":803};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=800},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},"Incorrect login or password":["Falscher Benutzername oder falsches Passwort"],"Request timeout exceeded":["Timeout der Anforderung ist abgelaufen"],"Order created":["Die Bestellung ist erstellt"],"Order updated":["Die Bestellung ist aktualisiert"],"Sorry, an error occurred":["Entschuldigung, ein Fehler ist aufgetreten."],"Network error":["Fehler im Netz"],"Server sent an invalid response":["Der Server hat ungültige Daten zurückgegeben"],"Invalid authentication token":["Ungültiges Autorisierungstoken"],"Method not found":["Methode ist nicht gefunden"],"Internal TMServer error":["Interner TM-Serverfehler"],"Invalid request parameters":["Ungültige Anfrageparameter"],"Access to required team lead is denied":["Zugriff zum eingegebenen Teammeister ist verweigert "],"Specified team lead not found":["Der eingegebene Teammeister ist nicht gefunden"],"Access to required driver is denied":["Zugriff zum eingegebenen Fahrer ist verweigert "],"Specified driver not found":["Der eingegebene Fahrer ist nicht gefunden"],"Access to required car is denied":["Zugriff zum eingegebenen Auto ist verweigert"],"Access to required cab group is denied":["Zugriff zur eingegebenen Gruppe der Besatzung ist verweigert  "],"Car not found":["Das Auto ist nicht gefunden"],"Access to required booking is denied":["Zugriff zur eingegebenen Bestellung ist verweigert"],"Required booking not found":["Die eingegebene Bestellung ist nicht gefunden "],"Required cab group not found":["Die eingegebene Gruppe der Besatzung ist nicht gefunden "],"Required car attribute not found":["Das angegebene Attribut des Autos ist nicht gefunden"],"Access to required car attribute is denied":["Zugriff zum eingegebenen Attribut des Autos ist verweigert"],"You are trying to edit a driver that is online at the moment":["Sie können den Fahrer in der Linie nicht editieren"],"A car for new cab should be specified":["Sie müssen das Auto für die neue Besatzung eingeben"],"A cab group for new cab should be specified":["Sie müssen eine Gruppe für die neue Besatzung eingeben"],"You are trying to delete a driver that is online at the moment":["Sie können den Fahrer in der Linie nicht löschen"],"You are trying to edit a car that is online at the moment":["Sie können das Auto in der Linie nicht editieren"],"You are trying to delete a cat that is online at the moment":["Sie können das Auto in der Linie nicht löschen"],"Specified driver has no cab":["Der eingegebene Fahrer hat keine Besatzung"],"Specified driver is not available":["Der eingegebene Fahrer ist nicht verfügbar"],"Specified driver is on a break":["Der eingegebene Fahrer ist in der Pause"],"Specified driver is performing a booking":["Der eingegebene Fahrer ist auf Bestellung"],"Driver is locked":["Der Fahrer ist blockiert"],"Insufficient funds":["Unzureichende Mittel"],"Unknown error":["Unbekannter Fehler"],"Driver's status changed":["Status des Fahrers ist geändert"],"Order's status changed":["Status der Bestellung ist geändert"],"No driver on order":["Es gibt keinen Fahrer auf der Bestellung."],"Driver and Crew Group mismatched":["Der Fahrer gehört zu einer anderen Gruppe der Besatzungen"],"Complete the form in order to answer the phone call":["Speichern Sie das Formular zum Beantworten eines Anrufs"],"Cannot initialize google maps":["Fehler beim Initialisieren von Google Maps"],"Oktell error: %s":["Fehler oktell: %s"],"Can't access media device":["Fehler beim Zugriff zum Mikrofon"],"Oktell is switched off":["Oktell ist deaktiviert"],"All licenses are busy":["Alle Lizenzen sind besetzt"],"Driver has no required attribute":["Der Fahrer enspricht nicht den angegebenen Attributen"],"Invalid phone number %s":["Falsche Nummer %s"],"Invalid cost components":["Falsche Werte der Komponenten der Summe"],"License inactive":["Lizenz fehlt"],"Item updated":["Objekt ist geändert"],"Item created":["Objekt ist erstellt"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},"Incorrect login or password":["Neteisingas vardas ar slaptažodis"],"Request timeout exceeded":["Baigėsi užklausos laikas"],"Order created":["Užsakymas sukurtas"],"Order updated":["Užsakymas atnaujintas"],"Sorry, an error occurred":["Apgailestau, įvyko klaida"],"Network error":["Tinklo klaida"],"Server sent an invalid response":["Serveris grąžino neteisingus duomenis"],"Invalid authentication token":["Neteisingas autentifikavimo žetonas"],"Method not found":["Metodas nerastas"],"Internal TMServer error":["Vidinė TM serverio klaida"],"Invalid request parameters":["Neteisingi užklausos parametrai"],"Access to required team lead is denied":["Prieiga prie paskirto meistro draudžiama"],"Specified team lead not found":["Nurodytas meistras nerastas"],"Access to required driver is denied":["Prieiga prie nurodyto vairuotojo yra uždrausta"],"Specified driver not found":["Nurodytas vairuotojas nerastas"],"Access to required car is denied":["Prieiga prie nurodyto automobilio draudžiama"],"Access to required cab group is denied":["Prieiga prie nurodytos ekipažo grupės draudžiama"],"Car not found":["Automobilis nerastas"],"Access to required booking is denied":["Prieiga prie nurodyto užsakymo yra draudžiama"],"Required booking not found":["Nurodytas užsakymas nerastas"],"Required cab group not found":["Nurodyta ekipažo grupė nerasta"],"Required car attribute not found":["Nurodytas automobilio atributas nerastas"],"Access to required car attribute is denied":["Draudžiama prieiga prie nurodyto užsakymo"],"You are trying to edit a driver that is online at the moment":["Jūs bandote redaguoti vairuotoją, kuris dabar yra eilėje"],"A car for new cab should be specified":["Turite nurodyti automobili naujam ekipažui"],"A cab group for new cab should be specified":["Turite nurodyti ekipao grupe naujam ekipažui"],"You are trying to delete a driver that is online at the moment":["Bandote pašalinti vairuotoją, kuris dabar yra eilėje"],"You are trying to edit a car that is online at the moment":["Jūs bandote redaguoti automobilį kuris dabar eilėje"],"You are trying to delete a cat that is online at the moment":["Jūs bandote pašalinti automobilį kuris dabar eilėje"],"Specified driver has no cab":["Nurodytas vairuotojas neturi ekipažo"],"Specified driver is not available":["Nurodytas vairuotojas nepasiekiamas"],"Specified driver is on a break":["Nurodytas vairuotojas pertraukoje"],"Specified driver is performing a booking":["Nurodytas vairuotojas ekipaže"],"Driver is locked":["Vairuotojas yra užblokuotas"],"Insufficient funds":["Nepakanka lėšų"],"Unknown error":["Nežinoma klaida"],"Driver's status changed":["Vairuotojo būsena pasikeitė"],"Order's status changed":["Užsakymo būsena pasikeitė"],"No driver on order":["Užsakyme nėra vairuotojo"],"Driver and Crew Group mismatched":["Vairuotojas priklauso kitai ekipažo grupei"],"Complete the form in order to answer the phone call":["Išsaugokite formą atsakydami į skambutį"],"Cannot initialize google maps":['Klaida inicijuojant "Google" žemėlapius'],"Oktell error: %s":["Oktell klaida: %s"],"Can't access media device":["Klaida gaunant prieigą prie mikrofono"],"Oktell is switched off":["Oktell išjungtas"],"All licenses are busy":["Visos licencijos yra užimtos"],"Driver has no required attribute":["Vairuotojas neatitinka nurodytų atributų"],"Invalid phone number %s":["Neteisingas numeris %s"],"Item updated":["Prekė atnaujinta"],"Item created":["Prekė sukurta"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},"Incorrect login or password":["Неверный логин или пароль"],"Request timeout exceeded":["Истек таймаут запроса"],"Order created":["Заказ создан"],"Order updated":["Заказ обновлен"],"Sorry, an error occurred":["Извините, произошла ошибка"],"Network error":["Ошибка в сети"],"Server sent an invalid response":["Сервер вернул неверные данные"],"Invalid authentication token":["Невалидный токен аутентификации"],"Method not found":["Метод не найден"],"Internal TMServer error":["Внутренняя ошибка ТМ-сервера"],"Invalid request parameters":["Неверные параметры запроса"],"Access to required team lead is denied":["Запрещен доступ к указанному бригадиру"],"Specified team lead not found":["Указанный бригадир не найден"],"Access to required driver is denied":["Запрещен доступ к указанному водителю"],"Specified driver not found":["Указанный водитель не найден"],"Access to required car is denied":["Запрещен доступ к указанному автомобилю"],"Access to required cab group is denied":["Запрещен доступ к указанной группе экипажа"],"Car not found":["Не найден автомобиль"],"Access to required booking is denied":["Запрещен доступ к указанному заказу"],"Required booking not found":["Указанный заказ не найден"],"Required cab group not found":["Указанная группа экипажа не найдена"],"Required car attribute not found":["Указанный аттрибут автомобиля не найден"],"Access to required car attribute is denied":["Запрещен доступ к указанному заказу"],"You are trying to edit a driver that is online at the moment":["Вы пытаетесь редактировать водителя, который сейчас на линии"],"A car for new cab should be specified":["Вы должны указать машину для нового экипажа"],"A cab group for new cab should be specified":["Вы должны указать группу экипажа для нового экипажа"],"You are trying to delete a driver that is online at the moment":["Вы пытаетесь удалить водителя, который сейчас на линии"],"You are trying to edit a car that is online at the moment":["Вы пытаетесь редактировать автомобиль, который сейчас на линии"],"You are trying to delete a cat that is online at the moment":["Вы пытаетесь удалить автомобиль, который сейчас на линии"],"Specified driver has no cab":["Указанный водитель не имеет экипажа"],"Specified driver is not available":["Указанный водитель не доступен"],"Specified driver is on a break":["Указанный водитель на перерыве"],"Specified driver is performing a booking":["Указанный водитель на заказе"],"Driver is locked":["Водитель заблокирован"],"Insufficient funds":["Недостаточно средств"],"Unknown error":["Неизвестная ошибка"],"Driver's status changed":["Статус водителя изменен"],"Order's status changed":["Статус заказа изменен"],"No driver on order":["На заказе нет водителя"],"Driver and Crew Group mismatched":["Водитель принадлежит другой группе экипажей"],"Complete the form in order to answer the phone call":["Сохраните форму для ответа на звонок"],"Cannot initialize google maps":["Ошибка при инициализации google maps"],"Oktell error: %s":["Ошибка oktell: %s"],"Can't access media device":["Ошибка получения доступа к микрофону"],"Oktell is switched off":["Октелл отключен"],"All licenses are busy":["Все лицензии заняты"],"Driver has no required attribute":["Водитель не соответствует заданным атрибутам"],"Invalid phone number %s":["Неправильный номер %s"],"Invalid cost components":["Неправильные значения компонентов суммы"],"License inactive":["Отсутствует лицензия"],"Item updated":["Объект изменен"],"Item created":["Объект создан"]}}}},,,function(e,t,n){var r=n(142),o=n(433).default,i=n(279).default,a=o({primary:r.blue,secondary:r.amber}),s=i({palette:a});e.exports={palette:a,theme:s,default:s}},,,,,,,,,,,,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(44);function i(e){return r.decode.decoder(function(t){if("string"!=typeof t)return r.failure("commaSep: expecting a string, given "+typeof t);var n=t.split(",").map(function(e){return e.trim()}).filter(function(e){return""!==e}),o=[];for(var i in n){var a=e.validate(n[i]);if("Left"===a.tag)return a;o.push(a.value)}return r.success(o)})}t.settingsDecoder=r.decode.record({address_search_places:i(r.decode.string).withDefault(["tm"]),auto_answer_call:r.decode.boolean,auto_open_order_on_call:r.decode.boolean,currency:r.decode.string,extra_attributes:i(r.decode.string).withDefault([]),locale:r.decode.string,oktell_address:r.decode.string,taxi_title:r.decode.string,timezone:r.decode.string,utc_offset:r.decode.float}),t.get=function(e){return o.apiRequest(e,r.decode.at(["data","attributes"],t.settingsDecoder),{method:"GET",url:r.http.join(e.operatorApi,"/api/v1/settings")})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(50),o=n(36),i=n(44);t.defaultFeatures={orders_end_point:!1,hourly_orders:!1,order_logs:!1,advance_orders:!1,simle_report_filter_by_name:!1,discount_cards_and_referal_codes:!1};var a=o.decode.decoder(function(e){if("object"!=typeof e)return o.failure("featuresDecoder: not an object");var n=r.mapValues(t.defaultFeatures,function(t,n){return Boolean(e[n])});return o.success(n)}),s=o.decode.at(["data","attributes"],a);t.get=function(e){return i.apiRequest(e,s,{method:"GET",url:o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/features")}).onError(function(){return o.eff.of(t.defaultFeatures)})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(44),i=r.decode.record({order_edit_crew:r.decode.boolean.withDefault(!0),order_edit_cost:r.decode.boolean.withDefault(!0),cars_view:r.decode.boolean.withDefault(!0),cars_add:r.decode.boolean.withDefault(!0),cars_edit:r.decode.boolean.withDefault(!0),cars_delete:r.decode.boolean.withDefault(!0),drivers_view:r.decode.boolean.withDefault(!0),drivers_add:r.decode.boolean.withDefault(!0),drivers_edit:r.decode.boolean.withDefault(!0),drivers_delete:r.decode.boolean.withDefault(!0),orders_view:r.decode.boolean.withDefault(!0),orders_add:r.decode.boolean.withDefault(!0),orders_edit:r.decode.boolean.withDefault(!0),orders_delete:r.decode.boolean.withDefault(!0),set_driver_online:r.decode.boolean.withDefault(!0),set_driver_offline:r.decode.boolean.withDefault(!0),oper_cab_statistics:r.decode.boolean.withDefault(!0)});t.profileDecoder=r.decode.record({login:r.decode.string,name:r.decode.string,server_time:o.momentDecoder.withDefault(null),access_rights:i}),t.get=function(e){return o.apiRequest(e,r.decode.at(["data","attributes"],t.profileDecoder),{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/profile")})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(44);t.settingsDecoder=r.decode.record({make_advance_if_before_order_minutes:r.decode.float.withDefault(0),back_order_change_route:r.decode.boolean.withDefault(!0)});var i={make_advance_if_before_order_minutes:0,back_order_change_route:!0};t.get=function(e){return o.apiRequest(e,r.decode.at(["data","attributes"],t.settingsDecoder),{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/settings")}).onError(function(){return r.eff.of(i)})}},,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.audioEl=null,t}return r(t,e),t.prototype.componentDidMount=function(){!0===this.props.play&&this.audioEl&&this.audioEl.play()},t.prototype.componentWillReceiveProps=function(e){!1===this.props.play&&!0===e.play&&this.audioEl&&this.audioEl.play(),!0===this.props.play&&!1===e.play&&this.audioEl&&this.audioEl.pause()},t.prototype.componentWillUnmount=function(){!0===this.props.play&&this.audioEl&&this.audioEl.pause()},t.prototype.render=function(){var e=this,t=this.props.url;return o.createElement("audio",{ref:function(t){return e.audioEl=t},src:t,autoPlay:!1,loop:!0})},t}(o.Component);t.default=i},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.internalState=null,t.start=function(){null===t.internalState&&(t.internalState={idx:0,titles:["************",document.title],timerId:setInterval(t.loop,1e3)})},t.stop=function(){null!==t.internalState&&(clearInterval(t.internalState.timerId),document.title=t.internalState.titles[1],t.internalState=null)},t.loop=function(){null!==t.internalState&&(document.title=t.internalState.titles[t.internalState.idx++%t.internalState.titles.length])},t}return r(t,e),t.prototype.componentDidMount=function(){this.props.play&&this.start()},t.prototype.componentWillReceiveProps=function(e){this.props.play&&!e.play&&this.stop(),!this.props.play&&e.play&&this.start()},t.prototype.componentsWillUnmount=function(){this.props.play&&this.stop()},t.prototype.render=function(){return null},t}(n(1).Component);t.default=o},function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(36);n(568),t.oktellConnect=function(e){return o.eff.fromCallback(function(t){oktell.connect(r({},e,{callback:function(e){!0===e.result?t(o.success(null)):t(o.failure({tag:"OktellError",message:e.serverErrorMessage||e.errorMessage}))}}))})},t.oktellDisconnect=o.eff.fromCallback(function(e){oktell.on("disconnect",function t(){e(o.success(null));oktell.off("disconnect",t)}),oktell.disconnect()}),t.oktellAnswer=function(e){return o.eff.fromCallback(function(t){oktell.answer(e,function(e){!0===e.result?t(o.success(null)):t(o.failure({tag:"OktellError",message:e.errorMessage}))})})},t.oktellEndCall=function(e){return o.eff.lazy(function(){return oktell.endCall(e),o.success(null)})},t.oktellDtmf=function(e){return o.eff.lazy(function(){return e.split("").forEach(function(e){return oktell.dtmf(e)}),o.success(null)})},t.oktellCall=function(e){return o.eff.fromCallback(function(t){oktell.call(e,function(e){!0===e.result?t(o.success(null)):t(o.failure({tag:"OktellError",message:e.errorMessage}))})})},t.oktellTransfer=function(e){return o.eff.fromCallback(function(t){oktell.transfer(e,function(e){!0===e.result?t(o.success(null)):t(o.failure({tag:"OktellError",message:e.errorMessage}))})})},t.oktellFlash=function(e){return o.eff.lazy(function(){return("*"+e).split("").map(function(e){return oktell.dtmf(e)}),o.success(null)})},t.oktellHold=o.eff.lazy(function(){return oktell.hold(),o.success(null)}),t.oktellResume=o.eff.lazy(function(){return oktell.resume(),o.success(null)})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(50),a=n(48),s=n(11),l=n(8),u=n(247),c=n(206),d=n(27),p=n(351),f=n(245),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={menuAnchor:null,showConfigHelp:!1},t.handleClick=function(e){var n=t.state.menuAnchor?null:e.currentTarget;t.setState({menuAnchor:n})},t.handleClose=function(){t.setState({menuAnchor:null})},t.handleLogout=function(){u.logoutStream.next()},t.handleSettings=function(){c.dispatchExternal({tag:"@Settings/open"}).subscribe()},t.handleToggleHelp=function(){t.setState({showConfigHelp:!t.state.showConfigHelp})},t.infoContent=function(e,t){var n=Object.keys(t).map(function(e){var n="boolean"===t[e].type?"true|false":t[e].type;return o.createElement(a.TableRow,null,o.createElement(a.TableCell,null,"?"+i.kebabCase(e)+"=<"+n+">"),o.createElement(a.TableCell,null,"default"in t[e]?JSON.stringify(t[e].default):"—"),o.createElement(a.TableCell,null,t[e].description))});return o.createElement(a.Table,null,o.createElement(a.TableHead,null,o.createElement(a.TableRow,null,o.createElement(a.TableCell,null,e("Name")),o.createElement(a.TableCell,null,e("Default value")),o.createElement(a.TableCell,null,e("Description")))),o.createElement(a.TableBody,null,n))}(t.props.__,p.configInfo(f.configDecoder)),t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.className,i=e.classes,l=this.state,u=l.menuAnchor,c=l.showConfigHelp,d=s(i.root,r);return o.createElement(o.Fragment,null,o.createElement("div",{className:d,onClick:this.handleClick},o.createElement(a.Avatar,{className:i.avatar},n.settings.taxi_title[0].toUpperCase()||"?"),o.createElement("div",{className:i.taxiTitle},o.createElement("div",null,n.settings.taxi_title),o.createElement("div",null,n.profile.login)),o.createElement("i",{className:"material-icons"},"arrow_drop_down"),o.createElement(a.Menu,{open:null!==u,onClose:this.handleClose,anchorEl:this.state.menuAnchor||void 0},o.createElement(a.MenuItem,{onClick:this.handleSettings,className:i.item},o.createElement(a.ListItemIcon,{className:i.icon},o.createElement(a.Icon,null,"settings")),o.createElement(a.ListItemText,null,t("Settings"))),o.createElement(a.MenuItem,{onClick:this.handleLogout,className:i.item},o.createElement(a.ListItemIcon,{className:i.icon},o.createElement(a.Icon,null,"exit_to_app")),o.createElement(a.ListItemText,null,t("Logout"))),f.__INFO__.debugInfo&&o.createElement(a.MenuItem,{onClick:this.handleToggleHelp,className:i.item},o.createElement(a.ListItemIcon,{className:i.icon},o.createElement(a.Icon,null,"info")),o.createElement(a.ListItemText,null,t("GET parameters reference"))))),o.createElement(a.Dialog,{onClose:this.handleToggleHelp,open:c,fullWidth:!0,maxWidth:"xl"},o.createElement(a.DialogTitle,null,t("GET parameters reference")),this.infoContent,o.createElement(a.DialogActions,null,o.createElement(a.Button,{onClick:this.handleToggleHelp},"Ok"))))},t}(o.Component);function m(e){return{root:{display:"flex",alignItems:"center","& > * + *":{marginLeft:2*e.spacing.unit},cursor:"pointer"},taxiTitle:{textShadow:"-1px 1px 8px #ffc, 1px -1px 8px #fff","& > *:first-child + *":{color:e.palette.text.secondary}},avatar:{},item:{height:"auto !important"}}}t.default=l.default(m)(d.withGettext(n(186))(h)),t.styles=m},function(e,t,n){var r={"./de.po":968,"./lt.po":969,"./ru.po":970};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=967},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Logout:["Abmelden"],"hh:mm A":["HH:mm"],"local server time":["lokale Serverzeit"],"%s — [Operator Workstation]":["%s — [Kabinett des Operators]"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Logout:["Atsijungti"],"hh:mm A":["HH:mm"],"local server time":["vietos laikas TM"],"%s — [Operator Workstation]":["%s — [Operatoriaus kabinetas]"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},"GET parameters reference":["Справка по GET параметрам"],"Default value":["По умолчанию"],Description:["Описание"],Name:["Название"],Logout:["Выйти"],Settings:["Настройки"],"hh:mm A":["HH:mm"],"local server time":["местное время TM"],"%s — [Operator Workstation]":["%s — [Кабинет Оператора]"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(99),s=n(36),l=n(48),u=n(160),c=n(165),d=n(44),p=n(8),f=n(11),h=n(972),m=n(1089),g=n(1097),v=n(1100),y=n(1104),_=n(27);t.translations=_.Translations.fromPO(n(686));var b=[{tag:"Orders",title:t.translations.__("Orders"),icon:"list"},{tag:"Drivers",title:t.translations.__("Drivers"),icon:"people"},{tag:"Cars",title:t.translations.__("Cars"),icon:"local_taxi"},{tag:"Dashboard",title:t.translations.__("Dashboard"),icon:"dashboard"}];t.getMenuItems=d.memoize(function(e){return b.filter(function(t){return!!e.screwAccessRights||!("Orders"===t.tag&&!e.profile.access_rights.orders_view)&&(!("Drivers"===t.tag&&!e.profile.access_rights.drivers_view)&&(!("Cars"===t.tag&&!e.profile.access_rights.cars_view)&&!("Dashboard"===t.tag&&!e.profile.access_rights.oper_cab_statistics)))})}),t.initFlags=function(e){var n=t.getMenuItems(e)[0];return n?{tag:n.tag,flags:t.tabToComponent[n.tag].initFlags(e)}:{tag:"NoAccess",flags:null}},t.tabToComponent={Orders:h,Drivers:m,Cars:g,Dashboard:v,NoAccess:y},t.init=function(e,n,r){return t.tabToComponent[n.tag].init(e,n.flags,r&&r.flags.tag===n.tag?r.nested:void 0).mapEff(function(e){return{flags:n,pending:!1,nested:e}})},t.update=function(e,n,r){switch(n.tag){case"Pending":return[o({},r,{pending:n.pending}),s.noop];case"Error":return[r,a.notifyError(n.error)];case"Update":var i=n.flags||r.flags,l=t.tabToComponent[i.tag],u=i.tag===r.flags.tag?r.nested:void 0;return[r,d.pending(l.init(e,i.flags,u).perform(function(e){return{tag:"Error",error:e}},function(e){return{tag:"Update/success",flags:i,state:e}}))];case"Update/success":return[o({},r,{flags:n.flags,nested:n.state}),s.noop];case"Nested":if(n.key!==r.flags.tag)return[r,s.noop];var c=(l=t.tabToComponent[n.key]).update(e,n.action,r.nested),p=c[0],f=c[1];return[o({},r,{nested:p}),f.mapCmd(C(n.key))]}};var C=function(e){return function(t){return{tag:"Nested",action:t,key:e}}},w=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.handleTabChange=function(e,r){var o=n.props,i=o.ctx;(0,o.dispatch)({tag:"Update",flags:{tag:r,flags:t.tabToComponent[r].initFlags(i)}})},n.renderTabs=d.memoize(function(e,n){return t.getMenuItems(e).map(function(t){return i.createElement(l.Tab,{key:t.tag,className:n.tab,label:t.title(e),value:t.tag,icon:i.createElement(u.default,null,t.icon)})})}),n}return r(n,e),n.prototype.renderContent=function(e){var t=e.ctx,n=e.model,r=n.nested,o=n.flags,a=e.dispatch,s=e.derivedData;switch(o.tag){case"NoAccess":return i.createElement(y.View,{ctx:t});case"Orders":return i.createElement(h.View,{ctx:t,model:r,dispatch:function(e){return a(C("Orders")(e))},onFlagsChange:function(e){return a({tag:"Update",flags:{tag:"Orders",flags:e}})},onItemClick:function(e){return a({tag:"@Order/open",id:e.id})},onAdd:function(){return a({tag:"@Order/add"})},onRequestUpdate:function(){return a({tag:"Update",flags:o})},selected:s.selectedOrder});case"Drivers":return i.createElement(m.View,{ctx:t,model:r,dispatch:function(e){return a(C("Drivers")(e))},onFlagsChange:function(e){return a({tag:"Update",flags:{tag:"Drivers",flags:e}})},onItemClick:function(e){return a({tag:"@Driver/open",id:e.id})},onRequestUpdate:function(){return a({tag:"Update",flags:o})},selected:s.selectedDriver});case"Cars":return i.createElement(g.View,{ctx:t,model:r,dispatch:function(e){return a(C("Cars")(e))},onItemClick:function(e){return a({tag:"@Car/open",id:e.id})},onFlagsChange:function(e){return a({tag:"Update",flags:{tag:"Cars",flags:e}})},selected:s.selectedCar});case"Dashboard":return i.createElement(v.View,{ctx:t,model:r,dispatch:function(e){return a(C("Dashboard")(e))}})}},n.prototype.render=function(){var e,t=this.props,n=t.ctx,r=t.classes,o=t.className,a=t.model,s=this.renderTabs(n,r),u=f(o,r.root,((e={})[r.centerShortList]=s.length<=3,e));return i.createElement("div",{className:u},i.createElement(l.Tabs,{value:a.flags.tag,onChange:this.handleTabChange,indicatorColor:"primary",textColor:"primary",className:r.tabs,scrollable:!0},s),this.renderContent(this.props),i.createElement(c.default,{pending:a.pending}))},n}(d.PureComponent);function E(e){var t=e.spacing.unit;return{root:{display:"flex",flexDirection:"column",height:"100%",zIndex:e.zIndex.appBar,top:t,left:t},tabs:{flex:"0 0 auto",minHeight:0,borderBottom:"solid 1px "+e.palette.divider,"& > div > div ":{},"& button":{minHeight:0,paddingTop:t},"& > div > div > span":{}},centerShortList:{"& [role=tablist] > div":{justifyContent:"center"}},tab:{minWidth:5*t,"& > span > span:nth-child(2)":{fontSize:12,paddingLeft:12,paddingRight:12}}}}t.View=p.default(E)(w),t.styles=E},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(36),l=n(640),u=n(99),c=n(48),d=n(641),p=n(392),f=n(393),h=n(988),m=n(11),g=n(144),v=n(207),y=n(8),_=n(44),b=n(9),C=n(306),w=n(27);t.initFlags=function(e){return o({},g.defaultQuery,{status:"current",limit:e.pageLimit})},t.init=function(e,t,n){var r=n?s.eff.of(n.filterState):h.init(e),o=n?n.flags.status!==t.status?"performed"===t.status:n.filterVisible:"performed"===t.status;return s.eff.ap(g.collection.pageCollection(e,t),v.getCollection(e).mapEff(function(e){return e.filter(function(e){return!e.forbid_manual_set})}),r,function(e,n,r){var i=e[0],a=e[1];return{filterVisible:o,flags:t,orders:i,total:a,states:n,filterState:r}})},t.update=function(e,t,n){switch(t.tag){case"Update":return[n,g.collection.pageCollection(e,t.flags).perform(function(e){return{tag:"Error",error:e}},function(e){return{tag:"Update/success",orders:e[0],total:e[1],flags:t.flags}})];case"Update/success":var r=t.flags.status!==n.flags.status?"performed"===t.flags.status:n.filterVisible;return[o({},n,{orders:t.orders,total:t.total,flags:t.flags,filterVisible:r}),s.noop];case"Filter/visibility":return[o({},n,{filterVisible:t.visibility}),s.noop];case"Error":return[n,u.notifyError(t.error)]}};var E=l.default(function(e,t){if("performed"===t){var n=b().startOf("day"),r=n.clone().add(1,"day");return o({},g.defaultQuery,{since:n,till:r,status:t,limit:e.pageLimit})}return o({},g.defaultQuery,{status:t,limit:e.pageLimit})}),S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleStatusChange=function(e,n){var r=t.props,o=r.ctx,i=r.onFlagsChange;i&&i(E(o,n))},t.handleFilterChange=function(e){var n=t.props.onFlagsChange;n&&n(o({},e,{offset:0}))},t.handleFilterReset=function(){var e=t.props,n=e.ctx,r=e.onFlagsChange,o=e.model.flags,i=e.dispatch,a=E(n,o.status);i({tag:"Filter/visibility",visibility:!1}),r&&r(a)},t.handleUpdate=function(){var e=t.props,n=e.onFlagsChange,r=e.model.flags;n&&n(r)},t.handleOffsetChange=function(e){var n=t.props,r=n.model.flags,i=n.onFlagsChange;i&&i(o({},r,{offset:e}))},t.handleItemClick=a.memoize(function(e){return function(){var n=t.props.onItemClick;n&&n(e)}}),t.handleStateChange=a.memoize(function(e){return function(n){(0,t.props.dispatch)({tag:"@Order/changeStatus",id:e.id,state:n})}}),t}return r(t,e),t.prototype.isFilterEmpty=function(){for(var e=this.props,t=e.ctx,n=e.model.flags,r=E(t,n.status),o=0,i=a.without(Object.keys(r),"offset","limit","status");o<i.length;o++){var s=i[o];if(!a.isEqual(n[s],r[s]))return!1}return!0},t.prototype.renderList=function(){var e=this,t=this.props,n=t.ctx,r=t.model,o=t.selected,a=t.classes;return i.createElement("div",{className:a.listWrapper},r.orders.map(function(t){return i.createElement(d.default,{key:t.id,ctx:n,states:r.states,value:t,selected:o===t.id,showMenu:!0,onClick:e.handleItemClick(t),onStateChange:e.handleStateChange(t)})}))},t.prototype.renderLabel=function(e,t){switch(e){case"current":return t("Current");case"advance":return t("Preliminary");case"performed":return t("Completed")}},t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.dispatch,o=e.model,a=e.className,s=e.classes,l=e.onAdd,u=m(a,s.root),d=this.renderLabel(o.flags.status,t);return i.createElement("div",{className:u},i.createElement(C.Helmet,null,i.createElement("title",null,w.sprintf(t("%s — [Operator Workstation]"),d))),i.createElement("div",{className:s.tabsWrapper},i.createElement(c.Tabs,{value:o.flags.status,onChange:this.handleStatusChange,indicatorColor:"primary",textColor:"primary",fullWidth:!0},i.createElement(c.Tab,{className:s.tab,value:"current",label:t("Current")}),i.createElement(c.Tab,{value:"advance",className:s.tab,label:t("Preliminary")}),i.createElement(c.Tab,{value:"performed",className:s.tab,label:t("Completed")}))),i.createElement("div",{className:s.content},i.createElement(h.View,{ctx:n,state:o.filterState,value:o.flags,onChange:this.handleFilterChange,onReset:this.isFilterEmpty()?void 0:this.handleFilterReset,onVisibilityChange:function(e){return r({tag:"Filter/visibility",visibility:e})},open:o.filterVisible}),this.renderList(),i.createElement("div",{className:s.footer},i.createElement("div",{className:s.buttons},i.createElement(c.Button,{onClick:l,size:"small",color:"primary",disabled:!n.profile.access_rights.orders_add},t("Add")),("current"===o.flags.status||"advance"===o.flags.status)&&i.createElement(p.default,{ctx:n,duration:n.refreshInterval,action:this.handleUpdate,listRef:o.orders})),i.createElement(f.default,{ctx:n,className:s.pagination,offset:o.flags.offset,limit:o.flags.limit,total:o.total,onOffsetChange:this.handleOffsetChange,listenKeyboard:!0,reactHint:!0}))))},t}(_.PureComponent);function T(e){var t=e.spacing.unit;return{root:{minHeight:0,display:"flex",flexDirection:"column",height:"100%"},tabsWrapper:{flex:"0 0 auto",borderBottom:"solid 1px "+e.palette.divider,fontSize:14},tab:{minWidth:0,"& > span > span":{fontSize:12,paddingLeft:12,paddingRight:12}},content:{flex:"100 100 100%",display:"flex",minHeight:0,flexDirection:"column"},refreshButton:{padding:"0 "+t+"px",marginLeft:-t},buttons:{marginLeft:-t,display:"flex"},listWrapper:{flex:"100 100 100%",position:"relative",overflowY:"auto",minHeight:0,borderBottom:"solid 1px "+e.palette.divider},footer:{flex:"0 0 auto",display:"flex",padding:[t,2*t],background:e.palette.grey[200],boxSizing:"border-box",height:6*t,alignItems:"center",whiteSpace:"nowrap","& > *:first-child":{flexGrow:10},"& > *:first-child + *":{flexGrow:0,display:"flex",alignItems:"center","& > * + *":{marginLeft:2*t}}},pagination:{"& > *:first-child + *":{marginLeft:t,boxShadow:"none",border:"solid 1px "+e.palette.divider,"& > *":{width:4*t,height:4*t}}}}}t.View=y.default(T)(w.withGettext(n(186),n(81))(S)),t.styles=T},function(e,t,n){var r={"./de.po":974,"./lt.po":975,"./ru.po":976};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=973},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Free:["Frei"],Unavailable:["Nicht verfügbar"],"On a break":["In der Pause"],"Performing booking":["Auf Bestellung"],Orders:["Bestellungen"],"Current orders":["laufende Bestellungen"],"Preliminary orders":["Vorbestellungen"],"Completed orders":["Abgeschlossene Bestellungen"],Current:["Laufende"],Completed:["Abgeschlossene"],Preliminary:["Vorbestellungen"],"[Preliminary]":["(Vorbestellungen)"],Search:["Suche"],"Change status":["Status ändern"],"Order is locked for editing":["Diese Bestellung kann nicht editiert werden"],Refresh:["Aktualisieren"],"No results":["Keine Ergebnisse"],Add:["Hinzufügen"],"Order is being edited by another user":["Die Bestellung wird von einem anderen Benutzer editiert"],"Client phone":["Telefon des Kunden"],Driver:["Fahrer"],"Picked up time":["Zeitpunkt der Lieferung"],Today:["Heute"],Yesterday:["Gestern"],"Order #%s":["Bestellung #%s"],"Phone number":["Telefon"],Addresses:["Аdressen"],"Pick-up address":["Adresse der Lieferung"],"Intermediate address":["Stoppen"],"Drop-off address":["Einstellung"],"Select attributes":["Attribute hinzufügen"],Tariff:["Tarif"],"Events log":["Ereignisprotokoll"],Close:["Schließen"],"in cash":["in bar"],"non-cash":["bargeldlos"],"by bank card":["mit der Bankkarte"],"bonus points":["Bonus"],total:["insgesamt"],sum:["Summe"],maximum:["Maximum"],"No events":["Keine Ereignisse"],Reset:["Zurücksetzen"],Save:["Speichern"],Cost:["Kosten"],"No data":["keine Angaben"],Value:["Wert"],Subtotal:["Summe"],"No phone":["Kein Telefon"],"Cannot edit this order":["Diese Bestellung kann nicht editiert werden"],"New order":["Bestellung hinzufügen"],"Cab group":["Gruppe der Besatzung"],"Enter phone":["Geben Sie die Telefonnummer ein"],"Client name":["Name des Kunden"],"Client group":["Gruppe des Kunden"],"Bonus balance":["Bilanz von Bonuspunkten"],"Cashless balance":["Bilanz des bargeldlosen Kontos"],City:["Stadt"],Address:["Adresse"],"Add address":["Adresse hinzufügen"],"Select address":["Adresse wählen"],"Go back":["Zurück"],Latitude:["Breite"],Longitude:["Länge"],street:["Straße"],house:["Haus"],point:["место"],"Delivery date":["Datum der Lieferung"],"use maximum":["Maximum"],"Order updated":["Die Bestellung ist aktualisiert"],"Order created":["Die Bestellung ist erstellt"],"Status changed":["Status ist geändert"],Tomorrow:["Morgen"],"Day after tomorrow":["Übermorgen"],"After, min":["Nach, min"],now:["jetzt"],today:["Heute"],"%s min":["%s Min."],"HH:mm DD/MM/YYYY":["HH:mm DD.MM.YYYY"],"No city":["keine Stadt"],"Enter pick-up address":["Geben Sie die Adresse der Lieferung"],"Enter pick-up time":["Geben Sie den Zeitpunkt der Lieferung"],"No attributes":["Keine Attribute"],Call:["Anrufen"],Open:["Öffnen"],Transfer:["Überweisen"],Flash:["Flash"],"No primary car":["Kein Hauptauto"],"From coordinates":["Nach Koordinaten"],"Order copied":["Die Bestellung ist kopiert"],"Confirm the action":["Aktion bestätigen"],"New order will be created with the same fields except for the driver, which will be emptied. Continue?":["Eine neue Bestellung wird mit denselben Feldern erstellt, mit Ausnahme von Fahrer, der gelöscht wird. Weiter?"],Cancel:["Zurücksetzen"],Confirm:["Bestätigen"],Copy:[" Kopieren"],"HH:mm":["HH:mm"],"YYYY/MM/DD":["DD.MM.YYYY"],Unknown:["Unbekannt"],Comment:["Kommentar"],"Event log":["Ereignisprotokoll"],"Show coordinates":["Koordinaten anzeigen"],Clear:["Löschen"],"Clear ALT+-":["Löschen ALT+-"],Employee:["Mitarbeiter"],"Enter name":["Den Namen eingeben"],Client:["Kunde"],Password:["Passwort"],"Hourly order":["Stundenbestellung"],"Select coordinates":["Koordinaten wählen"],"Open calendar":["Kalender anzeigen"],Processing:["Bearbeitung"],"Message sent":["Die Nachricht ist gesendet"],"Message delivered":["Die Nachricht ist geliefert"],"Error occurred":["Ein Fehler ist aufgetreten."],"Message outdated":["Die Nachricht ist veraltet"],Success:["Erfolgreich"],"No answer":["Keine Antwort"],Answer:["Geantwortet"],Missed:["Verpasst"],Transferred:["Übertragen"],Brokeoff:["Unterbrochen"],"Another user answered":["Von einem anderen Benutzer beantwortet"],Outgoing:["Ausgehend"],Incoming:["Eingehend"],"Status change":["Status ist geändert"],State:["Stand"],"Driver call":["Rufzeichen des Fahrers"],SMS:["SMS"],Message:["Nachricht"],Status:["Status"],Direction:["Richtung"],Result:["Ergebnis"],"Accepted by driver":["Von dem Fahrer angenommen"],"arriving in %d minute":["Zufahrt zu dem Ort für  %d Minuten","Zufahrt zu dem Ort für %d Minuten","Zufahrt zu dem Ort für %d Minuten"],"Driver on spot":["Der Fahrer ist am Ort"],"Passenger mounted":["Der Kunde steigt in das Auto ein"],"Call to client":["Anruf an den Fahrgast"],"Sms sent to client":["SMS an den Fahrgast"],Any:["Jeglicher"],"Choose order states":["Stand der Bestellung wählen"],Period:["Zeitraum"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Orders:["Užsakymai"],"Current orders":["Текущие заказы"],"Preliminary orders":["Išankstiniai užsakymai"],"Completed orders":["Užbaigti užsakymai"],Current:["Dabartiniai"],Completed:["Užbaigti"],Preliminary:["Išankstiniai"],"[Preliminary]":["[Išankstiniai]"],Search:["Paieška"],"Change status":["Keisti būsena"],"Order is being edited by another user":["Užsakymą redaguoja kitas vartotojas"],Refresh:["Atnaujinti"],"No results":["Tuščia"],Add:["Pridėti"],"Order is locked for editing":["Užsakymas yra užrakintas redaguoti"],"Client phone":["Kliento telefonas"],Driver:["Vairuotojas"],"Picked up time":["Paraiškos pateikimo laikas"],"Order #%s":["Užsakymas #%s"],"Phone number":["Telefono numeris"],Addresses:["Adresas"],"Pick-up address":["Pateikimas"],"Intermediate address":["Sustojimas"],"Drop-off address":["Paskyrimas"],"Select attributes":["Atributai"],Tariff:["Tarifas"],"Events log":["Įvykių žurnalas"],Close:["Uždaryti"],"Accepted by driver":["Priimta vairuotojo"],"arriving in %d minute":["Privažiavimas prie vietos už %d minute","Privažiavimas prie vietos už %d minutės","Privažiavimas prie vietos už %d minučių"],"Driver on spot":["Vairuotojas vietoje"],"Passenger mounted":["Klientas sėda į mašiną"],"Call to client":["Skambutis keleiviui"],"Sms sent to client":["SMS keleiviui"],"in cash":["grynais"],"non-cash":["negrynaisiais"],"by bank card":["Banko kortele"],"bonus points":["Premija"],total:["iš viso"],sum:["suma"],maximum:["maksimumas"],"No events":["Nėra įvykių"],Reset:["Atstatyti"],Save:["Išsaugoti"],Cost:["Kaina"],"No data":["N/D"],Value:["Reikšmė"],Subtotal:["Suma"],"No phone":["Nėra telefono"],"Cannot edit this order":["Negalima redaguoti šio užsakymo"],"New order":["Pridėti užsakymą"],"Cab group":["Pasirinkite ekipažo grupę"],"Enter phone":["Įveskite telefoną"],"Client name":["Kliento vardas"],"Client group":["Kliento grupė"],"Bonus balance":["Premijų balansas"],"Cashless balance":["Negrynujų pinigų sąskaitos balansas"],City:["Miestas"],Address:["Adresas"],"Select address":["Pasirinkite adresą"],"Add address":["pridėti adresa"],"Go back":["Grįžti"],Latitude:["Plotis"],Longitude:["Ilgis"],street:["gatvė"],house:["namas"],point:["vieta"],"Delivery date":["Pateikimo data"],"use maximum":["maksimumas"],"Order updated":["Užsakymas atnaujintas"],"Order created":["Užsakymas sukurtas"],"Status changed":["Būsena pakeista"],Today:["Šiandien"],Tomorrow:["Rytoj"],"Day after tomorrow":["Poryt"],"After, min":["Po, min"],now:["dabar"],today:["šiandien"],"%s min":["%s min"],"No city":["Miesto nėra"],"Enter pick-up address":["Įrašykite pateikimo adresą"],"Enter pick-up time":["Įrašykite pateikimo laiką"],"No attributes":["Atributu nėra"],Call:["iškviesti"],Open:["Atidaryti"],Transfer:["Išversti"],Flash:["Flešas"],"No primary car":["Nėra pagrindinio automobilio"],"From coordinates":["Pagal koordinates"],"Order copied":["Užsakymas kopijuotas"],"Confirm the action":["Patvirtinkite veiksmą"],Copy:["Kopijuoti"],"New order will be created with the same fields except for the driver, which will be emptied. Continue?":["Naujas užsakymas bus sukurtas tais pačiais laukais, išskyrus tvarkyklę, kuri bus išvalyta. Ar norite tęsti?"],Cancel:["Atšaukti"],Confirm:["Patvirtinti"],"HH:mm":["HH:mm"],"YYYY/MM/DD":["DD.MM.YYYY"],Unknown:["Nežinoma"],"Event log":["Įvykių žurnalas"],"Show coordinates":["Rodyti koordinates"],Clear:["Aiškus"],"Clear ALT+-":["Aiškus ALT+-"],Employee:["Darbuotojas"],"Enter name":["Įveskite vardą"],Client:["Klientas"],Password:["Slaptažodis"],"Hourly order":["Valandos tvarka"],"Select coordinates":["Pasirinkite koordinates"],"Open calendar":["Atidarykite kalendorių"],Processing:["Apdorojimas"],"Message sent":["Žinutė išsiųsta"],"Message delivered":["Pranešimas išsiųstas"],"Error occurred":["Įvyko klaida"],"Message outdated":["Pranešimas pasenęs"],Success:["Sėkmė"],"No answer":["Nėra atsakymo"],Answer:["Atsakymas"],Missed:["Praleisti"],Transferred:["Perkeltas"],Brokeoff:["Nulūžo"],"Another user answered":["Kitas naudotojas atsakė"],Outgoing:["Išeina"],Incoming:["Ateiti"],"Status change":["Būsenos pakeitimas"],State:["Statusas"],"Driver call":["Vairuotojo skambutis"],SMS:["SMS"],Message:["Pranešimas"],Status:["Status"],Direction:["Kryptis"],Result:["Rezultatas"],Any:["Bet kokį"],Period:["Laikotarpis"],"Choose order states":["Pasirinkite valstijas"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Orders:["Заказы"],"Current orders":["Текущие заказы"],"Preliminary orders":["Предварительные заказы"],"Completed orders":["Выполненные заказы"],Current:["Текущие"],Completed:["Завершенные"],Preliminary:["Предварительные"],"[Preliminary]":["[ПРЕДВ]"],Search:["Поиск"],"Change status":["Изменить статус"],"Order is locked for editing":["Этот заказ нельзя редактировать"],Refresh:["Обновить"],"No results":["Пусто"],Add:["Добавить"],"Order is being edited by another user":["Заказ редактируется другим пользователем"],"Client phone":["Телефон клиента"],Driver:["Водитель"],"Picked up time":["Время подачи"],Today:["Сегодня"],Yesterday:["Вчера"],Finished:["Завершен"],Aborted:["Отклонен"],"In work":["В работе"],Accepted:["Принят"],"Order #%s":["Заказ #%s"],"Phone number":["Номер телефона"],Addresses:["Адреса"],"Pick-up address":["Подача"],"Intermediate address":["Остановка"],"Drop-off address":["Назначение"],Attributes:["Атрибуты"],"Select attributes":["Выберите атрибуты"],Tariff:["Тариф"],"Events log":["Журнал событий"],Close:["Закрыть"],"in cash":["наличными"],"non-cash":["безналичными"],"by bank card":["банковской картой"],"bonus points":["бонус"],total:["итого"],sum:["сумма"],maximum:["максимум"],"No events":["Нет событий"],Reset:["Сбросить"],Save:["Сохранить"],Cost:["Стоимость"],"No data":["Н/Д"],Value:["Значение"],Subtotal:["Сумма"],"No phone":["Нет телефона"],"Cannot edit this order":["Этот заказ нельзя редактировать"],"New order":["Добавить заказ"],"Cab group":["Группа экипажа"],"Client name":["Имя клиента"],"Client group":["Группа клиента"],"Bonus balance":["Баланс бонусов"],"Cashless balance":["Баланс безналичного счета"],City:["Город"],Address:["Адрес"],"Add address":["Добавить адрес"],"Select address":["Выберите адрес"],"Go back":["Обратно"],street:["улица"],house:["дом"],point:["место"],"Delivery date":["Дата подачи"],"use maximum":["максимум"],"Order updated":["Заказ обновлен"],"Order created":["Заказ создан"],"Status changed":["Статус изменен"],Tomorrow:["Завтра"],"Day after tomorrow":["После завтра"],"After, min":["Через, мин"],now:["сейчас"],today:["сегодня"],"%s min":["%s мин"],"HH:mm DD/MM/YYYY":["HH:mm DD.MM.YYYY"],"No city":["Нет города"],"Enter pick-up address":["Введите адрес подачи"],"Enter pick-up time":["Введите время подачи"],"No attributes":["Нет атрибутов"],Call:["Вызвать"],Open:["Открыть"],Transfer:["Перевести"],Flash:["Флеш"],"No primary car":["Нет основного автомобиля"],"From coordinates":["По координатам"],"Order copied":["Заказ копирован"],"Confirm the action":["Подтвердите действие"],"New order will be created with the same fields except for the driver, which will be emptied. Continue?":["Новый заказ будет создан с теми же самыми полями, кроме водителя, который будет очищен. Продолжить?"],Cancel:["Отмена"],Confirm:["Подтвердить"],Copy:["Копировать"],"HH:mm":["HH:mm"],"YYYY/MM/DD":["DD.MM.YYYY"],Unknown:["Неизвестно"],Comment:["Комментарий"],"Event log":["Журнал событий"],Clear:["Удалить"],"Clear ALT+-":["Удалить ALT+-"],Employee:["Сотрудник"],"Enter name":["Введите имя"],Client:["Имя клиента"],Password:["Пароль"],"Hourly order":["Почасовой заказ"],"Select coordinates":["Выберите координаты"],"Open calendar":["Показать календарь"],Processing:["Обработка"],"Message sent":["Сообщение отправлено"],"Message delivered":["Сообщение доставлено"],"Error occurred":["Произошла ошибка"],"Message outdated":["Сообщение устарело"],Success:["Успешно"],"No answer":["Нет ответа"],Answer:["Отвечен"],Missed:["Пропущен"],Transferred:["Переведен"],Brokeoff:["Оборван"],"Another user answered":["Отвечен другим пользователем"],Outgoing:["Исходящий"],Incoming:["Входящий"],"Status change":["Статус изменен"],State:["Состояние"],"Driver call":["Позывной водителя"],SMS:["СМС"],Message:["Сообщение"],Status:["Статус"],Direction:["Направление"],Result:["Результат"],"Accepted by driver":["Принят водителем"],"arriving in %d minute":["подъезд к месту за %d минуту","подъезд к месту за %d минуты","подъезд к месту за %d минут"],"Driver on spot":["Водитель на месте"],"Passenger mounted":["Клиент садится в машину"],"Call to client":["Звонок пассажиру"],"Sms sent to client":["СМС пассажиру"],"Not selected":["Не выбран"],Any:["Любой"],"Choose order states":["Выберите состояния заказов"],Period:["Период"],"New driver":["Новый водитель"],Distribute:["Раздача"],"Only my orders":["Только мои заказы"],Sorting:["Сортировка"],Default:["По-умолчанию"],Latest:["Новые"],Oldest:["Старые"],"Send cost":["Отправлять стоимость"],"Referral code or discount card":["Реферальный код или дисконтная карта"],"Discount card assigned":["Использована дисконтная карта"],"Referral code assigned":["Использован реферальный код"],"TM+%s hour":["TM+%s час","TM+%s часа","TM+%s часов"],"TM time":["Время ТМ"],Distances:["Километраж"],"%s km":["%s км"],Country:["За городом"],"Before pickup":["До подачи за городом"],"singularPreliminary":["Предварительный"]}}}},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(978))},function(e,t,n){var r={"./de.po":979,"./lt.po":980,"./ru.po":981};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=978},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Free:["Frei"],Unavailable:["Nicht verfügbar"],"On a break":["In der Pause"],"Performing booking":["Auf Bestellung"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Free:["Laisvas"],Unavailable:["Nepasiekiamas"],"On a break":["Pertraukoje"],"Performing booking":["Užsakyme"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Free:["Свободен"],Unavailable:["Недоступен"],"On a break":["На перерыве"],"Performing booking":["На заказе"]}}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(643));var r=n(643);t.default=r.default},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(984))},function(e,t,n){var r={"./de.po":985,"./lt.po":986,"./ru.po":987};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=984},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},"<b>%d</b>&ndash;<b>%d</b> of <b>%d</b>":["<b>%d</b>&ndash;<b>%d</b> aus <b>%d</b>","<b>%d</b>&ndash;<b>%d</b> aus <b>%d</b>","<b>%d</b>&ndash;<b>%d</b> aus <b>%d</b>"],"Go back (CTRL+LEFT)":["Zurück (CTRL+LEFT)"],"Go forward (CTRL+RIGHT)":["Vorwärts (CTRL+RIGHT)"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},"<b>%d</b>&ndash;<b>%d</b> of <b>%d</b>":["<b>%d</b>&ndash;<b>%d</b> iš <b>%d</b>","<b>%d</b>&ndash;<b>%d</b> iš <b>%d</b>","<b>%d</b>&ndash;<b>%d</b> iš <b>%d</b>"],"Go back (CTRL+LEFT)":["Eik atgal (CTRL+LEFT)"],"Go forward (CTRL+RIGHT)":["Eiti pirmyn (CTRL+RIGHT)"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},"<b>%d</b>&ndash;<b>%d</b> of <b>%d</b>":["<b>%d</b>&ndash;<b>%d</b> из <b>%d</b>","<b>%d</b>&ndash;<b>%d</b> из <b>%d</b>","<b>%d</b>&ndash;<b>%d</b> из <b>%d</b>"],"Go back (CTRL+LEFT)":["Назад (CTRL+ВЛЕВО)"],"Go forward (CTRL+RIGHT)":["Вперед (CTRL+ВПРАВО)"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(36),l=n(644),u=n(8),c=n(11),d=n(249),p=n(207),f=n(187);n(648),n(662);var h=n(1016),m=n(132),g=n(44),v=n(27),y=n(214),_=n(682),b=n(144);t.init=function(e){return s.eff.ap(f.autocomplete.getCollection(e,o({},f.defaultQuery,{limit:0})),d.resource.getCollection(e),p.getCollection(e).mapEff(function(e){return e.filter(function(e){return!e.forbid_manual_set})}),function(e,t,n){return{drivers:e,crewGroups:t,orderStates:n}})};var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={focusedInput:null},t.handleSearchInput=function(e){var n=t.props,r=n.onChange,i=n.value;r&&r(o({},i,{search:e}))},t.filterStates=function(e){switch(t.props.value.status){case"current":return"accepted"===e.state_type||"in_work"===e.state_type;case"advance":return"accepted"===e.state_type;case"performed":return"finished"===e.state_type||"aborted"===e.state_type}},t}return r(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.__,r=t.ctx,a=t.value,s=t.classes,u=t.className,d=t.onChange,p=t.onReset,f=t.state,v=f.drivers,C=f.crewGroups,E=f.orderStates,S=w(v),T=w(C),O=w(E),A=c(u,s.root),x=a.driver&&S[a.driver]||null,k=a.crewGroup&&T[a.crewGroup]||null,R=g.filterMap(a.state,function(e){return O[e]||null}),I=this.state.focusedInput;return i.createElement(_.default,o({},this.props,{onReset:p,className:A,searchField:i.createElement(l.default,{ctx:r,disabled:"performed"===a.status,value:a.search,onValueChange:this.handleSearchInput})}),i.createElement("div",{className:s.row},i.createElement(m.AutoComplete,{ctx:r,value:x,printItem:function(e){return e?e.name:""},source:v,onValueChange:function(e){d&&d(o({},a,{driver:e?e.id:null}))},textFieldProps:{placeholder:n("Driver")}}),i.createElement(m.AutoComplete,{ctx:r,value:k,printItem:function(e){return e?e.name:""},source:C,onValueChange:function(e){d&&d(o({},a,{crewGroup:e?e.id:null}))},textFieldProps:{placeholder:n("Cab group")}})),i.createElement("div",{className:s.row},i.createElement(m.Debounce,{delay:1e3},i.createElement(m.MultiSelect,{ctx:r,value:R,source:E.filter(this.filterStates),printItem:function(e){return e?e.name:""},onValueChange:function(e){return d&&d(o({},a,{state:e.map(function(e){return e.id})}))},textFieldProps:{placeholder:n("Choose order states")},fullWidth:!0}))),i.createElement("div",{className:s.row},i.createElement(y.default,{labelPosition:"left",labelClassName:s.label,label:n("Sorting")},i.createElement(m.SelectField,{ctx:r,className:s.selectSorting,value:a.sort,onValueChange:function(e){return d&&d(o({},a,{sort:e}))},source:[null,"created","-created"],renderItem:function(e){return b.printSort(e)(r)}})),i.createElement(y.default,{labelPosition:"left",labelClassName:s.label,label:n("Only my orders")},i.createElement(m.BooleanField,{value:a.only_my_orders,onClick:function(){return d&&d(o({},a,{only_my_orders:!a.only_my_orders}))}}))),"performed"===a.status&&i.createElement("div",{className:c(s.row,s.period)},i.createElement("label",{className:s.label2},n("Period")),i.createElement(h.default,{startDate:a.since,endDate:a.till,focusedInput:I,onDatesChange:function(e){var t=e.startDate,n=e.endDate;d&&d(o({},a,{since:t?t.startOf("day"):null,till:n?n.startOf("day"):null}))},onFocusChange:function(t){return e.setState({focusedInput:t})},isOutsideRange:function(e){return!1},withPortal:!0})))},t}(g.PureComponent);t.View=u.default(E)(v.withGettext(n(81))(C));var w=a.memoize(function(e){return e.reduce(function(e,t){return e[t.id]=t,e},{})});function E(e){var t=e.spacing.unit;return{label2:o({},e.typography.caption),row:{display:"flex","& > * + *":{marginLeft:t},padding:[.5*t,t],justifyContent:"space-between"},period:{display:"flex",width:"100%",alignItems:"center",boxSizing:"border-box","& > * + *":{marginLeft:2*t},"& > *:first-child + *":{flex:"10 10 auto","& > * > *":{display:"flex",width:"100%",alignItems:"center"},"& > * > * > *:first-child":{flex:"10 10 auto"},"& > * > * > *:first-child + *":{flex:"0 0 auto"},"& > * > * > *:first-child + * + *":{flex:"10 10 auto"}}},label:{fontSize:14,color:e.palette.text.secondary,textAlign:"right",lineHeight:1.15},selectSorting:{marginLeft:t,maxWidth:15*t},"@global":{".DateRangePickerInput":{backgroundColor:"transparent",border:"none",height:4.5*t},".DateInput":{boxSizing:"border-box",padding:0,height:4.5*t,border:"solid 1px "+e.palette.divider,"& input":{boxSizing:"border-box",fontWeight:400,fontSize:14,padding:[.5*t,t]}},".DateInput__display-text":{lineHeight:"18px"},".DateRangePickerInput__arrow":{padding:"0 2px"},".DateRangePicker__tether--show":{zIndex:3e3},".DateRangePicker_picker__portal":{zIndex:99}}}}t.styles=E},function(e,t,n){var r={"./de.po":990,"./lt.po":991,"./ru.po":992};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=989},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Search:["Suche"],"Toggle filter":["Filter anzeigen"],"Reset filter":["Filter zurücksetzen"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Search:["Paieška"],"Toggle filter":["Rodyti filtrą"],"Reset filter":["Atstatyti filtrą"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Search:["Поиск"],"Toggle filter":["Показать фильтр"],"Reset filter":["Сбросить фильтры"]}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(8),l=n(11),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e,t=this.props,n=t.classes,r=t.focused,s=t.error,u=t.required,c=i(t,["classes","focused","error","required"]),d=l(n.root,((e={})[n.focused]=r,e[n.error]=s,e[n.required]=u,e));return a.createElement("label",o({},c,{className:d,role:"label"}))},t}(a.Component);t.default=s.default(function(e){var t=e.spacing.unit;return{root:{color:e.palette.text.secondary,fontSize:e.typography.pxToRem(13),fontWeight:500,lineHeight:1,padding:0},focused:{color:e.palette.primary.main},error:{color:e.palette.error.main},required:{"&:after":{content:'"*"',position:"relative",top:2,transform:"scale(1.5)",marginLeft:t-2,display:"inline-block"}}}})(u)},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.timer=null,t.callback=null,t.handleChange=function(e){t.timer&&clearTimeout(t.timer),t.setState({value:e}),t.forceUpdate(),t.callback=function(){t.timer=null,t.callback=null;var n=t.props.children.props.onValueChange;n&&n(e)},t.timer=setTimeout(t.callback,t.props.delay)},t.handleBlur=function(e){t.callback&&t.callback();var n=t.props.children.props.onBlur;n&&n(e)},t}return r(t,e),t.prototype.componentWillReceiveProps=function(e){"value"in this.state&&this.setState(function(e){return{value:void 0}})},t.prototype.render=function(){return o.cloneElement(this.props.children,{value:void 0!==this.state.value?this.state.value:this.props.children.props.value,onValueChange:this.handleChange,onBlur:this.handleBlur})},t.defaultProps={delay:500},t}(o.Component);t.Debounce=i,t.default=i},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),l=n(388),u=n(8),c=n(11),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleChange=function(e,n){var r=t.props.onValueChange;r&&r(n)},t}return r(t,e),t.prototype.render=function(){var e,t=this.props,n=t.ctx,r=t.value,i=t.classes,u=t.alignLeft,d=t.disabled,p=t.error,f=a(t,["ctx","value","classes","alignLeft","disabled","error"]),h=c(i.root,((e={})[i.alignLeft]=u,e));return s.createElement("div",o({},f),s.createElement(l.default,{className:h,checked:r,onChange:this.handleChange,disabled:d,"data-rh-at":"right","data-rh":"string"==typeof p||"function"==typeof p?"string"==typeof p?p:p(n):void 0}))},t=i([u.default(p)],t)}(s.Component);function p(e){return{root:{"& > span:first-child":{height:4.5*e.spacing.unit}},alignLeft:{marginLeft:-13}}}t.default=d,t.styles=p},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),l=n(54),u=n(8),c=n(9),d=n(404),p=n(48),f=n(681);n(648),n(662);var h=n(1077),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={open:!1,textFieldValue:null,value:null},t.handleRootRef=function(e){if(e){var n=l.findDOMNode(e);n&&(t.rootEl=n)}else t.rootEl=null},t.handlePickerRef=function(e){if(e){var n=l.findDOMNode(e);n&&(t.pickerEl=n)}else t.pickerEl=null},t.handleChange=function(e){t.setState({value:e})},t.handleBlur=function(){var e=t.props.onValueChange,n=t.state.value;if(n){var r=c(n,t.format(t.props));if(r.isValid())t.setState({value:null}),(t.props.value?t.props.value.valueOf():0)!==r.valueOf()&&e&&e(r)}},t.handleKeyDown=function(e){switch(e.key){case"Enter":t.handleBlur()}},t.handleFocusIn=function(e){var n=t,r=n.rootEl,o=n.pickerEl;if(!t.props.disabled){var i=e.target;if(!i.hasAttribute("data-ignore-focus-in")){var a=function e(t){if(t===r||t===o)return!0;return!!t.parentNode&&e(t.parentNode)}(i);t.setState({open:a})}}},t.handleClear=function(e){e.preventDefault(),e.stopPropagation();var n=t.props.onValueChange;n&&n(null)},t.handleVisibilityToggle=function(e){var n=t.state.open;t.setState({open:!n})},t.handleClose=function(e){e.preventDefault(),e.stopPropagation(),t.state.open&&t.setState({open:!1})},t.handleDatesChange=function(e){var n=t.props,r=n.value,o=n.onValueChange,i=r||c().startOf("minute"),a=e.clone();a.hours(i.hours()),a.minutes(i.minutes()),o&&o(a)},t}return r(t,e),t.prototype.componentDidMount=function(){var e=this;document.addEventListener("focusin",this.handleFocusIn),document.addEventListener("click",this.handleFocusIn),this.unlisten=function(){return document.removeEventListener("focusin",e.handleFocusIn),document.removeEventListener("click",e.handleFocusIn),e.unlisten=null}},t.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},t.prototype.format=function(e){return e.format||"DD/MM/YYYY"},t.prototype.render=function(){var e=this.props,t=e.classes,n=(e.ctx,e.error),r=e.InputProps,i=(e.onBlur,e.onChange,e.onFocus,e.value),l=(e.format,e.disabled),u=e.nonNull,c=e.dayPickerProps,m=a(e,["classes","ctx","error","InputProps","onBlur","onChange","onFocus","value","format","disabled","nonNull","dayPickerProps"]),g=this.rootEl,v=this.state.open,y=this,_=s.createElement(s.Fragment,null,s.createElement(f.default,{"data-ignore-focus-in":!0,onClick:this.handleVisibilityToggle},"date_range"),!u&&s.createElement(f.default,{"data-ignore-focus-in":!0,onClick:this.handleClear},"close"));return s.createElement("div",o({},m,{ref:this.handleRootRef}),s.createElement(d.default,o({},r,{disabled:l,error:n,className:t.input,onValueChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,endAdornment:_,value:function(e,t){return null!==e.value?e.value:t.value?t.value.format(y.format(y.props)):""}(this.state,this.props)})),g&&s.createElement(p.Popover,{anchorEl:g,open:v,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"left"},disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0,hideBackdrop:!0},s.createElement(h.default,o({ref:this.handlePickerRef,date:i,onDateChange:this.handleDatesChange,numberOfMonths:1},c))))},t.defaultProps={nonNull:!1},t=i([u.default(g)],t)}(s.Component);function g(e){return{input:{width:180,position:"relative"}}}t.default=m,t.styles=g},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M569.354 231.631C512.97 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-102.556 0-192.091-54.701-240-136 44.157-74.933 123.677-127.27 216.162-135.007C273.958 131.078 280 144.83 280 160c0 30.928-25.072 56-56 56s-56-25.072-56-56l.001-.042C157.794 179.043 152 200.844 152 224c0 75.111 60.889 136 136 136s136-60.889 136-136c0-31.031-10.4-59.629-27.895-82.515C451.704 164.638 498.009 205.106 528 256c-47.908 81.299-137.444 136-240 136z"></path></svg>'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M272.702 359.139c-80.483-9.011-136.212-86.886-116.93-167.042l116.93 167.042zM288 392c-102.556 0-192.092-54.701-240-136 21.755-36.917 52.1-68.342 88.344-91.658l-27.541-39.343C67.001 152.234 31.921 188.741 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.004 376.006 168.14 440 288 440a332.89 332.89 0 0 0 39.648-2.367l-32.021-45.744A284.16 284.16 0 0 1 288 392zm281.354-111.631c-33.232 56.394-83.421 101.742-143.554 129.492l48.116 68.74c3.801 5.429 2.48 12.912-2.949 16.712L450.23 509.83c-5.429 3.801-12.912 2.48-16.712-2.949L102.084 33.399c-3.801-5.429-2.48-12.912 2.949-16.712L125.77 2.17c5.429-3.801 12.912-2.48 16.712 2.949l55.526 79.325C226.612 76.343 256.808 72 288 72c119.86 0 224.996 63.994 281.354 159.631a48.002 48.002 0 0 1 0 48.738zM528 256c-44.157-74.933-123.677-127.27-216.162-135.007C302.042 131.078 296 144.83 296 160c0 30.928 25.072 56 56 56s56-25.072 56-56l-.001-.042c30.632 57.277 16.739 130.26-36.928 171.719l26.695 38.135C452.626 346.551 498.308 306.386 528 256z"></path></svg>'},function(e,t,n){var r={"./ru.po":1076};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1075},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},"Cannot be empty":["Заполните это поле"],"Nothing found…":["Ничего не найдено…"],Clear:["Очистить"],"See more":["Загрузить еще"]}}}},,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(8),l=n(11),u=n(48),c=n(248),d=n(99),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={open:!1,options:null},t.subscription=null,t.handleChange=function(e){var n=t.props,r=n.onValueChange,o=n.prepareItem,i=t.getOptions(),a=Number(e.target.value);isNaN(a)||i.length<=a||(a<0?r&&r(null):r&&r((o||function(e){return e})(i[a])))},t.handleOpen=function(){var e=t.props,n=e.source,r=e.ctx;Array.isArray(n)?t.setState({open:!0}):r&&t.fetchOptions(r,n)},t.handleClose=function(){t.setState({open:!1})},t}return r(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.source,n=e.ctx;!Array.isArray(t)&&n&&this.fetchOptions(n,t,!1)},t.prototype.componentWillUnmount=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)},t.prototype.getOptions=function(){return Array.isArray(this.state.options)?this.state.options:Array.isArray(this.props.source)?this.props.source:[]},t.prototype.fetchOptions=function(e,t,n){var r=this;void 0===n&&(n=!0),this.subscription||(this.setState({options:"pending"}),this.subscription=t.getCollection(e).subscribe(function(e){r.subscription=null,"Left"===e.tag?(d.notifyError(e.value),r.setState({options:null})):r.setState({options:e.value,open:n})}))},t.prototype.render=function(){var e,t=this.props,n=t.classes,r=t.error,o=t.nullCase,s=t.disabled,d=t.renderItem,p=t.value,f=t.className,h=t.isEqual,m=this.state.open,g=l(f,n.root,((e={})[n.error]=r,e)),v=this.getOptions(),y=h||a.isEqual,_=v.findIndex(function(e){return y(e,p)});return i.createElement(c.default,{value:_,onChange:this.handleChange,className:g,disabled:s,open:m,onOpen:this.handleOpen,onClose:this.handleClose},o&&i.createElement(u.MenuItem,{key:"@null",value:-1},o),v.map(function(e,t){return i.createElement(u.MenuItem,{key:t,value:t},(d||String)(e))}))},t=o([s.default(f)],t)}(i.Component);function f(e){return{root:{"&:before":{display:"none"},"& > div > div":{paddingLeft:e.spacing.unit,background:"rgba(0,0,0,0.04)",borderRadius:2}},error:{background:"rgba(255,0,0,0.08)"}}}t.default=p},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(54),s=n(50),l=n(292),u=n(293),c=n(185),d=n(112),p=n(8),f=n(165),h=n(27),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={selected:0},t.paperEl=null,t.unlisten=null,t.handleFocusClick=function(e){var n=t,r=n.paperEl,o=n.props,i=o.anchorEl,a=o.onVisibilityChange;a&&a(function e(t){if(t===i||t===r)return!0;return!!t.parentNode&&e(t.parentNode)}(e.target))},t.handleKeyDown=function(e){var n=t.props,r=n.suggestions,o=n.onSelect;switch(e.key){case"ArrowDown":t.state.selected<r.length-1&&t.setHovered(t.state.selected+1);break;case"ArrowUp":t.state.selected>0&&t.setHovered(t.state.selected-1);break;case"Enter":if(e.stopPropagation(),e.preventDefault(),t.state.selected>=r.length)break;o&&o(r[t.state.selected])}},t.handleSuggestionClick=s.memoize(function(e){return function(n){var r=t.props,o=r.suggestions,i=r.onSelect;n.stopPropagation(),n.preventDefault(),e>=o.length||i&&i(o[e])}}),t.handleClose=function(){var e=t.props.onVisibilityChange;e&&e(!1)},t.handlePaperRef=function(e){var n=t.props.anchorEl;if(e&&n){t.paperEl=a.findDOMNode(e);var r=t.props.marginThreshold||8,o=window.innerHeight-r,i=t.paperEl.getBoundingClientRect(),s=n.getBoundingClientRect(),l=i.height,u=s.bottom+4;u+l>o&&s.top-window.scrollY-l-8>r?t.paperEl.style.bottom=-(s.top-8)+"px":t.paperEl.style.top=u+"px",t.paperEl.style.left=s.left+"px",t.paperEl.style.minWidth=s.width+"px"}},t}return r(t,e),t.prototype.componentDidMount=function(){this.props.open&&this.listen()},t.prototype.componentWillUnmount=function(){this.unlisten&&this.unlisten()},t.prototype.componentWillReceiveProps=function(e){e.open&&!this.props.open&&this.listen(),!e.open&&this.props.open&&(this.setHovered(0),this.unlisten&&this.unlisten()),e.suggestions!==this.props.suggestions&&this.setHovered(0)},t.prototype.componentDidUpdate=function(e){var t="boolean"!=typeof this.props.dontMove||this.props.dontMove;e.suggestions!==this.props.suggestions&&!t&&this.paperEl&&this.handlePaperRef(this.paperEl)},t.prototype.listen=function(){var e=this;document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("focusin",this.handleFocusClick),document.addEventListener("click",this.handleFocusClick),this.unlisten=function(){document.removeEventListener("keydown",e.handleKeyDown),document.removeEventListener("focusin",e.handleFocusClick),document.removeEventListener("click",e.handleFocusClick),e.unlisten=null}},t.prototype.setHovered=function(e){var t=this;this.setState({selected:e},function(){if(t.paperEl){var e=t.paperEl.querySelector("[data-is-selected=true]");if(e){var n=e.parentNode,r=n.getBoundingClientRect();e.offsetTop-n.scrollTop>=.8*r.height?n.scrollTop=e.offsetTop-.8*r.height:e.offsetTop-n.scrollTop<.1*r.height&&(n.scrollTop=e.offsetTop-.1*r.height)}}})},t.prototype.renderSuggestions=function(e){var t=this,n=this.props.renderSuggestion,r=this.state.selected;return e.map(function(e,o){var a=n?n(e):String(e);return i.isValidElement(a)?i.cloneElement(a,{key:o,onMouseDown:function(e){t.handleSuggestionClick(o)(e),a.props.onClick&&a.props.onClick(e)},selected:r===o,"data-is-selected":r===o}):i.createElement(u.default,{key:o,selected:r===o,onMouseDown:t.handleSuggestionClick(o),"data-is-selected":r===o},a)})},t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.open,a=e.pending,s=e.suggestions,u=e.before,p=e.after,h={ref:this.handlePaperRef,className:n.paper};return i.createElement(c.default,{className:n.modal,open:!!r,onClose:this.handleClose,disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0,hideBackdrop:!0},i.createElement(d.default,o({},h),!!s.length&&i.createElement(l.default,{className:n.menu},u,this.renderSuggestions(s),p),!s.length&&i.createElement("div",{className:n.empty},i.createElement("span",null,t("Nothing found…"))),i.createElement(f.default,{pending:a||!1})))},t}(i.Component);function g(e){var t=e.spacing.unit;return{paper:{position:"absolute",zIndex:9e3},menu:{maxHeight:300,overflowY:"auto"},modal:{width:0,height:0},empty:{color:e.palette.text.secondary,padding:[t,2*t],textAlign:"center",fontStyle:"italic",width:"100%"}}}t.default=p.default(g)(h.withGettext(n(213))(m)),t.styles=g},function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(36);function i(e){return o.cmd.concat(o.cmd.of({tag:"@Pending",pending:!0}),e,o.cmd.of({tag:"@Pending",pending:!1}))}function a(e,t){var n=t.toLowerCase();e=e.toLowerCase();for(var r=0,o=0;o<t.length;o++)n[o]===e[r]&&(r+=1);return r===e.length}t.pending=i,t.defaultQuery={offset:0,search:"",limit:20},t.init=function(){return{open:!1,suggestions:[],pending:!1,total:0,query:t.defaultQuery}},t.update=function(e,n,s){var l=function(e){return{tag:"Error",error:e}};switch(n.tag){case"@Pending":return[r({},s,{pending:n.pending}),o.noop];case"Error":return[s,o.noop];case"Query":var u=n.query,c=e.options.source,d=e.options.printItem||function(e){return JSON.stringify(e)};if(Array.isArray(c)){for(var p=[],f=0,h=0;h<c.length&&p.length<u.limit;h++)if(!u.search||a(u.search,d(c[h]))){if(u.offset>f){f++;continue}p.push(c[h])}return[r({},s,{suggestions:p,query:u,open:!0,total:c.length}),o.noop]}if("pageCollection"in c){if(!("auth"in e&&e.auth))return[s,o.noop];var m=function(e){return{tag:"Query/success",suggestions:e[0],total:e[1],query:u}},g=c.pageCollection(e,u).perform(l,m);return[r({},s,{open:!0}),i(g)]}if("getCollection"in c)return"auth"in e&&e.auth?(m=function(e){return{tag:"Query/success",suggestions:e,total:0,query:u}},g=c.getCollection(e,u).perform(l,m),[r({},s,{open:!0}),i(g)]):[s,o.noop];throw new Error("Unknown source");case"Query/success":p=n.suggestions;var v=n.total,y=n.query;return[r({},s,{suggestions:p,total:v,query:y}),o.noop];case"Offset":return[s,o.cmd.of({tag:"Query",query:r({},s.query,{offset:n.value})})];case"Search":return[s,o.cmd.of({tag:"Query",query:r({},t.defaultQuery,{search:n.value})})];case"More":var _=s.query.limit;return[s,o.cmd.of({tag:"Query",query:r({},s.query,{limit:_+20})})];case"Focus":return e.options.openOnFocus&&!e.options.openOnClick?[s,o.cmd.of({tag:"Query",query:s.query})]:[s,o.noop];case"Blur":case"Close":return[r({},s,{open:!1}),o.noop];case"Open":return s.open?[s,o.noop]:[s,o.cmd.of({tag:"Query",query:t.defaultQuery})];case"Click":return e.options.openOnClick?s.open?[r({},s,{open:!1}),o.noop]:[s,o.cmd.of({tag:"Query",query:t.defaultQuery})]:[s,o.noop]}},t.fuzzyFilter=a},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),l=n(50),u=n(366),c=n(48),d=n(11),p=n(8),f=n(405),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDelete=u.default(function(e){return function(n){var r=t.props,o=r.value,i=r.onValueChange;if(!r.disabled){var a=o.slice();if(a.splice(e,1),n){var s=n.currentTarget.parentNode.childNodes[e+1];s&&s.focus()}i&&i(a)}}}),t.handleValueChange=function(e){var n=t.props,r=n.value,o=n.onValueChange,i=r.slice();if(e){for(var a=0;a<i.length;a++)if(t.isEqual(i[a],e))return i.splice(a,1),void(o&&o(i));i.push(e),o&&o(i)}else o&&o([])},t.renderChips=u.default(function(e){var n,r=t.props,o=r.classes,i=r.printItem,a=r.disabled,l=t.props.id||"id",u=d(((n={})[o.disabled]=a,n));return e.length?s.createElement("div",null,s.createElement("span",{className:o.chips},e.map(function(e,n){return s.createElement(c.Chip,{key:e[l],className:u,label:i(e),onClick:t.handleDelete(n),onDelete:t.handleDelete(n)})}))):null}),t.renderSuggestion=function(e){var n=t.props,r=n.renderItem,o=n.printItem,i=!!n.value.find(function(n){return t.isEqual(n,e)}),a=t.props.id||"id";return r?r(e,i):s.createElement(c.MenuItem,{key:e[a],disableRipple:!0},s.createElement(c.Checkbox,{disableRipple:!0,checked:i}),s.createElement(c.ListItemText,{primary:(o||String)(e)}))},t}return r(t,e),t.prototype.isEqual=function(e,t){return(this.props.isEqual||l.isEqual)(e,t)},t.prototype.render=function(){var e,t=this.props,n=t.ctx,r=t.classes,i=t.fullWidth,l=t.className,u=t.source,c=(t.renderItem,t.printItem),p=(t.id,t.textFieldProps),h=t.value,m=t.error,g=t.disabled,v=(t.onValueChange,t.placeholder),y=a(t,["ctx","classes","fullWidth","className","source","renderItem","printItem","id","textFieldProps","value","error","disabled","onValueChange","placeholder"]),_=d(l,r.root,((e={})[r.disabled]=g,e[r.fullWidth]=i,e));return s.createElement("div",o({},y,{className:_}),this.renderChips(h),s.createElement(f.default,{ctx:n,value:null,printItem:c,source:u,renderItem:this.renderSuggestion,onValueChange:this.handleValueChange,textFieldProps:p,placeholder:v,error:m,disabled:g,fullWidth:i,keepOpenAfterSelect:!0,openOnClick:!0,openOnFocus:!0,nonNull:!0}))},t.defaultProps={printItem:String},t=i([p.default(m)],t)}(s.Component);function m(e){var t=e.spacing.unit;return{root:{},chips:{marginLeft:-t,marginBottom:t,display:"inline-block","& > *":{display:"inline-flex",marginLeft:t,marginTop:t}},disabled:{cursor:"not-allowed"},fullWidth:{width:"100%"}}}t.default=h,t.styles=m},,,,,,,,function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(36),l=n(99),u=n(1090),c=n(392),d=n(393),p=n(1095),f=n(11),h=n(187),m=n(208),g=n(8),v=n(48),y=n(44),_=n(306),b=n(27);t.initFlags=function(e){return o({},h.defaultQuery,{limit:e.pageLimit})},t.init=function(e,t,n){var r=n?s.eff.of(n.states):m.resource.getCollection(e),o=!!n&&n.filterVisible;return s.eff.ap(h.collection.pageCollection(e,t),r,function(e,n){var r=e[0],i=e[1];return{flags:t,drivers:r,total:i,states:n,filterVisible:o}})},t.update=function(e,t,n){switch(t.tag){case"Update":return[n,h.collection.getCollection(e,t.flags).perform(function(e){return{tag:"Error",error:e}},function(e){return{tag:"Update/success",drivers:e[0],total:e[1],flags:t.flags}})];case"Update/success":return[o({},n,{drivers:t.drivers,total:t.total,flags:t.flags}),s.noop];case"Filter/visibility":return[o({},n,{filterVisible:t.visibility}),s.noop];case"Error":return[n,l.notifyError(t.error)]}};var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFilterChange=function(e){var n=t.props.onFlagsChange;n&&n(e)},t.handleFilterReset=function(){var e=t.props,n=e.onFlagsChange,r=e.model.flags;(0,e.dispatch)({tag:"Filter/visibility",visibility:!1}),n&&n(o({},h.defaultQuery,{limit:r.limit,offset:0}))},t.handleUpdate=function(){var e=t.props,n=e.onFlagsChange,r=e.model.flags;n&&n(r)},t.handleOffsetChange=function(e){var n=t.props,r=n.model.flags,i=n.onFlagsChange;i&&i(o({},r,{offset:e}))},t.handleItemClick=a.memoize(function(e){return function(){var n=t.props.onItemClick;n&&n(e)}}),t.handleStatusChange=a.memoize(function(e){return function(n){(0,t.props.dispatch)({tag:"@Driver/changeStatus",state:n,id:e.id})}}),t}return r(t,e),t.prototype.isFilterEmpty=function(){for(var e=this.props.model.flags,t=0,n=a.without(Object.keys(h.defaultQuery),"offset","limit");t<n.length;t++){var r=n[t];if(!a.isEqual(e[r],h.defaultQuery[r]))return!1}return!0},t.prototype.renderList=function(){var e=this,t=this.props,n=t.ctx,r=t.model,o=t.selected,a=t.classes;return i.createElement("div",{className:a.listWrapper},r.drivers.map(function(t){return i.createElement(u.default,{key:t.id,ctx:n,states:r.states,value:t,selected:o===t.id,showMenu:!0,onClick:e.handleItemClick(t),onStateChange:e.handleStatusChange(t)})}))},t.prototype.render=function(){var e=this.props,t=e.ctx,n=e.dispatch,r=e.model,o=e.className,a=e.classes,s=e.__,l=f(o,a.root),u=s("Drivers");return i.createElement("div",{className:l},i.createElement(_.Helmet,null,i.createElement("title",null,b.sprintf(s("%s — [Operator Workstation]"),u))),i.createElement("div",{className:a.content},i.createElement(p.default,{ctx:t,value:r.flags,onChange:this.handleFilterChange,onReset:this.isFilterEmpty()?void 0:this.handleFilterReset,onVisibilityChange:function(e){return n({tag:"Filter/visibility",visibility:e})},open:r.filterVisible}),this.renderList(),i.createElement("div",{className:a.footer},i.createElement("div",{className:a.buttons},i.createElement(v.Button,{size:"small",color:"primary",onClick:function(){return n({tag:"@Driver/new"})},disabled:!t.profile.access_rights.drivers_add},s("Add")),i.createElement(c.default,{ctx:t,duration:t.refreshInterval,action:this.handleUpdate,listRef:r.drivers})),i.createElement(d.default,{className:a.pagination,ctx:t,offset:r.flags.offset,limit:r.flags.limit,total:r.total,onOffsetChange:this.handleOffsetChange,listenKeyboard:!0,reactHint:!0}))))},t}(y.PureComponent);function w(e){var t=e.spacing.unit;return{root:{minHeight:0,display:"flex",flexDirection:"column",height:"100%"},tabsWrapper:{flex:"0 0 auto",borderBottom:"solid 1px "+e.palette.divider,fontSize:14},content:{flex:"100 100 100%",display:"flex",minHeight:0,flexDirection:"column"},refreshButton:{padding:"0 "+t+"px",marginLeft:-t},buttons:{marginLeft:-t},listWrapper:{flex:"100 100 100%",position:"relative",overflowY:"auto",minHeight:0,borderBottom:"solid 1px "+e.palette.divider},footer:{flex:"0 0 auto",display:"flex",padding:[t,2*t],background:e.palette.grey[200],alignItems:"center",height:6*t,boxSizing:"border-box","& > *:first-child":{flexGrow:10},"& > *:first-child + *":{flexGrow:0,display:"flex",alignItems:"center","& > * + *":{marginLeft:2*t}}},pagination:{"& > *:first-child + *":{marginLeft:t,boxShadow:"none",border:"solid 1px "+e.palette.divider,"& > *":{width:4*t,height:4*t}}}}}t.View=g.default(w)(b.withGettext(n(161))(C)),t.styles=w},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(50),a=n(48),s=n(73),l=n(142),u=n(8),c=n(11),d=n(297),p=n(27),f=n(44),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.primaryHeading=function(e){var t=this.props,n=t.value,r=t.classes,i=n.phones.find(function(e){return e.default}),a=i?i.number:"";return o.createElement("span",null,"#",n.id,", ",n.call," — ",n.name,", ",o.createElement("span",{className:r.nowrap},a))},t.prototype.secondaryHeading=function(e){var t=this.props.value;return(t.car?t.car.color+" "+t.car.brand+" "+t.car.plate:e("no car"))+", "+(t.blocked?e("Locked"):t.state?t.state.name:null)},t.prototype.render=function(){var e,t=this.props,n=t.__,r=t.value,s=t.selected,l=t.showMenu,u=t.onClick,d=t.states,p=t.className,h=t.classes,g=t.onStateChange,v=c(p,h.root,h[i.camelCase(r.state.state_type)],((e={})[h.selected]=s,e)),y=this.primaryHeading(n),_=this.secondaryHeading(n);return o.createElement(a.ListItem,{className:v,onClick:u},o.createElement(a.ListItemText,{primary:y,secondary:_}),r.blocked&&o.createElement(a.Icon,{color:"action","data-rh":n("Driver is locked")},"lock"),!f.coordsEmpty(r.coordinates)&&o.createElement(a.Icon,{color:"action","data-rh":n("Driver on map")},"gps_fixed"),o.createElement("div",{className:h.moreWrapper},l&&o.createElement(m,{items:d,onItemSelect:g,renderItemProps:{classes:h}},o.createElement(a.Icon,{className:h.more,"data-rh":n("Change status")},"more_vert"))))},t}(o.Component);t.default=u.default(g)(p.withGettext(n(161))(h));var m=d.default(function(e){return o.createElement(a.MenuItem,{key:e.item.id,className:c(e.classes.menuItem,e.classes[i.camelCase(e.item.state_type)])},e.item.name)});function g(e){var t=e.spacing.unit;return{root:{cursor:"default",userSelect:"none",position:"relative",padding:[1.5*t,.5*t,1.5*t,2*t],"& h3":{lineHeight:"1.15",fontSize:14},"&:hover":{background:s.fade(e.palette.text.primary,.05)},"&$selected":{background:s.fade(e.palette.text.primary,.1)},"&:before":{content:'""',display:"block",height:"calc(100% - 4px)",width:4,background:"transparent",position:"absolute",left:0,top:2},"& >*:first-child":{flex:"100 100 auto"}},menuItem:{"&:before":{content:'""',display:"block",height:"calc(100% - 4px)",width:4,background:"transparent",position:"absolute",left:0,top:2}},waiting:{"&:before":{background:l.blue[500]}},onOrder:{"&:before":{background:l.amber.A700}},moreWrapper:{height:"100%",display:"flex",alignItems:"center",top:0},more:{color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}},iconTitles:{marginTop:-7,marginLeft:-2,"& > *":{color:e.palette.text.secondary,textDecoration:"underline","&:hover":{textDecoration:"none"},"& > *:first-child":{bottom:-6,position:"relative",fontSize:22,marginRight:.5*t}},"& > * + *":{marginLeft:2*t}},selected:{},notAvailable:{},onBreak:{},nowrap:{whiteSpace:"nowrap"}}}t.styles=g},function(e,t,n){var r={"./de.po":1092,"./lt.po":1093,"./ru.po":1094};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1091},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Drivers:["Fahrer"],Search:["Suche"],"no car":["Kein Auto verfügbar "],"Driver is locked":["Der Fahrer ist blockiert "],Any:["Jeglicher"],"No results":["Keine Ergebnisse"],"Driver status":["Status des Fahrers"],Locked:["Blockiert"],"New driver":["Einen Fahrer hinzufügen"],"Full name":["Nach-, Vor- und Vatersname"],Password:["Passwort"],Generate:["Generieren"],"New password":["Neues Passwort"],"Lock driver":["Den Fahrer blockieren "],"Reason for blocking":["Grund für das Blockieren "],"Phone number":["Telefon"],"Cab group":["Gruppe der Besatzung"],Comment:["Kommentar"],Reset:["Zurücksetzen"],Save:["Speichern "],Cancel:["Zurücksetzen"],Color:["Farbe"],Brand:["Marke"],"Number plate":["Nummer"],Add:["Hinzufügen"],"No attributes":["Keine Attribute"],Delete:["Löschen"],OK:["OK"],"No cars yet":["Keine Autos verfügbar"],"Add car":["Ein Auto hinzufügen"],"Edit car":["Ein Auto editieren"],Status:["Status "],"id: %s":["ID: %s"],"Enter driver full name":["Geben Sie den Nach-, Vor- und Vatersnamen des Fahrers ein "],"Enter password":["Passwort eingeben"],"Enter phone number":["Geben Sie die Telefonnummer ein"],"At least one car should be specified":["Mindestens 1 Auto soll zugewiesen sein"],"Choose car brand":["Wählen Sie die Automarke"],"Choose car color":["Wählen Sie die Farbe des Autos"],"Enter number plate":["Geben Sie amtliches Kennzeichen ein "],"Select cab group":["Wählen Sie die Gruppe der Besatzung"],"Only drivers offline can be edited":["Nur inaktive Fahrer können editiert werden"],"Go to the order":[" Zur Bestellung gehen"],"Driver is on an order":["Der Fahrer führt die Bestellung aus "],"Open order":["Die Bestellung öffnen"],"Driver created":["Der Fahrer ist erstellt"],"Driver updated":["Der Fahrer ist aktualisiert"],"You have no permissions to edit this driver":["Sie sind nicht berechtigt, diesen Fahrer zu editieren "],"Change status":["Status ändern"],Close:["Schließen"],Call:["Anrufen"],Transfer:["Überweisen"],Flash:["Flash"],"Status changed":["Status ist geändert"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Drivers:["Vairuotojai"],Search:["Paieška"],"no car":["nėra automobilio"],"Driver is locked":["Vairuotojas yra užblokuotas"],Any:["Bet koks"],"No results":["Tuščia"],"Driver status":["Vairuotojo statusas"],Locked:["Užrakinta"],"New driver":["Pridėti vairuotoja"],"Full name":["Pilnas vardas"],Password:["Slaptaždis"],Generate:["Generuoti"],"New password":["Naujas slaptažodis"],"Lock driver":["Blokuoti vairuotoją"],"Reason for blocking":["Blokavimo priežastis"],"Phone number":["Telefonas"],"Cab group":["Ekipažo gruė"],Comment:["Komentaras"],Reset:["Atstatyti"],Save:["Išsaugoti"],Cancel:["Atšaukti"],Color:["Spalva"],Brand:["Markė"],"Number plate":["Numeris"],Attributes:["Atributai"],Add:["Pridėti"],"No attributes":["Nėra atributų"],Delete:["Ištrinti"],OK:["OK"],"No cars yet":["Nėra automobilių"],"Add car":["Pridėti automobilį"],"Edit car":["Redaguoti automobilį"],Status:["Būsena"],"id: %s":["id: %s"],"Enter driver full name":["Įveskite vairuotojo vardą"],"Enter password":["Įveskite slaptažodį"],"Enter phone number":["Įveskite telefono numerį"],"At least one car should be specified":["Turite priskirti bent 1 automobilį"],"Choose car brand":["Įveskite mašinos ženklą"],"Choose car color":["Nurodykite mašinos spalvą"],"Enter number plate":["Įveskite registracijos numerį"],"Select cab group":["Pasirinkite ekipažo grupę"],"Only drivers offline can be edited":["Galite redaguoti neaktyvius vairuotojus"],"Go to the order":["Pereiti prie užsakymo"],"Driver is on an order":["Vairuotojas vykdo užsakymą"],"Open order":["Atidaryti užsakymą"],"Driver created":["Vairuotojas sukurtas"],"Driver updated":["Vairuotojas atnaujintas"],"You have no permissions to edit this driver":["Jūs neturite leidimo redaguoti vairuotoją"],"Change status":["Keisti būseną"],Close:["Uždaryti"],Call:["Iškviesti"],Transfer:["Išversti"],Flash:["Flešas"],"Status changed":["Būsena pakeista"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Drivers:["Водители"],Search:["Поиск"],"no car":["нет автомобиля"],"Driver is locked":["Водитель заблокирован"],Any:["Любой"],"No results":["Пусто"],"Driver status":["Статус водителя"],Locked:["Заблокирован"],"New driver":["Новый водитель"],"Full name":["ФИО"],Password:["Пароль"],Generate:["Сгенерировать"],"New password":["Новый пароль"],"Lock driver":["Заблокировать водителя"],"Reason for blocking":["Причина блокировки"],"Phone number":["Телефон"],"Cab group":["Группа экипажа"],Comment:["Комментарий"],Reset:["Сбросить"],Save:["Сохранить"],Cancel:["Отмена"],Color:["Цвет"],Brand:["Марка"],"Number plate":["Номер"],Add:["Добавить"],"No attributes":["Нет атрибутов"],Delete:["Удалить"],OK:["OK"],"No cars yet":["Нет автомобилей"],"Add car":["Добавить автомобиль"],"Edit car":["Редактировать автомобиль"],Status:["Статус"],"id: %s":["ИД: %s"],"Enter driver full name":["Введите ФИО водителя"],"Enter password":["Введите пароль"],"Enter phone number":["Введите номер телефона"],"At least one car should be specified":["Необходимо назначить хотя бы 1 автомобиль"],"Choose car brand":["Укажите марку машины"],"Choose car color":["Укажите цвет машины"],"Enter number plate":["Введите регистрационный номер"],"Select cab group":["Выберите группу экипажа"],"Only drivers offline can be edited":["Можно редактировать только неактивных водителей"],"Go to the order":["Перейти к заказу"],"Driver is on an order":["Водитель выполняет заказ"],"Open order":["Открыть заказ"],"Driver created":["Водитель создан"],"Driver updated":["Водитель обновлен"],"You have no permissions to edit this driver":["У вас нет прав для редактирования водителя"],"Change status":["Изменить статус"],Close:["Закрыть"],Call:["Вызвать"],Transfer:["Перевести"],Flash:["Флеш"],"Status changed":["Статус изменен"],"Add a car":["Добавить автомобиль"],Remove:["Удалить"],"Set as main":["Сделать основным"],"Driver on map":["Водитель на карте"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(682),s=n(644),l=n(8),u=n(11),c=n(1096),d=n(208),p=n(27),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSearchInput=function(e){var n=t.props,r=n.onChange,i=n.value;r&&r(o({},i,{search:e}))},t.printStateType=function(e){var n=t.props.ctx;return e?d.printStateType(e)(n):""},t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.ctx,n=e.value,r=e.classes,l=e.className,d=e.onChange,p=e.onReset,f=e.__,m=u(l,r.root),g=i.createElement(s.default,{ctx:t,value:n.search,onValueChange:this.handleSearchInput});return i.createElement(a.default,o({},this.props,{onReset:p,className:m,searchField:g}),i.createElement("div",null,i.createElement(c.default,{value:n.stateType,print:this.printStateType,sourceStatic:h,onSelect:function(e){return d&&d(o({},n,{stateType:e}))},onClear:function(){return d&&d(o({},n,{stateType:null}))},inputProps:{placeholder:f("Driver status")},showOnFocus:!0})))},t}(i.Component);t.default=l.default(m)(p.withGettext(n(161))(f));var h=["not_available","waiting","on_break","on_order"];function m(e){return{root:{}}}t.styles=m},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(684));var r=n(684);t.default=r.default},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(48),s=n(50),l=n(36),u=n(99),c=n(393),d=n(11),p=n(295),f=n(8),h=n(73),m=n(44),g=n(306),v=n(27),y=v.Translations.fromPO(n(186),n(215));t.initFlags=function(e){return{offset:0,limit:e.pageLimit,search:"",sort:[]}},t.init=function(e,t,n){return l.eff.ap(p.resource.pageCollection(e,t),function(e){var n=e[0],r=e[1];return{flags:t,items:n,total:r}})},t.update=function(e,t,n){switch(t.tag){case"Update":return[n,p.resource.pageCollection(e,t.flags).perform(function(e){return{tag:"Error",error:e}},function(e){return{tag:"Update/success",drivers:e[0],total:e[1],flags:t.flags}})];case"Update/success":return[o({},n,{items:t.drivers,total:t.total,flags:t.flags}),l.noop];case"Filter/visibility":return[n,l.noop];case"Error":return[n,u.notifyError(t.error)]}};var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFilterChange=function(e){var n=t.props.onFlagsChange;n&&n(e)},t.handleUpdate=function(){var e=t.props,n=e.onFlagsChange,r=e.model.flags;n&&n(r)},t.handleOffsetChange=function(e){var n=t.props,r=n.model.flags,i=n.onFlagsChange;i&&i(o({},r,{offset:e}))},t.handleItemClick=s.memoize(function(e){return function(){var n=t.props.onItemClick;n&&n(e)}}),t.renderListItem=function(e){var n=t.props.classes;return i.createElement(a.ListItem,{key:e.id,className:n.item,onClick:t.handleItemClick(e)},i.createElement(a.Avatar,null,i.createElement(a.Icon,null,"local_taxi")),i.createElement(a.ListItemText,{className:n.listItemText,primary:e.color+" "+e.brand,secondary:"#"+e.id+" "+e.attributes.map(function(e){return e.name}).join(", ")}))},t}return r(t,e),t.prototype.renderList=function(){var e=this.props,t=e.model,n=e.classes;return i.createElement("div",{className:n.listWrapper},t.items.map(this.renderListItem))},t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.model,o=e.className,s=e.classes,l=e.dispatch,u=d(o,s.root);return i.createElement("div",{className:u},i.createElement(g.Helmet,null,i.createElement("title",null,v.sprintf(t("%s — [Operator Workstation]"),t("Cars")))),i.createElement("div",{className:s.content},this.renderList(),i.createElement("div",{className:s.footer},i.createElement("div",{className:s.buttons},i.createElement(a.Button,{size:"small",color:"primary",onClick:function(e){return l({tag:"@Car/add"})},disabled:!n.profile.access_rights.cars_add},i.createElement(a.Icon,{className:s.buttonIcon},"add")," ",t("Add"))),i.createElement(c.default,{ctx:n,className:s.pagination,offset:r.flags.offset,limit:r.flags.limit,total:r.total,onOffsetChange:this.handleOffsetChange,listenKeyboard:!0,reactHint:!0}))))},t}(m.PureComponent);function b(e){var t=e.spacing.unit;return{root:{minHeight:0,display:"flex",flexDirection:"column",height:"100%"},content:{flex:"100 100 100%",display:"flex",minHeight:0,flexDirection:"column"},buttons:{marginLeft:-t},listWrapper:{flex:"100 100 100%",position:"relative",overflowY:"auto",minHeight:0,borderBottom:"solid 1px "+e.palette.divider},footer:{flex:"0 0 auto",display:"flex",padding:[t,2*t],background:e.palette.grey[200],height:6*t,boxSizing:"border-box",alignItems:"center","& > *:first-child":{flexGrow:10},"& > *:first-child + *":{flexGrow:0,display:"flex",alignItems:"center","& > * + *":{marginLeft:2*t}}},pagination:{"& > *:first-child + *":{marginLeft:t,boxShadow:"none",border:"solid 1px "+e.palette.divider,"& > *":{width:4*t,height:4*t}}},item:{cursor:"default",userSelect:"none",position:"relative",padding:[t,.5*t,t,2*t],"&:hover":{background:h.fade(e.palette.text.primary,.05)},"&$selected":{background:h.fade(e.palette.text.primary,.1)}},listItemText:{"& > *":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},selected:{},buttonIcon:{marginLeft:-t}}}t.View=f.default(b)(v.withGettext(y)(_)),t.styles=b},function(e,t,n){var r={"./ru.po":1099};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1098},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Cars:["Автомобили"],"New car":["Новый автомобиль"],"Edit a car":["Редактировать автомобиль"],Color:["Цвет"],Brand:["Бренд"],Plate:["Номер"],Attributes:["Атрибуты"],"Choose attributes":["Выберите атрибуты"],Reset:["Сбросить"],Save:["Сохранить"],Add:["Добавить"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(48),s=n(36),l=n(8),u=n(44),c=n(11),d=n(1101),p=n(113),f=n(73),h=n(392),m=n(165),g=n(208),v=n(207),y=n(27);function _(e,t,n){return s.eff.record({reports:d.getSimpleReports(e).map(function(e){return e.sort(r)}),pending:s.eff.of(!1)});function r(e,t){return e.value&&!t.value?-1:t.value&&!e.value?1:e.data.length&&!t.data.length?-1:t.data.length&&!e.data.length?1:0}}t.initFlags=function(e){return{}},t.init=_,t.update=function(e,t,n){switch(t.tag){case"Pending":return[o({},n,{pending:t.pending}),s.noop];case"Refresh":return[n,u.pending(_(e).perform(u.onFailure,function(e){return{tag:"Refresh/success",model:e}}))];case"Refresh/success":return[t.model,s.noop]}};var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={open:{}},t.handleToggleVisibility=function(e){return function(){t.setState(function(t){var n=o({},t.open);return e in n?delete n[e]:n[e]=!0,o({},t,{open:n})})}},t.renderReport=u.memoize(function(e){var n=t.props,r=n.__,o=n.ctx,s=n.classes,l=t.state.open[e.name]||!1;return i.createElement(i.Fragment,{key:e.name},i.createElement(a.ListItem,{className:s.item},e.value&&i.createElement("span",{className:s.value},e.value),i.createElement(a.ListItemText,{secondary:d.printUnknownReportName(e.name)(o)}),!!e.data.length&&i.createElement(p.default,{color:"disabled","data-rh":r("Details"),onClick:t.handleToggleVisibility(e.name)},l?"expand_less":"expand_more")),i.createElement(a.Collapse,{in:l,timeout:"auto",unmountOnExit:!0},i.createElement(a.Table,null,i.createElement(a.TableHead,null,i.createElement(a.TableRow,null,i.createElement(a.TableCell,{className:s.cell},u(e.name)?function(e){switch(e){case"bookings_today":case"drivers_online":return r("Time (h)");case"active_drivers":return r("Week");case"orders_by_status":case"drivers_by_status":return r("Status");case"driver_refusals":return function(){return"Unreachable code"}}}(e.name):r("Measure")),i.createElement(a.TableCell,{className:s.cell},r("Value")))),i.createElement(a.TableBody,null,e.data.map(function(t){var n=t.label,r=t.value;return i.createElement(a.TableRow,null,i.createElement(a.TableCell,{className:s.cell},u(e.name)?function(e,t){switch(e){case"bookings_today":case"drivers_online":case"active_drivers":return t;case"orders_by_status":return v.printMaybeStateType(t)(o);case"drivers_by_status":return g.printMaybeStateType(t)(o);case"driver_refusals":return t}}(e.name,n):n),i.createElement(a.TableCell,{className:s.cell},r))})))));function u(e){return e in d.reportNames}}),t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.ctx,n=e.classes,r=e.className,o=e.model,s=e.dispatch,l=c(r,n.root);return i.createElement("div",{className:l},i.createElement(a.List,{className:n.list},o.reports.map(this.renderReport)),i.createElement("div",{className:n.footer},i.createElement(h.default,{ctx:t,duration:t.refreshInterval,action:function(){return s({tag:"Refresh"})},listRef:o.reports})),i.createElement(m.default,{pending:o.pending}))},t}(i.PureComponent);function C(e){var t=e.spacing.unit;return{root:{minHeight:0,flex:"10 10 auto",display:"flex",flexDirection:"column"},list:{overflowY:"auto",minHeight:0,flex:"10 10 auto",width:"100%"},item:{paddingLeft:3*t,paddingRight:2*t,"&:hover":{background:f.fade(e.palette.text.primary,.05)}},value:{fontSize:36,fontWeight:300,color:e.palette.text.primary},footer:{flex:"0 0 auto",display:"flex",padding:[t,t],background:e.palette.grey[200],height:6*t,boxSizing:"border-box",alignItems:"center",whiteSpace:"nowrap",borderTop:"solid 1px "+e.palette.divider},cell:{"&:nth-child(2)":{textAlign:"right"}}}}t.View=l.default(C)(y.withGettext(n(685))(b)),t.styles=C},function(e,t,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(36),i=n(44),a=n(27).Translations.fromPO(n(685)).__;function s(e){return{"filter[name]":e.name.length?e.name.join(","):void 0}}t.simpleReportAttributes=o.decode.record({name:o.decode.string,value:o.decode.string,data:o.decode.array(o.decode.record({label:o.decode.string,value:o.decode.string}))}),t.reportNames={bookings_today:a("Bookings today"),drivers_online:a("Drivers online"),active_drivers:a("Active drivers"),orders_by_status:a("Orders by status"),drivers_by_status:a("Drivers by status"),driver_refusals:a("Driver refusals")},t.defaultQuery={name:Object.keys(t.reportNames)},t.getSimpleReports=function(e,n){return void 0===n&&(n={}),i.apiRequest(e,o.decode.at("data",o.decode.array(o.decode.at("attributes",t.simpleReportAttributes))),{method:"GET",url:o.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/simple_reports",s(r({},t.defaultQuery,n)))})},t.collectionParams=s,t.printReportName=function(e){return t.reportNames[e]},t.printUnknownReportName=function(e){return t.reportNames[e]||function(){return e}}},function(e,t,n){var r={"./ru.po":1103};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1102},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Details:["Подробности"],"Bookings today":["Заказы за сегодня"],"Drivers online":["Водители онлайн"],"Active drivers":["Активные водители"],"Orders by status":["Заказы по статусам"],"Drivers by status":["Водители по статусам"],"Driver refusals":["Отказы водителей"],Measure:["Параметр"],Value:["Значение"],"Time (h)":["Время (ч)"],Week:["Неделя"],Status:["Статус"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(36),a=n(27),s=n(44),l=n(8),u=n(11);t.initFlags=function(e){return null},t.init=function(e,t,n){return i.eff.of(null)};var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.className,i=u(r,n.root);return o.createElement("div",{className:i},t("Sorry, you have no access to any part of the application"))},t}(s.PureComponent);function d(e){return{root:{color:e.palette.text.secondary,textAlign:"center"}}}t.View=a.withGettext(n(686))(l.default(d)(c)),t.styles=d},function(e,t,n){var r={"./de.po":1106,"./lt.po":1107,"./ru.po":1108};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1105},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Orders:["Bestellungen"],Drivers:["Fahrer"],Settings:["Einstellungen"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Orders:["Užsakymai"],Drivers:["Vairuotojai"],Settings:["Nustatymai"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Orders:["Заказы"],Drivers:["Водители"],Settings:["Настройки"],Cars:["Автомобили"],Dashboard:["Дашборд"],"Sorry, you have no access to any part of the application":[null],"У вас недостаточно прав для доступа к приложению":[null]}}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(44);t.routeDecoder=r.decode.record({distances:r.decode.record({city:r.decode.float,country:r.decode.float,source_country:r.decode.float}),route:r.decode.array(r.decode.record({latitude:r.decode.float,longitude:r.decode.float,is_country:r.decode.boolean}))}),t.post=function(e,n){return o.apiRequest(e,r.decode.at(["data","attributes"],t.routeDecoder),{method:"POST",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/routes"),body:function(e){return{data:{type:"routes",attributes:{addresses:e.addresses.filter(function(e){return e.coordinates&&e.coordinates.latitude&&e.coordinates.longitude}).map(function(e){var t=e.address,n=e.coordinates;return{address:t,coordinates:n}})}}}}(n)})}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(166),i=n(44);t.orderCostResource=o.resource("order_costs",{sum:r.decode.float,total:r.decode.float,tariff:o.resource("tariffs").withDefault(null)}),t.getCosts=function(e,n){return i.apiRequest(e,a.chain(function(){return t.orderCostResource.primaryDecoder()}),{method:"POST",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/order_costs"),body:function(e){var t={addresses:e.addresses.map(function(e){var t=e.address,n=e.coordinates;return{address:t,coordinates:n||{latitude:0,longitude:0}}})},n={};e.picked_up&&(t.picked_up=e.picked_up),void 0!==e.sum&&(t.sum=e.sum),void 0!==e.distances&&(t.distances=e.distances),void 0!==e.hourly_order&&(t.hourly_order=e.hourly_order),void 0!==e.go_back&&(t.go_back=e.go_back),void 0!==e.attributes&&(n.attributes={data:e.attributes.map(function(e){return{type:"attributes",id:e}})}),void 0!==e.driver&&(n.driver={data:{type:"drivers",id:e.driver}}),void 0!==e.crewGroup&&(n.crew_group={data:{type:"crew_groups",id:e.crewGroup}}),void 0!==e.tariff&&(n.tariff={data:{type:"tariffs",id:e.tariff}}),void 0!==e.client&&(n.client={data:{type:"clients",id:e.client}});var r={data:{type:"order_costs",attributes:t}};return Object.keys(n).length&&(r.data.relationships=n),i.coerceAllIdsToNumbers(r)}(n)})};var a=r.decode.decoder(function(e){return"object"==typeof e&&e.hasOwnProperty("data")?r.success((e.data.id="999",e)):r.success(e)})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(44);t.responseDecoder=r.decode.at(["data"],r.decode.array(r.decode.at(["attributes","name"],r.decode.string))),t.getCollection=function(e){return o.apiRequest(e,t.responseDecoder,{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/cities")})}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(184),l=n(214),u=n(8),c=n(11),d=n(132),p=n(44),f=n(27),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleChangeSum=function(e){var n=t.props.onChangeSum,r=Number(e);n&&!isNaN(r)&&n(r)},t.handleInputChange=a.memoize(function(e){return function(n){var r=t.props,i=r.onValueChange,a=r.value,s=r.client,l=n?Number(n):0;if(!isNaN(l)&&i){var u=o({},a);switch(e){case"sum":u.total=u.sum=l;break;case"cashless":var c=s?Math.min(a.total,s.max_cashless_can_use,l):l;u.cashless=c;break;case"bonus":var d=s?Math.min(a.total,s.max_bonus_can_use,l):l;u.bonus=d;break;case"bank_card":u.bank_card=Math.min(a.total,l);break;case"cash":return u.cash=Math.min(a.total,l),void i(u)}m(u,s||void 0),i(u)}}}),t.handleUseMaxCashless=function(){var e=t.props,n=e.client,r=e.value,i=e.onValueChange;if(n&&i){var a=o({},r,{use_max_cashless:!r.use_max_cashless});a.use_max_cashless||(a.cashless=0),m(a,n||void 0),i(a)}},t.handleUseMaxBonus=function(){var e=t.props,n=e.client,r=e.value,i=e.onValueChange;if(n&&i){var a=o({},r,{use_max_bonus:!r.use_max_bonus});a.use_max_bonus||(a.bonus=0),m(a,n||void 0),i(a)}},t.handleSendCostChange=function(){var e=t.props,n=e.send_cost,r=e.onSendCostChange;r&&r(!n)},t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.className,o=e.client,a=e.disabled,u=e.currencyFormatter,p=e.send_cost,f=this.props.value,h=c(r,n.root),m=u||String;return i.createElement("div",{className:h},i.createElement("div",null,i.createElement("table",null,i.createElement("tbody",null,i.createElement("tr",null,i.createElement("td",null,i.createElement(d.Label,null,t("sum")),i.createElement(d.Debounce,null,i.createElement(d.TextField,{value:String(g(f.sum)),disabled:a,onValueChange:this.handleChangeSum,type:"number"}))),i.createElement("td",null,i.createElement("span",null,t("total"),":")," ",i.createElement("span",null,m(f.total)))),i.createElement("tr",null,i.createElement("td",null,i.createElement(d.Label,null,t("in cash")),i.createElement(d.Debounce,null,i.createElement(d.TextField,{value:String(g(f.cash)),disabled:a,onValueChange:this.handleInputChange("cash"),type:"number"}))),i.createElement("td",null,i.createElement(d.Label,null,t("by bank card")),i.createElement(d.Debounce,null,i.createElement(d.TextField,{value:String(g(f.bank_card)),disabled:a,onValueChange:this.handleInputChange("bank_card"),type:"number"})))),null!==o&&i.createElement("tr",null,i.createElement("td",null,i.createElement(d.Label,null,t("bonus points")),i.createElement(d.Debounce,null,i.createElement(d.TextField,{disabled:a||f.use_max_bonus,value:String(g(f.bonus)),onValueChange:this.handleInputChange("bonus"),type:"number"}))),i.createElement("td",null,i.createElement(l.default,{label:t("use maximum"),className:n.checkbox},i.createElement(s.default,{disabled:!0===a,checked:f.use_max_bonus,onChange:this.handleUseMaxBonus,onClick:this.handleUseMaxBonus})))),null!==o&&i.createElement("tr",null,i.createElement("td",null,i.createElement(d.Label,null,t("non-cash")),i.createElement(d.Debounce,null,i.createElement(d.TextField,{disabled:a||f.use_max_cashless,value:String(g(f.cashless)),onValueChange:this.handleInputChange("cashless"),type:"number"}))),i.createElement("td",null,i.createElement(l.default,{label:t("use maximum"),className:n.checkbox},i.createElement(s.default,{disabled:!0===a,checked:f.use_max_cashless,onChange:this.handleUseMaxCashless,onClick:this.handleUseMaxCashless})))))),i.createElement(l.default,{label:t("Send cost"),className:n.sendCheckbox},i.createElement(s.default,{checked:p,onChange:this.handleSendCostChange,onClick:this.handleSendCostChange}))))},t}(p.PureComponent);function m(e,t){var n=e.total-e.bank_card;if(e.use_max_bonus||(n-=e.bonus),e.use_max_cashless||(n-=e.cashless),e.use_max_bonus&&t){var r=Math.max(Math.min(t.max_bonus_can_use,n),0);n-=r,e.bonus=r}if(e.use_max_cashless&&t){var o=Math.max(Math.min(t.max_cashless_can_use,n),0);n-=o,e.cashless=o}e.cash=n}function g(e){return+(Math.round(e+"e+2")+"e-2")}function v(e){var t=e.spacing.unit;return{root:{"& a":{color:e.palette.primary[500]}},item:{display:"block",position:"relative","& input":{boxSizing:"border-box",paddingRight:3*t}},icon:{position:"absolute",top:15,right:0,cursor:"pointer",color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}},icon2:{position:"absolute",top:15,right:3*t,cursor:"pointer",color:e.palette.text.secondary,"&:hover":{color:e.palette.text.primary}},add:{color:e.palette.primary[500],"&:hover":{textDecoration:"none"}},pending:{animation:"rotate-progress-circle 1733ms linear infinite"},"@keyframes rotate-progress-circle":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}},coords:{display:"flex","& > * + *":{marginLeft:t}},checkbox:{position:"relative",top:t},sendCheckbox:{marginLeft:1.5*-t}}}t.default=u.default(v)(f.withGettext(n(81))(h)),t.mutateCost=m,t.styles=v},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(8),l=n(11),u=n(48),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.classes,n=e.children,r=e.className,s=e.number,c=e.hideTitle,d=i(e,["classes","children","className","number","hideTitle"]),p=l(r,t.root);return a.createElement("div",o({},d,{className:p}),!c&&a.createElement("div",{className:t.divider},a.createElement("span",{className:t.key},a.createElement(u.Icon,null,"keyboard"),a.createElement("span",null,"Alt+",s))),n)},t}(a.Component);function d(e){var t=e.spacing.unit;return{root:{},divider:{textAlign:"center",marginTop:t,marginBottom:t,position:"relative",display:"flex",alignItems:"center",justifyContent:"center","&:before":{content:'""',display:"block",borderBottom:"solid 1px "+e.palette.divider,position:"absolute",top:13,width:"calc(100% + "+4*t+"px)"}},key:{border:"solid 1px "+e.palette.divider,borderRadius:2*t,padding:[2,t+2],background:"white",textTransform:"uppercase",position:"relative",color:e.palette.text.secondary,fontWeight:700,"& > *":{verticalAlign:"middle"},"& > * + *":{marginLeft:t}}}}t.default=s.default(d)(c),t.styles=d},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(8),l=n(160),u=n(214),c=n(184),d=n(11),p=n(1115),f=n(44),h=n(27),m=n(73),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.listRef=i.createRef(),t.initialPositions=null,t.dndItemIndex=null,t.handleAdd=function(){var e=t.props,n=e.onValueChange,r=e.value,o={address:"",city:r[r.length-2]?r[r.length-2].city:"",coordinates:null,uuid:f.nextUUID()},i=r.slice();i.splice(i.length-1,0,o),setTimeout(t.focusNthInput,100,i.length-2),n&&n(i)},t.handleDelete=a.memoize(function(e){return function(){var n=t.props,r=n.onValueChange,o=n.value,i=o.slice();o.length<=2?i.splice(e,1,{address:"",city:"",coordinates:null,uuid:f.nextUUID()}):i.splice(e,1),setTimeout(t.focusNthInput,100,Math.max(e-1,0)),r&&r(i)}}),t.handleChange=a.memoize(function(e){return function(n){var r=t.props,o=r.onValueChange,i=r.value.slice();i.splice(e,1,n),o&&o(i)}}),t.handleCoordinatesRequest=a.memoize(function(e){return function(){var n=t.props.onCoordinatesRequest;n&&n(e)}}),t.focusNthInput=function(e){if(t.listRef.current&&t.listRef.current.childNodes[e]){var n=t.listRef.current.childNodes[e],r=n.querySelector("[data-focus-target]")||n.querySelector("input");r?r.focus():n.focus()}},t.handleDragStart=function(e){e.nativeEvent.dataTransfer.setData("text/plain","anything");var n=e.currentTarget.querySelector("[data-dnd-handle]");if(n){var r=n.getBoundingClientRect();if(e.clientX>r.right||e.clientX<r.left||e.clientY>r.bottom||e.clientY<r.top)return e.preventDefault(),void e.stopPropagation();var o=t.listRef;o.current&&(t.initialPositions=Array.prototype.slice.call(o.current.childNodes).map(function(n,r){return e.target===n&&(t.dndItemIndex=r),n.getBoundingClientRect()}))}},t.handleToggleReverse=function(){var e=t.props,n=e.value,r=e.onValueChange,i=e.ctx,a=e.goBack,s=e.onGoBackChange;"old"!==i.goBackBehaviour?t.isReverse()?r&&r(n.slice(0,n.length-1)):n.length>=2&&r&&r(n.concat(o({},n[0],{uuid:f.nextUUID()+":"+n[0].uuid}))):s&&s(!a)},t.handleDragEnd=function(e){var n=t,r=n.listRef,o=n.dndItemIndex;if(r.current&&null!==o&&t.initialPositions){r.current.childNodes[o].style.removeProperty("opacity");for(var i=-1,a=0;a<r.current.childNodes.length;a++){var s=r.current.childNodes[a],l=t.initialPositions[a],u=t.initialPositions[a+1];(!u||e.clientY<=u.top)&&e.clientY>l.top&&i<0&&(i=a),s.style.removeProperty("transform")}var c=t.props,d=c.value,p=c.onValueChange,f=d.slice();f.splice(o,1),f.splice(i,0,d[o]),p&&p(f)}},t.handleDrop=function(e){e.preventDefault()},t.handleDragOver=function(e){e.preventDefault(),t.dndOver(e)},t}return r(t,e),t.prototype.dndOver=function(e){var t=this.listRef,n=this.dndItemIndex;if(t.current&&null!==n&&this.initialPositions)for(var r=t.current.childNodes[n].getBoundingClientRect().height,o=-1,i=0;i<t.current.childNodes.length;i++){var a=t.current.childNodes[i],s=this.initialPositions[i],l=this.initialPositions[i+1],u=(!l||e.clientY<=l.top)&&e.clientY>s.top&&o<0;n==i?a.style.transform="translate3d(0, 4000px, 0)":(u||o>=0)&&n>i?a.style.transform="translate3d(0, "+r+"px, 0)":o<0&&n<=i?a.style.transform="translate3d(0, "+-r+"px, 0)":a.style.removeProperty("transform"),u&&(o=i)}},t.prototype.renderLabel=function(e,t){var n=this.props.value;return 0===e?t("Pick-up address"):e===n.length-1?t("Drop-off address"):t("Intermediate address")},t.prototype.isReverse=function(e){void 0===e&&(e=this.props);var t=e.value,n=e.ctx,r=e.goBack;return"old"===n.goBackBehaviour?r:t.length>2&&t[0].uuid===function(e){var t=e.split(":");return 2===t.length?t[1]:null}(t[t.length-1].uuid)},t.prototype.render=function(){var e=this,t=this.props,n=t.__,r=t.ctx,o=t.value,a=t.cities,s=t.error,f=t.disabled,h=t.crewGroup,m=t.classes,g=t.className,v=d(g,m.root);return i.createElement("div",{className:v},i.createElement("div",{className:m.list,ref:this.listRef,onDrop:this.handleDrop,onDragOver:this.handleDragOver},o.map(function(t,o){return i.createElement(p.default,{key:o,ctx:r,className:m.item,cities:a,onAdd:e.handleAdd,onDelete:e.handleDelete(o),onChange:e.handleChange(o),error:0===o?s:void 0,value:t,label:e.renderLabel(o,n),disabled:!!f,crewGroup:h,onDragStart:e.handleDragStart,onDragEnd:e.handleDragEnd,onCoordinatesRequest:e.handleCoordinatesRequest(t)})})),i.createElement("div",{className:m.bottom},i.createElement("a",{className:m.add,href:"javascript://void()",onClick:this.handleAdd,"data-rh":n("⌨ ALT+=")},i.createElement(l.default,null,"add"),n("Add address")),i.createElement(u.default,{label:n("Go back")},i.createElement(c.default,{disabled:o.length<=1,checked:this.isReverse(),onChange:this.handleToggleReverse,onClick:this.handleToggleReverse}))))},t}(i.Component);function v(e){var t=e.spacing.unit,n={color:e.palette.primary.main,textDecoration:"none","&:hover":{color:m.fade(e.palette.primary.main,.75)},"&:active":{color:e.palette.error.main}};return{root:{position:"relative"},item:{position:"relative"},add:o({},n,{display:"inline-block",alignItems:"center",fontSize:14,marginLeft:-t,"& > *":{verticalAlign:"middle"},"& > *:first-child":{marginRight:.5*t,marginBottom:1}}),bottom:{display:"flex",alignItems:"center",justifyContent:"space-between"}}}t.default=s.default(v)(h.withGettext(n(81))(g)),t.styles=v},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(48),s=n(113),l=n(8),u=n(11),c=n(142),d=n(391),p=n(132),f=n(405),h=n(36),m=n(54),g=n(27),v=n(44),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={focused:!1,pending:!1},t.textFieldRef=i.createRef(),t.observableRef=i.createRef(),t.handlekeyPress=function(e){var n=t.props,r=n.onAdd,o=n.onDelete;"="===e.key&&e.altKey&&r&&r(),"-"===e.key&&e.altKey&&o&&o()},t.addressSource={pageCollection:function(e,n){var r=t.props,o=r.crewGroup,i=r.value,a=n.search,s=n.offset,l=n.limit;return n.search?d.pageCollection(e,{text:a,limit:l,offset:s,city:i.city,crewGroup:i.city?void 0:o,searchPlaces:e.settings.address_search_places}):h.eff.of([[],0])}},t.handleAddressSelect=function(e){var n=t.props,r=n.value,i=n.onDelete,a=n.onChange;if(e){var s=o({},r);if(e.city&&(s.city=e.city),"point"===e.kind){var l=e.street||e.house?e.street+" "+e.house:"";s.address=e.point+(l?" *"+l+"*":"")}else""===e.house?s.address=e.street:e.house&&e.street&&(s.address=e.street+" "+e.house);v.coordsEmpty(e.coordinates)||(s.coordinates=e.coordinates),a&&a(s)}else i&&i()},t.handleAddressChange=function(e){var n=t.props,r=n.onChange,i=n.value;r&&r(o({},i,{address:e}))},t.handleCityChange=function(e){var n=t.props,r=n.onChange,i=n.value;r&&r(o({},i,{city:e}))},t}return r(t,e),t.prototype.renderAddress=function(e){var t=this;return function(r){var o=t.props.classes;if(!r)return i.createElement(a.MenuItem,{key:"clear"},e("Clear"));var s=r.city||e("No city");switch(r.kind){case"street":return i.createElement(a.MenuItem,{className:o.menuItem},i.createElement(a.ListItemText,{primary:n(r),secondary:s}),i.createElement("div",null,e("street")));case"point":return i.createElement(a.MenuItem,{className:o.menuItem},i.createElement(a.ListItemText,{primary:n(r),secondary:[s,r.street,r.house].filter(function(e){return!!e}).join(", ")}),i.createElement("div",null,e("point")));case"house":return i.createElement(a.MenuItem,{className:o.menuItem},i.createElement(a.ListItemText,{primary:n(r),secondary:s}),i.createElement("div",null,e("house")))}};function n(e){if(!e)return"";switch(e.kind){case"street":return""+e.street;case"point":return""+e.point;case"house":return e.street+", "+e.house}}},t.prototype.renderButtons=function(e){var t=this.props,n=t.onDelete,r=t.value,o=t.onCoordinatesRequest;return i.createElement(i.Fragment,null,i.createElement(s.default,{"data-rh":e("Select coordinates"),onClick:o},r.coordinates?"gps_fixed":"gps_not_fixed"),i.createElement(s.default,{"data-rh":e("Clear ALT+-"),onClick:n},"close"))},t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.classes,o=e.className,a=e.onDragStart,l=e.onDragEnd,c=e.error,d=e.label,h=e.value,g=e.cities,v=u(o,r.root);return i.createElement("div",{className:v,onDragStart:a,onDragEnd:l,draggable:!0},i.createElement("div",{className:r.row},i.createElement(s.default,{className:r.dndHandle,"data-dnd-handle":!0},"more_vert"),i.createElement("div",{className:r.inputs,ref:this.textFieldRef},i.createElement("div",{className:r.city},i.createElement(p.AutoComplete,{ctx:n,source:g,value:h.city,onValueChange:this.handleCityChange,error:c,null:""},i.createElement(p.TextField,{value:"",type:"text",placeholder:t("City"),inputProps:{tabIndex:n.cityTabCycle?void 0:-1},onKeyDown:this.handlekeyPress}))),i.createElement(f.CreateObservable,{ref:this.observableRef},i.createElement(p.TextField,{ctx:n,placeholder:d,error:c,className:r.address,value:h.address,onValueChange:this.handleAddressChange,endAdornment:this.renderButtons(t),onKeyDown:this.handlekeyPress,inputProps:{"data-focus-target":!0}})))),!n.disableAddressSearch&&i.createElement(p.AutoComplete,{ctx:n,value:null,source:this.addressSource,observable:this.observableRef.current?this.observableRef.current.observable:void 0,renderItem:this.renderAddress(t),onValueChange:this.handleAddressSelect,openOnFocus:!1,anchorEl:this.textFieldRef.current&&m.findDOMNode(this.textFieldRef.current)||void 0},i.createElement("span",null)))},t}(i.Component);function _(e){var t=e.spacing.unit;return{root:{"& + &":{marginTop:t}},row:{position:"relative",paddingLeft:2*t,display:"flex",alignItems:"center"},inputs:{position:"relative",display:"flex",alignItems:"center",width:"100%"},dndHandle:{position:"absolute",left:-t,cursor:"move",color:"rgba(0,0,0,0.2)","&:hover":{color:"rgba(0,0,0,0.87)"}},address:{borderTopLeftRadius:0,borderBottomLeftRadius:0,width:"100%","& input":{paddingLeft:0}},city:{borderTopRightRadius:0,borderBottomRightRadius:0,width:84,flex:"0 0 auto","& .material-icons":{fontSize:16}},menuItem:{display:"flex",paddingLeft:t,paddingRight:t,whiteSpace:"initial",height:"initial",paddingTop:0,paddingBottom:0,maxWidth:350,"& > *:first-child":{flex:"100 100 100%",paddingTop:.5*t,paddingBottom:.5*t,"& > *:first-child":{fontSize:13,lineHeight:"1.35em"},"& > *:first-child + *":{fontSize:12,marginTop:-2}},"& > *:first-child + *":{flex:"0 0 auto",color:e.palette.text.secondary,background:c.grey[200],padding:[.25*t,.5*t],borderRadius:.5*t}}}}t.default=l.default(_)(g.withGettext(n(81))(y)),t.styles=_},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(48),s=n(113),l=n(1258),u=n(8),c=n(11),d=n(9),p=n(403),f=n(291),h=n(645),m=n(214),g=n(184),v=n(132),y=n(27),_=n(244),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={datePickerAnchor:null,dateValue:t.printDate(),timeValue:t.printTime()},t.relativeInputEl=null,t.handleRelativeChange=function(e){var n=t.props,r=n.onValueChange,o=n.now,i=e?parseInt(e):0;if(!(isNaN(i)||i<0||i>=1440)){var a=o().startOf("minute");a.add(i,"minutes"),r&&r(a)}},t.handleDateBlur=function(e){var n=t.props,r=n.__,o=n.onValueChange,i=n.now,a=n.value,s=t.state.dateValue,l=d(s,r("DD/MM/YYYY"));if(l.isValid()){var u=(a||i().startOf("minute")).toObject(),c=u.seconds,p=u.minutes,f=u.hours;l.seconds(c),l.minutes(p),l.hours(f),o&&o(l)}else t.setState({dateValue:t.printDate()})},t.handleTimeBlur=function(e){var n=t.props,r=n.__,o=n.onValueChange,i=n.now,a=n.value,s=t.state.timeValue,l=d(s,r("HH:mm"));if(l.isValid()){var u=(a||i().startOf("minute")).toObject(),c=u.months,p=u.date,f=u.years;l.date(p),l.months(c),l.year(f),o&&o(l)}else t.setState({timeValue:t.printTime()})},t.handleDateTextChange=function(e){t.setState({dateValue:e})},t.handleTimeTextChange=function(e){t.setState({timeValue:e})},t.handleClose=function(){t.setState({datePickerAnchor:null})},t.handleDateInputKeyPress=function(e){"ArrowDown"===e.key&&t.setState({datePickerAnchor:e.target})},t.handleClear=function(){var e=t.props.onValueChange;e&&e(null)},t.handleDateChange=function(e){var n=t.props,r=n.value,o=n.onValueChange,i=n.now,a=r||i().startOf("minute"),s=e.clone();s.hours(a.hours()),s.minutes(a.minutes()),s.seconds(a.seconds()),o&&o(s),t.setState({datePickerAnchor:null})},t.handleVisibilityToggle=function(e){if(t.state.datePickerAnchor)t.setState({datePickerAnchor:null});else{var n=e.currentTarget.parentNode.querySelector("input");if(!n)return;t.setState({datePickerAnchor:n})}},t.handleAdvanceToggle=function(){var e=t.props,n=e.isAdvance,r=e.onAdvanceChange;r&&r(!n)},t.renderTimeAdornment=_.default(function(e,t,n){var r=0!==n?y.sprintf(e("TM+%s hour","TM+%s hours",void 0,n),n):e("TM time");return i.createElement("span",{className:t.timeOffset},r)}),t.renderDateAdornment=_.default(function(e){return i.createElement(i.Fragment,null,i.createElement(s.default,{onClick:t.handleVisibilityToggle,"data-rh":e("Open calendar")},"date_range"),i.createElement(s.default,{onClick:t.handleClear},"close"))}),t.renderSuggestions=_.default(function(e){return[10,20,30,60].map(function(t){return i.createElement(a.MenuItem,{value:t},y.sprintf(e("%s min"),t))})}),t}return r(t,e),t.prototype.componentWillUpdate=function(e){e.value!==this.props.value&&this.setState({dateValue:this.printDate(e),timeValue:this.printTime(e)})},t.prototype.printRelativeTime=function(e){if(!e.value)return"";var t=e.now,n=d(e.value).valueOf()-t().startOf("minute").valueOf();return n>=864e5||n<0?"":String(Math.floor(n/6e4))},t.prototype.printDate=function(e){void 0===e&&(e=this.props);var t=e.__,n=e.value;return n?n.format(t("DD/MM/YYYY")):""},t.prototype.printTime=function(e){void 0===e&&(e=this.props);var t=e.__,n=e.value;return n?n.format(t("HH:mm")):""},t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.className,o=e.error,a=e.disabled,s=e.classes,u=e.value,d=e.isAdvance,y=e.serverTimeOffset,_=this.state,b=_.datePickerAnchor,C=_.dateValue,E=_.timeValue,S=c(r,s.root),T=this.renderTimeAdornment(t,s,y),O=this.renderDateAdornment(t);return i.createElement("div",{className:S},i.createElement(v.Label,null,t("Picked up time")),i.createElement("div",{className:s.wrapper},i.createElement("div",{className:s.time},i.createElement(v.TextField,{ctx:n,value:E,onBlur:this.handleTimeBlur,onValueChange:this.handleTimeTextChange,error:o,disabled:a,Input:l.default,endAdornment:T,inputProps:{mask:w(t("HH:mm")),maskChar:"_",alwaysShowMask:!0}})),i.createElement("div",{className:s.date},i.createElement(v.TextField,{ctx:n,onBlur:this.handleDateBlur,onValueChange:this.handleDateTextChange,value:C,error:o,disabled:a,Input:l.default,endAdornment:O,inputProps:{mask:w(t("DD/MM/YYYY")),maskChar:"_",alwaysShowMask:!0},onKeyDown:this.handleDateInputKeyPress}),i.createElement(f.default,{anchorEl:b||void 0,open:!!b,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"left"}},i.createElement(p.default,{date:u,onDayClick:this.handleDateChange,numberOfMonths:1})))),i.createElement("div",{className:s.advanced},i.createElement(h.default,{withSuggestions:this.renderSuggestions(t)},i.createElement(v.TextField,{value:this.printRelativeTime(this.props),onValueChange:this.handleRelativeChange,placeholder:t("After, min"),type:"number"})),n.features.advance_orders&&i.createElement(m.default,{label:t("Preliminary","singular")},i.createElement(g.default,{checked:d,onClick:this.handleAdvanceToggle}))))},t}(i.Component),C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.adjustDate=_.default(function(e,t){return 0===t?e:e?e.clone().add(t,"hours"):e}),t.unAdjustDate=_.default(function(e,t){return 0===t?e:e?e.clone().add(-t,"hours"):e}),t.handleValueChange=function(e){var n=t.props,r=n.onValueChange,o=n.serverTimeOffset;r&&r(t.unAdjustDate(e,o))},t.now=function(){var e=t.props.serverTimeOffset;return d().add(e,"hours")},t}return r(t,e),t.prototype.render=function(){return i.createElement(b,o({},this.props,{value:this.adjustDate(this.props.value,this.props.serverTimeOffset),onValueChange:this.handleValueChange,now:this.now}))},t}(i.Component);function w(e){return e.replace(/\w/g,"9")}function E(e){var t=e.spacing.unit;return{wrapper:{display:"flex",alignItems:"center","& > *":{position:"relative"},"& > * + *":{marginLeft:t}},time:{"& input":{width:64}},date:{flex:"10 10 auto"},advanced:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:t},timeOffset:{marginRight:t,whiteSpace:"nowrap",color:e.palette.text.secondary,fontSize:12},"@global":{".SingleDatePicker_picker__portal, .DateRangePicker_picker__portal":{zIndex:99}}}}t.default=u.default(E)(y.withGettext(n(81))(C)),t.styles=E},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(8),s=n(27),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.bill,a=e.className,s=i(a,n.root);return 0===r.length?o.createElement("div",{className:s},o.createElement("span",{className:n.noData},t("No data"))):o.createElement("div",{className:n.root},o.createElement("table",null,o.createElement("tbody",null,r.map(function(e,t){return o.createElement("tr",{key:t},o.createElement("td",null,e.text),o.createElement("td",null,e.value),o.createElement("td",null,e.sum))}))))},t}(o.Component);function u(e){var t=e.spacing.unit;return{root:{"& $noData":{textAlign:"center",display:"block"}},dataGrid:{"& td, & td:last-child, & th, & th:last-child":{paddingLeft:2*t,paddingRight:2*t}},noData:{fontStyle:"italic",color:e.palette.text.secondary}}}t.default=a.default(u)(s.withGettext(n(81))(l)),t.styles=u},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(11),l=n(8),u=n(132),c=n(687),d=n(27),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.renderAdornments=function(e){var t=this.props,n=t.ctx,r=t.currentCall;return a.createElement(c.default,{ctx:n,phone:e,currentCall:r})},t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.classes,l=e.className,c=i(e,["__","ctx","classes","className"]),d=s(l,r.root);return a.createElement("div",{className:d},a.createElement(u.Label,null,t("Client phone")),a.createElement(u.Debounce,{delay:500},a.createElement(u.TextField,o({},c,{ctx:n,endAdornment:this.renderAdornments(c.value),regexFilter:/^[0-9]*$/,fullWidth:!0}))))},t}(a.Component);function f(e){return{root:{}}}t.default=l.default(f)(d.withGettext(n(81))(p)),t.styles=f},function(e,t,n){var r={"./de.po":1120,"./lt.po":1121,"./ru.po":1122};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1119},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Disconnect:["Die Verbindung trennen"],"Phone number":["Telefon"],DTMF:["DTMF"],"New booking":["Neue Bestellung"],"Open booking":["Bestellung öffnen "],"Open driver":["Fahrer"],Customer:["Fahrgast"],Driver:["Fahrer"],"Unknown number":["Unbekannte Nummer"],"End call":["Abschließen"],Call:["Anrufen"],"Phone disconnected":["Das Telefon ist nicht verbunden"],Connect:["Verbindung herstellen"],Dismiss:["Ablehnen"],Answer:["Beantworten"],Transfer:["Überweisen"],Hold:["Haltezeit"],Flash:["Flash"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Disconnect:["Atjunkite"],"Phone number":["Telefono numeris"],DTMF:["Papildoma"],"New booking":["Naujas užsakymas"],"Open booking":["Atidaryti užsakymą"],"Open driver":["Vairuotojas"],Customer:["Keleivis"],Driver:["Vairuotojas"],"Unknown number":["Nežinomas numeris"],"End call":["Baigti skambutį"],Call:["Skambinkite"],"Phone disconnected":["Telefonas atjungtas"],Connect:["Prisijungti"],Dismiss:["Atleisti"],Answer:["Atsakymas"],Transfer:["Perdavimas"],Hold:["Laikykis"],Flash:["Flash"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Disconnect:["Разъединить"],"Phone number":["Номер телефона"],DTMF:["Доб. №"],"New booking":["Новый заказ"],"Open booking":["Открыть заказ"],"Open driver":["Водитель"],Customer:["Пассажир"],Driver:["Водитель"],"Unknown number":["Неизвестный номер"],"End call":["Завершить"],Call:["Позвонить"],"Phone disconnected":["Телефон отключен"],Connect:["Соединиться"],Dismiss:["Отклонить"],Answer:["Ответить"],Transfer:["Перевести"],Hold:["Удержание"],Flash:["Флеш"],"Phone is disconnected":["Телефон отключен"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(160),a=n(11),s=n(8),l=n(132),u=n(27),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={password:"",passwordValid:!1},t.handlePasswordChange=function(e){var n=t.props,r=n.valueClient,o=n.onClientChange;if(r&&r.password){var i=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,o,i,a;return o=2147483648&e,i=2147483648&t,a=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(r=1073741824&t)?2147483648^a^o^i:n|r?1073741824&a?3221225472^a^o^i:1073741824^a^o^i:a^o^i}function r(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return e&t|~e&n}(r,o,i),a),l)),s),r)}function o(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return e&n|t&~n}(r,o,i),a),l)),s),r)}function i(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return e^t^n}(r,o,i),a),l)),s),r)}function a(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return t^(e|~n)}(r,o,i),a),l)),s),r)}function s(e){var t,n="",r="";for(t=0;t<=3;t++)r="0"+(e>>>8*t&255).toString(16),n+=r.substr(r.length-2,2);return n}var l,u,c,d,p,f,h,m,g,v=Array();for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e),v=function(e){for(var t,n=e.length,r=n+8,o=16*((r-r%64)/64+1),i=Array(o-1),a=0,s=0;s<n;)a=s%4*8,i[t=(s-s%4)/4]=i[t]|e.charCodeAt(s)<<a,s++;return a=s%4*8,i[t=(s-s%4)/4]=i[t]|128<<a,i[o-2]=n<<3,i[o-1]=n>>>29,i}(e),f=1732584193,h=4023233417,m=2562383102,g=271733878,l=0;l<v.length;l+=16)u=f,c=h,d=m,p=g,f=r(f,h,m,g,v[l+0],7,3614090360),g=r(g,f,h,m,v[l+1],12,3905402710),m=r(m,g,f,h,v[l+2],17,606105819),h=r(h,m,g,f,v[l+3],22,3250441966),f=r(f,h,m,g,v[l+4],7,4118548399),g=r(g,f,h,m,v[l+5],12,1200080426),m=r(m,g,f,h,v[l+6],17,2821735955),h=r(h,m,g,f,v[l+7],22,4249261313),f=r(f,h,m,g,v[l+8],7,1770035416),g=r(g,f,h,m,v[l+9],12,2336552879),m=r(m,g,f,h,v[l+10],17,4294925233),h=r(h,m,g,f,v[l+11],22,2304563134),f=r(f,h,m,g,v[l+12],7,1804603682),g=r(g,f,h,m,v[l+13],12,4254626195),m=r(m,g,f,h,v[l+14],17,2792965006),h=r(h,m,g,f,v[l+15],22,1236535329),f=o(f,h,m,g,v[l+1],5,4129170786),g=o(g,f,h,m,v[l+6],9,3225465664),m=o(m,g,f,h,v[l+11],14,643717713),h=o(h,m,g,f,v[l+0],20,3921069994),f=o(f,h,m,g,v[l+5],5,3593408605),g=o(g,f,h,m,v[l+10],9,38016083),m=o(m,g,f,h,v[l+15],14,3634488961),h=o(h,m,g,f,v[l+4],20,3889429448),f=o(f,h,m,g,v[l+9],5,568446438),g=o(g,f,h,m,v[l+14],9,3275163606),m=o(m,g,f,h,v[l+3],14,4107603335),h=o(h,m,g,f,v[l+8],20,1163531501),f=o(f,h,m,g,v[l+13],5,2850285829),g=o(g,f,h,m,v[l+2],9,4243563512),m=o(m,g,f,h,v[l+7],14,1735328473),h=o(h,m,g,f,v[l+12],20,2368359562),f=i(f,h,m,g,v[l+5],4,4294588738),g=i(g,f,h,m,v[l+8],11,2272392833),m=i(m,g,f,h,v[l+11],16,1839030562),h=i(h,m,g,f,v[l+14],23,4259657740),f=i(f,h,m,g,v[l+1],4,2763975236),g=i(g,f,h,m,v[l+4],11,1272893353),m=i(m,g,f,h,v[l+7],16,4139469664),h=i(h,m,g,f,v[l+10],23,3200236656),f=i(f,h,m,g,v[l+13],4,681279174),g=i(g,f,h,m,v[l+0],11,3936430074),m=i(m,g,f,h,v[l+3],16,3572445317),h=i(h,m,g,f,v[l+6],23,76029189),f=i(f,h,m,g,v[l+9],4,3654602809),g=i(g,f,h,m,v[l+12],11,3873151461),m=i(m,g,f,h,v[l+15],16,530742520),h=i(h,m,g,f,v[l+2],23,3299628645),f=a(f,h,m,g,v[l+0],6,4096336452),g=a(g,f,h,m,v[l+7],10,1126891415),m=a(m,g,f,h,v[l+14],15,2878612391),h=a(h,m,g,f,v[l+5],21,4237533241),f=a(f,h,m,g,v[l+12],6,1700485571),g=a(g,f,h,m,v[l+3],10,2399980690),m=a(m,g,f,h,v[l+10],15,4293915773),h=a(h,m,g,f,v[l+1],21,2240044497),f=a(f,h,m,g,v[l+8],6,1873313359),g=a(g,f,h,m,v[l+15],10,4264355552),m=a(m,g,f,h,v[l+6],15,2734768916),h=a(h,m,g,f,v[l+13],21,1309151649),f=a(f,h,m,g,v[l+4],6,4149444226),g=a(g,f,h,m,v[l+11],10,3174756917),m=a(m,g,f,h,v[l+2],15,718787259),h=a(h,m,g,f,v[l+9],21,3951481745),f=n(f,u),h=n(h,c),m=n(m,d),g=n(g,p);return(s(f)+s(h)+s(m)+s(g)).toLowerCase()}(e)===r.password;!0===i&&!1===t.state.passwordValid?o&&o(r):!1===i&&!0===t.state.passwordValid&&o&&o(null),t.setState({password:e,passwordValid:i})}},t}return r(t,e),t.prototype.componentWillReceiveProps=function(e){var t=e.valueClient?e.valueClient.id:null;(this.props.valueClient?this.props.valueClient.id:null)!==t&&this.setState({password:"",passwordValid:!1})},t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.className,s=e.readOnly,u=e.valueClient,c=e.valueClientEmployee,d=e.valueCustomer,p=e.onClientEmployeeChange,f=e.onCustomerChange,h=e.needPasswordConfirmation,m=this.state,g=m.password,v=m.passwordValid,y=a(r,n.root),_=null!==c||u&&u.client_group&&!u.client_group.create_order_not_to_employees;return o.createElement("div",{className:y},u&&o.createElement("div",{className:n.clientInfo},u.password&&h&&o.createElement(l.TextField,{beginAdornment:o.createElement(i.default,{className:n.marginLeftIcon,color:"disabled"},"vpn_key"),endAdornment:v?o.createElement(i.default,{color:"primary"},"check_circle_outline"):null,value:g||"",placeholder:t("Password"),onValueChange:this.handlePasswordChange,disabled:s,error:!v,fullWidth:!0}),o.createElement("table",null,o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",null,t("Client name")),o.createElement("td",null,u.name)),o.createElement("tr",null,o.createElement("td",null,t("Client group")),o.createElement("td",null,u.client_group?u.client_group.name:t("Unknown"))),o.createElement("tr",null,o.createElement("td",null,t("Cashless balance")),o.createElement("td",null,u.cashless_balance)),o.createElement("tr",null,o.createElement("td",null,t("Bonus balance")),o.createElement("td",null,u.bonus_balance)))),o.createElement("div",{className:n.employee},o.createElement(l.SelectField,{value:c,onValueChange:p,source:[null].concat(u.client_employees),renderItem:function(e){return e?e.name:t("Enter name")},disabled:0===u.client_employees.length||s}),u.client_group&&u.client_group.create_order_not_to_employees&&o.createElement(l.TextField,{value:d||"",placeholder:t("Client"),onValueChange:function(e){return f&&f(e)},disabled:_||s}))))},t}(o.Component);function d(e){var t=e.spacing.unit;return{clientInfo:{lineHeight:1.15,"& td:first-child":{color:e.palette.text.secondary,marginRight:t,fontSize:14,"&:after":{content:'":"'}},"& td:first-child + *":{fontSize:14},"& table":{borderCollapse:"collapse"},"& td":{padding:0}},employee:{marginTop:t,display:"flex",alignItems:"flex-end","& > *":{flex:"10 10 100%"},"& > * + *":{marginLeft:.5*t}},marginLeftIcon:{marginLeft:.5*t}}}t.default=s.default(d)(u.withGettext(n(81))(c)),t.styles=d},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(8),s=n(11),l=n(132),u=n(27),c=n(1125),d=n(48),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={value:""},t.handleValueChange=function(e){var n=t.props,r=n.ctx,i=n.onValueChange;t.setState({value:e}),""===e&&(i&&i(null,"discount_card"),i&&i("","referral_code")),c.checkCode(r,e).subscribe(function(n){if("Right"===n.tag)if("discount_card"===n.value.code_type&&n.value.discount_card&&i){var r=o({},n.value.discount_card,{name:e});i(r,"discount_card"),t.setState({value:""})}else"referral_code"===n.value.code_type&&i&&(i(e,"referral_code"),t.setState({value:""}))})},t}return r(t,e),t.prototype.componentWillReceiveProps=function(e){this.state.value&&this.setState({value:""})},t.prototype.renderEndAdornment=function(){var e=this.props.value;return""===this.state.value&&(e.referral_code||e.discount_card)?i.createElement(d.Icon,{color:"primary"},"check_circle_outline"):null},t.prototype.render=function(){var e=this.props,t=e.__,n=e.className,r=e.classes,o=e.value,a=e.disabled,u=s(n,r.root),c=this.state.value||o.referral_code||(o.discount_card?o.discount_card.name:"");return i.createElement("div",{className:u},i.createElement(l.Debounce,null,i.createElement(l.TextField,{value:c,placeholder:t("Referral code or discount card"),disabled:"object"==typeof a?a.referral_code:a,onValueChange:this.handleValueChange,error:""!==this.state.value,endAdornment:this.renderEndAdornment(),fullWidth:!0})),o.referral_code&&i.createElement("div",{className:r.infoText},"✓ "+t("Referral code assigned")),o.discount_card&&i.createElement("div",{className:r.infoText},"✓ "+t("Discount card assigned")))},t}(i.Component);function f(e){return{root:{},infoText:{marginTop:.5*e.spacing.unit,color:e.palette.text.secondary,fontSize:14,fontStyle:"italic"}}}t.default=a.default(f)(u.withGettext(n(81))(p)),t.styles=f},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),o=n(181),i=n(44);t.resource=o.resource("client_code",{code_type:r.decode.literals("unknown","discount_card","referral_code"),discount_card:o.resource("discount_cards").withDefault(null),client:o.resource("clients").withDefault(null)}),t.checkCode=function(e,n){return i.apiRequest(e,function(e){return r.decode.decoder(function(t){return"object"!=typeof t||"object"!=typeof t.data||"id"in t.data||(t.data.id=""),e.validate(t)})}(t.resource.primaryDecoder()),{method:"GET",url:r.http.join(e.operatorApi,"/tm-proxy/operator_api/v1/client_code",t.resource.collectQuery(),{"filter[code]":n})})}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(48),l=n(8),u=n(11),c=n(159),d=n(27),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showConfirmation:!1,args:[]},t.handleClick=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.setState({args:e,showConfirmation:!0})},t.handleConfirm=function(){var e=t.props.children,n=t.state.args;e&&e.hasOwnProperty("props")&&"function"==typeof e.props.onClick&&e.props.onClick.apply(void 0,n),t.setState({showConfirmation:!1,args:[]})},t.handleCancel=function(){t.setState({showConfirmation:!1,args:[]})},t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.classes,o=e.className,i=e.Confirmation,s=e.children,l=this.state.showConfirmation,c=u(r.root,o),d=s&&s.hasOwnProperty("type")?a.cloneElement(s,{onClick:this.handleClick}):s;return a.createElement("div",{className:c},d,a.createElement(i,{__:t,ctx:n,open:l,onClose:this.handleCancel,onConfirm:this.handleConfirm}))},t}(a.Component);function f(e){return{}}t.WithConfirmation=p,t.default=l.default(f)(d.withGettext(n(1127))(p)),t.DeleteConfirmation=l.default(f)(function(e){var t=e.__,n=(e.classes,e.onConfirm),r=i(e,["__","classes","onConfirm"]);return a.createElement(s.Dialog,o({},r),a.createElement(s.DialogTitle,null,t("Confirm deletion")),a.createElement(s.DialogContent,null,t("Are you sure you want to delete this item?")),a.createElement(s.DialogActions,null,a.createElement(c.default,{onClick:r.onClose},t("Cancel")),a.createElement(c.default,{onClick:n,color:"primary"},t("Confirm"))))}),t.styles=f},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1128))},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=1128},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(48),a=n(8),s=n(9),l=n(144),u=n(27),c=n(113),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showLogs:!1},t.handleToggleLogs=function(){t.setState({showLogs:!t.state.showLogs})},t}return r(t,e),t.prototype.renderDialog=function(){var e=this.props,t=e.__,n=e.classes,r=e.ctx,a=e.model,u=this.state.showLogs;return o.createElement(i.Dialog,{open:u,onClose:this.handleToggleLogs},o.createElement(i.DialogTitle,null,t("Events log")),o.createElement(i.DialogContent,null,function(e){return e.length?o.createElement("div",{className:n.events},e.map(c)):o.createElement("div",null,t("No data"))}(a.initial.logs)),o.createElement(i.DialogActions,null,o.createElement(i.Button,{onClick:this.handleToggleLogs},t("Close"))));function c(e,i){switch(e.type){case"status_changed":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Status change")))),o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",null,t("State")),o.createElement("td",null,e.params.state)),e.params.driver_call&&o.createElement("tr",null,o.createElement("td",null,t("Driver call")),o.createElement("td",null,e.params.driver_call))));case"sms":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("SMS")))),o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",null,t("Message")),o.createElement("td",null,e.params.sms_message)),o.createElement("tr",null,o.createElement("td",null,t("Status")),o.createElement("td",null,l.describeSmsStatus(e.params.status)(r)))));case"call":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Call")))),o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",null,t("Direction")),o.createElement("td",null,l.describeCallDirection(e.params.direction)(r))),o.createElement("tr",null,o.createElement("td",null,t("Result")),o.createElement("td",null,l.describeCallResult(e.params.result)))));case"driver_accept":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Accepted by driver")))));case"driver_at_place":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Driver on spot")))));case"client_inside":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Passenger mounted")))));case"order_finished":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Completed")))));case"sms_to_client":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Sms sent to client")))));case"call_to_client":return o.createElement("table",{key:i,className:n.eventItem},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},s(e.date).format("LLL")," ",t("Call to client")))))}return o.createElement("div",{key:i},e.type)}},t.prototype.render=function(){var e=this.props.__;return o.createElement(o.Fragment,null,o.createElement(c.default,{onClick:this.handleToggleLogs,"data-rh":e("Event log")},"event"),this.renderDialog())},t}(o.PureComponent);function p(e){var t=e.spacing.unit;return{events:{},eventItem:{width:"100%",borderCollapse:"collapse","& + &":{marginTop:2*t},"& th":{textAlign:"left"},"& td:first-child":{padding:[0,2*t],textAlign:"right",color:e.palette.text.secondary,minWidth:11*t},"& td:first-child + *":{width:"80%"}}}}t.default=a.default(p)(u.withGettext(n(81))(d)),t.styles=p},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(8),s=n(73),l=n(27),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(e){t.setState({anchorEl:e.currentTarget})},t.handleClose=function(){t.setState({anchorEl:null})},t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.company,r=e.className,a=e.classes,s=i(r,a.root);return o.createElement("div",{className:s},o.createElement("div",{className:a.breadcrumbs},o.createElement("span",{className:a.title},t)),o.createElement("div",{className:a.company},o.createElement("div",{className:a.company},n)))},t}(o.Component);function c(e){var t=e.spacing.unit;return{root:{padding:[0,3*t,0,3*t],display:"flex",alignItems:"center",width:"100%","&, & > *":{display:"flex",alignItems:"center"},"& > $breadcrumbs":{flex:"10 10 auto",justifyContent:"flex-start"},"& > $company":{flex:"10 10 auto",justifyContent:"flex-end"}},breadcrumbs:{"& a":{textDecoration:"none",color:e.palette.text.secondary,padding:[1.5*t,t],marginLeft:-t,borderRadius:2,"&:hover":{color:e.palette.text.primary,background:s.fade(e.palette.text.primary,.05)}},"& > a:after":{content:'"→"',paddingLeft:t,color:e.palette.text.secondary,fontSize:16}},newMessage:{color:e.palette.secondary.A700},company:{},title:{fontSize:22,color:e.palette.primary[500]}}}t.Toolbar=u,t.default=a.default(c)(l.withGettext(n(692))(u)),t.styles=c},function(e,t,n){var r={"./ru.po":1132};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1131},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},"Found existing order":["Найден текущий заказ"],"create new order":["создать новый заказ"],"open existing":["открыть существующий"],"Go back":["Назад"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(112),l=n(367),u=n(11),c=n(8),d=function(e){function t(t){var n=e.call(this,t)||this;return n.state={isVibrating:!1},n.timerId=null,n.loop=function(){n.setState({isVibrating:!n.state.isVibrating}),n.timerId=setTimeout(n.loop,2e3)},n}return r(t,e),t.prototype.startVibrate=function(){this.timerId||this.loop()},t.prototype.stopVibrate=function(){this.timerId&&(clearTimeout(this.timerId),this.timerId=null,this.setState({isVibrating:!1}))},t.prototype.componentWillReceiveProps=function(e){var t=this.props.children.props.model,n=e.children.props.model;l.shouldVibrate(t)&&!l.shouldVibrate(n)&&this.stopVibrate(),!l.shouldVibrate(t)&&l.shouldVibrate(n)&&this.startVibrate()},t.prototype.componentWillUnmount=function(){this.stopVibrate()},t.prototype.render=function(){var e,t=this.props,n=t.children,r=t.className,l=t.classes,c=i(t,["children","className","classes"]);return a.createElement(s.default,o({},c,{className:u(r,(e={},e[l.vibrate]=this.state.isVibrating,e))}),n)},t}(a.Component);function p(e){return{error:{display:"flex",alignItems:"center",justifyContent:"center",padding:2*e.spacing.unit,width:"100%",height:"100%",boxSizing:"border-box","& > *:first-child":{color:e.palette.text.secondary,fontStyle:"italic"}},vibrate:{animation:"vibration 25ms linear infinite alternate"},"@keyframes vibration":{from:{transform:"translateX(-2px)"},to:{transform:"translateX(2px)"}}}}t.default=c.default(p)(d),t.styles=p},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(50),s=n(48),l=n(113),u=n(11),c=n(8),d=n(297),p=n(27),f=n(44),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleStatusChange=function(e){var n=t.props;(0,n.dispatch)({tag:"@Driver/changeStatus",id:n.model.initial.id,state:e})},t}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.className,o=e.onClose,s=e.model,c=s.states,d=s.initial,p=u(n.status,n[a.camelCase(d.state.state_type)]),h=u(n.root,r);return f.isNew(d)?i.createElement("div",{className:h},i.createElement("div",null,i.createElement("h2",{className:n.title},t("New driver"))),i.createElement("div",{className:n.icons},i.createElement(l.default,{className:n.close,onClick:o,"data-rh":t("Close")},"close"))):i.createElement("div",{className:h},i.createElement("div",null,i.createElement("h2",{className:n.title},d.name),i.createElement("div",{className:p},d.state.name)),i.createElement("div",{className:n.icons},i.createElement(m,{items:c,onItemSelect:this.handleStatusChange,renderItemProps:{classes:n}},i.createElement(l.default,{color:"disabled","data-rh":t("Change status")},"more_vert")),i.createElement(l.default,{className:n.close,onClick:o,"data-rh":t("Close")},"close")))},t}(i.Component);t.DriverEdit=h,t.default=c.default(g)(p.withGettext(n(161))(h));var m=d.default(function(e){return i.createElement(s.MenuItem,{key:e.item.id,className:u(e.classes.menuItem,e.classes[a.camelCase(e.item.state_type)])},e.item.name)});function g(e){var t=e.spacing.unit;return{root:{display:"flex",alignItems:"center",flex:"0 0 auto",height:54,boxSizing:"border-box",paddingLeft:2*t,paddingRight:2*t-4,justifyContent:"space-between",width:"100%","& > *":{minWidth:0},"& h2":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},title:o({},e.typography.title,{marginTop:0,marginBottom:2,height:"1em",position:"relative","& > *:first-child":{position:"absolute",width:"100%",height:"100%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}),icons:{display:"flex",flexDirection:"row",flexShrink:0,"& > * + *":{marginLeft:t}}}}t.styles=g},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(48),a=n(11),s=n(693),l=n(8),u=n(27),c=n(50),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleStatusChange=function(e){var n=t.props;(0,n.dispatch)({tag:"@Driver/changeStatus",id:n.model.initial.id,state:e})},t}return r(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.__,r=t.classes,l=t.className,u=t.dispatch,d=t.model,p=t.model.modified,f=a(r.root,l),h=c.isEmpty(s.form.validate(s.form.get(d)));return o.createElement("div",{className:f},o.createElement("div",null,o.createElement(i.Button,{size:"small",disabled:!p,onClick:function(){return u({tag:"Reset"})}},n("Reset"))),o.createElement("div",null,o.createElement(i.Button,{size:"small",variant:"raised",disabled:!p||!h,color:"primary",onClick:function(){return""===e.props.model.initial.id?u({tag:"Post"}):u({tag:"Patch"})}},n("Save"))))},t}(o.Component);function p(e){var t=e.spacing.unit;return{root:{display:"flex",alignItems:"center",flex:"0 0 auto",height:7*t,boxSizing:"border-box",paddingLeft:t,paddingRight:2*t,justifyContent:"space-between",width:"100%","& > *:first-child":{flex:"10 10 auto"},"& > *:first-child + *":{flex:"0 0 auto"}}}}t.CardFooter=d,t.default=l.default(p)(u.withGettext(n(161))(d)),t.styles=p},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(295),s=n(1137),l=n(8),u=n(132),c=n(50),d=n(27),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=c.memoize(function(e){return function(){var n=t.props,r=n.onCarClick;!n.disabled&&r&&r(e)}}),t.handleStarClick=c.memoize(function(e){return function(){var n=t.props,r=n.onMainIDChange;!n.disabled&&r&&r(e.id)}}),t.handleRemove=c.memoize(function(e){return function(){var n=t.props,r=n.onValueChange,o=n.disabled,i=n.value.filter(function(t){return t!==e});!o&&r&&r(i)}}),t.handleAddNew=function(e){if(e){var n=t.props,r=n.onValueChange,o=n.value,i=n.disabled,a=c.uniqBy(o.concat([e]),function(e){return e.id});!i&&e&&r&&r(a)}},t}return r(t,e),t.prototype.renderItems=function(e){var t=this,n=this.props,r=n.ctx,i=n.value,a=n.disabled;return o.createElement("div",{key:"items"},i.map(function(e){return o.createElement(s.default,{ctx:r,key:e.id,value:e,disabled:a,active:e.id===t.props.mainID,onClick:t.handleClick(e),onSetMain:t.handleStarClick(e),onRemove:t.handleRemove(e)})}))},t.prototype.renderInput=function(e){var t=this.props,n=t.ctx,r=t.classes,i=t.disabled,s=t.error;return o.createElement("div",{className:r.input},o.createElement(u.AutoComplete,{ctx:n,value:null,disabled:i,error:s,onValueChange:this.handleAddNew,source:a.resource,printItem:function(e){return e?e.color+" "+e.brand+" "+e.plate:""},placeholder:e("Add a car"),nonNull:!0}))},t.prototype.renderEmpty=function(e){var t=this.props.classes;return o.createElement("div",{key:"empty",className:t.empty},e("No cars yet"),",")},t.prototype.renderError=function(){var e=this.props,t=e.classes,n=e.error;return o.createElement("span",{className:t.error},n)},t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.className,a=e.value,s=i(n.root,r);return o.createElement("div",{className:s},a.length?this.renderItems(t):this.renderEmpty(t),this.renderInput(t),this.renderError())},t}(o.Component);function f(e){var t=e.spacing.unit;return{dialog:{maxWidth:450},editActions:{"& > *:first-child":{flex:"10 10 100%"},"& > *:first-child + *":{flex:"0 0 auto"}},empty:{padding:"0 "+2*t+"px"},input:{padding:"0 "+2*t+"px"},error:{padding:"0 "+2*t+"px"}}}t.default=l.default(f)(d.withGettext(n(161))(p)),t.styles=f},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(11),s=n(50),l=n(48),u=n(73),c=n(8),d=n(285),p=n(113),f=n(27),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleRemove=function(e){e.stopPropagation(),t.props.onRemove&&t.props.onRemove()},t.handleSetMain=function(e){e.stopPropagation(),t.props.onSetMain&&t.props.onSetMain()},t.preventBubbling=function(e){e.stopPropagation()},t}return r(t,e),t.prototype.secondaryHeading=function(e){var t=this.props.value,n=[],r=s.take(t.attributes,5);t.id&&n.push(f.sprintf(e("id: %s"),t.id)),r.forEach(function(e){return n.push(e.name)});var o=n.join(", ");return t.attributes.length>5?o+"…":o},t.prototype.render=function(){var e,t=this.props,n=t.__,r=t.classes,o=t.className,s=t.value,u=t.disabled,c=t.onClick,d=s.color+" "+s.brand+" "+s.plate,f=this.secondaryHeading(n),h=a(r.root,o,((e={})[r.disabled]=u,e));return i.createElement(l.ButtonBase,{className:h,onClick:c,focusRipple:!0,disableTouchRipple:!0},i.createElement(l.ListItem,{className:r.listItem},i.createElement(m,{onMouseDown:this.preventBubbling,onClick:this.handleSetMain,checked:this.props.active,"data-rh":n("Set as main")}),i.createElement(l.Avatar,null,i.createElement(p.default,null,"directions_car")),i.createElement(l.ListItemText,{primary:d,secondary:f}),i.createElement(l.ListItemSecondaryAction,{className:r.secondaryAction},i.createElement(p.default,{"data-rh":n("Remove"),onClick:this.handleRemove},"close"))))},t}(i.Component);t.default=c.default(g)(f.withGettext(n(161))(h));var m=function(e){var t=i.createElement(p.default,null,"radio_button_unchecked"),n=i.createElement(p.default,{color:"primary"},"radio_button_checked");return i.createElement(d.default,o({},e,{icon:t,checkedIcon:n}))};function g(e){var t=e.spacing.unit;return{root:{padding:0,background:"transparent",textAlign:"initial",display:"block",width:"100%",cursor:"default",listStyle:"none","&:hover":{background:u.fade(e.palette.text.primary,.05)}},listItem:{padding:[1.5*t,3*t,1.5*t,0],"& > *:first-child":{flex:"0 0 auto"}},disabled:{cursor:"not-allowed"},secondaryAction:{right:2*t-.5*t}}}t.styles=g},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n=0,r=e;n<r.length;n++){var o=t(r[n]);if(void 0!==o)return o}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(44),a=n(8),s=n(27),l=n(11),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e,t=this.props,n=t.model,r=t.classes,a=t.noPadding,s=t.__,u=l(r.header,((e={})[r.noPadding]=a,e));return o.createElement("div",{className:u},o.createElement("h2",null,i.isNew(n.initial)?s("New car"):s("Edit a car")))},t}(i.PureComponent);function c(e){var t=e.spacing.unit;return{header:{padding:[0,2*t],display:"flex",alignItems:"center",height:7*t,width:"100%",justifyContent:"space-between","& h2":{fontWeight:400,fontSize:22,margin:0}},noPadding:{padding:0,height:"initial"}}}t.default=a.default(c)(s.withGettext(n(215))(u)),t.styles=c},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(50),a=n(48),s=n(44),l=n(8),u=n(27),c=n(407),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.model,l=e.dispatch,u=e.classes,d=e.model,p=d.pending,f=d.modified,h=c.isReadOnly(n,r),m=null!==f,g=c.form.get(r),v=c.form.validate(g),y=i.isEmpty(v);return o.createElement("div",{className:u.buttons},o.createElement("div",null,o.createElement(a.Button,{size:"small",disabled:!m,onClick:function(){return l({tag:"Reset"})},children:t("Reset")})),o.createElement("div",null,o.createElement(a.Button,{color:"primary",disabled:!y||!m||p||h,variant:"raised",size:"small",onClick:function(){return l(s.isNew(r.initial)?{tag:"Post"}:{tag:"Patch"})},children:t("Save")})))},t}(s.PureComponent);function p(e){var t=e.spacing.unit;return{buttons:{flex:"0 0 auto",display:"flex",width:"100%",boxSizing:"border-box",padding:[t,2*t,t,t],justifyContent:"space-between"}}}t.default=l.default(p)(u.withGettext(n(215))(d)),t.styles=p},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(50),a=n(48),s=n(44),l=n(8),u=n(27),c=n(407),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.ctx,r=e.model,l=e.dispatch,u=e.classes,d=e.model,p=d.pending,f=d.modified,h=c.isReadOnly(n,r),m=null!==f,g=c.form.get(r),v=c.form.validate(g),y=i.isEmpty(v);return o.createElement("div",{className:u.dialogButtons},o.createElement("div",null,o.createElement(a.Button,{size:"small",disabled:!m,onClick:function(){return l({tag:"Reset"})},children:t("Reset")})),o.createElement("div",null,o.createElement(a.Button,{color:"primary",disabled:!y||!m||p||h,onClick:function(){return l(s.isNew(r.initial)?{tag:"Post"}:{tag:"Patch"})},children:t("Save")})))},t}(s.PureComponent);function p(e){var t=e.spacing.unit;return{buttons:{flex:"0 0 auto",display:"flex",width:"100%",boxSizing:"border-box",padding:[t,2*t,t,t],justifyContent:"space-between"}}}t.default=l.default(p)(u.withGettext(n(215))(d)),t.styles=p},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(9),s=n(8),l=n(27),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={now:a()},t.timer=null,t.loop=function(){var e=a();t.setState({now:e}),t.timer=setTimeout(t.loop,1e3*(60-e.seconds()))},t}return r(t,e),t.prototype.componentWillMount=function(){this.loop()},t.prototype.componentWillUmount=function(){this.timer=null,this.timer&&clearTimeout(this.timer)},t.prototype.render=function(){var e=this.props,t=e.__,n=e.className,r=e.classes,a=this.state.now,s=i(r.root,n);return o.createElement("div",{className:s},o.createElement("div",{className:r.time},a.format(t("hh:mm A"))),o.createElement("div",{className:r.claim},t("local server time")))},t}(o.Component);function c(e){return{root:{},time:{fontSize:44,fontWeight:300,textShadow:"-1px 1px 8px #ffc, 1px -1px 8px #fff",color:e.palette.text.primary,textAlign:"right"},claim:{textAlign:"right",textShadow:"-1px 1px 8px #ffc, 1px -1px 8px #fff",color:e.palette.text.primary,fontSize:14}}}t.default=s.default(c)(l.withGettext(n(186))(u)),t.styles=c},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(36),s=n(274),l=n(50),u=n(144),c=n(187),d=n(44),p=n(1144),f=n(11),h=n(8),m=n(1145);t.externalModePrio={"Common/init":0,"Common/order":100,"Input/orders":10,"Input/drivers":10},t.defaultInitialLocation={center:[56.84976,53.20448],zoom:8},t.init=function(e){return a.eff.record({controlMode:a.eff.of({tag:"Common/init"}),mode:a.eff.of({tag:"Common/init"}),mapSource:m.initMapSource(e,e.gisMapType),centerZoom:t.cache.read().onError(function(){return a.eff.of(t.defaultInitialLocation)})})},t.update=d.compose(function(e){return function(t,n,r){var i=e(t,n,r),a=i[0],s=i[1];if(v(r.mode,a.mode)){var l=y(a.mode);if(!l)return[a,s];var u=document.body,c=u.getBoundingClientRect(),d=c.width,f=c.height,h=function(e,t){if("Output/drivers"===e.tag&&e.active){var n=e.drivers.find(function(t){return t.id===e.active});if(n&&n.coordinates)return[n.coordinates.latitude,n.coordinates.longitude]}return p.center(t)}(a.mode,l),m=.5*d-.5*(d-786),g=p.getContainerScale(l,[Math.max(d-786-48,1e-10),Math.max(f-48,1e-10)]);return h[1]-=m/Math.pow(2,g),[o({},a,{centerZoom:{zoom:g,center:h}}),s]}return[a,s]}},function(e){return function(t,n,r){var i=e(t,n,r),s=i[0],u=i[1];return function(e,t){return!("Input/drivers"===e.tag&&"Input/drivers"===t.tag&&l.isEqual(e.query,t.query)||l.isEqual(e,t))}(s.controlMode,r.controlMode)?[o({},s,{mode:r.mode}),a.cmd.batch(u,a.cmd.of({tag:"Update",mode:s.controlMode}))]:"Input/drivers"===s.controlMode.tag&&"Output/drivers"===s.mode.tag&&s.mode.active!==s.controlMode.active?[o({},s,{mode:o({},s.mode,{active:s.controlMode.active})}),u]:[s,u]}})(function(e,t,n){if("function"==typeof t)return[t(n),a.noop];switch(t.tag){case"Update":if(!function(e,t){return"Input/drivers"===e.tag&&"Input/drivers"===t.tag?l.isEqual(e.query,t.query):l.isEqual(e,t)}(t.mode,n.controlMode))return[n,a.noop];if(_(t.mode))return[o({},n,{mode:t.mode}),a.noop];var r=function(e){return{tag:"Update/success",mode:n.controlMode,data:e}};return[n,function(e,t){switch(t.tag){case"Input/orders":var n=o({},t.query,{limit:0,offset:0});return u.gisResource.getCollection(e,n).mapEff(function(e){return{tag:"Output/orders",query:n,orders:e}});case"Input/drivers":var r=o({},t.query,{limit:0,offset:0,hasCoordinates:!0});return c.gisResource.getCollection(e,r).mapEff(function(e){return e.filter(function(e){return"not_available"!==e.state.state_type})}).mapEff(function(e){return{tag:"Output/drivers",active:t.active,query:r,drivers:e}})}}(e,t.mode).perform(d.onFailure,r)];case"Update/success":return[o({},n,{mode:t.data}),a.cmd.of({tag:"Update",mode:t.mode}).delay(e.mapUpdateInterval)];case"MapSource/change":r=function(e){return{tag:"MapSource/success",source:e}};var i=m.initMapSource(e,t.source).perform(d.onFailure,r);return[n,i];case"MapSource/success":return[o({},n,{mapSource:t.source}),a.noop]}});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.componentWillUnmount=function(){},t.prototype.componentWillReceiveProps=function(e){var t=this.props,n=t.ctx,r=t.mode,i=e.ctx,a=e.mode,s=e.dispatch;n.gisMapType!==i.gisMapType&&s({tag:"MapSource/change",source:i.gisMapType}),function(e,t){return!l.isEqual(e,t)}(r,a)&&s(function(e){return o({},e,{controlMode:a})})},t.prototype.render=function(){var e,t=this.props,n=t.ctx,r=t.model,o=t.className,a=t.classes,s=t.requestCoordinates,l=t.onCoordinatesResponse,u=t.onAddressChange,c=f(a.root,o,((e={})[a.requestCoordinates]=s,e));return i.createElement("div",{className:c,key:"root"},i.createElement(m.View,{ctx:n,state:r,onPickCoordinates:s?l:void 0,onAddressChange:u}))},t}(i.Component);function v(e,t){if(e.tag!==t.tag)switch(t.tag){case"Common/init":return!1;case"Common/order":case"Output/orders":case"Output/drivers":return!0}return"Common/order"===t.tag?!u.addressCoordinatesEqual(e.order.addresses,t.order.addresses):"Output/drivers"===t.tag&&"Output/drivers"===e.tag&&t.active!==e.active}function y(e){switch(e.tag){case"Common/init":return null;case"Common/order":var t=d.filterMap(e.order.addresses,function(e){return d.coordsEmpty(e.coordinates)?null:[e.coordinates.latitude,e.coordinates.longitude]});return e.order.driver&&!d.coordsEmpty(e.order.driver.coordinates)&&t.push([e.order.driver.coordinates.latitude,e.order.driver.coordinates.longitude]),p.bounds(t);case"Output/orders":return p.bounds(Array.prototype.concat.apply([],e.orders.map(function(e){return e.addresses})),function(e){return d.coordsEmpty(e.coordinates)?null:[e.coordinates.latitude,e.coordinates.longitude]});case"Output/drivers":return p.bounds(e.drivers,function(e){return d.coordsEmpty(e.coordinates)?null:[e.coordinates.latitude,e.coordinates.longitude]})}}function _(e){return"Common"===e.tag.split("/")[0]}function b(e){return{root:{width:"100%",height:"100%"},popup:{position:"absolute",backgroundColor:"white",padding:e.spacing.unit,borderRadius:2,border:"1px solid "+e.palette.divider,bottom:12,left:-50,minWidth:280}}}t.View=h.default(b)(g),t.shouldUpdateCenterZoom=v,t.calculateBounds=y,t.isCommonMode=_,t.styles=b;var C=a.decode.record({zoom:a.decode.nat,center:a.decode.tuple(a.decode.float,a.decode.float)});t.cache=new s.Cache("gismap",C)},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={x:128,y:128},r=256/360,o=256/(2*Math.PI);function i(e){var t={x:null,y:null},i=n;t.x=i.x+e[1]*r;var a=function(e,t,n){return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),e}(Math.sin(function(e){return e*(Math.PI/180)}(e[0])),-.9999,.9999);return t.y=i.y+.5*Math.log((1+a)/(1-a))*-o,t}function a(e){var t=n,i=(e.x-t.x)/r,a=(e.y-t.y)/-o;return[function(e){return e/(Math.PI/180)}(2*Math.atan(Math.exp(a))-Math.PI/2),i]}t.fromLatLngToPoint=i,t.fromPointToLatLng=a,t.moveLatLngByPixels=function(e,t,n){var r=i(e);return r.x+=t,r.y+=n,a(r)};var s=window,l=document,u=l.documentElement,c=l.getElementsByTagName("body")[0],d=s.innerWidth||u.clientWidth||c.clientWidth,p=256;t.chooseZoom=function(e){var t=e.getNorthEast(),n=e.getSouthWest().lng(),r=t.lng()-n;return r<0&&(r+=360),Math.round(Math.log(360*d/r/p)/Math.LN2)},t.bounds=function(e,t){void 0===t&&(t=function(e){return e});for(var n=[null,null],r=[null,null],o=0,i=e;o<i.length;o++){var a=t(i[o]);null!==a&&((null===n[0]||a[0]<n[0])&&(n[0]=a[0]),(null===n[1]||a[1]<n[1])&&(n[1]=a[1]),(null===r[0]||a[0]>r[0])&&(r[0]=a[0]),(null===r[1]||a[1]>r[1])&&(r[1]=a[1]))}return null===n[0]||null===n[1]||null===r[0]||null===r[1]?null:[n,r]},t.union=function(e,t){var n=e[0],r=e[1],o=t[0],i=t[1];return[[Math.min(n[0],o[0]),Math.min(n[1],o[1])],[Math.max(r[0],i[0]),Math.min(r[1],i[1])]]},t.center=function(e){var t=e[0],n=e[1];return[t[0]+.5*(n[0]-t[0]),t[1]+.5*(n[1]-t[1])]},t.getContainerScale=function(e,t,n){void 0===n&&(n={inscribe:!0});var r=Math.max(Math.abs(e[1][0]-e[0][0]),1e-10),o=Math.max(Math.abs(e[1][1]-e[0][1]),1e-10),i=Math.min(Math.max(0,n.inscribe?Math.min(a(t[1]/r),a(t[0]/o)):Math.max(a(t[1]/r),a(t[0]/o))),15);return n.preciseZoom?i:Math.floor(i+1e-10);function a(e){return Math.log(e)*Math.LOG2E}},t.chooseZoom2=function(e){var t=e[0],n=e[1],r=t[1],o=n[1]-r;return o<0&&(o+=360),Math.round(Math.log(360*d/o/p)/Math.LN2)}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(54),s=n(1146),l=n(36),u=n(352),c=n(1255),d=n(409),p=n(348),f=n(1148),h=n(69),m=n(109),g=n(1256),v=n(84),y=n(255),_=n(90),b=n(190),C=n(1149),w=n(101),E=n(124),S=n(256),T=n(20),O=n(722),A=n(48),x=n(1259),k=n(1150),R=n(1254),I=n(20),D=n(1151),N=n(406),P=n(27),j=n(50),L=n(68),M=n(0),U=n(206),F=n(11),q=n(260),B=n(244),H=n(44);n(1152),R.default.defs("EPSG:3395","+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"),k.register(R.default),I.get("EPSG:3395").setExtent([-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244]);var V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={feature:null,popupVisible:!1},t.map=null,t.olgm=null,t.vectorLayer=null,t.routeLayer=null,t.translate=null,t.popupRef=i.createRef(),t.overlay=null,t.driverPrevCoordinates={},t.driverRotations={},t.handlePopupRef=function(e){t.popupRef.current=e,t.overlay.setElement(e)},t.handleMapRef=function(e){if(e){var n=t.props,r=n.state,i=n.onAddressChange,a=r.centerZoom,s=a.center,l=a.zoom,u=r.mapSource,d=r.mode,p=t;t.vectorLayer=new w.default({source:new C.default({source:new E.default}),style:function(e){return e?1===e.values_.features.length?e.values_.features[0].getStyle():new _.default({image:new D.Circle({radius:16,fill:new D.Fill({color:"white"}),stroke:new D.Stroke({color:[33,150,243],width:4})}),text:new D.Text({text:e.values_.features.length+"",font:"bold 14px sans-serif"})}):new _.default({image:new D.Circle({radius:16,fill:new D.Fill({color:"white"}),stroke:new D.Stroke({color:[33,150,243],width:4})})})}}),t.vectorLayer.setZIndex(10),t.routeLayer=new w.default({source:new E.default}),t.routeLayer.setZIndex(9),t.translate=new $,t.overlay=new y.default({position:[0,0],positioning:"center-center",element:document.getElementById("marker"),stopEvent:!1}),t.map=new S.default({controls:[new O.FullScreen],target:e,loadTilesWhileInteracting:!0,layers:[t.routeLayer,t.vectorLayer],interactions:q.defaults().extend([t.translate]),view:new c.View({minZoom:3,maxZoom:18,center:T.fromLonLat([s[1],s[0]],"yandex"===u.tag?"EPSG:3395":void 0),zoom:l})}),t.map.addOverlay(t.overlay),t.map.on("singleclick",function(e){var t=this.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(t&&t.get("features")){var n=t.get("features"),r=M.boundingExtent(n.map(function(e){return e.getGeometry().getCoordinates()}));n.length>1&&p.map.getView().fit(r,{easing:L.easeOut,duration:500})}if(!t&&p.props.onPickCoordinates){var o=T.toLonLat(e.coordinate,p.map.getView().getProjection()),i=o[0],a=[o[1],i];p.props.onPickCoordinates(a)}}),t.translate.on("translateend",function(e){e.features.forEach(function(t){var n=t.get("features");if(n&&1===n.length){var r=n[0];if(r instanceof Y&&i){var a=T.toLonLat(e.coordinate,p.map.getView().getProjection()),s=a[0],l=a[1];i(o({},r.address,{coordinates:{longitude:s,latitude:l}}))}}})}),t.map.on("pointermove",function(e){var t=this.forEachFeatureAtPixel(e.pixel,function(e,t){return e});if(this.getTarget().style.cursor=t?"pointer":"",p.popupRef.current){var n=t&&t.get("features")?1===t.get("features").length?t.get("features")[0]:null:t||null;if(n){p.setState({feature:n,popupVisible:!0});var r=n.getGeometry(),o=r instanceof h.default?r.getCoordinates():e.coordinate;p.overlay.setPosition(o)}else p.setState({popupVisible:!1})}}),t.setSource(u),z(t,t.vectorLayer,t.routeLayer,d),setTimeout(function(){return t.map.updateSize()},0)}},t.handleOrderOpenClick=j.memoize(function(e){return function(){U.dispatchExternal({tag:"@Order/open",id:e.id}).subscribe()}}),t.handleDriverOpenClick=function(e){return function(t){U.dispatchExternal({tag:"@Driver/open",id:e.id}).subscribe()}},t.renderPopup=B.default(function(e,n,r,o){if(e instanceof W){var a=e.order;return i.createElement("div",{className:n.markerPopup},i.createElement("table",{className:n.infoWindowTable},i.createElement("tbody",null,i.createElement("tr",null,i.createElement("td",null,o("ID"),":"),i.createElement("td",null,a.id)),i.createElement("tr",null,i.createElement("td",null,o("Phone"),":"),i.createElement("td",null,a.phone)),i.createElement("tr",null,i.createElement("td",null,o("Route"),":"),i.createElement("td",null,function(e){return e.length<=2?e:[e[0],e[e.length-1]]}(a.addresses).map(function(e){return e.address}).join(" → "))),i.createElement("tr",null,i.createElement("td",null,o("Status"),":"),i.createElement("td",null,a.state.name)))),i.createElement("div",{className:n.linkWrapper},i.createElement("a",{href:"javascript://void 0",onClick:t.handleOrderOpenClick(a)},o("Open card"))))}if(e instanceof K){var s=e.driver,l=s.crew_group?s.crew_group.name:o("No cab group"),c=N.currencyFormatter(r);return i.createElement("div",{className:n.markerPopup},i.createElement("table",{className:n.infoWindowTable},i.createElement("tbody",null,i.createElement("tr",null,i.createElement("td",null,o("Alias"),":"),i.createElement("td",null,s.call)),i.createElement("tr",null,i.createElement("td",null,o("Full name"),":"),i.createElement("td",null,s.name)),i.createElement("tr",null,i.createElement("td",null,o("Cab group"),":"),i.createElement("td",null,l)),i.createElement("tr",null,i.createElement("td",null,o("Status"),":"),i.createElement("td",null,s.state.name)),i.createElement("tr",null,i.createElement("td",null,o("Balance on account"),":"),i.createElement("td",null,c(s.balance))))),i.createElement("div",{className:n.linkWrapper},i.createElement("a",{href:"javascript://void 0",onClick:t.handleDriverOpenClick(s)},o("Open card"))))}if(e instanceof Y){var d=e.address;return i.createElement("div",{className:n.inlinePopup},d.address)}if(e instanceof J){a=e.order;return e.route===a.route?i.createElement("div",{className:n.inlinePopup},o("Real route")):i.createElement("div",{className:n.inlinePopup},o("Prior route"))}return u.absurd(e)}),t}return r(t,e),t.prototype.updateDriverCoordinates=function(e){var t=this;e.forEach(function(e){H.coordsEmpty(e.coordinates)||(t.driverPrevCoordinates[e.id]=e.coordinates)})},t.prototype.getDriverRotation=function(e){e:if(!H.coordsEmpty(e.coordinates)&&e.id in this.driverPrevCoordinates&&this.map){var t=this.driverPrevCoordinates[e.id],n=this.map.getPixelFromCoordinate(T.fromLonLat([t.longitude,t.latitude])),r=n[0],o=n[1],i=this.map.getPixelFromCoordinate(T.fromLonLat([e.coordinates.longitude,e.coordinates.latitude])),a=i[0]-r,s=i[1]-o;if(0===a&&0===s)break e;var l=Math.atan2(s,a);return this.driverRotations[e.id]=l,l}if(e.id in this.driverRotations)return this.driverRotations[e.id];var u=Math.random()*Math.PI*2;return this.driverRotations[e.id]=u,u},t.prototype.componentDidUpdate=function(e){var t=this,n=e.state,r=n.mapSource,o=n.mode,i=n.centerZoom,a=i.center,s=i.zoom,l=this.props.state,u=l.mapSource,c=l.mode,d=l.centerZoom,p=d.center,f=d.zoom;r.tag!==u.tag&&(this.removeSource(r),this.setSource(u),setTimeout(function(){return t.map.updateSize()},0)),a===p&&s===f||this.map.getView().animate({center:T.fromLonLat([p[1],p[0]]),zoom:f,duration:500,easing:L.easeOut}),j.isEqual(o,c)||(z(this,this.vectorLayer,this.routeLayer,c,o),setTimeout(function(){return t.map.updateSize()},0)),"Output/drivers"===c.tag&&this.updateDriverCoordinates(c.drivers),"Common/order"===c.tag&&c.order.driver&&this.updateDriverCoordinates([c.order.driver])},t.prototype.setSource=function(e){this.map.addLayer(e.layer),this.map.setView(this.map.getView()),"google"===e.tag&&(this.olgm=this.olgm||new g.default({map:this.map}),this.olgm.activate())},t.prototype.removeSource=function(e){this.map.removeLayer(e.layer),"google"===e.tag&&this.olgm&&this.olgm.deactivate()},t.prototype.render=function(){var e,t,n=this.props,r=n.classes,o=n.__,s=n.ctx,l=n.onPickCoordinates,u=this.state,c=u.feature,d=u.popupVisible,p=F(r.map,((e={})[r.pick]=l,e)),f=F("react-hint","react-hint--top",r.popup,((t={})[r.popupOrder]=c instanceof W||c instanceof Y,t[r.popupVisible]=d,t));return i.createElement("div",{className:r.root},i.createElement("div",{ref:this.handleMapRef,className:p}),i.createElement("div",{ref:this.handlePopupRef,className:f}),c&&this.popupRef.current&&a.createPortal(i.createElement("div",{className:r.popupContent+" react-hint__content"},this.renderPopup(c,r,s,o)),this.popupRef.current))},t}(i.Component);function z(e,t,r,o,i){var a=e.props.__;if(i&&i.tag!==o.tag&&(t.getSource().getSource().clear(),r.getSource().clear()),"Common/init"!==o.tag){if("Output/orders"===o.tag)return i&&t.getSource().getSource().clear(),void o.orders.forEach(function(e){var r=e.addresses[0].coordinates;if(r){var o=new W(e,{geometry:new h.default(T.fromLonLat([r.longitude,r.latitude]))});o.setStyle(new _.default({image:new b.default({anchor:[.5,1],src:n(695)}),text:new D.Text({font:"bold 11px sans-serif",text:P.sprintf(a("Order #%s"),e.id),stroke:new D.Stroke({color:"white",width:2})})})),t.getSource().getSource().addFeature(o)}});if("Output/drivers"===o.tag)return i&&t.getSource().getSource().clear(),void o.drivers.forEach(function(n){return G(e,t.getSource().getSource(),n)});if("Common/order"!==o.tag)return u.absurd(o);var s;i&&(t.getSource().getSource().clear(),r.getSource().clear()),o.order.addresses.forEach(function(e){var r=e.coordinates;if(r){var i=new Y(o.order,e,{geometry:new h.default(T.fromLonLat([r.longitude,r.latitude]))});i.setStyle(new _.default({image:new b.default({anchor:[.5,1],src:n(695)}),text:new D.Text({font:"bold 11px sans-serif",text:e.address,stroke:new D.Stroke({color:"white",width:2})})})),t.getSource().getSource().addFeature(i)}}),o.order.route&&o.order.route.length&&((s=new J(o.order,o.order.route,{geometry:new m.default(o.order.route.map(function(e){return T.fromLonLat([e.longitude,e.latitude])}))})).setStyle(new _.default({stroke:new D.Stroke({color:"#2196F3",width:5,opacity:.5})})),r.getSource().addFeature(s)),o.order.prior_route&&o.order.prior_route.length&&((s=new J(o.order,o.order.prior_route,{geometry:new m.default(o.order.prior_route.map(function(e){return T.fromLonLat([e.longitude,e.latitude])}))})).setStyle(new _.default({stroke:new D.Stroke({color:"#2196F399",width:5,opacity:.5})})),r.getSource().addFeature(s)),o.order.driver&&"finished"!==o.order.state.state_type&&"aborted"!==o.order.state.state_type&&G(e,t.getSource().getSource(),o.order.driver)}}function G(e,t,r,o){var i=e.props.__;o&&t.removeFeature(o);var a=r.coordinates;if(!a)return null;var s=new K(r,{geometry:new h.default(T.fromLonLat([a.longitude,a.latitude]))});return s.setStyle(new _.default({image:new b.default({anchor:[.5,.5],src:function(e){if("not_available"===e.state.state_type||"on_break"===e.state.state_type)return n(1159);if("waiting"===e.state.state_type)return n(1160);if("on_order"===e.state.state_type)return n(1161);return u.absurd(e.state.state_type)}(r),rotation:e.getDriverRotation(r)-.5*Math.PI}),text:new D.Text({offsetY:16,font:"bold 11px sans-serif",text:P.sprintf(i("Call «%s»"),r.call),stroke:new D.Stroke({color:"white",width:2})})})),void t.addFeature(s)}t.View=P.withGettext(n(1154))(A.withStyles(Q)(V)),t.initMapSource=function(e,t){if("google"===t)return s.importGoogleApi(e).chain(function(){var e=new p.default({source:new d.default({url:"http://mt{0-3}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}"})});return l.eff.of({tag:"google-xyz",layer:e})});if("yandex"===t){var n=new p.default({source:new d.default({url:"http://vec01.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}",projection:"EPSG:3395"})});return l.eff.of({tag:"yandex",layer:n})}if("openstreetmaps"===t)return n=new p.default({source:new f.default}),l.eff.of({tag:"openstreetmaps",layer:n});if("2gis"===t)return n=new p.default({source:new d.default({url:"http://tile0.maps.2gis.com/tiles?l=map&x={x}&y={y}&z={z}&v=3"})}),l.eff.of({tag:"2gis",layer:n});if("bing"===t)return n=new p.default({source:new x.default({key:e.bingMapsKey,imagerySet:"Road"})}),l.eff.of({tag:"bing",layer:n});return u.absurd(t)},t.renderDriver=G;var W=function(e){function t(t,n){var r=e.call(this,n)||this;return r.order=t,r}return r(t,e),t}(v.default);t.OrderFeature=W;var K=function(e){function t(t,n){var r=e.call(this,n)||this;return r.driver=t,r}return r(t,e),t}(v.default);t.DriverFeature=K;var Y=function(e){function t(t,n,r){var o=e.call(this,r)||this;return o.order=t,o.address=n,o}return r(t,e),t}(v.default);t.AddressFeature=Y;var J=function(e){function t(t,n,r){var o=e.call(this,r)||this;return o.order=t,o.route=n,o}return r(t,e),t}(v.default);t.RouteFeature=J;var $=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){var t=e.get("features");if(t&&1===t.length&&t[0]instanceof Y)return e})},t}return r(t,e),t}(q.Translate);function Q(e){var t=e.spacing.unit;return{root:{width:"100%",height:"100%"},map:{width:"100%",height:"100%"},popupContent:{position:"absolute",bottom:4,fontSize:12,transform:"translateX(-50%)","& a":{fontWeight:600,color:"white"}},popup:{position:"absolute",transition:"visibility 0.3s linear,opacity 0.3s linear",visibility:"hidden",bottom:t,left:.8*-t+1,opacity:0,width:0,height:0,"&:hover":{visibility:"visible !important",opacity:"1 !important"},"&:after":{}},popupOrder:{bottom:4*t},popupVisible:{visibility:"visible",opacity:1},inlinePopup:{whiteSpace:"nowrap"},markerPopup:{"& table":{cellPadding:0,cellSpacing:0}},infoWindowTable:{borderSpacing:0,borderCollapse:"collapse"},pick:{cursor:"crosshair"},linkWrapper:{textAlign:"center"},"@global":{".ol-full-screen":{top:"initial",bottom:".5em"}}}}t.styles=Q},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(36);t.importGoogleApi=function(e){return r.eff.fromCallback(function(t){if("undefined"!=typeof google&&google.maps)t(r.success(null));else{var n=document.createElement("script"),o=e.googleMapKey,i=e.locale.split("-"),a=i[0],s=i[1];n.id="81b874f9-69aa-41dd-8c9d-af8ac5cbd794",n.type="text/javascript",n.onerror=function(){return t(r.failure({tag:"GoogleMapInitFailure"}))},n.onload=function(){return t(r.success(null))},document.body.appendChild(n),n.src=r.http.join("https://maps.googleapis.com/maps/api/js",{key:o,language:a,region:s})}})}},,,,,,,,function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1155))},function(e,t,n){var r={"./de.po":1156,"./lt.po":1157,"./ru.po":1158};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1155},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},ID:["ID"],Phone:["Telefon"],Route:["Route"],Status:["Status "],"No cab group":["Keine Gruppe "],Alias:["Rufzeichen"],"Cab group":["Gruppe der Besatzung"],"Full name":["Nach-, Vor- und Vatersname"],"Balance on account":["Bilanz"],"Open card":["Karte öffnen"],"Starting point":["Beginn der Route"],"End point":["Ende der Route "],"Intermediate point":["Stoppen"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},ID:["ID"],Phone:["Telefonas"],Route:["Maršrutas"],Status:["Būsena"],"No cab group":["Be grupės"],Alias:["Slapyvardis"],"Cab group":["Ekipažo grupė"],"Full name":["Pilnas vardas"],"Balance on account":["Balansas"],"Open card":["Atidaryti kortelę"],"Starting point":["Pradėti maršrutą"],"End point":["Maršruto pabaiga"],"Intermediate point":["Sustoti"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},ID:["Ид"],Phone:["Телефон"],Route:["Маршрут"],Status:["Статус"],"No cab group":["Без группы"],Alias:["Позывной"],"Cab group":["Группа экипажа"],"Full name":["ФИО"],"Balance on account":["Баланс"],"Open card":["Открыть карточку"],"Starting point":["Начало маршрута"],"End point":["Конец маршрута"],"Intermediate point":["Остановкаa"],"Real route":["Фактический маршрут"],"Prior route":["Предварительный маршрут"],"Call «%s»":["Позывной «%s»"],"Order #%s":["Заказ #%s"]}}}},function(e,t,n){e.exports=n.p+"3e55c80f8b6133b384166eae1cc371b0.svg"},function(e,t,n){e.exports=n.p+"1f9fbc8a96a46f4af75a43cfe346cbe5.svg"},function(e,t,n){e.exports=n.p+"7cf5546916f9485de10e60ff4f33d835.svg"},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(48),s=n(50),l=n(36),u=n(99),c=n(99),d=n(8),p=n(11),f=n(294),h=n(27),m=n(245),g=h.Translations.fromPO(n(696));t.initFlags=function(e){return null},t.init=function(e,t,n){var r=e.locale,o=e.gisMapType,i=e.oktellReconnectTimeout,a=e.disableAddressSearch,s=e.autoAnswerTimeout,u={locale:r,gisMapType:o,oktellReconnectTimeout:i,disableAddressSearch:a,autoAnswerTimeout:s,cityTabCycle:e.cityTabCycle,openOrderCardOn:e.openOrderCardOn,fullFeaturedOnURL:e.fullFeaturedOnURL,goBackBehaviour:e.goBackBehaviour},c=0!==i&&-1===y.indexOf(i),d=0!==i&&-1===_.indexOf(s);return l.eff.of({initial:u,patch:{},pending:!1,customTimeout:c,customTimeout2:d})},t.update=function(e,n,r){switch(n.tag){case"Pending/start":return[o({},r,{pending:!0}),l.noop];case"Pending/stop":return[o({},r,{pending:!1}),l.noop];case"Error":return[r,u.notifyError(n.error)];case"Patch":var i=t.formL.get(r);return[r,l.eff.callback(function(){return c.contextStream.next(o({},e,i))}).chainEff(function(){return c.contextCache.save(i)}).perform(function(e){return{tag:"Error",error:e}},function(){return{tag:"Patch/success"}})];case"Patch/success":var a=t.formL.get(r);return[o({},r,{initial:a,patch:{}}),u.notifySuccess(g.__("Settings saved"))];case"Reset":return[o({},r,{patch:{}}),l.noop];case"Change":var s=n.key,d=n.value;return[t.formL.modify(r,function(e){var t;return o({},e,((t={})[s]=d,t))}),l.noop];case"CustomTimeout/toggle":return[o({},r,{customTimeout:!r.customTimeout}),l.noop];case"CustomTimeout2/toggle":return[o({},r,{customTimeout2:!r.customTimeout2}),l.noop]}},t.formL=new l.optics.Lens(s.memoize(function(e){var t=e.initial,n=e.patch;return s.isEmpty(n)?t:o({},t,n)}),function(e,t){var n=Object.keys(e.initial).reduce(function(n,r){return!s.isEqual(e.initial[r],t[r])&&(n[r]=t[r]),n},{});return o({},e,{patch:n})});var v=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleTimeoutChange=function(e){var n=e.target.value,r=t.props,o=r.dispatch;r.model.customTimeout?(o({tag:"CustomTimeout/toggle"}),o({tag:"Change",key:"oktellReconnectTimeout",value:n})):o("custom"===n?{tag:"CustomTimeout/toggle"}:{tag:"Change",key:"oktellReconnectTimeout",value:n})},t.handleTimeoutChange2=function(e){var n=e.target.value,r=t.props,o=r.dispatch;r.model.customTimeout2?(o({tag:"CustomTimeout2/toggle"}),o({tag:"Change",key:"autoAnswerTimeout",value:n})):o("custom"===n?{tag:"CustomTimeout2/toggle"}:{tag:"Change",key:"autoAnswerTimeout",value:n})},t}return r(n,e),n.prototype.render=function(){var e=this.props,t=e.classes,n=e.className;if(e.dialog)return this.renderDialog();var r=p(n,t.root);return i.createElement("div",{className:r},i.createElement("div",{className:t.formWrapper},this.renderForm()),i.createElement("div",{className:t.footer},this.renderButtons()))},n.prototype.renderDialog=function(){var e=this.props.__;return i.createElement(i.Fragment,null,i.createElement(a.DialogTitle,null,e("Settings")),i.createElement(a.DialogContent,null,this.renderForm()),i.createElement(a.DialogActions,null,this.renderButtons()))},n.prototype.renderButtons=function(){var e=this.props,t=e.__,n=e.model,r=e.classes,o=e.dispatch,l=e.dialog?"flat":"raised";return i.createElement(i.Fragment,null,i.createElement(a.Button,{className:r.shiftLeft,onClick:function(){return o({tag:"Reset"})},size:"small",disabled:s.isEmpty(n.patch)},t("Reset")),i.createElement(a.Button,{onClick:function(){return o({tag:"Patch"})},size:"small",color:"primary",variant:l,disabled:s.isEmpty(n.patch)},t("Save")))},n.prototype.renderForm=function(){var e=this.props,n=e.__,r=e.model,o=e.classes,s=e.dispatch,l=t.formL.get(r);return i.createElement("form",{className:o.form},i.createElement("div",null,i.createElement(a.InputLabel,null,n("Locale")),i.createElement(a.Select,{value:l.locale,onChange:function(e){return s({tag:"Change",key:"locale",value:e.target.value})}},m.__INFO__.locales.map(function(e){return i.createElement(a.MenuItem,{key:e,value:e},i.createElement("span",{className:o.languageItem},i.createElement("span",{dangerouslySetInnerHTML:{__html:b[e]}}),function(e){switch(e){case"ru-RU":return"Русский";case"en-US":return"English (USA)";case"en-GB":return"English (UK)";case"de-DE":return"Deutsch";case"lt-LT":return"Lietuviškai";default:return""}}(e)))}))),i.createElement("div",null,i.createElement(a.InputLabel,null,n("Map provider")),i.createElement(a.Select,{value:l.gisMapType,onChange:function(e){return s({tag:"Change",key:"gisMapType",value:e.target.value})}},i.createElement(a.MenuItem,{value:"google"},"Google.Maps"),i.createElement(a.MenuItem,{value:"yandex"},"Yandex карты"),i.createElement(a.MenuItem,{value:"openstreetmaps"},"OpenStreetMaps"),i.createElement(a.MenuItem,{value:"2gis"},"2GIS"),i.createElement(a.MenuItem,{value:"bing"},"Bing"))),i.createElement("div",null,i.createElement(a.InputLabel,null,n("Call center re-register interval")),i.createElement(a.Select,{value:r.customTimeout?"custom":l.oktellReconnectTimeout,onChange:this.handleTimeoutChange},i.createElement(a.MenuItem,{key:0,value:0},n("Don't re-register")),y.map(function(e){return i.createElement(a.MenuItem,{key:e,value:e},h.sprintf(n("%d min"),e/6e4|0))}),i.createElement(a.MenuItem,{key:"custom",value:"custom"},n("Custom"))),r.customTimeout&&i.createElement(f.default,{inputProps:{min:5},value:l.oktellReconnectTimeout/6e4|0,onChange:function(e){return s({tag:"Change",key:"oktellReconnectTimeout",value:6e4*Number(e.target.value)})},type:"number"})),i.createElement("div",null,i.createElement(a.InputLabel,null,n("Open order card on")),i.createElement(a.Select,{value:l.openOrderCardOn,onChange:function(e){return s({tag:"Change",key:"openOrderCardOn",value:e.target.value})}},i.createElement(a.MenuItem,{key:"dont-open",value:"dont-open"},n("Don't open")),i.createElement(a.MenuItem,{key:"receive",value:"receive"},n("When receive call")),i.createElement(a.MenuItem,{key:"answer",value:"answer"},n("When answer call")))),i.createElement("div",null,i.createElement(a.InputLabel,null,n("Auto answer timeout")),i.createElement(a.Select,{value:r.customTimeout2?"custom":l.autoAnswerTimeout,onChange:this.handleTimeoutChange2},i.createElement(a.MenuItem,{key:0,value:0},n("0 sec — Immediate auto answer")),_.map(function(e){return i.createElement(a.MenuItem,{key:e,value:e},h.sprintf(n("%d sec","%d sec",void 0,e/1e3|0),e/1e3|0))}),i.createElement(a.MenuItem,{key:"custom",value:"custom"},n("Custom"))),r.customTimeout2&&i.createElement(f.default,{value:l.autoAnswerTimeout/1e3|0,onChange:function(e){return s({tag:"Change",key:"autoAnswerTimeout",value:1e3*Number(e.target.value)})},type:"number"})),i.createElement("div",null,i.createElement(a.InputLabel,null,n("Disable address search")),i.createElement("div",null,i.createElement(a.Switch,{checked:l.disableAddressSearch,onChange:function(e,t){return s({tag:"Change",key:"disableAddressSearch",value:t})}}))),i.createElement("div",null,i.createElement(a.InputLabel,null,n("City field receives tab focus")),i.createElement("div",null,i.createElement(a.Switch,{checked:l.cityTabCycle,onChange:function(e,t){return s({tag:"Change",key:"cityTabCycle",value:t})}}))),i.createElement("div",null,i.createElement(a.InputLabel,null,n("Open full-featured app from URL")),i.createElement("div",null,i.createElement(a.Switch,{checked:l.fullFeaturedOnURL,onChange:function(e,t){return s({tag:"Change",key:"fullFeaturedOnURL",value:t})}}))))},n}(i.Component);t.View=d.default(C)(h.withGettext(n(696))(v));var y=[10,20,40].map(function(e){return 60*e*1e3}),_=[1,2,3,4,5,10].map(function(e){return 1e3*e}),b={"en-US":n(1167),"ru-RU":n(1168),"de-DE":n(1169),"en-GB":n(1170),"lt-LT":n(1171)};function C(e){var t=e.spacing.unit;return{root:{minHeight:0,display:"flex",flexDirection:"column",height:"100%","& > * + *":{borderTop:"solid 1px "+e.palette.divider}},formWrapper:{padding:2*t,flex:"100 100 100%"},form:{"& > *":{display:"flex",alignItems:"center","& > *:first-child":{flex:"0 0 200px",textAlign:"right",fontSize:14},"& > *:first-child + *":{flex:"10 10 auto"},"& > * + *":{marginLeft:2*t}},"& > * + *":{marginTop:2*t}},languageItem:{display:"flex",alignItems:"center","& svg":{height:16},"& *:first-child":{display:"flex",marginRight:.5*t}},footer:{flex:"0 0 auto",display:"flex",padding:[t,2*t],background:e.palette.grey[200],height:6*t,boxSizing:"border-box",alignItems:"center",whiteSpace:"nowrap",justifyContent:"space-between"},shiftLeft:{marginLeft:-t}}}t.styles=C},function(e,t,n){var r={"./de.po":1164,"./lt.po":1165,"./ru.po":1166};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1163},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Settings:["Einstellungen"],Locale:["Sprache"],Currency:["Währung"],"Map provider":["Art der Karte"],Reset:["Zurücksetzen"],Save:["Speichern "],"Call center re-register interval":["Abstand der Wiederverbind von Callcenter "],Custom:["Benutzerdefiniert"],"Don't re-register":["Nicht erneut verbinden"],"%d min":["%d Min."],"Disable address search":["Adressensuche deaktivieren"],"%d sec":["%d Sek.","%d Sekunden","%d Sekunden"],"Auto answer timeout":["Verzögerung der automatischen Antwort"],"0 sec — Immediate auto answer":["0 Sekunden — Ohne Verzögerung"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Settings:["Nustatymai"],Locale:["Lokalė"],Currency:["Valiuta"],"Map provider":["Žemėlapis teikėjas"],Reset:["Atstatyti"],Save:["Sutaupyti"],"Call center re-register interval":["Kvietimo centras perregistruoti intervalą"],Custom:["Tinkintas"],Default:["Neprijunkite"],"%d min":["%d min"],"Disable address search":["Išjungti adresų paiešką"],"%d sec":["%d sec"],"Auto answer timeout":["Automatinio atsakymo atidėjimas"],"0 sec — Immediate auto answer":["0 sec — Nedelsiant"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Settings:["Настройки"],Locale:["Язык"],Currency:["Валюта"],"Map provider":["Тип карты"],Reset:["Сбросить"],Save:["Сохранить"],"Call center re-register interval":["Интервал переподключения колл-центра"],Custom:["Другой"],"Don't re-register":["Не переподключаться"],"%d min":["%d мин"],"Disable address search":["Отключить поиск адресов"],"%d sec":["%d секунда","%d секунды","%d секунд"],"Auto answer timeout":["Задержка автоответа"],"0 sec — Immediate auto answer":["0 секунд — Без задержки"],"City field receives tab focus":["Tab-фокус в поле город"],"Open order card on":["Открывать карточку заказа"],"Don't open":["Не открывать"],"When receive call":["При приеме звонка"],"When answer call":["При ответе на звонок"],"Settings saved":["Настройки сохранены"],"Open full-featured app from URL":["Открывать полную форму при звонке из URL"],"Go back checkbox bevahiour (in order card)":["Поведение чекбока Обратно (карточка заказа)"],"Old behaviour in TM":["Старое поведение"],"New behaviour":["Новое поведение"]}}}},,,,,,function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1173);t.Card=r.default;var o=n(1174);t.CardHeader=o.default;var i=n(1178);t.CardContent=i.default;var a=n(1179);t.CardFooter=a.default},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(11),l=n(48),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.classes,n=e.className,r=e.children,u=i(e,["classes","className","children"]);return a.createElement(l.Paper,o({},u,{className:s(t.root,n)}),r)},t}(a.Component);function c(e){return{root:{display:"flex",flexDirection:"column",minHeight:0,"& > * + *":{borderTop:"solid 1px "+e.palette.divider}}}}t.default=l.withStyles(c)(u),t.styles=c},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(48),s=n(27),l=n(113),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.className,a=e.children,s=e.onClose;return o.createElement("div",{className:i(n.root,r)},a,s&&o.createElement(l.default,{className:n.close,"data-rh":t("Close"),onClick:s,children:"close"}))},t}(o.Component);function c(e){var t=e.spacing.unit;return{root:{display:"flex",flex:"0 0 auto",alignItems:"center",height:7*t},close:{marginRight:2*t}}}t.default=s.withGettext(n(1175))(a.withStyles(c)(u)),t.styles=c},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1176))},function(e,t,n){var r={"./ru.po":1177};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1176},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Close:["Закрыть"]}}}},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(48),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.classes,n=e.className,r=e.children;return o.createElement("div",{className:i(t.root,n)},r)},t}(o.Component);function l(e){return{root:{overflowY:"auto",minHeight:0,flexGrow:100}}}t.default=a.withStyles(l)(s),t.styles=l},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(11),a=n(48),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.classes,n=e.className,r=e.children;return o.createElement("div",{className:i(t.root,n)},r)},t}(o.Component);function l(e){return{root:{flex:"0 0 auto",display:"flex",alignItems:"center",height:6*e.spacing.unit,boxSizing:"border-box",background:e.palette.grey[200]}}}t.default=a.withStyles(l)(s),t.styles=l},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=n(48),a=n(27),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this.props,t=e.__,n=e.classes,r=e.driver.order,a=e.orderStates,s=e.onClose,l=e.orderState,u=e.onOrderOpen,c=e.onOrderStatusChange,d=e.onConfirm;if(!r)return null;var p=o.createElement("div",null,o.createElement("p",{className:n.claim},t("You're trying to change the status of a driver that has an ongoing order. You should change the order's status first")," ",o.createElement("a",{href:"javascript://void 0",onClick:function(){return u&&u(r.id)}},t("Go to the order"))),o.createElement("table",{className:n.table},o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",null,t("Order id")),o.createElement("td",null,r.id)),o.createElement("tr",null,o.createElement("td",null,t("Route")),o.createElement("td",null,function(e){return e.length<=2?e:[e[0],e[e.length-1]]}(r.addresses).map(function(e){return e.address}).join(" → "))))),o.createElement(i.FormControl,{className:n.selectFieldWrapper},o.createElement(i.InputLabel,null,t("Order status")),o.createElement(i.Select,{value:l?l.id:"null",onChange:function(e){return c&&c(e.target.value)}},o.createElement(i.MenuItem,{key:"null",value:"null"},t("Not selected")),a.map(function(e){return o.createElement(i.MenuItem,{value:e.id,key:e.id},e.name)}))));return o.createElement(i.Dialog,{open:!0,onClose:s,className:n.dialog},o.createElement(i.DialogTitle,null,t("Confirm status change")),o.createElement(i.DialogContent,null,p),o.createElement(i.DialogActions,{className:n.actions},o.createElement(i.Button,{onClick:s},t("Cancel")),o.createElement(i.Button,{onClick:d,color:"primary",disabled:!l},t("Confirm"))))},t}(o.Component);function l(e){return{}}t.View=i.withStyles(l)(a.withGettext(n(697))(s)),t.styles=l},function(e,t,n){var r={"./de.po":1182,"./lt.po":1183,"./ru.po":1184};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1181},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},Confirm:["Bestätigen"],"You're trying to change the status of a driver that has an ongoing order. You should change the order's status first":["Sie versuchen, den Status des Fahrers zu ändern, der eine aktive Bestellung hat. Sie müssen zuerst den Status der Bestellung ändern"],"Order status":["Status der Bestellung"],"Confirm status change":["Die Änderung von Status bestätigen"],"Go to the order":[" Zur Bestellung gehen"],"Order id":["ID der Bestellung"],Cancel:["Zurücksetzen"],"Not selected":["Nicht gewählt"],Route:["Route"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},Confirm:["Patvirtinti"],"You're trying to change the status of a driver that has an ongoing order. You should change the order's status first":["Jūs bandote pakeisti vairuotojo, turinčio aktyvųjį užsakymą, būseną. Jūs turite pakeisti užsakymo būseną"],"Order status":["Užsakymo būsena"],"Confirm status change":["Patvirtinkite būsenos pakeitimą"],"Go to the order":["Pereiti prie užsakymo"],"Order id":["Užsakymo id"],Cancel:["Atšaukti"],"Not selected":["Nepasirinkta"],Route:["Maršrutas"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},Confirm:["Продолжить"],"You're trying to change the status of a driver that has an ongoing order. You should change the order's status first":["Вы пытаетесь изменить статус водителя, у которого есть активный заказ. Необходимо изменить статус заказа"],"Order status":["Статус заказа"],"Confirm status change":["Подтвердите смену статуса"],"Go to the order":["Перейти к заказу"],"Order id":["Ид заказа"],Cancel:["Отмена"],"Not selected":["Не выбран"],Route:["Маршрут"]}}}},function(e,t,n){(function(e){var n,r;!function(r){var o=function(){"use strict";var e={};return Object.defineProperties(e,{version:{get:function(){return"0.4.0-devel"}},name:{get:function(){return"JsSIP"}}}),e}();!function(e){var t=function(){var e=function(e,t,n){this.logger=e,this.category=t,this.label=n};return e.prototype.debug=function(e){this.logger.debug(this.category,this.label,e)},e.prototype.log=function(e){this.logger.log(this.category,this.label,e)},e.prototype.warn=function(e){this.logger.warn(this.category,this.label,e)},e.prototype.error=function(e){this.logger.error(this.category,this.label,e)},e}(),n=function(){var e,t={error:0,warn:1,log:2,debug:3},n=2,o=!0,i=null;this.loggers={},e=this.getLogger("jssip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return o},set:function(t){"boolean"==typeof t?o=t:e.error('invalid "builtinEnabled" parameter value: '+r.JSON.stringify(t))}},level:{get:function(){return n},set:function(o){o>=0&&o<=3?n=o:o>3?n=3:t.hasOwnProperty(o)?n=t[o]:e.error('invalid "level" parameter value: '+r.JSON.stringify(o))}},connector:{get:function(){return i},set:function(t){null===t||""===t||void 0===t?i=null:"function"==typeof t?i=t:e.error('invalid "connector" parameter value: '+r.JSON.stringify(t))}}})};n.prototype.print=function(e,t,n,r){var o=[];o.push(new Date),o.push(t),n&&o.push(n),o.push(""),"string"==typeof r?e.call(console,o.join(" | ")+r):e.call(console,r)},n.prototype.debug=function(e,t,n){3===this.level&&(this.builtinEnabled&&this.print(console.debug,e,t,n),this.connector&&this.connector("debug",e,t,n))},n.prototype.log=function(e,t,n){this.level>=2&&(this.builtinEnabled&&this.print(console.log,e,t,n),this.connector&&this.connector("log",e,t,n))},n.prototype.warn=function(e,t,n){this.level>=1&&(this.builtinEnabled&&this.print(console.warn,e,t,n),this.connector&&this.connector("warn",e,t,n))},n.prototype.error=function(e,t,n){this.builtinEnabled&&this.print(console.error,e,t,n),this.connector&&this.connector("error",e,t,n)},n.prototype.getLogger=function(e,n){var r;return n&&3===this.level?new t(this,e,n):this.loggers[e]?this.loggers[e]:(r=new t(this,e),this.loggers[e]=r,r)},e.LoggerFactory=n}(o),function(e){var t,n,r=(new e.LoggerFactory).getLogger("jssip.eventemitter"),o={MAX_LISTENERS:10};(t=function(){}).prototype={initEvents:function(e){var t;for(t in this.logger||(this.logger=r),this.maxListeners=o.MAX_LISTENERS,this.events={},this.oneTimeListeners={},e)this.events[e[t]]=[],this.oneTimeListeners[e[t]]=[]},checkEvent:function(e){return!!this.events[e]},addListener:function(e,t){void 0!==t&&("function"==typeof t?this.checkEvent(e)?(this.events[e].length>=this.maxListeners&&this.logger.warn("max listeners exceeded for event "+e),this.events[e].push(t)):this.logger.error("unable to add a listener to a nonexistent event"+e):this.logger.error("listener must be a function"))},on:function(e,t){this.addListener(e,t)},once:function(e,t){this.on(e,t),this.oneTimeListeners[e].push(t)},removeListener:function(e,t){var n,r,o=0;if(void 0!==t){if("function"!=typeof t)this.logger.error("listener must be a function");else if(!this.checkEvent(e))return void this.logger.error("unable to remove a listener from a nonexistent event"+e);for(r=(n=this.events[e]).length;o<r;)n[o]===t?n.splice(o,1):o++}},removeAllListener:function(e){this.checkEvent(e)?(this.events[e]=[],this.oneTimeListeners[e]=[]):this.logger.error("unable to remove listeners from a nonexistent event"+e)},setMaxListeners:function(e){"number"!=typeof e||e<0?this.logger.error("listeners must be a positive number"):this.maxListeners=e},listeners:function(e){if(this.checkEvent(e))return this.events[e];this.logger.error("no event "+e)},emit:function(t,n,r){var o,i,a,s=this;if(this.checkEvent(t)){for(a in this.logger.log("emitting event "+t),(o=this.events[t]).length,i=new e.Event(t,n,r),o.map(function(e){return function(){e.call(null,i)}}).forEach(function(e){try{e()}catch(e){s.logger.error(e.stack)}}),this.oneTimeListeners[t])this.removeListener(t,this.oneTimeListeners[t][a]);this.oneTimeListeners[t]=[]}else this.logger.error("unable to emit a nonexistent event"+t)}},n=function(e,t,n){this.type=e,this.sender=t,this.data=n},t.C=o,e.EventEmitter=t,e.Event=n}(o),o.C={USER_AGENT:o.name+" "+o.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",BYE:"Terminated",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}},function(e){var t;t={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+r.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),NotReadyError:function(){var e=function(e){this.code=4,this.name="NOT_READY_ERROR",this.message=e};return e.prototype=new Error,e}()},e.Exceptions=t}(o),function(e){var t,n=500;t={T1:n,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4},e.Timers=t}(o),function(e){var t;(t=function(e,t){this.logger=e.getLogger("jssip.transport"),this.ua=e,this.ws=null,this.server=t,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.ua.transport=this,this.connect()}).prototype={send:function(e){var t=e.toString();return this.ws&&this.ws.readyState===WebSocket.OPEN?(!0===this.ua.configuration.trace_sip&&this.logger.log("sending WebSocket message:\n\n"+t+"\n"),this.ws.send(t),!0):(this.logger.warn("unable to send message, WebSocket is not open"),!1)},disconnect:function(){this.ws&&(r.clearTimeout(this.reconnectTimer),this.closed=!0,this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(r.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var e=this;if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return this.logger.log("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new WebSocket(this.server.ws_uri,"sip"),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(t){e.onClose(t)},this.ws.onmessage=function(t){e.onMessage(t)},this.ws.onerror=function(t){e.onError(t)}}catch(e){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+e),this.lastTransportError.code=null,this.lastTransportError.reason=e.message,this.ua.onTransportError(this)}},onOpen:function(){this.connected=!0,this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(r.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(e){var t=this.connected;this.connected=!1,this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),!1===e.wasClean&&this.logger.warn("WebSocket abrupt disconnection"),!0===t?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reConnect()):this.ua.onTransportError(this)},onMessage:function(t){var n,r,o=t.data;if("\r\n"!==o){if("string"!=typeof o){try{o=String.fromCharCode.apply(null,new Uint8Array(o))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.ua.configuration.trace_sip&&this.logger.log("received WebSocket binary message:\n\n"+o+"\n")}else!0===this.ua.configuration.trace_sip&&this.logger.log("received WebSocket text message:\n\n"+o+"\n");if((n=e.Parser.parseMessage(o,this.ua))&&!(this.ua.status===e.UA.C.STATUS_USER_CLOSED&&n instanceof e.IncomingRequest)&&e.sanityCheck(n,this.ua,this))if(n instanceof e.IncomingRequest)n.transport=this,this.ua.receiveRequest(n);else if(n instanceof e.IncomingResponse)switch(n.method){case e.C.INVITE:(r=this.ua.transactions.ict[n.via_branch])&&r.receiveResponse(n);break;case e.C.ACK:break;default:(r=this.ua.transactions.nict[n.via_branch])&&r.receiveResponse(n)}}else!0===this.ua.configuration.trace_sip&&this.logger.log("received WebSocket message with CRLF Keep Alive response")},onError:function(e){this.logger.warn("WebSocket connection error: "+e)},reConnect:function(){var e=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=r.setTimeout(function(){e.connect(),e.reconnectTimer=null},1e3*this.ua.configuration.ws_server_reconnection_timeout))}},t.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2},e.Transport=t}(o),function(e){var t;function n(e,t){var n=t,r=0,o=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(o=e.indexOf("\r\n",n)))return o;!e.substring(o+2,o+4).match(/(^\r\n)/)&&e.charAt(o+2).match(/(^\s+)/)?n=o+2:r=o}return r}function r(t,n,r,o){var i,a,s,l,u=n.indexOf(":",r),c=n.substring(r,u).trim(),d=n.substring(u+1,o).trim();switch(c.toLowerCase()){case"via":case"v":t.addHeader("via",d),1===t.getHeaders("via").length?(l=t.parseHeader("Via"))&&(t.via=l,t.via_branch=l.branch):l=0;break;case"from":case"f":t.setHeader("from",d),(l=t.parseHeader("from"))&&(t.from=l,t.from_tag=l.getParam("tag"));break;case"to":case"t":t.setHeader("to",d),(l=t.parseHeader("to"))&&(t.to=l,t.to_tag=l.getParam("tag"));break;case"record-route":for(-1===(l=e.Grammar.parse(d,"Record_Route"))&&(l=void 0),s=l.length,a=0;a<s;a++)i=l[a],t.addHeader("record-route",d.substring(i.possition,i.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=i.parsed;break;case"call-id":case"i":t.setHeader("call-id",d),(l=t.parseHeader("call-id"))&&(t.call_id=d);break;case"contact":case"m":for(-1===(l=e.Grammar.parse(d,"Contact"))&&(l=void 0),s=l.length,a=0;a<s;a++)i=l[a],t.addHeader("contact",d.substring(i.possition,i.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=i.parsed;break;case"content-length":case"l":t.setHeader("content-length",d),l=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",d),l=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",d),(l=t.parseHeader("cseq"))&&(t.cseq=l.value),t instanceof e.IncomingResponse&&(t.method=l.method);break;case"max-forwards":t.setHeader("max-forwards",d),l=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",d),l=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",d),l=t.parseHeader("proxy-authenticate");break;default:t.setHeader(c,d),l=0}return void 0!==l||{error:'error parsing header "'+c+'"'}}(t={}).parseMessage=function(t,o){var i,a,s,l,u,c=0,d=t.indexOf("\r\n"),p=o.getLogger("jssip.parser");if(-1!==d){if(a=t.substring(0,d),-1!==(u=e.Grammar.parse(a,"Request_Response"))){for(u.status_code?((i=new e.IncomingResponse(o)).status_code=u.status_code,i.reason_phrase=u.reason_phrase):((i=new e.IncomingRequest(o)).method=u.method,i.ruri=u.uri),i.data=t,c=d+2;;){if(-2===(d=n(t,c))){l=c+2;break}if(-1===d)return void u.error("malformed message");if(!0!==(u=r(i,t,c,d)))return void p.error(u.error);c=d+2}return i.hasHeader("content-length")?(s=i.getHeader("content-length"),i.body=t.substr(l,s)):i.body=t.substring(l),i}p.warn('error parsing first line of SIP message: "'+a+'"')}else p.warn("no CRLF found, not a SIP message, discarded")},e.Parser=t}(o),function(e){var t,n,r,o;(t=function(t,n,r,o,i,a){var s,l,u,c;if(o=o||{},!t||!n||!r)return null;this.logger=r.getLogger("jssip.sipmessage"),this.ua=r,this.headers={},this.method=t,this.ruri=n,this.body=a,this.extraHeaders=i&&i.slice()||[],o.route_set?this.setHeader("route",o.route_set):r.configuration.use_preloaded_route&&this.setHeader("route",r.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),s=o.to_display_name||0===o.to_display_name?'"'+o.to_display_name+'" ':"",s+="<"+(o.to_uri||n)+">",s+=o.to_tag?";tag="+o.to_tag:"",this.to=new e.NameAddrHeader.parse(s),this.setHeader("to",s),l=o.from_display_name||0===o.from_display_name?'"'+o.from_display_name+'" ':r.configuration.display_name?'"'+r.configuration.display_name+'" ':"",l+="<"+(o.from_uri||r.configuration.uri)+">;tag=",l+=o.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(l),this.setHeader("from",l),u=o.call_id||r.configuration.jssip_id+e.Utils.createRandomToken(15),this.call_id=u,this.setHeader("call-id",u),c=o.cseq||Math.floor(1e4*Math.random()),this.cseq=c,this.setHeader("cseq",c+" "+t)}).prototype={setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){var n,r,o=this.extraHeaders.length,i=this.headers[e.Utils.headerize(t)];if(i){if(i[0])return i[0]}else for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<o;r++)if(i=this.extraHeaders[r],n.test(i))return i.substring(i.indexOf(":")+1).trim()},getHeaders:function(t){var n,r,o,i=this.headers[e.Utils.headerize(t)],a=[];if(i){for(r=i.length,n=0;n<r;n++)a.push(i[n]);return a}for(r=this.extraHeaders.length,o=new RegExp("^\\s*"+t+"\\s*:","i"),n=0;n<r;n++)i=this.extraHeaders[n],o.test(i)&&a.push(i.substring(i.indexOf(":")+1).trim());return a},hasHeader:function(t){var n,r,o=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<o;r++)if(n.test(this.extraHeaders[r]))return!0;return!1},toString:function(){var t,n,r,o="",i=[];for(t in o+=this.method+" "+this.ruri+" SIP/2.0\r\n",this.headers)for(n=this.headers[t].length,r=0;r<n;r++)o+=t+": "+this.headers[t][r]+"\r\n";for(n=this.extraHeaders.length,r=0;r<n;r++)o+=this.extraHeaders[r].trim()+"\r\n";switch(this.method){case e.C.REGISTER:i.push("path","gruu");break;case e.C.INVITE:(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&i.push("gruu")}return i.push("outbound"),o+="Allow: "+e.Utils.getAllowedMethods(this.ua)+"\r\n",o+="Supported: "+i+"\r\n",o+="User-Agent: "+e.C.USER_AGENT+"\r\n",this.body?(o+="Content-Length: "+(n=e.Utils.str_utf8_length(this.body))+"\r\n\r\n",o+=this.body):o+="Content-Length: 0\r\n\r\n",o}},(n=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}).prototype={addHeader:function(t,n){var r={raw:n};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(r):this.headers[t]=[r]},getHeader:function(t){var n=this.headers[e.Utils.headerize(t)];if(n)return n[0]?n[0].raw:void 0},getHeaders:function(t){var n,r,o=this.headers[e.Utils.headerize(t)],i=[];if(!o)return[];for(r=o.length,n=0;n<r;n++)i.push(o[n].raw);return i},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,n){var r,o,i;if(t=e.Utils.headerize(t),n=n||0,this.headers[t]){if(!(n>=this.headers[t].length))return o=(r=this.headers[t][n]).raw,r.parsed?r.parsed:-1===(i=e.Grammar.parse(o,t.replace(/-/g,"_")))?(this.headers[t].splice(n,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+o+'"')):(r.parsed=i,i);this.logger.log('not so many "'+t+'" headers present')}else this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,n){var r={raw:n};this.headers[e.Utils.headerize(t)]=[r]},toString:function(){return this.data}},((r=function(e){this.logger=e.getLogger("jssip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}).prototype=new n).reply=function(t,n,r,o,i,a){var s,l,u,c,d,p=[],f=this.getHeader("To"),h=0,m=0;if(n=n||null,!(t=t||null)||t<100||t>699)throw new TypeError("Invalid status_code: "+t);if(n&&"string"!=typeof n&&!(n instanceof String))throw new TypeError("Invalid reason_phrase: "+n);if(n=n||e.C.REASON_PHRASE[t]||"",r=r&&r.slice()||[],d="SIP/2.0 "+t+" "+n+"\r\n",this.method===e.C.INVITE&&t>100&&t<=200)for(u=(s=this.getHeaders("record-route")).length;h<u;h++)d+="Record-Route: "+s[h]+"\r\n";for(u=(l=this.getHeaders("via")).length;m<u;m++)d+="Via: "+l[m]+"\r\n";for(!this.to_tag&&t>100?f+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(f+=";tag="+this.to_tag),d+="To: "+f+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",u=r.length,c=0;c<u;c++)d+=r[c].trim()+"\r\n";switch(this.method){case e.C.INVITE:(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&p.push("gruu")}p.push("outbound"),this.method===e.C.OPTIONS?(d+="Allow: "+e.Utils.getAllowedMethods(this.ua)+"\r\n",d+="Accept: "+e.UA.C.ACCEPTED_BODY_TYPES+"\r\n"):405===t?d+="Allow: "+e.Utils.getAllowedMethods(this.ua)+"\r\n":415===t&&(d+="Accept: "+e.UA.C.ACCEPTED_BODY_TYPES+"\r\n"),d+="Supported: "+p+"\r\n",o?(d+="Content-Type: application/sdp\r\n",d+="Content-Length: "+(u=e.Utils.str_utf8_length(o))+"\r\n\r\n",d+=o):d+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(t,d,i,a)},r.prototype.reply_sl=function(t,n){var r,o,i=0,a=this.getHeaders("via"),s=a.length;if(n=n||null,!(t=t||null)||t<100||t>699)throw new TypeError("Invalid status_code: "+t);if(n&&"string"!=typeof n&&!(n instanceof String))throw new TypeError("Invalid reason_phrase: "+n);for(o="SIP/2.0 "+t+" "+(n=n||e.C.REASON_PHRASE[t]||"")+"\r\n";i<s;i++)o+="Via: "+a[i]+"\r\n";r=this.getHeader("To"),!this.to_tag&&t>100?r+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.to_tag),o+="To: "+r+"\r\n",o+="From: "+this.getHeader("From")+"\r\n",o+="Call-ID: "+this.call_id+"\r\n",o+="CSeq: "+this.cseq+" "+this.method+"\r\n",o+="Content-Length: 0\r\n\r\n",this.transport.send(o)},(o=function(e){this.logger=e.getLogger("jssip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null}).prototype=new n,e.OutgoingRequest=t,e.IncomingRequest=r,e.IncomingResponse=o}(o),function(e){var t;(t=function(t,n,r,o,i,a){var s,l;if(!r)throw new TypeError('missing or invalid "host" parameter');for(s in t=t||e.C.SIP,this.parameters={},this.headers={},i)this.setParam(s,i[s]);for(l in a)this.setHeader(l,a[l]);Object.defineProperties(this,{scheme:{get:function(){return t},set:function(e){t=e.toLowerCase()}},user:{get:function(){return n},set:function(e){n=e}},host:{get:function(){return r},set:function(e){r=e.toLowerCase()}},port:{get:function(){return o},set:function(e){o=0===e?e:parseInt(e,10)||null}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString().toLowerCase())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return!!this.parameters.hasOwnProperty(e.toLowerCase())},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return!!this.headers.hasOwnProperty(e.Utils.headerize(t))},deleteHeader:function(t){var n;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return n=this.headers[t],delete this.headers[t],n},clearHeaders:function(){this.headers={}},clone:function(){return new t(this.scheme,this.user,this.host,this.port,r.JSON.parse(r.JSON.stringify(this.parameters)),r.JSON.parse(r.JSON.stringify(this.headers)))},toString:function(){var t,n,r,o,i=[];for(n in o=this.scheme+":",this.user&&(o+=e.Utils.escapeUser(this.user)+"@"),o+=this.host,(this.port||0===this.port)&&(o+=":"+this.port),this.parameters)o+=";"+n,null!==this.parameters[n]&&(o+="="+this.parameters[n]);for(t in this.headers)for(r in this.headers[t])i.push(t+"="+this.headers[t][r]);return i.length>0&&(o+="?"+i.join("&")),o},toAor:function(t){var n;return n=this.scheme+":",this.user&&(n+=e.Utils.escapeUser(this.user)+"@"),n+=this.host,t&&(this.port||0===this.port)&&(n+=":"+this.port),n}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"SIP_URI"))?t:void 0},e.URI=t}(o),function(e){var t;(t=function(t,n,r){var o;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');for(o in this.uri=t,this.parameters={},r)this.setParam(o,r[o]);Object.defineProperties(this,{display_name:{get:function(){return n},set:function(e){n=0===e?"0":e}}})}).prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return!!this.parameters.hasOwnProperty(e.toLowerCase())},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},clone:function(){return new t(this.uri.clone(),this.display_name,r.JSON.parse(r.JSON.stringify(this.parameters)))},toString:function(){var e,t;for(t in e=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",e+="<"+this.uri.toString()+">",this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return-1!==(t=e.Grammar.parse(t,"Name_Addr_Header"))?t:void 0},e.NameAddrHeader=t}(o),function(e){var t={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},n=function(e,n,r){var o;this.type=t.NON_INVITE_CLIENT,this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=n,this.logger=e.ua.getLogger("jssip.transaction.nict",this.id),o="SIP/2.0/"+(e.ua.configuration.hack_via_tcp?"TCP":r.server.scheme),o+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",o),this.request_sender.ua.newTransaction(this),this.initEvents(["stateChanged"])};(n.prototype=new e.EventEmitter).stateChanged=function(e){this.state=e,this.emit("stateChanged",this)},n.prototype.send=function(){var n=this;this.stateChanged(t.STATUS_TRYING),this.F=r.setTimeout(function(){n.timer_F()},e.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},n.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),r.clearTimeout(this.F),r.clearTimeout(this.K),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},n.prototype.timer_F=function(){this.logger.log("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},n.prototype.timer_K=function(){this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},n.prototype.receiveResponse=function(n){var o=this,i=n.status_code;if(i<200)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(n)}else switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),r.clearTimeout(this.F),408===i?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(n),this.K=r.setTimeout(function(){o.timer_K()},e.Timers.TIMER_K)}};var o=function(e,n,r){var o,i=this;this.type=t.INVITE_CLIENT,this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=n,this.logger=e.ua.getLogger("jssip.transaction.ict",this.id),o="SIP/2.0/"+(e.ua.configuration.hack_via_tcp?"TCP":r.server.scheme),o+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",o),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e){i.cancel_request(i,e)},this.initEvents(["stateChanged"])};(o.prototype=new e.EventEmitter).stateChanged=function(e){this.state=e,this.emit("stateChanged",this)},o.prototype.send=function(){var n=this;this.stateChanged(t.STATUS_CALLING),this.B=r.setTimeout(function(){n.timer_B()},e.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},o.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),r.clearTimeout(this.B),r.clearTimeout(this.D),r.clearTimeout(this.M),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==t.STATUS_ACCEPTED&&this.request_sender.onTransportError()},o.prototype.timer_M=function(){this.logger.log("Timer M expired for INVITE client transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(r.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},o.prototype.timer_B=function(){this.logger.log("Timer B expired for INVITE client transaction "+this.id),this.state===t.STATUS_CALLING&&(this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},o.prototype.timer_D=function(){this.logger.log("Timer D expired for INVITE client transaction "+this.id),r.clearTimeout(this.B),this.stateChanged(t.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},o.prototype.sendACK=function(t){var n=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+t.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=r.setTimeout(function(){n.timer_D()},e.Timers.TIMER_D),this.transport.send(this.ack)},o.prototype.cancel_request=function(n,r){var o=n.request;this.cancel=e.C.CANCEL+" "+o.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+o.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+o.headers.Route.toString()+"\r\n"),this.cancel+="To: "+o.headers.To.toString()+"\r\n",this.cancel+="From: "+o.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+o.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+o.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",r&&(this.cancel+="Reason: "+r+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===t.STATUS_PROCEEDING&&this.transport.send(this.cancel)},o.prototype.receiveResponse=function(n){var o=this,i=n.status_code;if(i>=100&&i<=199)switch(this.state){case t.STATUS_CALLING:this.stateChanged(t.STATUS_PROCEEDING),this.request_sender.receiveResponse(n),this.cancel&&this.transport.send(this.cancel);break;case t.STATUS_PROCEEDING:this.request_sender.receiveResponse(n)}else if(i>=200&&i<=299)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.M=r.setTimeout(function(){o.timer_M()},e.Timers.TIMER_M),this.request_sender.receiveResponse(n);break;case t.STATUS_ACCEPTED:this.request_sender.receiveResponse(n)}else if(i>=300&&i<=699)switch(this.state){case t.STATUS_CALLING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.sendACK(n),this.request_sender.receiveResponse(n);break;case t.STATUS_COMPLETED:this.sendACK(n)}};var i=function(e,t,n){var r;this.transport=n,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=t,this.logger=e.ua.getLogger("jssip.transaction.nict",this.id),r="SIP/2.0/"+(e.ua.configuration.hack_via_tcp?"TCP":n.server.scheme),r+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",r)};(i.prototype=new e.EventEmitter).send=function(){this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var a=function(e,n){this.type=t.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=n,this.last_response="",e.server_transaction=this,this.logger=n.getLogger("jssip.transaction.nist",this.id),this.state=t.STATUS_TRYING,n.newTransaction(this),this.initEvents(["stateChanged"])};(a.prototype=new e.EventEmitter).stateChanged=function(e){this.state=e,this.emit("stateChanged",this)},a.prototype.timer_J=function(){this.logger.log("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),r.clearTimeout(this.J),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.receiveResponse=function(n,o,i,a){var s=this;if(100===n)switch(this.state){case t.STATUS_TRYING:this.stateChanged(t.STATUS_PROCEEDING),this.transport.send(o)||this.onTransportError();break;case t.STATUS_PROCEEDING:this.last_response=o,this.transport.send(o)?i&&i():(this.onTransportError(),a&&a())}else if(n>=200&&n<=699)switch(this.state){case t.STATUS_TRYING:case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_COMPLETED),this.last_response=o,this.J=r.setTimeout(function(){s.timer_J()},e.Timers.TIMER_J),this.transport.send(o)?i&&i():(this.onTransportError(),a&&a())}};var s=function(e,n){this.type=t.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=n,this.last_response="",e.server_transaction=this,this.logger=n.getLogger("jssip.transaction.ist",this.id),this.state=t.STATUS_PROCEEDING,n.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100),this.initEvents(["stateChanged"])};(s.prototype=new e.EventEmitter).stateChanged=function(e){this.state=e,this.emit("stateChanged",this)},s.prototype.timer_H=function(){this.logger.log("Timer H expired for INVITE server transaction "+this.id),this.state===t.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},s.prototype.timer_I=function(){this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this)},s.prototype.timer_L=function(){this.logger.log("Timer L expired for INVITE server transaction "+this.id),this.state===t.STATUS_ACCEPTED&&(this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},s.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(r.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),r.clearTimeout(this.L),r.clearTimeout(this.H),r.clearTimeout(this.I),this.stateChanged(t.STATUS_TERMINATED),this.ua.destroyTransaction(this))},s.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},s.prototype.receiveResponse=function(n,o,i,a){var s=this;if(n>=100&&n<=199)switch(this.state){case t.STATUS_PROCEEDING:this.transport.send(o)||this.onTransportError(),this.last_response=o}if(n>100&&n<=199&&this.state===t.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=r.setInterval(function(){s.resend_provisional()},e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(n>=200&&n<=299)switch(this.state){case t.STATUS_PROCEEDING:this.stateChanged(t.STATUS_ACCEPTED),this.last_response=o,this.L=r.setTimeout(function(){s.timer_L()},e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(r.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case t.STATUS_ACCEPTED:this.transport.send(o)?i&&i():(this.onTransportError(),a&&a())}else if(n>=300&&n<=699)switch(this.state){case t.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(r.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(o)?(this.stateChanged(t.STATUS_COMPLETED),this.H=r.setTimeout(function(){s.timer_H()},e.Timers.TIMER_H),i&&i()):(this.onTransportError(),a&&a())}};e.Transactions={C:t,checkTransaction:function(n,o){var i;switch(o.method){case e.C.INVITE:if(i=n.transactions.ist[o.via_branch]){switch(i.state){case t.STATUS_PROCEEDING:i.transport.send(i.last_response)}return!0}break;case e.C.ACK:if(!(i=n.transactions.ist[o.via_branch]))return!1;if(i.state===t.STATUS_ACCEPTED)return!1;if(i.state===t.STATUS_COMPLETED)return i.state=t.STATUS_CONFIRMED,i.I=r.setTimeout(function(){i.timer_I()},e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return(i=n.transactions.ist[o.via_branch])?(o.reply_sl(200),i.state!==t.STATUS_PROCEEDING):(o.reply_sl(481),!0);default:if(i=n.transactions.nist[o.via_branch]){switch(i.state){case t.STATUS_TRYING:break;case t.STATUS_PROCEEDING:case t.STATUS_COMPLETED:i.transport.send(i.last_response)}return!0}}},NonInviteClientTransaction:n,InviteClientTransaction:o,AckClientTransaction:i,NonInviteServerTransaction:a,InviteServerTransaction:s}}(o),function(e){var t,n=function(e){var t;return(t=function(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null}).prototype={send:function(){var t=this,n=new e.RequestSender(this,this.dialog.owner.ua);n.send(),this.request.method===e.C.INVITE&&n.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,n.clientTransaction.on("stateChanged",function r(o){o.sender.state!==e.Transactions.C.STATUS_ACCEPTED&&o.sender.state!==e.Transactions.C.STATUS_COMPLETED&&o.sender.state!==e.Transactions.C.STATUS_TERMINATED||(n.clientTransaction.removeListener("stateChanged",r),t.dialog.uac_pending_reply=!1,!1===t.dialog.uas_pending_reply&&t.dialog.owner.onReadyToReinvite())}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=r.setTimeout(function(){n.applicant.owner.status!==e.RTCSession.C.STATUS_TERMINATED&&(n.reattempt=!0,n.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}(e),o={STATUS_EARLY:1,STATUS_CONFIRMED:2};(t=function(t,n,r,i){var a;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};i=n instanceof e.IncomingResponse?n.status_code<200?o.STATUS_EARLY:o.STATUS_CONFIRMED:i||o.STATUS_CONFIRMED,a=n.parseHeader("contact"),"UAS"===r?(this.id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=i,this.remote_seqnum=n.cseq,this.local_uri=n.parseHeader("to").uri,this.remote_uri=n.parseHeader("from").uri,this.remote_target=a.uri,this.route_set=n.getHeaders("record-route")):"UAC"===r&&(this.id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=i,this.local_seqnum=n.cseq,this.local_uri=n.parseHeader("from").uri,this.remote_uri=n.parseHeader("to").uri,this.remote_target=a.uri,this.route_set=n.getHeaders("record-route").reverse()),this.logger=t.ua.getLogger("jssip.dialog",this.id.toString()),this.owner=t,t.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+r+" dialog created with status "+(this.state===o.STATUS_EARLY?"EARLY":"CONFIRMED"))}).prototype={update:function(e,t){this.state=o.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(t,n,r){var o,i;return n=n&&n.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),o=t===e.C.CANCEL||t===e.C.ACK?this.local_seqnum:this.local_seqnum+=1,(i=new e.OutgoingRequest(t,this.remote_target,this.owner.ua,{cseq:o,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},n,r)).dialog=this,i},checkInDialogRequest:function(t){var n=this;if(this.remote_seqnum){if(t.cseq<this.remote_seqnum)return t.method!==e.C.ACK&&t.reply(500),!1;t.cseq>this.remote_seqnum&&(this.remote_seqnum=t.cseq)}else this.remote_seqnum=t.cseq;switch(t.method){case e.C.INVITE:if(!0===this.uac_pending_reply)t.reply(491);else{if(!0===this.uas_pending_reply){var r=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+r]),!1}this.uas_pending_reply=!0,t.server_transaction.on("stateChanged",function r(o){o.sender.state!==e.Transactions.C.STATUS_ACCEPTED&&o.sender.state!==e.Transactions.C.STATUS_COMPLETED&&o.sender.state!==e.Transactions.C.STATUS_TERMINATED||(t.server_transaction.removeListener("stateChanged",r),n.uas_pending_reply=!1,!1===n.uac_pending_reply&&n.owner.onReadyToReinvite())})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(r){r.sender.state===e.Transactions.C.STATUS_ACCEPTED&&(n.remote_target=t.parseHeader("contact").uri)});break;case e.C.NOTIFY:t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(r){r.sender.state===e.Transactions.C.STATUS_COMPLETED&&(n.remote_target=t.parseHeader("contact").uri)})}return!0},sendRequest:function(e,t,r){var o=(r=r||{}).extraHeaders&&r.extraHeaders.slice()||[],i=r.body||null,a=this.createRequest(t,o,i);new n(this,e,a).send()},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},t.C=o,e.Dialog=t}(o),function(e){var t;(t=function(t,n){this.logger=n.getLogger("jssip.requestsender"),this.ua=n,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,n.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()}).prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n,r,o,i=t.status_code;if(401!==i&&407!==i||null===this.ua.configuration.password)this.applicant.receiveResponse(t);else{if(401===t.status_code?(r=t.parseHeader("www-authenticate"),o="authorization"):(r=t.parseHeader("proxy-authenticate"),o="proxy-authorization"),!r)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&!0===r.stale){if(this.credentials||(this.credentials=new e.DigestAuthentication(this.ua)),!this.credentials.authenticate(this.request,r))return void this.applicant.receiveResponse(t);this.challenged=!0,r.stale&&(this.staled=!0),t.method===e.C.REGISTER?n=this.applicant.cseq+=1:this.request.dialog?n=this.request.dialog.local_seqnum+=1:(n=this.request.cseq+1,this.request.cseq=n),this.request.setHeader("cseq",n+" "+this.method),this.request.setHeader(o,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}}},e.RequestSender=t}(o),function(e){var t;(t=function(t,n){this.logger=t.getLogger("jssip.registrator"),this.ua=t,this.transport=n,this.registrar=t.configuration.registrar_server,this.expires=t.configuration.register_expires,this.call_id=e.Utils.createRandomToken(22),this.cseq=80,this.to_uri=t.configuration.uri,this.registrationTimer=null,this.registered=this.registered_before=!1,this.ua.registrator=this,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.contact+=";reg-id=1",this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'}).prototype={register:function(t){var n,o,i,a=this;(t=t||{}).extraHeaders&&0!==Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders&&t.extraHeaders.slice()),(i=this.extraHeaders.slice()).push("Contact: "+this.contact+";expires="+this.expires),this.request=new e.OutgoingRequest(e.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},i),n=new e.RequestSender(this,this.ua),this.receiveResponse=function(t){var n,i,s=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(r.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(t.hasHeader("expires")&&(i=t.getHeader("expires")),!s){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;s--;){if((n=t.parseHeader("contact",s)).uri.user===this.ua.contact.uri.user){i=n.getParam("expires");break}n=null}if(!n){this.logger.warn("no Contact header pointing to us, response ignored");break}i||(i=this.expires),this.registrationTimer=r.setTimeout(function(){a.registrationTimer=null,a.register()},1e3*i-3e3),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=n.getParam("temp-gruu").replace(/"/g,"")),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=n.getParam("pub-gruu").replace(/"/g,"")),this.registered=!0,this.ua.emit("registered",this.ua,{response:t});break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register()):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:o=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,o)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},n.send()},unregister:function(t){var n;if(this.registered){(t=t||{}).extraHeaders&&0!==Object.keys(t.extraHeaders).length&&(this.extraHeaders=t.extraHeaders&&t.extraHeaders.slice()),n=this.extraHeaders.slice(),this.registered=!1,null!==this.registrationTimer&&(r.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(n.push("Contact: *"),n.push("Expires: 0"),this.request=new e.OutgoingRequest(e.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},n)):(n.push("Contact: "+this.contact+";expires=0"),this.request=new e.OutgoingRequest(e.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},n));var o=new e.RequestSender(this,this.ua);this.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.unregistered(t);break;default:n=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,n)}},this.onRequestTimeout=function(){this.unregistered(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,e.C.causes.CONNECTION_ERROR)},o.send()}else this.logger.warn("already unregistered")},registrationFailure:function(e,t){this.ua.emit("registrationFailed",this.ua,{response:e||null,cause:t}),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:e||null,cause:t}))},unregistered:function(e,t){this.registered=!1,this.ua.emit("unregistered",this.ua,{response:e||null,cause:t||null})},onTransportClosed:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(r.clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered,this.unregister()}},e.Registrator=t}(o),function(e){var t,n=function(e){var t=function(e){this.owner=e,this.logger=e.ua.getLogger("jssip.rtcsession.request",e.id),this.initEvents(["progress","succeeded","failed"])};return(t.prototype=new e.EventEmitter).send=function(t,n){var r,o=(n=n||{}).extraHeaders&&n.extraHeaders.slice()||[],i=n.eventHandlers||{},s=n.body||null;if(void 0===t)throw new TypeError("Not enough arguments");if(this.owner.status!==e.RTCSession.C.STATUS_1XX_RECEIVED&&this.owner.status!==e.RTCSession.C.STATUS_WAITING_FOR_ANSWER&&this.owner.status!==e.RTCSession.C.STATUS_WAITING_FOR_ACK&&this.owner.status!==e.RTCSession.C.STATUS_CONFIRMED&&this.owner.status!==e.RTCSession.C.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.owner.status);if(this.owner.status===a.STATUS_TERMINATED&&t!==e.C.BYE)throw new e.Exceptions.InvalidStateError(this.owner.status);for(r in i)this.on(r,i[r]);this.owner.dialog.sendRequest(this,t,{extraHeaders:o,body:s})},t.prototype.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",this,{originator:"remote",response:t});break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",this,{originator:"remote",response:t});break;default:n=e.Utils.sipErrorCause(t.status_code),this.emit("failed",this,{originator:"remote",response:t,cause:n})}},t.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:e.C.causes.REQUEST_TIMEOUT}),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:e.C.causes.CONNECTION_ERROR}),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",this,{originator:"remote",response:t,cause:e.C.causes.DIALOG_ERROR}),this.owner.onDialogError(t)},t}(e),o=function(e){var t=function(e,t){t=t||{},this.logger=e.ua.getLogger("jssip.rtcsession.rtcmediahandler",e.id),this.session=e,this.localMedia=null,this.peerConnection=null,this.ready=!0,this.init(t)};return t.prototype={isReady:function(){return this.ready},createOffer:function(e,t,n){var r=this;function o(){"complete"!==r.peerConnection.iceGatheringState||"connected"!==r.peerConnection.iceConnectionState&&"completed"!==r.peerConnection.iceConnectionState?r.onIceCompleted=function(){r.onIceCompleted=void 0,r.ready=!0,e(r.peerConnection.localDescription.sdp)}:(r.ready=!0,e(r.peerConnection.localDescription.sdp))}this.ready=!1,this.peerConnection.createOffer(function(e){r.setLocalDescription(e,o,function(e){r.ready=!0,t(e)})},function(e){r.ready=!0,r.logger.error("unable to create offer"),r.logger.error(e),t(e)},n)},createAnswer:function(e,t,n){var r=this;function o(){"complete"!==r.peerConnection.iceGatheringState||"connected"!==r.peerConnection.iceConnectionState&&"completed"!==r.peerConnection.iceConnectionState?r.onIceCompleted=function(){r.onIceCompleted=void 0,r.ready=!0,e(r.peerConnection.localDescription.sdp)}:(r.ready=!0,e(r.peerConnection.localDescription.sdp))}this.ready=!1,this.peerConnection.createAnswer(function(e){r.setLocalDescription(e,o,function(e){r.ready=!0,t(e)})},function(e){r.ready=!0,r.logger.error("unable to create answer"),r.logger.error(e),t(e)},n)},setLocalDescription:function(e,t,n){var r=this;this.peerConnection.setLocalDescription(e,t,function(e){r.logger.error("unable to set local description"),r.logger.error(e),n(e)})},addStream:function(e,t,n,r){try{this.peerConnection.addStream(e,r)}catch(e){return this.logger.error("error adding stream"),this.logger.error(e),void n()}t()},init:function(t){var n,r,o,i=this,a=[],s=(t=t||{}).constraints||{},l=t.stun_servers||null,u=t.turn_servers||null,c=this.session.ua.configuration;for(l||(l=c.stun_servers),u||(u=c.turn_servers),l.length>0&&a.push({url:l}),r=u.length,n=0;n<r;n++)o=u[n],a.push({url:o.urls,username:o.username,credential:o.credential});this.peerConnection=new e.WebRTC.RTCPeerConnection({iceServers:a},s),this.peerConnection.onaddstream=function(e){i.logger.log("stream added: "+e.stream.id)},this.peerConnection.onremovestream=function(e){i.logger.log("stream removed: "+e.stream.id)},this.peerConnection.onicecandidate=function(){"function"==typeof i.onIceCompleted&&i.onIceCompleted()},this.peerConnection.oniceconnectionstatechange=function(){i.logger.log('ICE connection state changed to "'+this.iceConnectionState+'"'),"disconnected"===this.iceConnectionState&&i.session.terminate({cause:e.C.causes.RTP_TIMEOUT,status_code:200,reason_phrase:e.C.causes.RTP_TIMEOUT})},this.peerConnection.onstatechange=function(){i.logger.log('PeerConnection state changed to "'+this.readyState+'"')}},close:function(){this.logger.log("closing PeerConnection"),this.peerConnection&&(this.peerConnection.close(),this.localMedia)},getUserMedia:function(t,n,o,i){var a=this;this.logger.log("requesting access to local media");var s=function(e){a.logger.log("got local media stream"),a.localMedia=e,t.emit("mediaPermissionsAccept",t),n(e)},l=function(e){a.logger.error("unable to get user media"),a.logger.error(e),t.emit("mediaPermissionsRefuse",t),o()},u=r.oktellVoice&&"function"==typeof r.oktellVoice.getUserMediaStream?r.oktellVoice.getUserMediaStream():void 0;u?s(u):r.oktellVoice&&"function"==typeof r.oktellVoice.getUserMediaStream?(t.emit("mediaPermissionsRequest",t),r.oktellVoice.getUserMediaStream(s,l,!1)):e.WebRTC.getUserMedia(i,s,l)},onMessage:function(t,n,r,o){this.peerConnection.setRemoteDescription(new e.WebRTC.RTCSessionDescription({type:t,sdp:n}),r,o)}},t}(e),i=function(e){var t;return((t=function(e){this.logger=e.ua.getLogger("jssip.rtcsession.dtmf",e.id),this.owner=e,this.direction=null,this.tone=null,this.duration=null,this.initEvents(["succeeded","failed"])}).prototype=new e.EventEmitter).send=function(t,n){var r,o,i,a;if(void 0===t)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==e.RTCSession.C.STATUS_CONFIRMED&&this.owner.status!==e.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);if(i=(n=n||{}).extraHeaders?n.extraHeaders.slice():[],o=n.eventHandlers||{},"string"==typeof t)t=t.toUpperCase();else{if("number"!=typeof t)throw new TypeError("Invalid tone: "+t);t=t.toString()}if(!t.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+t);for(r in this.tone=t,this.duration=n.duration,o)this.on(r,o[r]);i.push("Content-Type: application/dtmf-relay"),a="Signal= "+this.tone+"\r\n",a+="Duration= "+this.duration,this.owner.emit("newDTMF",this.owner,{originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:i,body:a})},t.prototype.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",this,{originator:"remote",response:t});break;default:n=e.Utils.sipErrorCause(t.status_code),this.emit("failed",this,{originator:"remote",response:t,cause:n})}},t.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:e.C.causes.REQUEST_TIMEOUT}),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:e.C.causes.CONNECTION_ERROR}),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",this,{originator:"remote",response:t,cause:e.C.causes.DIALOG_ERROR}),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){var t,n=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,r=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=e,e.reply(200),e.body&&2===(t=e.body.split("\r\n")).length&&(n.test(t[0])&&(this.tone=t[0].replace(n,"$2")),r.test(t[1])&&(this.duration=parseInt(t[1].replace(r,"$2"),10))),this.tone&&this.duration?this.owner.emit("newDTMF",this.owner,{originator:"remote",dtmf:this,request:e}):this.logger.warn("invalid INFO DTMF received, discarded")},t.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},t}(e),a={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};((t=function(e){this.ua=e,this.status=a.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.rtcMediaHandler=null,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.local_hold=!1,this.remote_hold=!1,this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(e){for(var t=0,n=this.actions.length;t<n;t++)if(this.actions[t].name===e)return!0;return!1},shift:function(){return this.actions.shift()},push:function(e){this.actions.push({name:e})},pop:function(e){for(var t=0,n=this.actions.length;t<n;t++)this.actions[t].name===e&&this.actions.splice(t,1)}},this.data={},this.initEvents(["connecting","progress","failed","started","ended","newDTMF","hold","unhold","muted","unmuted"])}).prototype=new e.EventEmitter).terminate=function(t){var n,r,o=(t=t||{}).cause||e.C.causes.BYE,i=t.status_code,s=t.reason_phrase,l=t.extraHeaders&&t.extraHeaders.slice()||[],u=t.body,c=this;if(this.status===a.STATUS_TERMINATED)throw new e.Exceptions.InvalidStateError(this.status);switch(this.status){case a.STATUS_NULL:case a.STATUS_INVITE_SENT:case a.STATUS_1XX_RECEIVED:if(this.logger.log("canceling RTCSession"),i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&(n="SIP ;cause="+i+' ;text="'+(s=s||e.C.REASON_PHRASE[i]||"")+'"'),this.status===a.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=n):this.status===a.STATUS_INVITE_SENT?this.received_100?this.request.cancel(n):(this.isCanceled=!0,this.cancelReason=n):this.status===a.STATUS_1XX_RECEIVED&&this.request.cancel(n),this.status=a.STATUS_CANCELED,this.failed("local",null,e.C.causes.CANCELED);break;case a.STATUS_WAITING_FOR_ANSWER:case a.STATUS_ANSWERED:if(this.logger.log("rejecting RTCSession"),(i=i||480)<300||i>=700)throw new TypeError("Invalid status_code: "+i);this.request.reply(i,s,l,u),this.failed("local",null,e.C.causes.REJECTED);break;case a.STATUS_WAITING_FOR_ACK:case a.STATUS_CONFIRMED:if(this.logger.log("terminating RTCSession"),s=t.reason_phrase||e.C.REASON_PHRASE[i]||"",i&&(i<200||i>=700))throw new TypeError("Invalid status_code: "+i);i&&l.push("Reason: SIP ;cause="+i+'; text="'+s+'"'),this.status===a.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==e.Transactions.C.STATUS_TERMINATED?(r=this.dialog,this.receiveRequest=function(t){t.method===e.C.ACK&&(this.sendRequest(e.C.BYE,{extraHeaders:l,body:u}),r.terminate())},this.request.server_transaction.on("stateChanged",function(t){t.sender.state===e.Transactions.C.STATUS_TERMINATED&&(c.sendRequest(e.C.BYE,{extraHeaders:l,body:u}),r.terminate())}),this.ended("local",null,o),this.dialog=r,this.ua.dialogs[r.id.toString()]=r):(this.sendRequest(e.C.BYE,{extraHeaders:l,body:u}),this.ended("local",null,o))}this.close()},t.prototype.answer=function(t){t=t||{};var n,o,i,s,l=!1,u=!1,c=this,d=this.request,p=t.extraHeaders&&t.extraHeaders.slice()||[],f=t.mediaConstraints||{},h=t.RTCAnswerConstraints||{},m=t.mediaStream||null,g=function(e){c.rtcMediaHandler.addStream(e,v,y)},v=function(){c.connecting(d),c.status!==a.STATUS_TERMINATED&&c.rtcMediaHandler.createAnswer(_,b,h)},y=function(){c.status!==a.STATUS_TERMINATED&&c.failed("system",null,e.C.causes.WEBRTC_ERROR)},_=function(t){d.reply(200,null,p,t,function(){c.status=a.STATUS_WAITING_FOR_ACK,c.setInvite2xxTimer(d,t),c.setACKTimer(),c.started("local")},function(){c.failed("system",null,e.C.causes.CONNECTION_ERROR)})},b=function(){c.status!==a.STATUS_TERMINATED&&c.failed("system",null,e.C.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new e.Exceptions.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==a.STATUS_WAITING_FOR_ANSWER)throw new e.Exceptions.InvalidStateError(this.status);if(this.status=a.STATUS_ANSWERED,this.createDialog(d,"UAS")){for(r.clearTimeout(this.timers.userNoAnswerTimer),p.unshift("Contact: "+c.contact),s=this.rtcMediaHandler.peerConnection.remoteDescription||{},(i=e.Parser.parseSDP(s.sdp||"")).media instanceof Array||(i.media=[i.media||[]]),n=i.media.length;n--;)"audio"!==i.media[n].type||"sendrecv"!==i.media[n].direction&&"recvonly"!==i.media[n].direction||(l=!0),"video"!==i.media[n].type||"sendrecv"!==i.media[n].direction&&"recvonly"!==i.media[n].direction||(u=!0);if(m&&!1===f.audio)for(o=m.getAudioTracks().length,n=0;n<o;n++)m.removeTrack(m.getAudioTracks()[n]);if(m&&!1===f.video)for(o=m.getVideoTracks().length,n=0;n<o;n++)m.removeTrack(m.getVideoTracks()[n]);void 0===f.audio&&(f.audio=l),void 0===f.video&&(f.video=u),m?g(m):this.rtcMediaHandler.getUserMedia(this.ua,g,function(){d.reply(480),c.failed("local",null,e.C.causes.USER_DENIED_MEDIA_ACCESS)},f)}else d.reply(500,"Missing Contact header field")},t.prototype.sendDTMF=function(t,n){var o,s,l=0,u=this;if(o=(n=n||{}).duration||null,s=n.interToneGap||null,void 0===t)throw new TypeError("Not enough arguments");if(this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.status);if("number"==typeof t&&(t=t.toString()),!t||"string"!=typeof t||!t.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+t);if(o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid tone duration: "+o);if(o?o<i.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+i.C.MIN_DURATION+" milliseconds"),o=i.C.MIN_DURATION):o>i.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+i.C.MAX_DURATION+" milliseconds"),o=i.C.MAX_DURATION):o=Math.abs(o):o=i.C.DEFAULT_DURATION,n.duration=o,s&&!e.Utils.isDecimal(s))throw new TypeError("Invalid interToneGap: "+s);if(s?s<i.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+i.C.MIN_INTER_TONE_GAP+" milliseconds"),s=i.C.MIN_INTER_TONE_GAP):s=Math.abs(s):s=i.C.DEFAULT_INTER_TONE_GAP,this.tones)this.tones+=t;else{this.tones=t;var c=function(){var e,t,d=u.tones;if(u.status===a.STATUS_TERMINATED||!d||l>=d.length)u.tones=null;else{if(e=d[l],l+=1,","===e)t=2e3;else{var p=new i(u);p.on("failed",function(){u.tones=null}),p.send(e,n),t=o+s}r.setTimeout(c,t)}};c()}},t.prototype.sendRequest=function(e,t){new n(this).send(e,t)},t.prototype.isReadyToReinvite=function(){if(this.rtcMediaHandler.isReady())return!0!==this.dialog.uac_pending_reply&&!0!==this.dialog.uas_pending_reply},t.prototype.mute=function(e){e=e||{audio:!0,video:!1};var t=!1,n=!1;!1===this.audioMuted&&e.audio&&(t=!0,this.audioMuted=!0,this.toogleMuteAudio(!0)),!1===this.videoMuted&&e.video&&(n=!0,this.videoMuted=!0,this.toogleMuteVideo(!0)),!0!==t&&!0!==n||this.onmute({audio:t,video:n})},t.prototype.unmute=function(e){e=e||{audio:!0,video:!0};var t=!1,n=!1;!0===this.audioMuted&&e.audio&&(t=!0,this.audioMuted=!1,!1===this.local_hold&&this.toogleMuteAudio(!1)),!0===this.videoMuted&&e.video&&(n=!0,this.videoMuted=!1,!1===this.local_hold&&this.toogleMuteVideo(!1)),!0!==t&&!0!==n||this.onunmute({audio:t,video:n})},t.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},t.prototype.hold=function(){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(this.toogleMuteAudio(!0),this.toogleMuteVideo(!0),!this.isReadyToReinvite())return this.pending_actions.isPending("unhold")?void this.pending_actions.pop("unhold"):this.pending_actions.isPending("hold")?void 0:void this.pending_actions.push("hold");!0!==this.local_hold&&(this.onhold("local"),this.sendReinvite({mangle:function(t){var n,r;for(r=(t=e.Parser.parseSDP(t)).media.length,n=0;n<r;n++)void 0===t.media[n].direction?t.media[n].direction="sendonly":"sendrecv"===t.media[n].direction?t.media[n].direction="sendonly":"sendonly"===t.media[n].direction&&(t.media[n].direction="inactive");return e.Parser.writeSDP(t)}}))},t.prototype.unhold=function(){if(this.status!==a.STATUS_WAITING_FOR_ACK&&this.status!==a.STATUS_CONFIRMED)throw new e.Exceptions.InvalidStateError(this.status);if(this.audioMuted||this.toogleMuteAudio(!1),this.videoMuted||this.toogleMuteVideo(!1),!this.isReadyToReinvite())return this.pending_actions.isPending("hold")?void this.pending_actions.pop("hold"):this.pending_actions.isPending("unhold")?void 0:void this.pending_actions.push("unhold");!1!==this.local_hold&&(this.onunhold("local"),this.sendReinvite())},t.prototype.isOnHold=function(){return{local:this.local_hold,remote:this.remote_hold}},t.prototype.setInvite2xxTimer=function(t,n){var o=this,i=e.Timers.T1;this.timers.invite2xxTimer=r.setTimeout(function s(){o.status===a.STATUS_WAITING_FOR_ACK&&(t.reply(200,null,["Contact: "+o.contact],n),i<e.Timers.T2&&(i*=2)>e.Timers.T2&&(i=e.Timers.T2),o.timers.invite2xxTimer=r.setTimeout(s,i))},i)},t.prototype.setACKTimer=function(){var t=this;this.timers.ackTimer=r.setTimeout(function(){t.status===a.STATUS_WAITING_FOR_ACK&&(t.logger.log("no ACK received, terminating the call"),r.clearTimeout(t.timers.invite2xxTimer),t.sendRequest(e.C.BYE),t.ended("remote",null,e.C.causes.NO_ACK))},e.Timers.TIMER_H)},t.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]},t.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]},t.prototype.init_incoming=function(t){var n,i=this,s=t.getHeader("Content-Type");t.body&&"application/sdp"===s?(this.status=a.STATUS_INVITE_RECEIVED,this.from_tag=t.from_tag,this.id=t.call_id+this.from_tag,this.request=t,this.contact=this.ua.contact.toString(),this.logger=this.ua.getLogger("jssip.rtcsession",this.id),this.ua.sessions[this.id]=this,t.hasHeader("expires")&&(n=1e3*t.getHeader("expires")),t.to_tag=e.Utils.newTag(),this.createDialog(t,"UAS",!0)?(this.rtcMediaHandler=new o(this,{constraints:{optional:[{DtlsSrtpKeyAgreement:"true"}]}}),this.rtcMediaHandler.onMessage("offer",t.body,function(){t.reply(180,null,["Contact: "+i.contact]),i.status=a.STATUS_WAITING_FOR_ANSWER,i.timers.userNoAnswerTimer=r.setTimeout(function(){t.reply(408),i.failed("local",null,e.C.causes.NO_ANSWER)},i.ua.configuration.no_answer_timeout),n&&(i.timers.expiresTimer=r.setTimeout(function(){i.status===a.STATUS_WAITING_FOR_ANSWER&&(t.reply(487),i.failed("system",null,e.C.causes.EXPIRES))},n)),i.newRTCSession("remote",t)},function(e){i.logger.warn("invalid SDP"),i.logger.warn(e),t.reply(488)})):t.reply(500,"Missing Contact header field")):t.reply(415)},t.prototype.connect=function(t,n){var r,i,s,l=t,u=(n=n||{}).eventHandlers||{},c=n.extraHeaders&&n.extraHeaders.slice()||[],d=n.mediaConstraints||{audio:!0,video:!0},p=n.mediaStream||null,f=n.RTCConstraints||{},h=n.RTCOfferConstraints||{},m=n.stun_servers||null,g=n.turn_servers||null;if(m){if(!(s=e.UA.configuration_check.optional.stun_servers(m)))throw new TypeError("Invalid stun_servers: "+m);m=s}if(g){if(!(s=e.UA.configuration_check.optional.turn_servers(g)))throw new TypeError("Invalid turn_servers: "+g);g=s}if(void 0===t)throw new TypeError("Not enough arguments");if(!e.WebRTC.isSupported)throw new e.Exceptions.NotSupportedError("WebRTC not supported");if(!(t=this.ua.normalizeTarget(t)))throw new TypeError("Invalid target: "+l);if(this.status!==a.STATUS_NULL)throw new e.Exceptions.InvalidStateError(this.status);for(r in u)this.on(r,u[r]);this.from_tag=e.Utils.newTag(),this.anonymous=n.anonymous||!1,this.isCanceled=!1,this.received_100=!1,i={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(i.from_display_name="Anonymous",i.from_uri="sip:anonymous@anonymous.invalid",c.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),c.push("Privacy: id")),c.push("Contact: "+this.contact),c.push("Content-Type: application/sdp"),this.request=new e.OutgoingRequest(e.C.INVITE,t,this.ua,i,c),this.id=this.request.call_id+this.from_tag,this.logger=this.ua.getLogger("jssip.rtcsession",this.id),this.rtcMediaHandler=new o(this,{constraints:f,stun_servers:m,turn_servers:g}),this.ua.sessions[this.id]=this,this.newRTCSession("local",this.request),this.sendInitialRequest(d,h,p)},t.prototype.close=function(){var e;if(this.status!==a.STATUS_TERMINATED){for(e in this.logger.log("closing INVITE session "+this.id),this.rtcMediaHandler&&this.rtcMediaHandler.close(),this.timers)r.clearTimeout(this.timers[e]);for(e in this.dialog&&(this.dialog.terminate(),delete this.dialog),this.earlyDialogs)this.earlyDialogs[e].terminate(),delete this.earlyDialogs[e];this.status=a.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},t.prototype.createDialog=function(t,n,r){var o,i,a="UAS"===n?t.to_tag:t.from_tag,s="UAS"===n?t.from_tag:t.to_tag,l=t.call_id+a+s;return i=this.earlyDialogs[l],r?!!i||((i=new e.Dialog(this,t,n,e.Dialog.C.STATUS_EARLY)).error?(this.logger.error(o.error),this.failed("remote",t,e.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[l]=i,!0)):i?(i.update(t,n),this.dialog=i,delete this.earlyDialogs[l],!0):(o=new e.Dialog(this,t,n)).error?(this.logger.error(o.error),this.failed("remote",t,e.C.causes.INTERNAL_ERROR),!1):(this.to_tag=t.to_tag,this.dialog=o,!0)},t.prototype.receiveReinvite=function(t){var n,r,o,i=this,s=t.getHeader("Content-Type"),l=!0;if(t.body){if("application/sdp"!==s)return this.logger.warn("invalid Content-Type"),void t.reply(415);for(n=e.Parser.parseSDP(t.body),r=0;r<n.media.length;r++)"sendonly"!==(o=n.direction||n.media[r].direction||"sendrecv")&&"inactive"!==o&&(l=!1);this.rtcMediaHandler.onMessage("offer",t.body,function(){i.rtcMediaHandler.createAnswer(function(e){t.reply(200,null,["Contact: "+i.contact],e,function(){i.status=a.STATUS_WAITING_FOR_ACK,i.setInvite2xxTimer(t,e),i.setACKTimer(),!0===i.remote_hold&&!1===l?i.onunhold("remote"):!1===i.remote_hold&&!0===l&&i.onhold("remote")})},function(){t.reply(500)})},function(e){i.logger.error(e),t.reply(488)})}},t.prototype.receiveRequest=function(t){var n;if(t.method===e.C.CANCEL)this.status!==a.STATUS_WAITING_FOR_ANSWER&&this.status!==a.STATUS_ANSWERED||(this.status=a.STATUS_CANCELED,this.request.reply(487),this.failed("remote",t,e.C.causes.CANCELED));else switch(t.method){case e.C.ACK:this.status===a.STATUS_WAITING_FOR_ACK&&(r.clearTimeout(this.timers.ackTimer),r.clearTimeout(this.timers.invite2xxTimer),this.status=a.STATUS_CONFIRMED);break;case e.C.BYE:this.status===a.STATUS_CONFIRMED&&(t.reply(200),this.ended("remote",t,e.C.causes.BYE));break;case e.C.INVITE:this.status===a.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(t));break;case e.C.INFO:this.status!==a.STATUS_CONFIRMED&&this.status!==a.STATUS_WAITING_FOR_ACK||(n=t.getHeader("content-type"))&&n.match(/^application\/dtmf-relay/i)&&new i(this).init_incoming(t)}},t.prototype.sendInitialRequest=function(t,n,r){var o=this,i=new e.RequestSender(o,this.ua),s=function(e){o.rtcMediaHandler.addStream(e,l,u)},l=function(){o.connecting(o.request),o.status!==a.STATUS_TERMINATED&&o.rtcMediaHandler.createOffer(c,d,n)},u=function(){o.status!==a.STATUS_TERMINATED&&o.failed("system",null,e.C.causes.WEBRTC_ERROR)},c=function(e){o.isCanceled||o.status===a.STATUS_TERMINATED||(o.request.body=e,o.status=a.STATUS_INVITE_SENT,i.send())},d=function(){o.status!==a.STATUS_TERMINATED&&o.failed("system",null,e.C.causes.WEBRTC_ERROR)};this.receiveResponse=this.receiveInviteResponse,r?s(r):this.rtcMediaHandler.getUserMedia(this.ua,s,function(){o.status!==a.STATUS_TERMINATED&&o.failed("local",null,e.C.causes.USER_DENIED_MEDIA_ACCESS)},t)},t.prototype.sendReinvite=function(t){var n=this,r=(t=t||{}).extraHeaders||[],o=t.eventHandlers||{},i=t.mangle||null;o.succeeded?this.reinviteSucceeded=o.succeeded:this.reinviteSucceeded=function(){},o.failed?this.reinviteFailed=o.failed:this.reinviteFailed=function(){},r.push("Contact: "+this.contact),r.push("Allow: "+e.Utils.getAllowedMethods(this.ua)),r.push("Content-Type: application/sdp"),this.receiveResponse=this.receiveReinviteResponse,this.rtcMediaHandler.createOffer(function(t){i&&(t=i(t)),n.dialog.sendRequest(n,e.C.INVITE,{extraHeaders:r,body:t})},function(){n.isReadyToReinvite()&&n.onReadyToReinvite(),n.reinviteFailed()})},t.prototype.receiveInviteResponse=function(t){var n,r,o=this;if(this.dialog&&t.status_code>=200&&t.status_code<=299)return this.dialog.id.call_id===t.call_id&&this.dialog.id.local_tag===t.from_tag&&this.dialog.id.remote_tag===t.to_tag?void this.sendRequest(e.C.ACK):void 0!==(r=new e.Dialog(this,t,"UAC")).error?void this.logger.error(r.error):(r.sendRequest({owner:{status:a.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},e.C.ACK),void r.sendRequest({owner:{status:a.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},e.C.BYE));if(this.status===a.STATUS_INVITE_SENT||this.status===a.STATUS_1XX_RECEIVED)if(this.isCanceled)t.status_code>=100&&t.status_code<200?this.request.cancel(this.cancelReason):t.status_code>=200&&t.status_code<299&&this.acceptAndTerminate(t);else switch(!0){case/^100$/.test(t.status_code):this.received_100=!0;break;case/^1[0-9]{2}$/.test(t.status_code):if(this.status!==a.STATUS_INVITE_SENT&&this.status!==a.STATUS_1XX_RECEIVED)break;if(!t.to_tag){this.logger.warn("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this.createDialog(t,"UAC",!0))break;if(!t.body){o.status=a.STATUS_1XX_RECEIVED,o.progress("remote",t);break}this.rtcMediaHandler.onMessage("pranswer",t.body,function(){o.status=a.STATUS_1XX_RECEIVED,o.progress("remote",t)},function(e){o.logger.warn(e),this.earlyDialogs[t.call_id+t.from_tag+t.to_tag].terminate()});break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=a.STATUS_CONFIRMED,!t.body){this.acceptAndTerminate(t,400,"Missing session description"),this.failed("remote",t,e.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(t,"UAC"))break;this.rtcMediaHandler.onMessage("answer",t.body,function(){o.sendRequest(e.C.ACK),o.started("remote",t)},function(n){o.logger.warn(n),o.acceptAndTerminate(t,488,"Not Acceptable Here"),o.failed("remote",t,e.C.causes.BAD_MEDIA_DESCRIPTION)});break;default:n=e.Utils.sipErrorCause(t.status_code),this.failed("remote",t,n)}},t.prototype.receiveReinviteResponse=function(t){var n=this,r=t.getHeader("Content-Type");if(this.status!==a.STATUS_TERMINATED)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(this.status=a.STATUS_CONFIRMED,this.sendRequest(e.C.ACK),!t.body){this.reinviteFailed();break}if("application/sdp"!==r){this.reinviteFailed();break}this.rtcMediaHandler.onMessage("answer",t.body,function(){n.reinviteSucceeded()},function(){n.reinviteFailed()});break;default:this.reinviteFailed()}},t.prototype.acceptAndTerminate=function(t,n,r){var o=[];n&&(r=r||e.C.REASON_PHRASE[n]||"",o.push("Reason: SIP ;cause="+n+'; text="'+r+'"')),(this.dialog||this.createDialog(t,"UAC"))&&(this.sendRequest(e.C.ACK),this.sendRequest(e.C.BYE,{extraHeaders:o})),this.status=a.STATUS_TERMINATED},t.prototype.toogleMuteAudio=function(e){var t,n,r,o=this.getLocalStreams();for(t in o)for(n in r=o[t].getAudioTracks())r[n].enabled=!e},t.prototype.toogleMuteVideo=function(e){var t,n,r,o=this.getLocalStreams();for(t in o)for(n in r=o[t].getVideoTracks())r[n].enabled=!e},t.prototype.onTransportError=function(){this.status!==a.STATUS_TERMINATED&&(this.status===a.STATUS_CONFIRMED?this.ended("system",null,e.C.causes.CONNECTION_ERROR):this.failed("system",null,e.C.causes.CONNECTION_ERROR))},t.prototype.onRequestTimeout=function(){this.status!==a.STATUS_TERMINATED&&(this.status===a.STATUS_CONFIRMED?this.ended("system",null,e.C.causes.REQUEST_TIMEOUT):this.failed("system",null,e.C.causes.REQUEST_TIMEOUT))},t.prototype.onDialogError=function(t){this.status!==a.STATUS_TERMINATED&&(this.status===a.STATUS_CONFIRMED?this.ended("remote",t,e.C.causes.DIALOG_ERROR):this.failed("remote",t,e.C.causes.DIALOG_ERROR))},t.prototype.newRTCSession=function(e,t){"remote"===e?(this.direction="incoming",this.local_identity=t.to,this.remote_identity=t.from):"local"===e&&(this.direction="outgoing",this.local_identity=t.from,this.remote_identity=t.to),this.ua.emit("newRTCSession",this.ua,{originator:e,session:this,request:t})},t.prototype.connecting=function(e){this.emit("connecting",this,{request:e})},t.prototype.progress=function(e,t){this.emit("progress",this,{originator:e,response:t||null})},t.prototype.started=function(e,t){this.start_time=new Date,this.emit("started",this,{originator:e,response:t||null})},t.prototype.ended=function(e,t,n){this.end_time=new Date,this.close(),this.emit("ended",this,{originator:e,message:t||null,cause:n})},t.prototype.failed=function(e,t,n){this.close(),this.emit("failed",this,{originator:e,message:t||null,cause:n})},t.prototype.onhold=function(e){"local"===e?this.local_hold=!0:this.remote_hold=!0,this.emit("hold",this,{originator:e})},t.prototype.onunhold=function(e){"local"===e?this.local_hold=!1:this.remote_hold=!1,this.emit("unhold",this,{originator:e})},t.prototype.onmute=function(e){this.emit("muted",this,{audio:e.audio,video:e.video})},t.prototype.onunmute=function(e){this.emit("unmuted",this,{audio:e.audio,video:e.video})},t.prototype.onReadyToReinvite=function(){var e=this.pending_actions.length()>0?this.pending_actions.shift():null;e&&("hold"===e.name?this.hold():"unhold"===e.name&&this.unhold())},t.C=a,e.RTCSession=t}(o),function(e){var t;((t=function(e){this.ua=e,this.logger=e.getLogger("jssip.message"),this.data={}}).prototype=new e.EventEmitter).send=function(t,n,r){var o,i,a,s,l,u=t;if(void 0===t||void 0===n)throw new TypeError("Not enough arguments");if(!(t=this.ua.normalizeTarget(t)))throw new TypeError("Invalid target: "+u);for(i in this.initEvents(["succeeded","failed"]),l=(r=r||{}).extraHeaders&&r.extraHeaders.slice()||[],s=r.eventHandlers||{},a=r.contentType||"text/plain",this.content_type=a,s)this.on(i,s[i]);this.closed=!1,this.ua.applicants[this]=this,l.push("Content-Type: "+a),this.request=new e.OutgoingRequest(e.C.MESSAGE,t,this.ua,null,l),n?(this.request.body=n,this.content=n):this.content=null,o=new e.RequestSender(this,this.ua),this.newMessage("local",this.request),o.send()},t.prototype.receiveResponse=function(t){var n;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):delete this.ua.applicants[this],this.emit("succeeded",this,{originator:"remote",response:t});break;default:delete this.ua.applicants[this],n=e.Utils.sipErrorCause(t.status_code),this.emit("failed",this,{originator:"remote",response:t,cause:n})}},t.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.C.causes.REQUEST_TIMEOUT})},t.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.C.causes.CONNECTION_ERROR})},t.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},t.prototype.init_incoming=function(t){var n;this.request=t,this.content_type=t.getHeader("Content-Type"),t.body?this.content=t.body:this.content=null,this.newMessage("remote",t),!(n=this.ua.transactions.nist[t.via_branch])||n.state!==e.Transactions.C.STATUS_TRYING&&n.state!==e.Transactions.C.STATUS_PROCEEDING||t.reply(200)},t.prototype.accept=function(t){var n=(t=t||{}).extraHeaders&&t.extraHeaders.slice()||[],r=t.body;if("incoming"!==this.direction)throw new e.Exceptions.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,n,r)},t.prototype.reject=function(t){var n=(t=t||{}).status_code||480,r=t.reason_phrase,o=t.extraHeaders&&t.extraHeaders.slice()||[],i=t.body;if("incoming"!==this.direction)throw new e.Exceptions.NotSupportedError('"reject" not supported for outgoing Message');if(n<300||n>=700)throw new TypeError("Invalid status_code: "+n);this.request.reply(n,r,o,i)},t.prototype.newMessage=function(e,t){"remote"===e?(this.direction="incoming",this.local_identity=t.to,this.remote_identity=t.from):"local"===e&&(this.direction="outgoing",this.local_identity=t.from,this.remote_identity=t.to),this.ua.emit("newMessage",this.ua,{originator:e,message:this,request:t})},e.Message=t}(o),function(e){var t,n={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE",newMessage:"MESSAGE"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:69,TAG_LENGTH:10};((t=function(t){if(n.ACCEPTED_BODY_TYPES=n.ACCEPTED_BODY_TYPES.toString(),this.log=new e.LoggerFactory,this.logger=this.getLogger("jssip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=n.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===t)throw new TypeError("Not enough arguments");t.log&&(t.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=t.log.builtinEnabled),t.log.hasOwnProperty("level")&&(this.log.level=t.log.level),t.log.hasOwnProperty("connector")&&(this.log.connector=t.log.connector));try{this.loadConfig(t),this.initEvents(["connecting","connected","disconnected","newTransaction","transactionDestroyed","registered","unregistered","registrationFailed","newRTCSession","newMessage","mediaPermissionsRequest","mediaPermissionsAccept","mediaPermissionsRefuse"])}catch(e){throw this.status=n.STATUS_NOT_READY,this.error=n.CONFIGURATION_ERROR,e}this.registrator=new e.Registrator(this)}).prototype=new e.EventEmitter).register=function(e){this.configuration.register=!0,this.registrator.register(e)},t.prototype.unregister=function(e){this.configuration.register=!1,this.registrator.unregister(e)},t.prototype.isRegistered=function(){return!!this.registrator.registered},t.prototype.isConnected=function(){return!!this.transport&&this.transport.connected},t.prototype.call=function(t,n){new e.RTCSession(this).connect(t,n)},t.prototype.sendMessage=function(t,n,r){new e.Message(this).send(t,n,r)},t.prototype.stop=function(){var e,t,o=this;if(this.logger.log("user requested closure..."),this.status!==n.STATUS_USER_CLOSED){for(e in r.clearTimeout(this.transportRecoveryTimer),this.logger.log("closing registrator"),this.registrator.close(),this.sessions)this.logger.log("closing session "+e),this.sessions[e].terminate();for(t in this.applicants)this.applicants[t].close();this.status=n.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",function e(){0===o.nistTransactionsCount&&0===o.nictTransactionsCount&&(o.removeListener("transactionDestroyed",e),o.transport.disconnect())})}else this.logger.warn("UA already closed")},t.prototype.start=function(){var t;this.logger.log("user requested startup..."),this.status===n.STATUS_INIT?(t=this.getNextWsServer(),new e.Transport(this,t)):this.status===n.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=n.STATUS_READY,this.transport.connect()):this.status===n.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect")},t.prototype.normalizeTarget=function(t){return e.Utils.normalizeTarget(t,this.configuration.hostport_params)},t.prototype.saveCredentials=function(e){this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e},t.prototype.getCredentials=function(e){var t,n;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&((n=this.cache.credentials[t][e.ruri]).method=e.method),n},t.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},t.prototype.onTransportClosed=function(t){var n,r,o,i=["nict","ict","nist","ist"];for(t.server.status=e.Transport.C.STATUS_DISCONNECTED,this.logger.log("connection state set to "+e.Transport.C.STATUS_DISCONNECTED),o=i.length,n=0;n<o;n++)for(r in this.transactions[i[n]])this.transactions[i[n]][r].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},t.prototype.onTransportError=function(t){var r;this.logger.log("transport "+t.server.ws_uri+" failed | connection state set to "+e.Transport.C.STATUS_ERROR),t.server.status=e.Transport.C.STATUS_ERROR,this.emit("disconnected",this,{transport:t,code:t.lastTransportError.code,reason:t.lastTransportError.reason}),(r=this.getNextWsServer())?new e.Transport(this,r):(this.closeSessionsOnTransportError(),this.error&&this.error===n.NETWORK_ERROR||(this.status=n.STATUS_NOT_READY,this.error=n.NETWORK_ERROR),this.recoverTransport())},t.prototype.onTransportConnected=function(t){this.transport=t,this.transportRecoverAttempts=0,t.server.status=e.Transport.C.STATUS_READY,this.logger.log("connection state set to "+e.Transport.C.STATUS_READY),this.status!==n.STATUS_USER_CLOSED&&(this.status=n.STATUS_READY,this.error=null,this.configuration.register&&this.registrator.onTransportConnected(),this.emit("connected",this,{transport:t}))},t.prototype.onTransportConnecting=function(e,t){this.emit("connecting",this,{transport:e,attempts:t})},t.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",this,{transaction:e})},t.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",this,{transaction:e})},t.prototype.receiveRequest=function(t){var n,r,o=t.method;if(t.ruri.user!==this.configuration.uri.user&&t.ruri.user!==this.contact.uri.user)return this.logger.warn("Request-URI does not point to us"),void(t.method!==e.C.ACK&&t.reply_sl(404));if(t.ruri.scheme!==e.C.SIPS){if(!e.Transactions.checkTransaction(this,t)){if(o===e.C.INVITE?new e.Transactions.InviteServerTransaction(t,this):o!==e.C.ACK&&new e.Transactions.NonInviteServerTransaction(t,this),o===e.C.OPTIONS)t.reply(200);else if(o===e.C.MESSAGE){if(!this.checkEvent("newMessage")||0===this.listeners("newMessage").length)return void t.reply(405);new e.Message(this).init_incoming(t)}else if(o===e.C.INVITE&&(!this.checkEvent("newRTCSession")||0===this.listeners("newRTCSession").length))return void t.reply(405);if(t.to_tag)(n=this.findDialog(t))?n.receiveRequest(t):o===e.C.NOTIFY?(r=this.findSession(t))?r.receiveRequest(t):(this.logger.warn("received NOTIFY request for a non existent session"),t.reply(481,"Subscription does not exist")):o!==e.C.ACK&&t.reply(481);else switch(o){case e.C.INVITE:e.WebRTC.isSupported?(r=new e.RTCSession(this)).init_incoming(t):(this.logger.warn("INVITE received but WebRTC is not supported"),t.reply(488));break;case e.C.BYE:t.reply(481);break;case e.C.CANCEL:(r=this.findSession(t))?r.receiveRequest(t):this.logger.warn("received CANCEL request for a non existent session");break;case e.C.ACK:break;default:t.reply(405)}}}else t.reply_sl(416)},t.prototype.findSession=function(e){var t=e.call_id+e.from_tag,n=this.sessions[t],r=e.call_id+e.to_tag,o=this.sessions[r];return n||(o||null)},t.prototype.findDialog=function(e){var t=e.call_id+e.from_tag+e.to_tag,n=this.dialogs[t];return n||(t=e.call_id+e.to_tag+e.from_tag,(n=this.dialogs[t])||null)},t.prototype.getNextWsServer=function(){var t,n,r,o=[];for(n=this.configuration.ws_servers.length,t=0;t<n;t++)(r=this.configuration.ws_servers[t]).status!==e.Transport.C.STATUS_ERROR&&(0===o.length?o.push(r):r.weight>o[0].weight?o=[r]:r.weight===o[0].weight&&o.push(r));return o[t=Math.floor(Math.random()*o.length)]},t.prototype.closeSessionsOnTransportError=function(){var e;for(e in this.sessions)this.sessions[e].onTransportError();this.registrator.onTransportClosed()},t.prototype.recoverTransport=function(t){var n,o,i,a,s;for(a=(t=t||this).transportRecoverAttempts,o=t.configuration.ws_servers.length,n=0;n<o;n++)t.configuration.ws_servers[n].status=0;s=t.getNextWsServer(),(i=Math.floor(Math.random()*Math.pow(2,a)+1)*t.configuration.connection_recovery_min_interval)>t.configuration.connection_recovery_max_interval&&(this.logger.log("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),i=t.configuration.connection_recovery_min_interval,a=0),this.logger.log("next connection attempt in "+i+" seconds"),this.transportRecoveryTimer=r.setTimeout(function(){t.transportRecoverAttempts=a+1,new e.Transport(t,s)},1e3*i)},t.prototype.loadConfig=function(n){var o,i,a,s,l,u={via_host:e.Utils.createRandomToken(12)+".invalid",password:null,register_expires:n.register_expires||600,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],trace_sip:!1,hack_via_tcp:!1,hack_ip_in_contact:!1};for(o in t.configuration_check.mandatory){if(!n.hasOwnProperty(o))throw new e.Exceptions.ConfigurationError(o);if(i=n[o],void 0===(a=t.configuration_check.mandatory[o](i)))throw new e.Exceptions.ConfigurationError(o,i);u[o]=a}for(o in t.configuration_check.optional)if(n.hasOwnProperty(o)){if(i=n[o],e.Utils.isEmpty(i))continue;if(void 0===(a=t.configuration_check.optional[o](i)))throw new e.Exceptions.ConfigurationError(o,i);u[o]=a}if(u.connection_recovery_max_interval<u.connection_recovery_min_interval)throw new e.Exceptions.ConfigurationError("connection_recovery_max_interval",u.connection_recovery_max_interval);for(o in 0===u.display_name&&(u.display_name="0"),u.instance_id||(u.instance_id=e.Utils.newUUID()),u.jssip_id=e.Utils.createRandomToken(5),(s=u.uri.clone()).user=null,u.hostport_params=s.toString().replace(/^sip:/i,""),u.authorization_user||(u.authorization_user=u.uri.user),u.registrar_server||((l=u.uri.clone()).user=null,u.registrar_server=l),u.no_answer_timeout=1e3*u.no_answer_timeout,u.hack_ip_in_contact&&(u.via_host=e.Utils.getRandomTestNetIP()),(i=n.stun_servers)instanceof Array&&0===i.length&&(u.stun_servers=[]),this.contact={pub_gruu:null,temp_gruu:null,uri:new e.URI("sip",u.uri.user,u.via_host,null,{transport:"ws"}),toString:function(e){var t=(e=e||{}).anonymous||null,n=e.outbound||null,r="<";return r+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!n||(t?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}},u)t.configuration_skeleton[o].value=u[o];for(o in Object.defineProperties(this.configuration,t.configuration_skeleton),u)t.configuration_skeleton[o].value="";for(o in this.logger.log("configuration parameters after validation:"),u)switch(o){case"uri":case"registrar_server":this.logger.log("· "+o+": "+u[o]);break;case"password":this.logger.log("· "+o+": NOT SHOWN");break;default:this.logger.log("· "+o+": "+r.JSON.stringify(u[o]))}},t.configuration_skeleton=function(){var e,t={},n=["jssip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_ip_in_contact","instance_id","no_answer_timeout","password","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","via_core_value","via_host"];for(e in n)t[n[e]]={value:"",writable:!1,configurable:!1};return t.register={value:"",writable:!0,configurable:!1},t}(),t.configuration_check={mandatory:{uri:function(t){var n;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(n=e.URI.parse(t))&&n.user?n:void 0},ws_servers:function(t){var n,r,o;if("string"==typeof t)t=[{ws_uri:t}];else{if(!(t instanceof Array))return;for(r=t.length,n=0;n<r;n++)"string"==typeof t[n]&&(t[n]={ws_uri:t[n]})}if(0===t.length)return!1;for(r=t.length,n=0;n<r;n++){if(!t[n].ws_uri)return void this.logger.error('missing "ws_uri" attribute in ws_servers parameter');if(t[n].weight&&!Number(t[n].weight))return void this.logger.error('"weight" attribute in ws_servers parameter must be a Number');if(-1===(o=e.Grammar.parse(t[n].ws_uri,"absoluteURI")))return void this.logger.error('invalid "ws_uri" attribute in ws_servers parameter: '+t[n].ws_uri);if("wss"!==o.scheme&&"ws"!==o.scheme)return void this.logger.error("invalid URI scheme in ws_servers parameter: "+o.scheme);t[n].sip_uri="<sip:"+o.host+(o.port?":"+o.port:"")+";transport=ws;lr>",t[n].weight||(t[n].weight=0),t[n].status=0,t[n].scheme=o.scheme.toUpperCase()}return t}},optional:{authorization_user:function(t){return-1===e.Grammar.parse('"'+t+'"',"quoted_string")?void 0:t},connection_recovery_max_interval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=r.Number(t))>0)return n},connection_recovery_min_interval:function(t){var n;if(e.Utils.isDecimal(t)&&(n=r.Number(t))>0)return n},display_name:function(t){return-1===e.Grammar.parse('"'+t+'"',"display_name")?void 0:t},hack_via_tcp:function(e){if("boolean"==typeof e)return e},hack_ip_in_contact:function(e){if("boolean"==typeof e)return e},instance_id:function(t){return/^uuid:/i.test(t)&&(t=t.substr(5)),-1===e.Grammar.parse(t,"uuid")?void 0:t},no_answer_timeout:function(t){var n;if(e.Utils.isDecimal(t)&&(n=r.Number(t))>0)return n},password:function(e){return String(e)},register:function(e){if("boolean"==typeof e)return e},register_expires:function(t){var n;if(e.Utils.isDecimal(t)&&(n=r.Number(t))>0)return n},registrar_server:function(t){var n;return/^sip:/i.test(t)||(t=e.C.SIP+":"+t),(n=e.URI.parse(t))?n.user?void 0:n:void 0},stun_servers:function(t){var n,r,o;if("string"==typeof t)t=[t];else if(!(t instanceof Array))return;for(r=t.length,n=0;n<r;n++){if(o=t[n],/^stuns?:/.test(o)||(o="stun:"+o),-1===e.Grammar.parse(o,"stun_URI"))return;t[n]=o}return t},trace_sip:function(e){if("boolean"==typeof e)return e},turn_servers:function(t){var n,r,o,i,a,s;for(t instanceof Array||(t=[t]),o=t.length,n=0;n<o;n++){if((a=t[n]).server&&(a.urls=[a.server]),a.password&&(a.credential=[a.password]),!a.urls||!a.username||!a.credential)return;for(a.urls instanceof Array||(a.urls=[a.urls]),i=a.urls.length,r=0;r<i;r++)if(s=a.urls[r],/^turns?:/.test(s)||(s="turn:"+s),-1===e.Grammar.parse(s,"turn_URI"))return}return t},use_preloaded_route:function(e){if("boolean"==typeof e)return e}}},t.C=n,e.UA=t}(o),function(e){var t;t={str_utf8_length:function(e){return r.unescape(encodeURIComponent(e)).length},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},isEmpty:function(e){if(null===e||""===e||void 0===e||e instanceof Array&&0===e.length||"number"==typeof e&&r.isNaN(e))return!0},createRandomToken:function(e,t){var n,r="";for(t=t||32,n=0;n<e;n++)r+=(Math.random()*t|0).toString(t);return r},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},hostType:function(t){if(t)return-1!==(t=e.Grammar.parse(t,"host"))?t.host_type:void 0},normalizeTarget:function(t,n){var r,o,i,a;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch((o=t.split("@")).length){case 1:if(!n)return;i=t,a=n;break;case 2:i=o[0],a=o[1];break;default:i=o.slice(0,o.length-1).join("@"),a=o[o.length-1]}return i=i.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(i)&&(i=i.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(i)+"@"+a,(r=e.URI.parse(t))?r:void 0}}else;},escapeUser:function(e){return r.encodeURIComponent(r.decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),o="",i=r.length;for(t=0;t<i;t++)0!==t&&(o+="-"),o+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[o]&&(o=n[o]),o},sipErrorCause:function(t){var n;for(n in e.C.SIP_ERROR_CAUSES)if(-1!==e.C.SIP_ERROR_CAUSES[n].indexOf(t))return e.C.causes[n];return e.C.causes.SIP_FAILURE_CODE},getRandomTestNetIP:function(){return"192.0.2."+function(e,t){return r.Math.floor(r.Math.random()*(t-e+1)+e)}(1,254)},getAllowedMethods:function(t){var n,r=e.UA.C.ALLOWED_METHODS.toString();for(n in e.UA.C.EVENT_METHODS)t.checkEvent(n)&&t.listeners(n).length>0&&(r+=","+e.UA.C.EVENT_METHODS[n]);return r},calculateMD5:function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,o,i,a;return o=2147483648&e,i=2147483648&t,a=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(r=1073741824&t)?2147483648^a^o^i:n|r?1073741824&a?3221225472^a^o^i:1073741824^a^o^i:a^o^i}function r(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return e&t|~e&n}(r,o,i),a),l)),s),r)}function o(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return e&n|t&~n}(r,o,i),a),l)),s),r)}function i(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return e^t^n}(r,o,i),a),l)),s),r)}function a(e,r,o,i,a,s,l){return n(t(e=n(e,n(n(function(e,t,n){return t^(e|~n)}(r,o,i),a),l)),s),r)}function s(e){var t,n="",r="";for(t=0;t<=3;t++)n+=(r="0"+(e>>>8*t&255).toString(16)).substr(r.length-2,2);return n}var l,u,c,d,p,f,h,m,g,v;for(l=function(e){for(var t,n=e.length,r=n+8,o=16*((r-r%64)/64+1),i=Array(o-1),a=0,s=0;s<n;)a=s%4*8,i[t=(s-s%4)/4]=i[t]|e.charCodeAt(s)<<a,s++;return a=s%4*8,i[t=(s-s%4)/4]=i[t]|128<<a,i[o-2]=n<<3,i[o-1]=n>>>29,i}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}(e)),h=1732584193,m=4023233417,g=2562383102,v=271733878,u=0;u<l.length;u+=16)c=h,d=m,p=g,f=v,m=a(m=a(m=a(m=a(m=i(m=i(m=i(m=i(m=o(m=o(m=o(m=o(m=r(m=r(m=r(m=r(m,g=r(g,v=r(v,h=r(h,m,g,v,l[u+0],7,3614090360),m,g,l[u+1],12,3905402710),h,m,l[u+2],17,606105819),v,h,l[u+3],22,3250441966),g=r(g,v=r(v,h=r(h,m,g,v,l[u+4],7,4118548399),m,g,l[u+5],12,1200080426),h,m,l[u+6],17,2821735955),v,h,l[u+7],22,4249261313),g=r(g,v=r(v,h=r(h,m,g,v,l[u+8],7,1770035416),m,g,l[u+9],12,2336552879),h,m,l[u+10],17,4294925233),v,h,l[u+11],22,2304563134),g=r(g,v=r(v,h=r(h,m,g,v,l[u+12],7,1804603682),m,g,l[u+13],12,4254626195),h,m,l[u+14],17,2792965006),v,h,l[u+15],22,1236535329),g=o(g,v=o(v,h=o(h,m,g,v,l[u+1],5,4129170786),m,g,l[u+6],9,3225465664),h,m,l[u+11],14,643717713),v,h,l[u+0],20,3921069994),g=o(g,v=o(v,h=o(h,m,g,v,l[u+5],5,3593408605),m,g,l[u+10],9,38016083),h,m,l[u+15],14,3634488961),v,h,l[u+4],20,3889429448),g=o(g,v=o(v,h=o(h,m,g,v,l[u+9],5,568446438),m,g,l[u+14],9,3275163606),h,m,l[u+3],14,4107603335),v,h,l[u+8],20,1163531501),g=o(g,v=o(v,h=o(h,m,g,v,l[u+13],5,2850285829),m,g,l[u+2],9,4243563512),h,m,l[u+7],14,1735328473),v,h,l[u+12],20,2368359562),g=i(g,v=i(v,h=i(h,m,g,v,l[u+5],4,4294588738),m,g,l[u+8],11,2272392833),h,m,l[u+11],16,1839030562),v,h,l[u+14],23,4259657740),g=i(g,v=i(v,h=i(h,m,g,v,l[u+1],4,2763975236),m,g,l[u+4],11,1272893353),h,m,l[u+7],16,4139469664),v,h,l[u+10],23,3200236656),g=i(g,v=i(v,h=i(h,m,g,v,l[u+13],4,681279174),m,g,l[u+0],11,3936430074),h,m,l[u+3],16,3572445317),v,h,l[u+6],23,76029189),g=i(g,v=i(v,h=i(h,m,g,v,l[u+9],4,3654602809),m,g,l[u+12],11,3873151461),h,m,l[u+15],16,530742520),v,h,l[u+2],23,3299628645),g=a(g,v=a(v,h=a(h,m,g,v,l[u+0],6,4096336452),m,g,l[u+7],10,1126891415),h,m,l[u+14],15,2878612391),v,h,l[u+5],21,4237533241),g=a(g,v=a(v,h=a(h,m,g,v,l[u+12],6,1700485571),m,g,l[u+3],10,2399980690),h,m,l[u+10],15,4293915773),v,h,l[u+1],21,2240044497),g=a(g,v=a(v,h=a(h,m,g,v,l[u+8],6,1873313359),m,g,l[u+15],10,4264355552),h,m,l[u+6],15,2734768916),v,h,l[u+13],21,1309151649),g=a(g,v=a(v,h=a(h,m,g,v,l[u+4],6,4149444226),m,g,l[u+11],10,3174756917),h,m,l[u+2],15,718787259),v,h,l[u+9],21,3951481745),h=n(h,c),m=n(m,d),g=n(g,p),v=n(v,f);return(s(h)+s(m)+s(g)+s(v)).toLowerCase()}},e.Utils=t}(o),function(e){var t,n,r,o,i,a=[],s=[],l=[];function u(t){for(var n,o="SIP/2.0 "+t+" "+e.C.REASON_PHRASE[t]+"\r\n",a=r.getHeaders("via"),s=a.length,l=0;l<s;l++)o+="Via: "+a[l]+"\r\n";n=r.getHeader("To"),r.to_tag||(n+=";tag="+e.Utils.newTag()),o+="To: "+n+"\r\n",o+="From: "+r.getHeader("From")+"\r\n",o+="Call-ID: "+r.call_id+"\r\n",o+="CSeq: "+r.cseq+" "+r.method+"\r\n",o+="\r\n",i.send(o)}a.push(function(){if("sip"!==r.s("to").uri.scheme)return u(416),!1}),a.push(function(){if(!r.to_tag&&r.call_id.substr(0,5)===o.configuration.jssip_id)return u(482),!1}),a.push(function(){if(e.Utils.str_utf8_length(r.body)<r.getHeader("content-length"))return u(400),!1}),a.push(function(){var t,n,i=r.from_tag,a=r.call_id,s=r.cseq;if(!r.to_tag)if(r.method===e.C.INVITE){if(!(t=o.transactions.ist[r.via_branch]))return;for(n in o.transactions.ist)if((t=o.transactions.ist[n]).request.from_tag===i&&t.request.call_id===a&&t.request.cseq===s)return u(482),!1}else{if(!(t=o.transactions.nist[r.via_branch]))return;for(n in o.transactions.nist)if((t=o.transactions.nist[n]).request.from_tag===i&&t.request.call_id===a&&t.request.cseq===s)return u(482),!1}}),s.push(function(){if(r.getHeaders("via").length>1)return n.warn("More than one Via header field present in the response. Dropping the response"),!1}),s.push(function(){if(e.Utils.str_utf8_length(r.body)<r.getHeader("content-length"))return n.warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1}),l.push(function(){for(var e=["from","to","call_id","cseq","via"],t=e.length;t--;)if(!r.hasHeader(e[t]))return n.warn("Missing mandatory header field : "+e[t]+". Dropping the response"),!1}),t=function(t,u,c){var d;for(r=t,i=c,n=(o=u).getLogger("jssip.sanitycheck"),d=l.length;d--;)if(!1===l[d](r))return!1;if(r instanceof e.IncomingRequest){for(d=a.length;d--;)if(!1===a[d](r))return!1}else if(r instanceof e.IncomingResponse)for(d=s.length;d--;)if(!1===s[d](r))return!1;return!0},e.sanityCheck=t}(o),function(e){var t;(t=function(e){this.logger=e.getLogger("jssip.digestauthentication"),this.username=e.configuration.authorization_user,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}).prototype.authenticate=function(t,n){if(this.algorithm=n.algorithm,this.realm=n.realm,this.nonce=n.nonce,this.opaque=n.opaque,this.stale=n.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(n.qop)if(n.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(n.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.Utils.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var t,n;t=e.Utils.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(n=e.Utils.calculateMD5(this.method+":"+this.uri),this.response=e.Utils.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+n)):"auth-int"===this.qop?(n=e.Utils.calculateMD5(this.method+":"+this.uri+":"+e.Utils.calculateMD5(this.body?this.body:"")),this.response=e.Utils.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+n)):null===this.qop&&(n=e.Utils.calculateMD5(this.method+":"+this.uri),this.response=e.Utils.calculateMD5(t+":"+this.nonce+":"+n))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},e.DigestAuthentication=t}(o),function(e){var t;t={},r.navigator.webkitGetUserMedia?t.getUserMedia=r.navigator.webkitGetUserMedia.bind(navigator):r.navigator.mozGetUserMedia?t.getUserMedia=r.navigator.mozGetUserMedia.bind(navigator):r.navigator.getUserMedia&&(t.getUserMedia=r.navigator.getUserMedia.bind(navigator)),r.webkitRTCPeerConnection?t.RTCPeerConnection=r.webkitRTCPeerConnection:r.mozRTCPeerConnection?t.RTCPeerConnection=r.mozRTCPeerConnection:r.RTCPeerConnection&&(t.RTCPeerConnection=r.RTCPeerConnection),r.webkitRTCSessionDescription?t.RTCSessionDescription=r.webkitRTCSessionDescription:r.mozRTCSessionDescription?t.RTCSessionDescription=r.mozRTCSessionDescription:r.RTCSessionDescription&&(t.RTCSessionDescription=r.RTCSessionDescription),t.RTCPeerConnection&&t.RTCPeerConnection.prototype&&(t.RTCPeerConnection.prototype.getLocalStreams||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})),t.getUserMedia&&t.RTCPeerConnection&&t.RTCSessionDescription?t.isSupported=!0:t.isSupported=!1,e.WebRTC=t}(o),"object"==typeof e&&e&&"object"==typeof e.exports?(e.exports=o,r.JsSIP=o):(r.JsSIP=o,void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n))}(window),JsSIP.Grammar=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var t={parse:function(t,n){var r={CRLF:u,DIGIT:c,ALPHA:d,HEXDIG:p,WSP:f,OCTET:h,DQUOTE:m,SP:g,HTAB:v,alphanum:y,reserved:_,unreserved:b,mark:C,escaped:w,LWS:E,SWS:S,HCOLON:T,TEXT_UTF8_TRIM:O,TEXT_UTF8char:A,UTF8_NONASCII:x,UTF8_CONT:k,LHEX:function(){var e;null===(e=c())&&(/^[a-f]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[a-f]")));return e},token:R,token_nodot:I,separators:function(){var e;40===t.charCodeAt(o)?(e="(",o++):(e=null,0===i&&l('"("'));null===e&&(41===t.charCodeAt(o)?(e=")",o++):(e=null,0===i&&l('")"')),null===e&&(60===t.charCodeAt(o)?(e="<",o++):(e=null,0===i&&l('"<"')),null===e&&(62===t.charCodeAt(o)?(e=">",o++):(e=null,0===i&&l('">"')),null===e&&(64===t.charCodeAt(o)?(e="@",o++):(e=null,0===i&&l('"@"')),null===e&&(44===t.charCodeAt(o)?(e=",",o++):(e=null,0===i&&l('","')),null===e&&(59===t.charCodeAt(o)?(e=";",o++):(e=null,0===i&&l('";"')),null===e&&(58===t.charCodeAt(o)?(e=":",o++):(e=null,0===i&&l('":"')),null===e&&(92===t.charCodeAt(o)?(e="\\",o++):(e=null,0===i&&l('"\\\\"')),null===e&&null===(e=m())&&(47===t.charCodeAt(o)?(e="/",o++):(e=null,0===i&&l('"/"')),null===e&&(91===t.charCodeAt(o)?(e="[",o++):(e=null,0===i&&l('"["')),null===e&&(93===t.charCodeAt(o)?(e="]",o++):(e=null,0===i&&l('"]"')),null===e&&(63===t.charCodeAt(o)?(e="?",o++):(e=null,0===i&&l('"?"')),null===e&&(61===t.charCodeAt(o)?(e="=",o++):(e=null,0===i&&l('"="')),null===e&&(123===t.charCodeAt(o)?(e="{",o++):(e=null,0===i&&l('"{"')),null===e&&(125===t.charCodeAt(o)?(e="}",o++):(e=null,0===i&&l('"}"')),null===e&&null===(e=g())&&(e=v()))))))))))))))));return e},word:D,STAR:N,SLASH:P,EQUAL:j,LPAREN:L,RPAREN:M,RAQUOT:U,LAQUOT:F,COMMA:q,SEMI:B,COLON:H,LDQUOT:V,RDQUOT:z,comment:function e(){var t,n,r;var i;i=o;t=L();if(null!==t){for(n=[],null===(r=G())&&null===(r=J())&&(r=e());null!==r;)n.push(r),null===(r=G())&&null===(r=J())&&(r=e());null!==n&&null!==(r=M())?t=[t,n,r]:(t=null,o=i)}else t=null,o=i;return t},ctext:G,quoted_string:W,quoted_string_clean:K,qdtext:Y,quoted_pair:J,SIP_URI_noparams:$,SIP_URI:Q,uri_scheme:Z,userinfo:X,user:ee,user_unreserved:te,password:ne,hostport:re,host:oe,hostname:ie,domainlabel:ae,toplabel:se,IPv6reference:le,IPv6address:ue,h16:ce,ls32:de,IPv4address:pe,dec_octet:fe,port:he,uri_parameters:me,uri_parameter:ge,transport_param:ve,user_param:ye,method_param:_e,ttl_param:be,maddr_param:Ce,lr_param:we,other_param:Ee,pname:Se,pvalue:Te,paramchar:Oe,param_unreserved:Ae,headers:xe,header:ke,hname:Re,hvalue:Ie,hnv_unreserved:De,Request_Response:function(){var e;null===(e=st())&&(e=Ne());return e},Request_Line:Ne,Request_URI:Pe,absoluteURI:je,hier_part:Le,net_path:Me,abs_path:Ue,opaque_part:Fe,uric:qe,uric_no_slash:Be,path_segments:He,segment:Ve,param:ze,pchar:Ge,scheme:We,authority:Ke,srvr:Ye,reg_name:Je,query:$e,SIP_Version:Qe,INVITEm:Ze,ACKm:Xe,OPTIONSm:et,BYEm:tt,CANCELm:nt,REGISTERm:rt,SUBSCRIBEm:ot,NOTIFYm:it,Method:at,Status_Line:st,Status_Code:lt,extension_code:ut,Reason_Phrase:ct,Allow_Events:function(){var e,t,n,r,i,a;if(i=o,null!==(e=Pt())){for(t=[],a=o,null!==(n=q())&&null!==(r=Pt())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=q())&&null!==(r=Pt())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},Call_ID:function(){var e,n,r,a,s,u;a=o,s=o,null!==(e=D())?(u=o,64===t.charCodeAt(o)?(n="@",o++):(n=null,0===i&&l('"@"')),null!==n&&null!==(r=D())?n=[n,r]:(n=null,o=u),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=s)):(e=null,o=s);null!==e&&(e=function(e){Rn=t.substring(o,e)}(a));null===e&&(o=a);return e},Contact:function(){var e,t,n,r,i,a,s;if(i=o,null===(e=N()))if(a=o,null!==(e=dt())){for(t=[],s=o,null!==(n=q())&&null!==(r=dt())?n=[n,r]:(n=null,o=s);null!==n;)t.push(n),s=o,null!==(n=q())&&null!==(r=dt())?n=[n,r]:(n=null,o=s);null!==t?e=[e,t]:(e=null,o=a)}else e=null,o=a;null!==e&&(e=function(e){var t,n;for(n=Rn.multi_header.length,t=0;t<n;t++)if(null===Rn.multi_header[t].parsed){Rn=null;break}Rn=null!==Rn?Rn.multi_header:-1}());null===e&&(o=i);return e},contact_param:dt,name_addr:pt,display_name:ft,contact_params:ht,c_p_q:mt,c_p_expires:gt,delta_seconds:vt,qvalue:yt,generic_param:_t,gen_value:bt,Content_Disposition:function(){var e,t,n,r,i,a;if(i=o,null!==(e=Ct())){for(t=[],a=o,null!==(n=B())&&null!==(r=wt())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=B())&&null!==(r=wt())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},disp_type:Ct,disp_param:wt,handling_param:Et,Content_Encoding:function(){var e,t,n,r,i,a;if(i=o,null!==(e=R())){for(t=[],a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},Content_Length:function(){var e,t,n;if(n=o,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;null!==e&&(e=function(e,t){Rn=parseInt(t.join(""))}(0,e));null===e&&(o=n);return e},Content_Type:function(){var e,n;n=o,null!==(e=St())&&(e=function(e){Rn=t.substring(o,e)}(n));null===e&&(o=n);return e},media_type:St,m_type:Tt,discrete_type:Ot,composite_type:At,extension_token:xt,x_token:kt,m_subtype:Rt,m_parameter:It,m_value:Dt,CSeq:function(){var e,t,n,r;r=o,null!==(e=Nt())&&null!==(t=E())&&null!==(n=at())?e=[e,t,n]:(e=null,o=r);return e},CSeq_value:Nt,Expires:function(){var e,t;t=o,null!==(e=vt())&&(e=function(e,t){Rn=t}(0,e));null===e&&(o=t);return e},Event:function(){var e,t,n,r,i,a,s;if(i=o,a=o,null!==(e=Pt())){for(t=[],s=o,null!==(n=B())&&null!==(r=_t())?n=[n,r]:(n=null,o=s);null!==n;)t.push(n),s=o,null!==(n=B())&&null!==(r=_t())?n=[n,r]:(n=null,o=s);null!==t?e=[e,t]:(e=null,o=a)}else e=null,o=a;null!==e&&(e=function(e,t){Rn.event=t.join("").toLowerCase()}(0,e[0]));null===e&&(o=i);return e},event_type:Pt,From:function(){var e,t,n,r,i,a,s;i=o,a=o,null===(e=$())&&(e=pt());if(null!==e){for(t=[],s=o,null!==(n=B())&&null!==(r=jt())?n=[n,r]:(n=null,o=s);null!==n;)t.push(n),s=o,null!==(n=B())&&null!==(r=jt())?n=[n,r]:(n=null,o=s);null!==t?e=[e,t]:(e=null,o=a)}else e=null,o=a;null!==e&&(e=function(e){var t=Rn.tag;try{Rn=new JsSIP.NameAddrHeader(Rn.uri,Rn.display_name,Rn.params),t&&Rn.setParam("tag",t)}catch(e){Rn=-1}}());null===e&&(o=i);return e},from_param:jt,tag_param:Lt,Max_Forwards:function(){var e,t,n;if(n=o,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;null!==e&&(e=function(e,t){Rn=parseInt(t.join(""))}(0,e));null===e&&(o=n);return e},Min_Expires:function(){var e,t;t=o,null!==(e=vt())&&(e=function(e,t){Rn=t}(0,e));null===e&&(o=t);return e},Name_Addr_Header:function(){var e,t,n,r,i,a,s,l,u,c;l=o,u=o,e=[],t=ft();for(;null!==t;)e.push(t),t=ft();if(null!==e)if(null!==(t=F()))if(null!==(n=Q()))if(null!==(r=U())){for(i=[],c=o,null!==(a=B())&&null!==(s=_t())?a=[a,s]:(a=null,o=c);null!==a;)i.push(a),c=o,null!==(a=B())&&null!==(s=_t())?a=[a,s]:(a=null,o=c);null!==i?e=[e,t,n,r,i]:(e=null,o=u)}else e=null,o=u;else e=null,o=u;else e=null,o=u;else e=null,o=u;null!==e&&(e=function(e){try{Rn=new JsSIP.NameAddrHeader(Rn.uri,Rn.display_name,Rn.params)}catch(e){Rn=-1}}());null===e&&(o=l);return e},Proxy_Authenticate:function(){return Mt()},challenge:Mt,other_challenge:Ut,auth_param:Ft,digest_cln:qt,realm:Bt,realm_value:Ht,domain:Vt,URI:zt,nonce:Gt,nonce_value:Wt,opaque:Kt,stale:Yt,algorithm:Jt,qop_options:$t,qop_value:Qt,Proxy_Require:function(){var e,t,n,r,i,a;if(i=o,null!==(e=R())){for(t=[],a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},Record_Route:function(){var e,t,n,r,i,a,s;if(i=o,a=o,null!==(e=Zt())){for(t=[],s=o,null!==(n=q())&&null!==(r=Zt())?n=[n,r]:(n=null,o=s);null!==n;)t.push(n),s=o,null!==(n=q())&&null!==(r=Zt())?n=[n,r]:(n=null,o=s);null!==t?e=[e,t]:(e=null,o=a)}else e=null,o=a;null!==e&&(e=function(e){var t,n;for(n=Rn.multi_header.length,t=0;t<n;t++)if(null===Rn.multi_header[t].parsed){Rn=null;break}Rn=null!==Rn?Rn.multi_header:-1}());null===e&&(o=i);return e},rec_route:Zt,Require:function(){var e,t,n,r,i,a;if(i=o,null!==(e=R())){for(t=[],a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},Route:function(){var e,t,n,r,i,a;if(i=o,null!==(e=Xt())){for(t=[],a=o,null!==(n=q())&&null!==(r=Xt())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=q())&&null!==(r=Xt())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},route_param:Xt,Subscription_State:function(){var e,t,n,r,i,a;if(i=o,null!==(e=en())){for(t=[],a=o,null!==(n=B())&&null!==(r=tn())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=B())&&null!==(r=tn())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},substate_value:en,subexp_params:tn,event_reason_value:nn,Subject:function(){var e;return e=null!==(e=O())?e:""},Supported:function(){var e,t,n,r,i,a;if(i=o,null!==(e=R())){for(t=[],a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=q())&&null!==(r=R())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e=null!==e?e:""},To:function(){var e,t,n,r,i,a,s;i=o,a=o,null===(e=$())&&(e=pt());if(null!==e){for(t=[],s=o,null!==(n=B())&&null!==(r=rn())?n=[n,r]:(n=null,o=s);null!==n;)t.push(n),s=o,null!==(n=B())&&null!==(r=rn())?n=[n,r]:(n=null,o=s);null!==t?e=[e,t]:(e=null,o=a)}else e=null,o=a;null!==e&&(e=function(e){var t=Rn.tag;try{Rn=new JsSIP.NameAddrHeader(Rn.uri,Rn.display_name,Rn.params),t&&Rn.setParam("tag",t)}catch(e){Rn=-1}}());null===e&&(o=i);return e},to_param:rn,Via:function(){var e,t,n,r,i,a;if(i=o,null!==(e=on())){for(t=[],a=o,null!==(n=q())&&null!==(r=on())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=q())&&null!==(r=on())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e},via_parm:on,via_params:an,via_ttl:sn,via_maddr:ln,via_received:un,via_branch:cn,response_port:dn,sent_protocol:pn,protocol_name:fn,transport:hn,sent_by:mn,via_host:gn,via_port:vn,ttl:yn,WWW_Authenticate:function(){return Mt()},extension_header:function(){var e,t,n,r;r=o,null!==(e=R())&&null!==(t=T())&&null!==(n=_n())?e=[e,t,n]:(e=null,o=r);return e},header_value:_n,message_body:function(){var e,t;e=[],t=h();for(;null!==t;)e.push(t),t=h();return e},stun_URI:function(){var e,n,r,a;a=o,null!==(e=bn())?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=Cn())?e=[e,n,r]:(e=null,o=a)):(e=null,o=a);return e},stun_scheme:bn,stun_host_port:Cn,stun_host:wn,reg_name:Je,stun_unreserved:En,sub_delims:Sn,turn_URI:function(){var e,n,r,a,s,u,c;u=o,null!==(e=Tn())?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=Cn())?(c=o,"?transport="===t.substr(o,11)?(a="?transport=",o+=11):(a=null,0===i&&l('"?transport="')),null!==a&&null!==(s=hn())?a=[a,s]:(a=null,o=c),null!==(a=null!==a?a:"")?e=[e,n,r,a]:(e=null,o=u)):(e=null,o=u)):(e=null,o=u);return e},turn_scheme:Tn,turn_transport:function(){var e,n,r,a,s;if(a=o,s=o,null!==(e=hn())){if("udp"===t.substr(o,3).toLowerCase()?(n=t.substr(o,3),o+=3):(n=null,0===i&&l('"udp"')),null===n&&("tcp"===t.substr(o,3).toLowerCase()?(n=t.substr(o,3),o+=3):(n=null,0===i&&l('"tcp"')),null===n))for(n=[],r=b();null!==r;)n.push(r),r=b();null!==n?e=[e,n]:(e=null,o=s)}else e=null,o=s;null!==e&&(e=void(Rn.transport=transport));null===e&&(o=a);return e},uuid_URI:function(){var e,n,r;r=o,"uuid:"===t.substr(o,5)?(e="uuid:",o+=5):(e=null,0===i&&l('"uuid:"'));null!==e&&null!==(n=On())?e=[e,n]:(e=null,o=r);return e},uuid:On,hex4:An,hex8:xn,hex12:kn};if(void 0!==n){if(void 0===r[n])throw new Error("Invalid rule name: "+e(n)+".")}else n="CRLF";var o=0,i=0,a=0,s=[];function l(e){o<a||(o>a&&(a=o,s=[]),s.push(e))}function u(){var e;return"\r\n"===t.substr(o,2)?(e="\r\n",o+=2):(e=null,0===i&&l('"\\r\\n"')),e}function c(){var e;return/^[0-9]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[0-9]")),e}function d(){var e;return/^[a-zA-Z]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[a-zA-Z]")),e}function p(){var e;return/^[0-9a-fA-F]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[0-9a-fA-F]")),e}function f(){var e;return null===(e=g())&&(e=v()),e}function h(){var e;return/^[\0-\xFF]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[\\0-\\xFF]")),e}function m(){var e;return/^["]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l('["]')),e}function g(){var e;return 32===t.charCodeAt(o)?(e=" ",o++):(e=null,0===i&&l('" "')),e}function v(){var e;return 9===t.charCodeAt(o)?(e="\t",o++):(e=null,0===i&&l('"\\t"')),e}function y(){var e;return/^[a-zA-Z0-9]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[a-zA-Z0-9]")),e}function _(){var e;return 59===t.charCodeAt(o)?(e=";",o++):(e=null,0===i&&l('";"')),null===e&&(47===t.charCodeAt(o)?(e="/",o++):(e=null,0===i&&l('"/"')),null===e&&(63===t.charCodeAt(o)?(e="?",o++):(e=null,0===i&&l('"?"')),null===e&&(58===t.charCodeAt(o)?(e=":",o++):(e=null,0===i&&l('":"')),null===e&&(64===t.charCodeAt(o)?(e="@",o++):(e=null,0===i&&l('"@"')),null===e&&(38===t.charCodeAt(o)?(e="&",o++):(e=null,0===i&&l('"&"')),null===e&&(61===t.charCodeAt(o)?(e="=",o++):(e=null,0===i&&l('"="')),null===e&&(43===t.charCodeAt(o)?(e="+",o++):(e=null,0===i&&l('"+"')),null===e&&(36===t.charCodeAt(o)?(e="$",o++):(e=null,0===i&&l('"$"')),null===e&&(44===t.charCodeAt(o)?(e=",",o++):(e=null,0===i&&l('","'))))))))))),e}function b(){var e;return null===(e=y())&&(e=C()),e}function C(){var e;return 45===t.charCodeAt(o)?(e="-",o++):(e=null,0===i&&l('"-"')),null===e&&(95===t.charCodeAt(o)?(e="_",o++):(e=null,0===i&&l('"_"')),null===e&&(46===t.charCodeAt(o)?(e=".",o++):(e=null,0===i&&l('"."')),null===e&&(33===t.charCodeAt(o)?(e="!",o++):(e=null,0===i&&l('"!"')),null===e&&(126===t.charCodeAt(o)?(e="~",o++):(e=null,0===i&&l('"~"')),null===e&&(42===t.charCodeAt(o)?(e="*",o++):(e=null,0===i&&l('"*"')),null===e&&(39===t.charCodeAt(o)?(e="'",o++):(e=null,0===i&&l('"\'"')),null===e&&(40===t.charCodeAt(o)?(e="(",o++):(e=null,0===i&&l('"("')),null===e&&(41===t.charCodeAt(o)?(e=")",o++):(e=null,0===i&&l('")"')))))))))),e}function w(){var e,n,r,a,s;return a=o,s=o,37===t.charCodeAt(o)?(e="%",o++):(e=null,0===i&&l('"%"')),null!==e&&null!==(n=p())&&null!==(r=p())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=e.join("")),null===e&&(o=a),e}function E(){var e,t,n,r,i,a;for(r=o,i=o,a=o,e=[],t=f();null!==t;)e.push(t),t=f();if(null!==e&&null!==(t=u())?e=[e,t]:(e=null,o=a),null!==(e=null!==e?e:"")){if(null!==(n=f()))for(t=[];null!==n;)t.push(n),n=f();else t=null;null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return null!==e&&(e=" "),null===e&&(o=r),e}function S(){var e;return e=null!==(e=E())?e:""}function T(){var e,n,r,a,s;for(a=o,s=o,e=[],null===(n=g())&&(n=v());null!==n;)e.push(n),null===(n=g())&&(n=v());return null!==e?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=":"),null===e&&(o=a),e}function O(){var e,n,r,i,a,s,l;if(a=o,s=o,null!==(n=A()))for(e=[];null!==n;)e.push(n),n=A();else e=null;if(null!==e){for(n=[],l=o,r=[],i=E();null!==i;)r.push(i),i=E();for(null!==r&&null!==(i=A())?r=[r,i]:(r=null,o=l);null!==r;){for(n.push(r),l=o,r=[],i=E();null!==i;)r.push(i),i=E();null!==r&&null!==(i=A())?r=[r,i]:(r=null,o=l)}null!==n?e=[e,n]:(e=null,o=s)}else e=null,o=s;return null!==e&&(e=function(e){return t.substring(o,e)}(a)),null===e&&(o=a),e}function A(){var e;return/^[!-~]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[!-~]")),null===e&&(e=x()),e}function x(){var e;return/^[\x80-\uFFFF]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[\\x80-\\uFFFF]")),e}function k(){var e;return/^[\x80-\xBF]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[\\x80-\\xBF]")),e}function R(){var e,n,r;if(r=o,null===(n=y())&&(45===t.charCodeAt(o)?(n="-",o++):(n=null,0===i&&l('"-"')),null===n&&(46===t.charCodeAt(o)?(n=".",o++):(n=null,0===i&&l('"."')),null===n&&(33===t.charCodeAt(o)?(n="!",o++):(n=null,0===i&&l('"!"')),null===n&&(37===t.charCodeAt(o)?(n="%",o++):(n=null,0===i&&l('"%"')),null===n&&(42===t.charCodeAt(o)?(n="*",o++):(n=null,0===i&&l('"*"')),null===n&&(95===t.charCodeAt(o)?(n="_",o++):(n=null,0===i&&l('"_"')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(96===t.charCodeAt(o)?(n="`",o++):(n=null,0===i&&l('"`"')),null===n&&(39===t.charCodeAt(o)?(n="'",o++):(n=null,0===i&&l('"\'"')),null===n&&(126===t.charCodeAt(o)?(n="~",o++):(n=null,0===i&&l('"~"')))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=y())&&(45===t.charCodeAt(o)?(n="-",o++):(n=null,0===i&&l('"-"')),null===n&&(46===t.charCodeAt(o)?(n=".",o++):(n=null,0===i&&l('"."')),null===n&&(33===t.charCodeAt(o)?(n="!",o++):(n=null,0===i&&l('"!"')),null===n&&(37===t.charCodeAt(o)?(n="%",o++):(n=null,0===i&&l('"%"')),null===n&&(42===t.charCodeAt(o)?(n="*",o++):(n=null,0===i&&l('"*"')),null===n&&(95===t.charCodeAt(o)?(n="_",o++):(n=null,0===i&&l('"_"')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(96===t.charCodeAt(o)?(n="`",o++):(n=null,0===i&&l('"`"')),null===n&&(39===t.charCodeAt(o)?(n="'",o++):(n=null,0===i&&l('"\'"')),null===n&&(126===t.charCodeAt(o)?(n="~",o++):(n=null,0===i&&l('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(o,e)}(r)),null===e&&(o=r),e}function I(){var e,n,r;if(r=o,null===(n=y())&&(45===t.charCodeAt(o)?(n="-",o++):(n=null,0===i&&l('"-"')),null===n&&(33===t.charCodeAt(o)?(n="!",o++):(n=null,0===i&&l('"!"')),null===n&&(37===t.charCodeAt(o)?(n="%",o++):(n=null,0===i&&l('"%"')),null===n&&(42===t.charCodeAt(o)?(n="*",o++):(n=null,0===i&&l('"*"')),null===n&&(95===t.charCodeAt(o)?(n="_",o++):(n=null,0===i&&l('"_"')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(96===t.charCodeAt(o)?(n="`",o++):(n=null,0===i&&l('"`"')),null===n&&(39===t.charCodeAt(o)?(n="'",o++):(n=null,0===i&&l('"\'"')),null===n&&(126===t.charCodeAt(o)?(n="~",o++):(n=null,0===i&&l('"~"'))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=y())&&(45===t.charCodeAt(o)?(n="-",o++):(n=null,0===i&&l('"-"')),null===n&&(33===t.charCodeAt(o)?(n="!",o++):(n=null,0===i&&l('"!"')),null===n&&(37===t.charCodeAt(o)?(n="%",o++):(n=null,0===i&&l('"%"')),null===n&&(42===t.charCodeAt(o)?(n="*",o++):(n=null,0===i&&l('"*"')),null===n&&(95===t.charCodeAt(o)?(n="_",o++):(n=null,0===i&&l('"_"')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(96===t.charCodeAt(o)?(n="`",o++):(n=null,0===i&&l('"`"')),null===n&&(39===t.charCodeAt(o)?(n="'",o++):(n=null,0===i&&l('"\'"')),null===n&&(126===t.charCodeAt(o)?(n="~",o++):(n=null,0===i&&l('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(o,e)}(r)),null===e&&(o=r),e}function D(){var e,n,r;if(r=o,null===(n=y())&&(45===t.charCodeAt(o)?(n="-",o++):(n=null,0===i&&l('"-"')),null===n&&(46===t.charCodeAt(o)?(n=".",o++):(n=null,0===i&&l('"."')),null===n&&(33===t.charCodeAt(o)?(n="!",o++):(n=null,0===i&&l('"!"')),null===n&&(37===t.charCodeAt(o)?(n="%",o++):(n=null,0===i&&l('"%"')),null===n&&(42===t.charCodeAt(o)?(n="*",o++):(n=null,0===i&&l('"*"')),null===n&&(95===t.charCodeAt(o)?(n="_",o++):(n=null,0===i&&l('"_"')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(96===t.charCodeAt(o)?(n="`",o++):(n=null,0===i&&l('"`"')),null===n&&(39===t.charCodeAt(o)?(n="'",o++):(n=null,0===i&&l('"\'"')),null===n&&(126===t.charCodeAt(o)?(n="~",o++):(n=null,0===i&&l('"~"')),null===n&&(40===t.charCodeAt(o)?(n="(",o++):(n=null,0===i&&l('"("')),null===n&&(41===t.charCodeAt(o)?(n=")",o++):(n=null,0===i&&l('")"')),null===n&&(60===t.charCodeAt(o)?(n="<",o++):(n=null,0===i&&l('"<"')),null===n&&(62===t.charCodeAt(o)?(n=">",o++):(n=null,0===i&&l('">"')),null===n&&(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null===n&&(92===t.charCodeAt(o)?(n="\\",o++):(n=null,0===i&&l('"\\\\"')),null===n&&null===(n=m())&&(47===t.charCodeAt(o)?(n="/",o++):(n=null,0===i&&l('"/"')),null===n&&(91===t.charCodeAt(o)?(n="[",o++):(n=null,0===i&&l('"["')),null===n&&(93===t.charCodeAt(o)?(n="]",o++):(n=null,0===i&&l('"]"')),null===n&&(63===t.charCodeAt(o)?(n="?",o++):(n=null,0===i&&l('"?"')),null===n&&(123===t.charCodeAt(o)?(n="{",o++):(n=null,0===i&&l('"{"')),null===n&&(125===t.charCodeAt(o)?(n="}",o++):(n=null,0===i&&l('"}"')))))))))))))))))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=y())&&(45===t.charCodeAt(o)?(n="-",o++):(n=null,0===i&&l('"-"')),null===n&&(46===t.charCodeAt(o)?(n=".",o++):(n=null,0===i&&l('"."')),null===n&&(33===t.charCodeAt(o)?(n="!",o++):(n=null,0===i&&l('"!"')),null===n&&(37===t.charCodeAt(o)?(n="%",o++):(n=null,0===i&&l('"%"')),null===n&&(42===t.charCodeAt(o)?(n="*",o++):(n=null,0===i&&l('"*"')),null===n&&(95===t.charCodeAt(o)?(n="_",o++):(n=null,0===i&&l('"_"')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(96===t.charCodeAt(o)?(n="`",o++):(n=null,0===i&&l('"`"')),null===n&&(39===t.charCodeAt(o)?(n="'",o++):(n=null,0===i&&l('"\'"')),null===n&&(126===t.charCodeAt(o)?(n="~",o++):(n=null,0===i&&l('"~"')),null===n&&(40===t.charCodeAt(o)?(n="(",o++):(n=null,0===i&&l('"("')),null===n&&(41===t.charCodeAt(o)?(n=")",o++):(n=null,0===i&&l('")"')),null===n&&(60===t.charCodeAt(o)?(n="<",o++):(n=null,0===i&&l('"<"')),null===n&&(62===t.charCodeAt(o)?(n=">",o++):(n=null,0===i&&l('">"')),null===n&&(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null===n&&(92===t.charCodeAt(o)?(n="\\",o++):(n=null,0===i&&l('"\\\\"')),null===n&&null===(n=m())&&(47===t.charCodeAt(o)?(n="/",o++):(n=null,0===i&&l('"/"')),null===n&&(91===t.charCodeAt(o)?(n="[",o++):(n=null,0===i&&l('"["')),null===n&&(93===t.charCodeAt(o)?(n="]",o++):(n=null,0===i&&l('"]"')),null===n&&(63===t.charCodeAt(o)?(n="?",o++):(n=null,0===i&&l('"?"')),null===n&&(123===t.charCodeAt(o)?(n="{",o++):(n=null,0===i&&l('"{"')),null===n&&(125===t.charCodeAt(o)?(n="}",o++):(n=null,0===i&&l('"}"'))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return t.substring(o,e)}(r)),null===e&&(o=r),e}function N(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(42===t.charCodeAt(o)?(n="*",o++):(n=null,0===i&&l('"*"')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e="*"),null===e&&(o=a),e}function P(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(47===t.charCodeAt(o)?(n="/",o++):(n=null,0===i&&l('"/"')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e="/"),null===e&&(o=a),e}function j(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e="="),null===e&&(o=a),e}function L(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(40===t.charCodeAt(o)?(n="(",o++):(n=null,0===i&&l('"("')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e="("),null===e&&(o=a),e}function M(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(41===t.charCodeAt(o)?(n=")",o++):(n=null,0===i&&l('")"')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=")"),null===e&&(o=a),e}function U(){var e,n,r,a;return r=o,a=o,62===t.charCodeAt(o)?(e=">",o++):(e=null,0===i&&l('">"')),null!==e&&null!==(n=S())?e=[e,n]:(e=null,o=a),null!==e&&(e=">"),null===e&&(o=r),e}function F(){var e,n,r,a;return r=o,a=o,null!==(e=S())?(60===t.charCodeAt(o)?(n="<",o++):(n=null,0===i&&l('"<"')),null!==n?e=[e,n]:(e=null,o=a)):(e=null,o=a),null!==e&&(e="<"),null===e&&(o=r),e}function q(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(44===t.charCodeAt(o)?(n=",",o++):(n=null,0===i&&l('","')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=","),null===e&&(o=a),e}function B(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(59===t.charCodeAt(o)?(n=";",o++):(n=null,0===i&&l('";"')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=";"),null===e&&(o=a),e}function H(){var e,n,r,a,s;return a=o,s=o,null!==(e=S())?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=S())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=":"),null===e&&(o=a),e}function V(){var e,t,n,r;return n=o,r=o,null!==(e=S())&&null!==(t=m())?e=[e,t]:(e=null,o=r),null!==e&&(e='"'),null===e&&(o=n),e}function z(){var e,t,n,r;return n=o,r=o,null!==(e=m())&&null!==(t=S())?e=[e,t]:(e=null,o=r),null!==e&&(e='"'),null===e&&(o=n),e}function G(){var e;return/^[!-']/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[!-']")),null===e&&(/^[*-[]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[*-[]")),null===e&&(/^[\]-~]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[\\]-~]")),null===e&&null===(e=x())&&(e=E()))),e}function W(){var e,n,r,i,a,s;if(a=o,s=o,null!==(e=S()))if(null!==(n=m())){for(r=[],null===(i=Y())&&(i=J());null!==i;)r.push(i),null===(i=Y())&&(i=J());null!==r&&null!==(i=m())?e=[e,n,r,i]:(e=null,o=s)}else e=null,o=s;else e=null,o=s;return null!==e&&(e=function(e){return t.substring(o,e)}(a)),null===e&&(o=a),e}function K(){var e,n,r,i,a,s;if(a=o,s=o,null!==(e=S()))if(null!==(n=m())){for(r=[],null===(i=Y())&&(i=J());null!==i;)r.push(i),null===(i=Y())&&(i=J());null!==r&&null!==(i=m())?e=[e,n,r,i]:(e=null,o=s)}else e=null,o=s;else e=null,o=s;return null!==e&&(e=function(e){return t.substring(o-1,e+1)}(a)),null===e&&(o=a),e}function Y(){var e;return null===(e=E())&&(33===t.charCodeAt(o)?(e="!",o++):(e=null,0===i&&l('"!"')),null===e&&(/^[#-[]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[#-[]")),null===e&&(/^[\]-~]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[\\]-~]")),null===e&&(e=x())))),e}function J(){var e,n,r;return r=o,92===t.charCodeAt(o)?(e="\\",o++):(e=null,0===i&&l('"\\\\"')),null!==e?(/^[\0-\t]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[\\0-\\t]")),null===n&&(/^[\x0B-\f]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[\\x0B-\\f]")),null===n&&(/^[\x0E-]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[\\x0E-]")))),null!==n?e=[e,n]:(e=null,o=r)):(e=null,o=r),e}function $(){var e,n,r,a,s,u;return s=o,u=o,null!==(e=Z())?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=null!==(r=X())?r:"")&&null!==(a=re())?e=[e,n,r,a]:(e=null,o=u)):(e=null,o=u),null!==e&&(e=function(e){try{Rn.uri=new JsSIP.URI(Rn.scheme,Rn.user,Rn.host,Rn.port),delete Rn.scheme,delete Rn.user,delete Rn.host,delete Rn.host_type,delete Rn.port}catch(e){Rn=-1}}()),null===e&&(o=s),e}function Q(){var e,r,a,s,u,c,d,p;return d=o,p=o,null!==(e=Z())?(58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=null!==(a=X())?a:"")&&null!==(s=re())&&null!==(u=me())&&null!==(c=null!==(c=xe())?c:"")?e=[e,r,a,s,u,c]:(e=null,o=p)):(e=null,o=p),null!==e&&(e=function(e){try{Rn.uri=new JsSIP.URI(Rn.scheme,Rn.user,Rn.host,Rn.port,Rn.uri_params,Rn.uri_headers),delete Rn.scheme,delete Rn.user,delete Rn.host,delete Rn.host_type,delete Rn.port,delete Rn.uri_params,"SIP_URI"===n&&(Rn=Rn.uri)}catch(e){Rn=-1}}()),null===e&&(o=d),e}function Z(){var e,n;return"sip"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"sip"')),null===e&&(n=o,"sips"===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"sips"')),null!==e&&(e=void(Rn.scheme=uri_scheme.toLowerCase())),null===e&&(o=n)),e}function X(){var e,n,r,a,s,u;return a=o,s=o,null!==(e=ee())?(u=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ne())?n=[n,r]:(n=null,o=u),null!==(n=null!==n?n:"")?(64===t.charCodeAt(o)?(r="@",o++):(r=null,0===i&&l('"@"')),null!==r?e=[e,n,r]:(e=null,o=s)):(e=null,o=s)):(e=null,o=s),null!==e&&(e=function(e){Rn.user=window.decodeURIComponent(t.substring(o-1,e))}(a)),null===e&&(o=a),e}function ee(){var e,t;if(null===(t=b())&&null===(t=w())&&(t=te()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=b())&&null===(t=w())&&(t=te());else e=null;return e}function te(){var e;return 38===t.charCodeAt(o)?(e="&",o++):(e=null,0===i&&l('"&"')),null===e&&(61===t.charCodeAt(o)?(e="=",o++):(e=null,0===i&&l('"="')),null===e&&(43===t.charCodeAt(o)?(e="+",o++):(e=null,0===i&&l('"+"')),null===e&&(36===t.charCodeAt(o)?(e="$",o++):(e=null,0===i&&l('"$"')),null===e&&(44===t.charCodeAt(o)?(e=",",o++):(e=null,0===i&&l('","')),null===e&&(59===t.charCodeAt(o)?(e=";",o++):(e=null,0===i&&l('";"')),null===e&&(63===t.charCodeAt(o)?(e="?",o++):(e=null,0===i&&l('"?"')),null===e&&(47===t.charCodeAt(o)?(e="/",o++):(e=null,0===i&&l('"/"'))))))))),e}function ne(){var e,n,r;for(r=o,e=[],null===(n=b())&&null===(n=w())&&(38===t.charCodeAt(o)?(n="&",o++):(n=null,0===i&&l('"&"')),null===n&&(61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(36===t.charCodeAt(o)?(n="$",o++):(n=null,0===i&&l('"$"')),null===n&&(44===t.charCodeAt(o)?(n=",",o++):(n=null,0===i&&l('","')))))));null!==n;)e.push(n),null===(n=b())&&null===(n=w())&&(38===t.charCodeAt(o)?(n="&",o++):(n=null,0===i&&l('"&"')),null===n&&(61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')),null===n&&(36===t.charCodeAt(o)?(n="$",o++):(n=null,0===i&&l('"$"')),null===n&&(44===t.charCodeAt(o)?(n=",",o++):(n=null,0===i&&l('","')))))));return null!==e&&(e=function(e){Rn.password=t.substring(o,e)}(r)),null===e&&(o=r),e}function re(){var e,n,r,a,s;return a=o,null!==(e=oe())?(s=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=he())?n=[n,r]:(n=null,o=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=a)):(e=null,o=a),e}function oe(){var e,n;return n=o,null===(e=pe())&&null===(e=le())&&(e=ie()),null!==e&&(e=function(e){return Rn.host=t.substring(o,e).toLowerCase(),Rn.host}(n)),null===e&&(o=n),e}function ie(){var e,n,r,a,s,u;for(a=o,s=o,e=[],u=o,null!==(n=ae())?(46===t.charCodeAt(o)?(r=".",o++):(r=null,0===i&&l('"."')),null!==r?n=[n,r]:(n=null,o=u)):(n=null,o=u);null!==n;)e.push(n),u=o,null!==(n=ae())?(46===t.charCodeAt(o)?(r=".",o++):(r=null,0===i&&l('"."')),null!==r?n=[n,r]:(n=null,o=u)):(n=null,o=u);return null!==e&&null!==(n=se())?(46===t.charCodeAt(o)?(r=".",o++):(r=null,0===i&&l('"."')),null!==(r=null!==r?r:"")?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=function(e){return Rn.host_type="domain",t.substring(o,e)}(a)),null===e&&(o=a),e}function ae(){var e,n;if(/^[a-zA-Z0-9_\-]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[a-zA-Z0-9_\\-]")),null!==n)for(e=[];null!==n;)e.push(n),/^[a-zA-Z0-9_\-]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[a-zA-Z0-9_\\-]"));else e=null;return e}function se(){var e,n;if(/^[a-zA-Z0-9_\-]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[a-zA-Z0-9_\\-]")),null!==n)for(e=[];null!==n;)e.push(n),/^[a-zA-Z0-9_\-]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[a-zA-Z0-9_\\-]"));else e=null;return e}function le(){var e,n,r,a,s;return a=o,s=o,91===t.charCodeAt(o)?(e="[",o++):(e=null,0===i&&l('"["')),null!==e&&null!==(n=ue())?(93===t.charCodeAt(o)?(r="]",o++):(r=null,0===i&&l('"]"')),null!==r?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=function(e){return Rn.host_type="IPv6",t.substring(o,e)}(a)),null===e&&(o=a),e}function ue(){var e,n,r,a,s,u,c,d,p,f,h,m,g,v,y,_;return v=o,y=o,null!==(e=ce())?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?(58===t.charCodeAt(o)?(a=":",o++):(a=null,0===i&&l('":"')),null!==a&&null!==(s=ce())?(58===t.charCodeAt(o)?(u=":",o++):(u=null,0===i&&l('":"')),null!==u&&null!==(c=ce())?(58===t.charCodeAt(o)?(d=":",o++):(d=null,0===i&&l('":"')),null!==d&&null!==(p=ce())?(58===t.charCodeAt(o)?(f=":",o++):(f=null,0===i&&l('":"')),null!==f&&null!==(h=ce())?(58===t.charCodeAt(o)?(m=":",o++):(m=null,0===i&&l('":"')),null!==m&&null!==(g=de())?e=[e,n,r,a,s,u,c,d,p,f,h,m,g]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,"::"===t.substr(o,2)?(e="::",o+=2):(e=null,0===i&&l('"::"')),null!==e&&null!==(n=ce())?(58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?(58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=ce())?(58===t.charCodeAt(o)?(c=":",o++):(c=null,0===i&&l('":"')),null!==c&&null!==(d=ce())?(58===t.charCodeAt(o)?(p=":",o++):(p=null,0===i&&l('":"')),null!==p&&null!==(f=ce())?(58===t.charCodeAt(o)?(h=":",o++):(h=null,0===i&&l('":"')),null!==h&&null!==(m=de())?e=[e,n,r,a,s,u,c,d,p,f,h,m]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,"::"===t.substr(o,2)?(e="::",o+=2):(e=null,0===i&&l('"::"')),null!==e&&null!==(n=ce())?(58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?(58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=ce())?(58===t.charCodeAt(o)?(c=":",o++):(c=null,0===i&&l('":"')),null!==c&&null!==(d=ce())?(58===t.charCodeAt(o)?(p=":",o++):(p=null,0===i&&l('":"')),null!==p&&null!==(f=de())?e=[e,n,r,a,s,u,c,d,p,f]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,"::"===t.substr(o,2)?(e="::",o+=2):(e=null,0===i&&l('"::"')),null!==e&&null!==(n=ce())?(58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?(58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=ce())?(58===t.charCodeAt(o)?(c=":",o++):(c=null,0===i&&l('":"')),null!==c&&null!==(d=de())?e=[e,n,r,a,s,u,c,d]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,"::"===t.substr(o,2)?(e="::",o+=2):(e=null,0===i&&l('"::"')),null!==e&&null!==(n=ce())?(58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?(58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=de())?e=[e,n,r,a,s,u]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,"::"===t.substr(o,2)?(e="::",o+=2):(e=null,0===i&&l('"::"')),null!==e&&null!==(n=ce())?(58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=de())?e=[e,n,r,a]:(e=null,o=y)):(e=null,o=y),null===e&&(y=o,"::"===t.substr(o,2)?(e="::",o+=2):(e=null,0===i&&l('"::"')),null!==e&&null!==(n=de())?e=[e,n]:(e=null,o=y),null===e&&(y=o,"::"===t.substr(o,2)?(e="::",o+=2):(e=null,0===i&&l('"::"')),null!==e&&null!==(n=ce())?e=[e,n]:(e=null,o=y),null===e&&(y=o,null!==(e=ce())?("::"===t.substr(o,2)?(n="::",o+=2):(n=null,0===i&&l('"::"')),null!==n&&null!==(r=ce())?(58===t.charCodeAt(o)?(a=":",o++):(a=null,0===i&&l('":"')),null!==a&&null!==(s=ce())?(58===t.charCodeAt(o)?(u=":",o++):(u=null,0===i&&l('":"')),null!==u&&null!==(c=ce())?(58===t.charCodeAt(o)?(d=":",o++):(d=null,0===i&&l('":"')),null!==d&&null!==(p=ce())?(58===t.charCodeAt(o)?(f=":",o++):(f=null,0===i&&l('":"')),null!==f&&null!==(h=de())?e=[e,n,r,a,s,u,c,d,p,f,h]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,null!==(e=ce())?(_=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?n=[n,r]:(n=null,o=_),null!==(n=null!==n?n:"")?("::"===t.substr(o,2)?(r="::",o+=2):(r=null,0===i&&l('"::"')),null!==r&&null!==(a=ce())?(58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=ce())?(58===t.charCodeAt(o)?(c=":",o++):(c=null,0===i&&l('":"')),null!==c&&null!==(d=ce())?(58===t.charCodeAt(o)?(p=":",o++):(p=null,0===i&&l('":"')),null!==p&&null!==(f=de())?e=[e,n,r,a,s,u,c,d,p,f]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,null!==(e=ce())?(_=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?n=[n,r]:(n=null,o=_),null!==(n=null!==n?n:"")?(_=o,58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?r=[r,a]:(r=null,o=_),null!==(r=null!==r?r:"")?("::"===t.substr(o,2)?(a="::",o+=2):(a=null,0===i&&l('"::"')),null!==a&&null!==(s=ce())?(58===t.charCodeAt(o)?(u=":",o++):(u=null,0===i&&l('":"')),null!==u&&null!==(c=ce())?(58===t.charCodeAt(o)?(d=":",o++):(d=null,0===i&&l('":"')),null!==d&&null!==(p=de())?e=[e,n,r,a,s,u,c,d,p]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,null!==(e=ce())?(_=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?n=[n,r]:(n=null,o=_),null!==(n=null!==n?n:"")?(_=o,58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?r=[r,a]:(r=null,o=_),null!==(r=null!==r?r:"")?(_=o,58===t.charCodeAt(o)?(a=":",o++):(a=null,0===i&&l('":"')),null!==a&&null!==(s=ce())?a=[a,s]:(a=null,o=_),null!==(a=null!==a?a:"")?("::"===t.substr(o,2)?(s="::",o+=2):(s=null,0===i&&l('"::"')),null!==s&&null!==(u=ce())?(58===t.charCodeAt(o)?(c=":",o++):(c=null,0===i&&l('":"')),null!==c&&null!==(d=de())?e=[e,n,r,a,s,u,c,d]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,null!==(e=ce())?(_=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?n=[n,r]:(n=null,o=_),null!==(n=null!==n?n:"")?(_=o,58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?r=[r,a]:(r=null,o=_),null!==(r=null!==r?r:"")?(_=o,58===t.charCodeAt(o)?(a=":",o++):(a=null,0===i&&l('":"')),null!==a&&null!==(s=ce())?a=[a,s]:(a=null,o=_),null!==(a=null!==a?a:"")?(_=o,58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=ce())?s=[s,u]:(s=null,o=_),null!==(s=null!==s?s:"")?("::"===t.substr(o,2)?(u="::",o+=2):(u=null,0===i&&l('"::"')),null!==u&&null!==(c=de())?e=[e,n,r,a,s,u,c]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,null!==(e=ce())?(_=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?n=[n,r]:(n=null,o=_),null!==(n=null!==n?n:"")?(_=o,58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?r=[r,a]:(r=null,o=_),null!==(r=null!==r?r:"")?(_=o,58===t.charCodeAt(o)?(a=":",o++):(a=null,0===i&&l('":"')),null!==a&&null!==(s=ce())?a=[a,s]:(a=null,o=_),null!==(a=null!==a?a:"")?(_=o,58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=ce())?s=[s,u]:(s=null,o=_),null!==(s=null!==s?s:"")?(_=o,58===t.charCodeAt(o)?(u=":",o++):(u=null,0===i&&l('":"')),null!==u&&null!==(c=ce())?u=[u,c]:(u=null,o=_),null!==(u=null!==u?u:"")?("::"===t.substr(o,2)?(c="::",o+=2):(c=null,0===i&&l('"::"')),null!==c&&null!==(d=ce())?e=[e,n,r,a,s,u,c,d]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y),null===e&&(y=o,null!==(e=ce())?(_=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?n=[n,r]:(n=null,o=_),null!==(n=null!==n?n:"")?(_=o,58===t.charCodeAt(o)?(r=":",o++):(r=null,0===i&&l('":"')),null!==r&&null!==(a=ce())?r=[r,a]:(r=null,o=_),null!==(r=null!==r?r:"")?(_=o,58===t.charCodeAt(o)?(a=":",o++):(a=null,0===i&&l('":"')),null!==a&&null!==(s=ce())?a=[a,s]:(a=null,o=_),null!==(a=null!==a?a:"")?(_=o,58===t.charCodeAt(o)?(s=":",o++):(s=null,0===i&&l('":"')),null!==s&&null!==(u=ce())?s=[s,u]:(s=null,o=_),null!==(s=null!==s?s:"")?(_=o,58===t.charCodeAt(o)?(u=":",o++):(u=null,0===i&&l('":"')),null!==u&&null!==(c=ce())?u=[u,c]:(u=null,o=_),null!==(u=null!==u?u:"")?(_=o,58===t.charCodeAt(o)?(c=":",o++):(c=null,0===i&&l('":"')),null!==c&&null!==(d=ce())?c=[c,d]:(c=null,o=_),null!==(c=null!==c?c:"")?("::"===t.substr(o,2)?(d="::",o+=2):(d=null,0===i&&l('"::"')),null!==d?e=[e,n,r,a,s,u,c,d]:(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y)):(e=null,o=y))))))))))))))),null!==e&&(e=function(e){return Rn.host_type="IPv6",t.substring(o,e)}(v)),null===e&&(o=v),e}function ce(){var e,t,n,r,i;return i=o,null!==(e=p())&&null!==(t=null!==(t=p())?t:"")&&null!==(n=null!==(n=p())?n:"")&&null!==(r=null!==(r=p())?r:"")?e=[e,t,n,r]:(e=null,o=i),e}function de(){var e,n,r,a;return a=o,null!==(e=ce())?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=ce())?e=[e,n,r]:(e=null,o=a)):(e=null,o=a),null===e&&(e=pe()),e}function pe(){var e,n,r,a,s,u,c,d,p;return d=o,p=o,null!==(e=fe())?(46===t.charCodeAt(o)?(n=".",o++):(n=null,0===i&&l('"."')),null!==n&&null!==(r=fe())?(46===t.charCodeAt(o)?(a=".",o++):(a=null,0===i&&l('"."')),null!==a&&null!==(s=fe())?(46===t.charCodeAt(o)?(u=".",o++):(u=null,0===i&&l('"."')),null!==u&&null!==(c=fe())?e=[e,n,r,a,s,u,c]:(e=null,o=p)):(e=null,o=p)):(e=null,o=p)):(e=null,o=p),null!==e&&(e=function(e){return Rn.host_type="IPv4",t.substring(o,e)}(d)),null===e&&(o=d),e}function fe(){var e,n,r,a;return a=o,"25"===t.substr(o,2)?(e="25",o+=2):(e=null,0===i&&l('"25"')),null!==e?(/^[0-5]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[0-5]")),null!==n?e=[e,n]:(e=null,o=a)):(e=null,o=a),null===e&&(a=o,50===t.charCodeAt(o)?(e="2",o++):(e=null,0===i&&l('"2"')),null!==e?(/^[0-4]/.test(t.charAt(o))?(n=t.charAt(o),o++):(n=null,0===i&&l("[0-4]")),null!==n&&null!==(r=c())?e=[e,n,r]:(e=null,o=a)):(e=null,o=a),null===e&&(a=o,49===t.charCodeAt(o)?(e="1",o++):(e=null,0===i&&l('"1"')),null!==e&&null!==(n=c())&&null!==(r=c())?e=[e,n,r]:(e=null,o=a),null===e&&(a=o,/^[1-9]/.test(t.charAt(o))?(e=t.charAt(o),o++):(e=null,0===i&&l("[1-9]")),null!==e&&null!==(n=c())?e=[e,n]:(e=null,o=a),null===e&&(e=c())))),e}function he(){var e,t,n,r,i,a,s;return a=o,s=o,null!==(e=null!==(e=c())?e:"")&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")&&null!==(r=null!==(r=c())?r:"")&&null!==(i=null!==(i=c())?i:"")?e=[e,t,n,r,i]:(e=null,o=s),null!==e&&(e=function(e,t){return t=parseInt(t.join("")),Rn.port=t,t}(0,e)),null===e&&(o=a),e}function me(){var e,n,r,a;for(e=[],a=o,59===t.charCodeAt(o)?(n=";",o++):(n=null,0===i&&l('";"')),null!==n&&null!==(r=ge())?n=[n,r]:(n=null,o=a);null!==n;)e.push(n),a=o,59===t.charCodeAt(o)?(n=";",o++):(n=null,0===i&&l('";"')),null!==n&&null!==(r=ge())?n=[n,r]:(n=null,o=a);return e}function ge(){var e;return null===(e=ve())&&null===(e=ye())&&null===(e=_e())&&null===(e=be())&&null===(e=Ce())&&null===(e=we())&&(e=Ee()),e}function ve(){var e,n,r,a;return r=o,a=o,"transport="===t.substr(o,10).toLowerCase()?(e=t.substr(o,10),o+=10):(e=null,0===i&&l('"transport="')),null!==e?("udp"===t.substr(o,3).toLowerCase()?(n=t.substr(o,3),o+=3):(n=null,0===i&&l('"udp"')),null===n&&("tcp"===t.substr(o,3).toLowerCase()?(n=t.substr(o,3),o+=3):(n=null,0===i&&l('"tcp"')),null===n&&("sctp"===t.substr(o,4).toLowerCase()?(n=t.substr(o,4),o+=4):(n=null,0===i&&l('"sctp"')),null===n&&("tls"===t.substr(o,3).toLowerCase()?(n=t.substr(o,3),o+=3):(n=null,0===i&&l('"tls"')),null===n&&(n=R())))),null!==n?e=[e,n]:(e=null,o=a)):(e=null,o=a),null!==e&&(e=function(e,t){Rn.uri_params||(Rn.uri_params={}),Rn.uri_params.transport=t.toLowerCase()}(0,e[1])),null===e&&(o=r),e}function ye(){var e,n,r,a;return r=o,a=o,"user="===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"user="')),null!==e?("phone"===t.substr(o,5).toLowerCase()?(n=t.substr(o,5),o+=5):(n=null,0===i&&l('"phone"')),null===n&&("ip"===t.substr(o,2).toLowerCase()?(n=t.substr(o,2),o+=2):(n=null,0===i&&l('"ip"')),null===n&&(n=R())),null!==n?e=[e,n]:(e=null,o=a)):(e=null,o=a),null!==e&&(e=function(e,t){Rn.uri_params||(Rn.uri_params={}),Rn.uri_params.user=t.toLowerCase()}(0,e[1])),null===e&&(o=r),e}function _e(){var e,n,r,a;return r=o,a=o,"method="===t.substr(o,7).toLowerCase()?(e=t.substr(o,7),o+=7):(e=null,0===i&&l('"method="')),null!==e&&null!==(n=at())?e=[e,n]:(e=null,o=a),null!==e&&(e=function(e,t){Rn.uri_params||(Rn.uri_params={}),Rn.uri_params.method=t}(0,e[1])),null===e&&(o=r),e}function be(){var e,n,r,a;return r=o,a=o,"ttl="===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"ttl="')),null!==e&&null!==(n=yn())?e=[e,n]:(e=null,o=a),null!==e&&(e=function(e,t){Rn.params||(Rn.params={}),Rn.params.ttl=t}(0,e[1])),null===e&&(o=r),e}function Ce(){var e,n,r,a;return r=o,a=o,"maddr="===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"maddr="')),null!==e&&null!==(n=oe())?e=[e,n]:(e=null,o=a),null!==e&&(e=function(e,t){Rn.uri_params||(Rn.uri_params={}),Rn.uri_params.maddr=t}(0,e[1])),null===e&&(o=r),e}function we(){var e,n,r,a,s,u;return a=o,s=o,"lr"===t.substr(o,2).toLowerCase()?(e=t.substr(o,2),o+=2):(e=null,0===i&&l('"lr"')),null!==e?(u=o,61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null!==n&&null!==(r=R())?n=[n,r]:(n=null,o=u),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=s)):(e=null,o=s),null!==e&&(Rn.uri_params||(Rn.uri_params={}),e=void(Rn.uri_params.lr=void 0)),null===e&&(o=a),e}function Ee(){var e,n,r,a,s,u;return a=o,s=o,null!==(e=Se())?(u=o,61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null!==n&&null!==(r=Te())?n=[n,r]:(n=null,o=u),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=function(e,t,n){Rn.uri_params||(Rn.uri_params={}),n=void 0===n?void 0:n[1],Rn.uri_params[t.toLowerCase()]=n&&n.toLowerCase()}(0,e[0],e[1])),null===e&&(o=a),e}function Se(){var e,t,n;if(n=o,null!==(t=Oe()))for(e=[];null!==t;)e.push(t),t=Oe();else e=null;return null!==e&&(e=e.join("")),null===e&&(o=n),e}function Te(){var e,t,n;if(n=o,null!==(t=Oe()))for(e=[];null!==t;)e.push(t),t=Oe();else e=null;return null!==e&&(e=e.join("")),null===e&&(o=n),e}function Oe(){var e;return null===(e=Ae())&&null===(e=b())&&(e=w()),e}function Ae(){var e;return 91===t.charCodeAt(o)?(e="[",o++):(e=null,0===i&&l('"["')),null===e&&(93===t.charCodeAt(o)?(e="]",o++):(e=null,0===i&&l('"]"')),null===e&&(47===t.charCodeAt(o)?(e="/",o++):(e=null,0===i&&l('"/"')),null===e&&(58===t.charCodeAt(o)?(e=":",o++):(e=null,0===i&&l('":"')),null===e&&(38===t.charCodeAt(o)?(e="&",o++):(e=null,0===i&&l('"&"')),null===e&&(43===t.charCodeAt(o)?(e="+",o++):(e=null,0===i&&l('"+"')),null===e&&(36===t.charCodeAt(o)?(e="$",o++):(e=null,0===i&&l('"$"')))))))),e}function xe(){var e,n,r,a,s,u,c;if(u=o,63===t.charCodeAt(o)?(e="?",o++):(e=null,0===i&&l('"?"')),null!==e)if(null!==(n=ke())){for(r=[],c=o,38===t.charCodeAt(o)?(a="&",o++):(a=null,0===i&&l('"&"')),null!==a&&null!==(s=ke())?a=[a,s]:(a=null,o=c);null!==a;)r.push(a),c=o,38===t.charCodeAt(o)?(a="&",o++):(a=null,0===i&&l('"&"')),null!==a&&null!==(s=ke())?a=[a,s]:(a=null,o=c);null!==r?e=[e,n,r]:(e=null,o=u)}else e=null,o=u;else e=null,o=u;return e}function ke(){var e,n,r,a,s;return a=o,s=o,null!==(e=Re())?(61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null!==n&&null!==(r=Ie())?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=function(e,t,n){t=t.join("").toLowerCase(),n=n.join(""),Rn.uri_headers||(Rn.uri_headers={}),Rn.uri_headers[t]?Rn.uri_headers[t].push(n):Rn.uri_headers[t]=[n]}(0,e[0],e[2])),null===e&&(o=a),e}function Re(){var e,t;if(null===(t=De())&&null===(t=b())&&(t=w()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=De())&&null===(t=b())&&(t=w());else e=null;return e}function Ie(){var e,t;for(e=[],null===(t=De())&&null===(t=b())&&(t=w());null!==t;)e.push(t),null===(t=De())&&null===(t=b())&&(t=w());return e}function De(){var e;return 91===t.charCodeAt(o)?(e="[",o++):(e=null,0===i&&l('"["')),null===e&&(93===t.charCodeAt(o)?(e="]",o++):(e=null,0===i&&l('"]"')),null===e&&(47===t.charCodeAt(o)?(e="/",o++):(e=null,0===i&&l('"/"')),null===e&&(63===t.charCodeAt(o)?(e="?",o++):(e=null,0===i&&l('"?"')),null===e&&(58===t.charCodeAt(o)?(e=":",o++):(e=null,0===i&&l('":"')),null===e&&(43===t.charCodeAt(o)?(e="+",o++):(e=null,0===i&&l('"+"')),null===e&&(36===t.charCodeAt(o)?(e="$",o++):(e=null,0===i&&l('"$"')))))))),e}function Ne(){var e,t,n,r,i,a;return a=o,null!==(e=at())&&null!==(t=g())&&null!==(n=Pe())&&null!==(r=g())&&null!==(i=Qe())?e=[e,t,n,r,i]:(e=null,o=a),e}function Pe(){var e;return null===(e=Q())&&(e=je()),e}function je(){var e,n,r,a;return a=o,null!==(e=We())?(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n?(null===(r=Le())&&(r=Fe()),null!==r?e=[e,n,r]:(e=null,o=a)):(e=null,o=a)):(e=null,o=a),e}function Le(){var e,n,r,a,s;return a=o,null===(e=Me())&&(e=Ue()),null!==e?(s=o,63===t.charCodeAt(o)?(n="?",o++):(n=null,0===i&&l('"?"')),null!==n&&null!==(r=$e())?n=[n,r]:(n=null,o=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=a)):(e=null,o=a),e}function Me(){var e,n,r,a;return a=o,"//"===t.substr(o,2)?(e="//",o+=2):(e=null,0===i&&l('"//"')),null!==e&&null!==(n=Ke())&&null!==(r=null!==(r=Ue())?r:"")?e=[e,n,r]:(e=null,o=a),e}function Ue(){var e,n,r;return r=o,47===t.charCodeAt(o)?(e="/",o++):(e=null,0===i&&l('"/"')),null!==e&&null!==(n=He())?e=[e,n]:(e=null,o=r),e}function Fe(){var e,t,n,r;if(r=o,null!==(e=Be())){for(t=[],n=qe();null!==n;)t.push(n),n=qe();null!==t?e=[e,t]:(e=null,o=r)}else e=null,o=r;return e}function qe(){var e;return null===(e=_())&&null===(e=b())&&(e=w()),e}function Be(){var e;return null===(e=b())&&null===(e=w())&&(59===t.charCodeAt(o)?(e=";",o++):(e=null,0===i&&l('";"')),null===e&&(63===t.charCodeAt(o)?(e="?",o++):(e=null,0===i&&l('"?"')),null===e&&(58===t.charCodeAt(o)?(e=":",o++):(e=null,0===i&&l('":"')),null===e&&(64===t.charCodeAt(o)?(e="@",o++):(e=null,0===i&&l('"@"')),null===e&&(38===t.charCodeAt(o)?(e="&",o++):(e=null,0===i&&l('"&"')),null===e&&(61===t.charCodeAt(o)?(e="=",o++):(e=null,0===i&&l('"="')),null===e&&(43===t.charCodeAt(o)?(e="+",o++):(e=null,0===i&&l('"+"')),null===e&&(36===t.charCodeAt(o)?(e="$",o++):(e=null,0===i&&l('"$"')),null===e&&(44===t.charCodeAt(o)?(e=",",o++):(e=null,0===i&&l('","'))))))))))),e}function He(){var e,n,r,a,s,u;if(s=o,null!==(e=Ve())){for(n=[],u=o,47===t.charCodeAt(o)?(r="/",o++):(r=null,0===i&&l('"/"')),null!==r&&null!==(a=Ve())?r=[r,a]:(r=null,o=u);null!==r;)n.push(r),u=o,47===t.charCodeAt(o)?(r="/",o++):(r=null,0===i&&l('"/"')),null!==r&&null!==(a=Ve())?r=[r,a]:(r=null,o=u);null!==n?e=[e,n]:(e=null,o=s)}else e=null,o=s;return e}function Ve(){var e,n,r,a,s,u;for(s=o,e=[],n=Ge();null!==n;)e.push(n),n=Ge();if(null!==e){for(n=[],u=o,59===t.charCodeAt(o)?(r=";",o++):(r=null,0===i&&l('";"')),null!==r&&null!==(a=ze())?r=[r,a]:(r=null,o=u);null!==r;)n.push(r),u=o,59===t.charCodeAt(o)?(r=";",o++):(r=null,0===i&&l('";"')),null!==r&&null!==(a=ze())?r=[r,a]:(r=null,o=u);null!==n?e=[e,n]:(e=null,o=s)}else e=null,o=s;return e}function ze(){var e,t;for(e=[],t=Ge();null!==t;)e.push(t),t=Ge();return e}function Ge(){var e;return null===(e=b())&&null===(e=w())&&(58===t.charCodeAt(o)?(e=":",o++):(e=null,0===i&&l('":"')),null===e&&(64===t.charCodeAt(o)?(e="@",o++):(e=null,0===i&&l('"@"')),null===e&&(38===t.charCodeAt(o)?(e="&",o++):(e=null,0===i&&l('"&"')),null===e&&(61===t.charCodeAt(o)?(e="=",o++):(e=null,0===i&&l('"="')),null===e&&(43===t.charCodeAt(o)?(e="+",o++):(e=null,0===i&&l('"+"')),null===e&&(36===t.charCodeAt(o)?(e="$",o++):(e=null,0===i&&l('"$"')),null===e&&(44===t.charCodeAt(o)?(e=",",o++):(e=null,0===i&&l('","'))))))))),e}function We(){var e,n,r,a,s;if(a=o,s=o,null!==(e=d())){for(n=[],null===(r=d())&&null===(r=c())&&(43===t.charCodeAt(o)?(r="+",o++):(r=null,0===i&&l('"+"')),null===r&&(45===t.charCodeAt(o)?(r="-",o++):(r=null,0===i&&l('"-"')),null===r&&(46===t.charCodeAt(o)?(r=".",o++):(r=null,0===i&&l('"."')))));null!==r;)n.push(r),null===(r=d())&&null===(r=c())&&(43===t.charCodeAt(o)?(r="+",o++):(r=null,0===i&&l('"+"')),null===r&&(45===t.charCodeAt(o)?(r="-",o++):(r=null,0===i&&l('"-"')),null===r&&(46===t.charCodeAt(o)?(r=".",o++):(r=null,0===i&&l('"."')))));null!==n?e=[e,n]:(e=null,o=s)}else e=null,o=s;return null!==e&&(e=function(e){Rn.scheme=t.substring(o,e)}(a)),null===e&&(o=a),e}function Ke(){var e;return null===(e=Ye())&&(e=Je()),e}function Ye(){var e,n,r,a;return r=o,a=o,null!==(e=X())?(64===t.charCodeAt(o)?(n="@",o++):(n=null,0===i&&l('"@"')),null!==n?e=[e,n]:(e=null,o=a)):(e=null,o=a),null!==(e=null!==e?e:"")&&null!==(n=re())?e=[e,n]:(e=null,o=r),e=null!==e?e:""}function Je(){var e,n;if(null===(n=b())&&null===(n=w())&&(36===t.charCodeAt(o)?(n="$",o++):(n=null,0===i&&l('"$"')),null===n&&(44===t.charCodeAt(o)?(n=",",o++):(n=null,0===i&&l('","')),null===n&&(59===t.charCodeAt(o)?(n=";",o++):(n=null,0===i&&l('";"')),null===n&&(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null===n&&(64===t.charCodeAt(o)?(n="@",o++):(n=null,0===i&&l('"@"')),null===n&&(38===t.charCodeAt(o)?(n="&",o++):(n=null,0===i&&l('"&"')),null===n&&(61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"')))))))))),null!==n)for(e=[];null!==n;)e.push(n),null===(n=b())&&null===(n=w())&&(36===t.charCodeAt(o)?(n="$",o++):(n=null,0===i&&l('"$"')),null===n&&(44===t.charCodeAt(o)?(n=",",o++):(n=null,0===i&&l('","')),null===n&&(59===t.charCodeAt(o)?(n=";",o++):(n=null,0===i&&l('";"')),null===n&&(58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null===n&&(64===t.charCodeAt(o)?(n="@",o++):(n=null,0===i&&l('"@"')),null===n&&(38===t.charCodeAt(o)?(n="&",o++):(n=null,0===i&&l('"&"')),null===n&&(61===t.charCodeAt(o)?(n="=",o++):(n=null,0===i&&l('"="')),null===n&&(43===t.charCodeAt(o)?(n="+",o++):(n=null,0===i&&l('"+"'))))))))));else e=null;return e}function $e(){var e,t;for(e=[],t=qe();null!==t;)e.push(t),t=qe();return e}function Qe(){var e,n,r,a,s,u,d,p;if(d=o,p=o,"sip"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"SIP"')),null!==e)if(47===t.charCodeAt(o)?(n="/",o++):(n=null,0===i&&l('"/"')),null!==n){if(null!==(a=c()))for(r=[];null!==a;)r.push(a),a=c();else r=null;if(null!==r)if(46===t.charCodeAt(o)?(a=".",o++):(a=null,0===i&&l('"."')),null!==a){if(null!==(u=c()))for(s=[];null!==u;)s.push(u),u=c();else s=null;null!==s?e=[e,n,r,a,s]:(e=null,o=p)}else e=null,o=p;else e=null,o=p}else e=null,o=p;else e=null,o=p;return null!==e&&(e=function(e){Rn.sip_version=t.substring(o,e)}(d)),null===e&&(o=d),e}function Ze(){var e;return"INVITE"===t.substr(o,6)?(e="INVITE",o+=6):(e=null,0===i&&l('"INVITE"')),e}function Xe(){var e;return"ACK"===t.substr(o,3)?(e="ACK",o+=3):(e=null,0===i&&l('"ACK"')),e}function et(){var e;return"OPTIONS"===t.substr(o,7)?(e="OPTIONS",o+=7):(e=null,0===i&&l('"OPTIONS"')),e}function tt(){var e;return"BYE"===t.substr(o,3)?(e="BYE",o+=3):(e=null,0===i&&l('"BYE"')),e}function nt(){var e;return"CANCEL"===t.substr(o,6)?(e="CANCEL",o+=6):(e=null,0===i&&l('"CANCEL"')),e}function rt(){var e;return"REGISTER"===t.substr(o,8)?(e="REGISTER",o+=8):(e=null,0===i&&l('"REGISTER"')),e}function ot(){var e;return"SUBSCRIBE"===t.substr(o,9)?(e="SUBSCRIBE",o+=9):(e=null,0===i&&l('"SUBSCRIBE"')),e}function it(){var e;return"NOTIFY"===t.substr(o,6)?(e="NOTIFY",o+=6):(e=null,0===i&&l('"NOTIFY"')),e}function at(){var e,n;return n=o,null===(e=Ze())&&null===(e=Xe())&&null===(e=et())&&null===(e=tt())&&null===(e=nt())&&null===(e=rt())&&null===(e=ot())&&null===(e=it())&&(e=R()),null!==e&&(e=function(e){return Rn.method=t.substring(o,e),Rn.method}(n)),null===e&&(o=n),e}function st(){var e,t,n,r,i,a;return a=o,null!==(e=Qe())&&null!==(t=g())&&null!==(n=lt())&&null!==(r=g())&&null!==(i=ct())?e=[e,t,n,r,i]:(e=null,o=a),e}function lt(){var e,t;return t=o,null!==(e=ut())&&(e=function(e,t){Rn.status_code=parseInt(t.join(""))}(0,e)),null===e&&(o=t),e}function ut(){var e,t,n,r;return r=o,null!==(e=c())&&null!==(t=c())&&null!==(n=c())?e=[e,t,n]:(e=null,o=r),e}function ct(){var e,n,r;for(r=o,e=[],null===(n=_())&&null===(n=b())&&null===(n=w())&&null===(n=x())&&null===(n=k())&&null===(n=g())&&(n=v());null!==n;)e.push(n),null===(n=_())&&null===(n=b())&&null===(n=w())&&null===(n=x())&&null===(n=k())&&null===(n=g())&&(n=v());return null!==e&&(e=function(e){Rn.reason_phrase=t.substring(o,e)}(r)),null===e&&(o=r),e}function dt(){var e,t,n,r,i,a,s;if(i=o,a=o,null===(e=$())&&(e=pt()),null!==e){for(t=[],s=o,null!==(n=B())&&null!==(r=ht())?n=[n,r]:(n=null,o=s);null!==n;)t.push(n),s=o,null!==(n=B())&&null!==(r=ht())?n=[n,r]:(n=null,o=s);null!==t?e=[e,t]:(e=null,o=a)}else e=null,o=a;return null!==e&&(e=function(e){var t;Rn.multi_header||(Rn.multi_header=[]);try{t=new JsSIP.NameAddrHeader(Rn.uri,Rn.display_name,Rn.params),delete Rn.uri,delete Rn.display_name,delete Rn.params}catch(e){t=null}Rn.multi_header.push({possition:o,offset:e,parsed:t})}(i)),null===e&&(o=i),e}function pt(){var e,t,n,r,i;return i=o,null!==(e=null!==(e=ft())?e:"")&&null!==(t=F())&&null!==(n=Q())&&null!==(r=U())?e=[e,t,n,r]:(e=null,o=i),e}function ft(){var e,n,r,i,a,s,l;if(a=o,s=o,null!==(e=R())){for(n=[],l=o,null!==(r=E())&&null!==(i=R())?r=[r,i]:(r=null,o=l);null!==r;)n.push(r),l=o,null!==(r=E())&&null!==(i=R())?r=[r,i]:(r=null,o=l);null!==n?e=[e,n]:(e=null,o=s)}else e=null,o=s;return null===e&&(e=W()),null!==e&&(e=function(e,n){'"'===(n=t.substring(o,e).trim())[0]&&(n=n.substring(1,n.length-1)),Rn.display_name=n}(a,e)),null===e&&(o=a),e}function ht(){var e;return null===(e=mt())&&null===(e=gt())&&(e=_t()),e}function mt(){var e,n,r,a,s;return a=o,s=o,"q"===t.substr(o,1).toLowerCase()?(e=t.substr(o,1),o++):(e=null,0===i&&l('"q"')),null!==e&&null!==(n=j())&&null!==(r=yt())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.params||(Rn.params={}),Rn.params.q=t}(0,e[2])),null===e&&(o=a),e}function gt(){var e,n,r,a,s;return a=o,s=o,"expires"===t.substr(o,7).toLowerCase()?(e=t.substr(o,7),o+=7):(e=null,0===i&&l('"expires"')),null!==e&&null!==(n=j())&&null!==(r=vt())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.params||(Rn.params={}),Rn.params.expires=t}(0,e[2])),null===e&&(o=a),e}function vt(){var e,t,n;if(n=o,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;return null!==e&&(e=parseInt(e.join(""))),null===e&&(o=n),e}function yt(){var e,n,r,a,s,u,d,p;return u=o,d=o,48===t.charCodeAt(o)?(e="0",o++):(e=null,0===i&&l('"0"')),null!==e?(p=o,46===t.charCodeAt(o)?(n=".",o++):(n=null,0===i&&l('"."')),null!==n&&null!==(r=null!==(r=c())?r:"")&&null!==(a=null!==(a=c())?a:"")&&null!==(s=null!==(s=c())?s:"")?n=[n,r,a,s]:(n=null,o=p),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=d)):(e=null,o=d),null!==e&&(e=function(e){return parseFloat(t.substring(o,e))}(u)),null===e&&(o=u),e}function _t(){var e,t,n,r,i,a;return r=o,i=o,null!==(e=R())?(a=o,null!==(t=j())&&null!==(n=bt())?t=[t,n]:(t=null,o=a),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,o=i)):(e=null,o=i),null!==e&&(e=function(e,t,n){Rn.params||(Rn.params={}),n=void 0===n?void 0:n[1],Rn.params[t.toLowerCase()]=n}(0,e[0],e[1])),null===e&&(o=r),e}function bt(){var e;return null===(e=R())&&null===(e=oe())&&(e=W()),e}function Ct(){var e;return"render"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"render"')),null===e&&("session"===t.substr(o,7).toLowerCase()?(e=t.substr(o,7),o+=7):(e=null,0===i&&l('"session"')),null===e&&("icon"===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"icon"')),null===e&&("alert"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"alert"')),null===e&&(e=R())))),e}function wt(){var e;return null===(e=Et())&&(e=_t()),e}function Et(){var e,n,r,a;return a=o,"handling"===t.substr(o,8).toLowerCase()?(e=t.substr(o,8),o+=8):(e=null,0===i&&l('"handling"')),null!==e&&null!==(n=j())?("optional"===t.substr(o,8).toLowerCase()?(r=t.substr(o,8),o+=8):(r=null,0===i&&l('"optional"')),null===r&&("required"===t.substr(o,8).toLowerCase()?(r=t.substr(o,8),o+=8):(r=null,0===i&&l('"required"')),null===r&&(r=R())),null!==r?e=[e,n,r]:(e=null,o=a)):(e=null,o=a),e}function St(){var e,t,n,r,i,a,s,l;if(s=o,null!==(e=Tt()))if(null!==(t=P()))if(null!==(n=Rt())){for(r=[],l=o,null!==(i=B())&&null!==(a=It())?i=[i,a]:(i=null,o=l);null!==i;)r.push(i),l=o,null!==(i=B())&&null!==(a=It())?i=[i,a]:(i=null,o=l);null!==r?e=[e,t,n,r]:(e=null,o=s)}else e=null,o=s;else e=null,o=s;else e=null,o=s;return e}function Tt(){var e;return null===(e=Ot())&&(e=At()),e}function Ot(){var e;return"text"===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"text"')),null===e&&("image"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"image"')),null===e&&("audio"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"audio"')),null===e&&("video"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"video"')),null===e&&("application"===t.substr(o,11).toLowerCase()?(e=t.substr(o,11),o+=11):(e=null,0===i&&l('"application"')),null===e&&(e=xt()))))),e}function At(){var e;return"message"===t.substr(o,7).toLowerCase()?(e=t.substr(o,7),o+=7):(e=null,0===i&&l('"message"')),null===e&&("multipart"===t.substr(o,9).toLowerCase()?(e=t.substr(o,9),o+=9):(e=null,0===i&&l('"multipart"')),null===e&&(e=xt())),e}function xt(){var e;return null===(e=R())&&(e=kt()),e}function kt(){var e,n,r;return r=o,"x-"===t.substr(o,2).toLowerCase()?(e=t.substr(o,2),o+=2):(e=null,0===i&&l('"x-"')),null!==e&&null!==(n=R())?e=[e,n]:(e=null,o=r),e}function Rt(){var e;return null===(e=xt())&&(e=R()),e}function It(){var e,t,n,r;return r=o,null!==(e=R())&&null!==(t=j())&&null!==(n=Dt())?e=[e,t,n]:(e=null,o=r),e}function Dt(){var e;return null===(e=R())&&(e=W()),e}function Nt(){var e,t,n;if(n=o,null!==(t=c()))for(e=[];null!==t;)e.push(t),t=c();else e=null;return null!==e&&(e=function(e,t){Rn.value=parseInt(t.join(""))}(0,e)),null===e&&(o=n),e}function Pt(){var e,n,r,a,s,u;if(s=o,null!==(e=I())){for(n=[],u=o,46===t.charCodeAt(o)?(r=".",o++):(r=null,0===i&&l('"."')),null!==r&&null!==(a=I())?r=[r,a]:(r=null,o=u);null!==r;)n.push(r),u=o,46===t.charCodeAt(o)?(r=".",o++):(r=null,0===i&&l('"."')),null!==r&&null!==(a=I())?r=[r,a]:(r=null,o=u);null!==n?e=[e,n]:(e=null,o=s)}else e=null,o=s;return e}function jt(){var e;return null===(e=Lt())&&(e=_t()),e}function Lt(){var e,n,r,a,s;return a=o,s=o,"tag"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"tag"')),null!==e&&null!==(n=j())&&null!==(r=R())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.tag=t}(0,e[2])),null===e&&(o=a),e}function Mt(){var e,n,r,a,s,u,c,d;if(c=o,"digest"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"Digest"')),null!==e)if(null!==(n=E()))if(null!==(r=qt())){for(a=[],d=o,null!==(s=q())&&null!==(u=qt())?s=[s,u]:(s=null,o=d);null!==s;)a.push(s),d=o,null!==(s=q())&&null!==(u=qt())?s=[s,u]:(s=null,o=d);null!==a?e=[e,n,r,a]:(e=null,o=c)}else e=null,o=c;else e=null,o=c;else e=null,o=c;return null===e&&(e=Ut()),e}function Ut(){var e,t,n,r,i,a,s,l;if(s=o,null!==(e=R()))if(null!==(t=E()))if(null!==(n=Ft())){for(r=[],l=o,null!==(i=q())&&null!==(a=Ft())?i=[i,a]:(i=null,o=l);null!==i;)r.push(i),l=o,null!==(i=q())&&null!==(a=Ft())?i=[i,a]:(i=null,o=l);null!==r?e=[e,t,n,r]:(e=null,o=s)}else e=null,o=s;else e=null,o=s;else e=null,o=s;return e}function Ft(){var e,t,n,r;return r=o,null!==(e=R())&&null!==(t=j())?(null===(n=R())&&(n=W()),null!==n?e=[e,t,n]:(e=null,o=r)):(e=null,o=r),e}function qt(){var e;return null===(e=Bt())&&null===(e=Vt())&&null===(e=Gt())&&null===(e=Kt())&&null===(e=Yt())&&null===(e=Jt())&&null===(e=$t())&&(e=Ft()),e}function Bt(){var e,n,r,a;return a=o,"realm"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"realm"')),null!==e&&null!==(n=j())&&null!==(r=Ht())?e=[e,n,r]:(e=null,o=a),e}function Ht(){var e,t;return t=o,null!==(e=K())&&(e=function(e,t){Rn.realm=t}(0,e)),null===e&&(o=t),e}function Vt(){var e,n,r,a,s,u,c,d,p;if(d=o,"domain"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"domain"')),null!==e)if(null!==(n=j()))if(null!==(r=V()))if(null!==(a=zt())){if(s=[],p=o,null!==(c=g()))for(u=[];null!==c;)u.push(c),c=g();else u=null;for(null!==u&&null!==(c=zt())?u=[u,c]:(u=null,o=p);null!==u;){if(s.push(u),p=o,null!==(c=g()))for(u=[];null!==c;)u.push(c),c=g();else u=null;null!==u&&null!==(c=zt())?u=[u,c]:(u=null,o=p)}null!==s&&null!==(u=z())?e=[e,n,r,a,s,u]:(e=null,o=d)}else e=null,o=d;else e=null,o=d;else e=null,o=d;else e=null,o=d;return e}function zt(){var e;return null===(e=je())&&(e=Ue()),e}function Gt(){var e,n,r,a;return a=o,"nonce"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"nonce"')),null!==e&&null!==(n=j())&&null!==(r=Wt())?e=[e,n,r]:(e=null,o=a),e}function Wt(){var e,t;return t=o,null!==(e=K())&&(e=function(e,t){Rn.nonce=t}(0,e)),null===e&&(o=t),e}function Kt(){var e,n,r,a,s;return a=o,s=o,"opaque"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"opaque"')),null!==e&&null!==(n=j())&&null!==(r=K())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.opaque=t}(0,e[2])),null===e&&(o=a),e}function Yt(){var e,n,r,a,s;return a=o,"stale"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"stale"')),null!==e&&null!==(n=j())?(s=o,"true"===t.substr(o,4).toLowerCase()?(r=t.substr(o,4),o+=4):(r=null,0===i&&l('"true"')),null!==r&&(r=void(Rn.stale=!0)),null===r&&(o=s),null===r&&(s=o,"false"===t.substr(o,5).toLowerCase()?(r=t.substr(o,5),o+=5):(r=null,0===i&&l('"false"')),null!==r&&(r=void(Rn.stale=!1)),null===r&&(o=s)),null!==r?e=[e,n,r]:(e=null,o=a)):(e=null,o=a),e}function Jt(){var e,n,r,a,s;return a=o,s=o,"algorithm"===t.substr(o,9).toLowerCase()?(e=t.substr(o,9),o+=9):(e=null,0===i&&l('"algorithm"')),null!==e&&null!==(n=j())?("md5"===t.substr(o,3).toLowerCase()?(r=t.substr(o,3),o+=3):(r=null,0===i&&l('"MD5"')),null===r&&("md5-sess"===t.substr(o,8).toLowerCase()?(r=t.substr(o,8),o+=8):(r=null,0===i&&l('"MD5-sess"')),null===r&&(r=R())),null!==r?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=function(e,t){Rn.algorithm=t.toUpperCase()}(0,e[2])),null===e&&(o=a),e}function $t(){var e,n,r,a,s,u,c,d,p,f;if(d=o,"qop"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"qop"')),null!==e)if(null!==(n=j()))if(null!==(r=V())){if(p=o,null!==(a=Qt())){for(s=[],f=o,44===t.charCodeAt(o)?(u=",",o++):(u=null,0===i&&l('","')),null!==u&&null!==(c=Qt())?u=[u,c]:(u=null,o=f);null!==u;)s.push(u),f=o,44===t.charCodeAt(o)?(u=",",o++):(u=null,0===i&&l('","')),null!==u&&null!==(c=Qt())?u=[u,c]:(u=null,o=f);null!==s?a=[a,s]:(a=null,o=p)}else a=null,o=p;null!==a&&null!==(s=z())?e=[e,n,r,a,s]:(e=null,o=d)}else e=null,o=d;else e=null,o=d;else e=null,o=d;return e}function Qt(){var e,n;return n=o,"auth-int"===t.substr(o,8).toLowerCase()?(e=t.substr(o,8),o+=8):(e=null,0===i&&l('"auth-int"')),null===e&&("auth"===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"auth"')),null===e&&(e=R())),null!==e&&(e=function(e,t){Rn.qop||(Rn.qop=[]),Rn.qop.push(t.toLowerCase())}(0,e)),null===e&&(o=n),e}function Zt(){var e,t,n,r,i,a,s;if(i=o,a=o,null!==(e=pt())){for(t=[],s=o,null!==(n=B())&&null!==(r=_t())?n=[n,r]:(n=null,o=s);null!==n;)t.push(n),s=o,null!==(n=B())&&null!==(r=_t())?n=[n,r]:(n=null,o=s);null!==t?e=[e,t]:(e=null,o=a)}else e=null,o=a;return null!==e&&(e=function(e){var t;Rn.multi_header||(Rn.multi_header=[]);try{t=new JsSIP.NameAddrHeader(Rn.uri,Rn.display_name,Rn.params),delete Rn.uri,delete Rn.display_name,delete Rn.params}catch(e){t=null}Rn.multi_header.push({possition:o,offset:e,parsed:t})}(i)),null===e&&(o=i),e}function Xt(){var e,t,n,r,i,a;if(i=o,null!==(e=pt())){for(t=[],a=o,null!==(n=B())&&null!==(r=_t())?n=[n,r]:(n=null,o=a);null!==n;)t.push(n),a=o,null!==(n=B())&&null!==(r=_t())?n=[n,r]:(n=null,o=a);null!==t?e=[e,t]:(e=null,o=i)}else e=null,o=i;return e}function en(){var e,n;return n=o,"active"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"active"')),null===e&&("pending"===t.substr(o,7).toLowerCase()?(e=t.substr(o,7),o+=7):(e=null,0===i&&l('"pending"')),null===e&&("terminated"===t.substr(o,10).toLowerCase()?(e=t.substr(o,10),o+=10):(e=null,0===i&&l('"terminated"')),null===e&&(e=R()))),null!==e&&(e=function(e){Rn.state=t.substring(o,e)}(n)),null===e&&(o=n),e}function tn(){var e,n,r,a,s;return a=o,s=o,"reason"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"reason"')),null!==e&&null!==(n=j())&&null!==(r=nn())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){void 0!==t&&(Rn.reason=t)}(0,e[2])),null===e&&(o=a),null===e&&(a=o,s=o,"expires"===t.substr(o,7).toLowerCase()?(e=t.substr(o,7),o+=7):(e=null,0===i&&l('"expires"')),null!==e&&null!==(n=j())&&null!==(r=vt())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){void 0!==t&&(Rn.expires=t)}(0,e[2])),null===e&&(o=a),null===e&&(a=o,s=o,"retry_after"===t.substr(o,11).toLowerCase()?(e=t.substr(o,11),o+=11):(e=null,0===i&&l('"retry_after"')),null!==e&&null!==(n=j())&&null!==(r=vt())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){void 0!==t&&(Rn.retry_after=t)}(0,e[2])),null===e&&(o=a),null===e&&(e=_t()))),e}function nn(){var e;return"deactivated"===t.substr(o,11).toLowerCase()?(e=t.substr(o,11),o+=11):(e=null,0===i&&l('"deactivated"')),null===e&&("probation"===t.substr(o,9).toLowerCase()?(e=t.substr(o,9),o+=9):(e=null,0===i&&l('"probation"')),null===e&&("rejected"===t.substr(o,8).toLowerCase()?(e=t.substr(o,8),o+=8):(e=null,0===i&&l('"rejected"')),null===e&&("timeout"===t.substr(o,7).toLowerCase()?(e=t.substr(o,7),o+=7):(e=null,0===i&&l('"timeout"')),null===e&&("giveup"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"giveup"')),null===e&&("noresource"===t.substr(o,10).toLowerCase()?(e=t.substr(o,10),o+=10):(e=null,0===i&&l('"noresource"')),null===e&&("invariant"===t.substr(o,9).toLowerCase()?(e=t.substr(o,9),o+=9):(e=null,0===i&&l('"invariant"')),null===e&&(e=R()))))))),e}function rn(){var e;return null===(e=Lt())&&(e=_t()),e}function on(){var e,t,n,r,i,a,s,l;if(s=o,null!==(e=pn()))if(null!==(t=E()))if(null!==(n=mn())){for(r=[],l=o,null!==(i=B())&&null!==(a=an())?i=[i,a]:(i=null,o=l);null!==i;)r.push(i),l=o,null!==(i=B())&&null!==(a=an())?i=[i,a]:(i=null,o=l);null!==r?e=[e,t,n,r]:(e=null,o=s)}else e=null,o=s;else e=null,o=s;else e=null,o=s;return e}function an(){var e;return null===(e=sn())&&null===(e=ln())&&null===(e=un())&&null===(e=cn())&&null===(e=dn())&&(e=_t()),e}function sn(){var e,n,r,a,s;return a=o,s=o,"ttl"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"ttl"')),null!==e&&null!==(n=j())&&null!==(r=yn())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.ttl=t}(0,e[2])),null===e&&(o=a),e}function ln(){var e,n,r,a,s;return a=o,s=o,"maddr"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"maddr"')),null!==e&&null!==(n=j())&&null!==(r=oe())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.maddr=t}(0,e[2])),null===e&&(o=a),e}function un(){var e,n,r,a,s;return a=o,s=o,"received"===t.substr(o,8).toLowerCase()?(e=t.substr(o,8),o+=8):(e=null,0===i&&l('"received"')),null!==e&&null!==(n=j())?(null===(r=pe())&&(r=ue()),null!==r?e=[e,n,r]:(e=null,o=s)):(e=null,o=s),null!==e&&(e=function(e,t){Rn.received=t}(0,e[2])),null===e&&(o=a),e}function cn(){var e,n,r,a,s;return a=o,s=o,"branch"===t.substr(o,6).toLowerCase()?(e=t.substr(o,6),o+=6):(e=null,0===i&&l('"branch"')),null!==e&&null!==(n=j())&&null!==(r=R())?e=[e,n,r]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.branch=t}(0,e[2])),null===e&&(o=a),e}function dn(){var e,n,r,a,s,u,d;if(s=o,u=o,"rport"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"rport"')),null!==e){if(d=o,null!==(n=j())){for(r=[],a=c();null!==a;)r.push(a),a=c();null!==r?n=[n,r]:(n=null,o=d)}else n=null,o=d;null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=u)}else e=null,o=u;return null!==e&&(e=void("undefined"!=typeof response_port&&(Rn.rport=response_port.join("")))),null===e&&(o=s),e}function pn(){var e,t,n,r,i,a;return a=o,null!==(e=fn())&&null!==(t=P())&&null!==(n=R())&&null!==(r=P())&&null!==(i=hn())?e=[e,t,n,r,i]:(e=null,o=a),e}function fn(){var e,n;return n=o,"sip"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"SIP"')),null===e&&(e=R()),null!==e&&(e=function(e,t){Rn.protocol=t}(0,e)),null===e&&(o=n),e}function hn(){var e,n;return n=o,"udp"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"UDP"')),null===e&&("tcp"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"TCP"')),null===e&&("tls"===t.substr(o,3).toLowerCase()?(e=t.substr(o,3),o+=3):(e=null,0===i&&l('"TLS"')),null===e&&("sctp"===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"SCTP"')),null===e&&(e=R())))),null!==e&&(e=function(e,t){Rn.transport=t}(0,e)),null===e&&(o=n),e}function mn(){var e,t,n,r,i;return r=o,null!==(e=gn())?(i=o,null!==(t=H())&&null!==(n=vn())?t=[t,n]:(t=null,o=i),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,o=r)):(e=null,o=r),e}function gn(){var e,n;return n=o,null===(e=pe())&&null===(e=le())&&(e=ie()),null!==e&&(e=function(e){Rn.host=t.substring(o,e)}(n)),null===e&&(o=n),e}function vn(){var e,t,n,r,i,a,s;return a=o,s=o,null!==(e=null!==(e=c())?e:"")&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")&&null!==(r=null!==(r=c())?r:"")&&null!==(i=null!==(i=c())?i:"")?e=[e,t,n,r,i]:(e=null,o=s),null!==e&&(e=function(e,t){Rn.port=parseInt(t.join(""))}(0,e)),null===e&&(o=a),e}function yn(){var e,t,n,r,i;return r=o,i=o,null!==(e=c())&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")?e=[e,t,n]:(e=null,o=i),null!==e&&(e=parseInt(e.join(""))),null===e&&(o=r),e}function _n(){var e,t;for(e=[],null===(t=A())&&null===(t=k())&&(t=E());null!==t;)e.push(t),null===(t=A())&&null===(t=k())&&(t=E());return e}function bn(){var e,n;return n=o,"stuns"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"stuns"')),null===e&&("stun"===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"stun"'))),null!==e&&(e=function(e,t){Rn.scheme=t}(0,e)),null===e&&(o=n),e}function Cn(){var e,n,r,a,s;return a=o,null!==(e=wn())?(s=o,58===t.charCodeAt(o)?(n=":",o++):(n=null,0===i&&l('":"')),null!==n&&null!==(r=he())?n=[n,r]:(n=null,o=s),null!==(n=null!==n?n:"")?e=[e,n]:(e=null,o=a)):(e=null,o=a),e}function wn(){var e,t;return t=o,null===(e=pe())&&null===(e=le())&&(e=Je()),null!==e&&(e=function(e,t){Rn.host=t}(0,e)),null===e&&(o=t),e}function Je(){var e,n,r;for(r=o,e=[],null===(n=En())&&null===(n=w())&&(n=Sn());null!==n;)e.push(n),null===(n=En())&&null===(n=w())&&(n=Sn());return null!==e&&(e=function(e){return t.substring(o,e)}(r)),null===e&&(o=r),e}function En(){var e;return null===(e=d())&&null===(e=c())&&(45===t.charCodeAt(o)?(e="-",o++):(e=null,0===i&&l('"-"')),null===e&&(46===t.charCodeAt(o)?(e=".",o++):(e=null,0===i&&l('"."')),null===e&&(95===t.charCodeAt(o)?(e="_",o++):(e=null,0===i&&l('"_"')),null===e&&(126===t.charCodeAt(o)?(e="~",o++):(e=null,0===i&&l('"~"')))))),e}function Sn(){var e;return 33===t.charCodeAt(o)?(e="!",o++):(e=null,0===i&&l('"!"')),null===e&&(36===t.charCodeAt(o)?(e="$",o++):(e=null,0===i&&l('"$"')),null===e&&(38===t.charCodeAt(o)?(e="&",o++):(e=null,0===i&&l('"&"')),null===e&&(39===t.charCodeAt(o)?(e="'",o++):(e=null,0===i&&l('"\'"')),null===e&&(40===t.charCodeAt(o)?(e="(",o++):(e=null,0===i&&l('"("')),null===e&&(41===t.charCodeAt(o)?(e=")",o++):(e=null,0===i&&l('")"')),null===e&&(42===t.charCodeAt(o)?(e="*",o++):(e=null,0===i&&l('"*"')),null===e&&(43===t.charCodeAt(o)?(e="+",o++):(e=null,0===i&&l('"+"')),null===e&&(44===t.charCodeAt(o)?(e=",",o++):(e=null,0===i&&l('","')),null===e&&(59===t.charCodeAt(o)?(e=";",o++):(e=null,0===i&&l('";"')),null===e&&(61===t.charCodeAt(o)?(e="=",o++):(e=null,0===i&&l('"="')))))))))))),e}function Tn(){var e,n;return n=o,"turns"===t.substr(o,5).toLowerCase()?(e=t.substr(o,5),o+=5):(e=null,0===i&&l('"turns"')),null===e&&("turn"===t.substr(o,4).toLowerCase()?(e=t.substr(o,4),o+=4):(e=null,0===i&&l('"turn"'))),null!==e&&(e=function(e,t){Rn.scheme=t}(0,e)),null===e&&(o=n),e}function On(){var e,n,r,a,s,u,c,d,p,f,h;return f=o,h=o,null!==(e=xn())?(45===t.charCodeAt(o)?(n="-",o++):(n=null,0===i&&l('"-"')),null!==n&&null!==(r=An())?(45===t.charCodeAt(o)?(a="-",o++):(a=null,0===i&&l('"-"')),null!==a&&null!==(s=An())?(45===t.charCodeAt(o)?(u="-",o++):(u=null,0===i&&l('"-"')),null!==u&&null!==(c=An())?(45===t.charCodeAt(o)?(d="-",o++):(d=null,0===i&&l('"-"')),null!==d&&null!==(p=kn())?e=[e,n,r,a,s,u,c,d,p]:(e=null,o=h)):(e=null,o=h)):(e=null,o=h)):(e=null,o=h)):(e=null,o=h),null!==e&&(e=function(e,n){Rn=t.substring(o+5,e)}(f,e[0])),null===e&&(o=f),e}function An(){var e,t,n,r,i;return i=o,null!==(e=p())&&null!==(t=p())&&null!==(n=p())&&null!==(r=p())?e=[e,t,n,r]:(e=null,o=i),e}function xn(){var e,t,n;return n=o,null!==(e=An())&&null!==(t=An())?e=[e,t]:(e=null,o=n),e}function kn(){var e,t,n,r;return r=o,null!==(e=An())&&null!==(t=An())&&null!==(n=An())?e=[e,t,n]:(e=null,o=r),e}var Rn={};if(null===r[n]()||o!==t.length){var In=Math.max(o,a),Dn=In<t.length?t.charAt(In):null,Nn=function(){for(var e=1,n=1,r=!1,i=0;i<Math.max(o,a);i++){var s=t.charAt(i);"\n"===s?(r||e++,n=1,r=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e++,n=1,r=!0):(n++,r=!1)}return{line:e,column:n}}();return new this.SyntaxError(function(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}(s),Dn,In,Nn.line,Nn.column),-1}return Rn},toSource:function(){return this._source},SyntaxError:function(t,n,r,o,i){this.name="SyntaxError",this.expected=t,this.found=n,this.message=function(t,n){var r;switch(t.length){case 0:r="end of input";break;case 1:r=t[0];break;default:r=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return"Expected "+r+" but "+(n?e(n):"end of input")+" found."}(t,n),this.offset=r,this.line=o,this.column=i}};return t.SyntaxError.prototype=Error.prototype,t}(),function e(t,n,o){function i(s,l){if(!n[s]){if(!t[s]){if(!l&&("function"==typeof r&&r))return r(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return i(n||e)},u,u.exports,e,t,n,o)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){var r=e("./lib/parser"),o=e("./lib/writer");n.write=o,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates},{"./lib/parser":3,"./lib/writer":4}],2:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (.*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (.*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS)\:(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)\s?(.*)?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap\:(\d*) ([\w\-]*)\/(\d*)(?:\s*\/(.*))?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":"rtpmap:%d %s/%s"}},{push:"fmtp",reg:/^fmtp\:(\d*) (.*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"rtcp",reg:/^rtcp\:(\d*)(?: (\S*) IP(\d) (.*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb\:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb\:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (.*))?/,names:["value","uri","config"],format:function(e){return null!=e.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (.*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup\:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid\:(\w*)/,format:"mid:%s"},{name:"ptime",reg:/^ptime\:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime\:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:"%s"},{name:"iceUfrag",reg:/^ice-ufrag\:(.*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd\:(.*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint\:(\S*) (.*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","generation"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",null!=e.generation&&(t+=" generation %d"),t}},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options\:(.*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc\:(\d*) ([\w_]*)\:(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{name:"msidSemantic",reg:/^msid-semantic\: (\w*) (.*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group\:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],3:[function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,n){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:o?t[e.name]:t;!function(e,t,n,o){if(o&&!n)t[o]=r(e[1]);else for(var i=0;i<n.length;i+=1)null!=e[i+1]&&(t[n[i]]=r(e[i+1]))}(n.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=e("./grammar"),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},n=[],r=t;return e.split("\r\n").filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var l=i[t][s];if(l.reg.test(a))return o(l,r,a)}}),t.media=n,t};var s=function(e,t){var n=t.split("=");return 2===n.length&&(e[n[0]]=r(n[1])),e};n.parseFmtpConfig=function(e){return e.split(";").reduce(s,{})},n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),o=0;o<n.length;o+=3)t.push({component:n[o],ip:n[o+1],port:n[o+2]});return t}},{"./grammar":2}],4:[function(e,t,n){var r=e("./grammar"),o=/%[sdv%]/g,i=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?r.push(n[t.name][a]):r.push(n[t.names[i]])}else r.push(n[t.name]);return function(e){var t=1,n=arguments,r=n.length;return e.replace(o,function(e){if(t>=r)return e;var o=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})}.apply(null,r)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||a,o=t.innerOrder||s,l=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e?l.push(i(t,n,e)):n.push in e&&e[n.push].forEach(function(e){l.push(i(t,n,e))})})}),e.media.forEach(function(e){l.push(i("m",r.m[0],e)),o.forEach(function(t){r[t].forEach(function(n){n.name in e?l.push(i(t,n,e)):n.push in e&&e[n.push].forEach(function(e){l.push(i(t,n,e))})})})}),l.join("\r\n")+"\r\n"}},{"./grammar":2}],5:[function(e,t,n){!function(t){var n=e("sdp-transform");t.Parser.parseSDP=n.parse,t.Parser.writeSDP=n.write,t.Parser.parseFmtpConfig=n.parseFmtpConfig,t.Parser.parsePayloads=n.parsePayloads,t.Parser.parseRemoteCandidates=n.parseRemoteCandidates}(JsSIP)},{"sdp-transform":1}]},{},[5]);var o=[].slice,i={}.hasOwnProperty;window.oktellVoice=function(){var e,t,n,r,a,s,l,u,c,d,p,f,h,m,g,v;for(r=!1,"",c=function(){var e,t,n,i,a,s,l,u,c;if(e=1<=arguments.length?o.call(arguments,0):[],r){for(n=(t=new Date).getFullYear()+"-"+(t.getMonth()<10?"0":"")+t.getMonth()+"-"+(t.getDate()<10?"0":"")+t.getDate(),s=(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+":"+(t.getMilliseconds()+1e3).toString().substr(1),n+" "+s+" | ",i="log","error"===e[0].toString().toLowerCase()&&(i="error"),a=u=0,c=e.length;u<c;a=++u){if("object"==typeof(l=e[a]))try{JSON.stringify(l)}catch(e){e,l.toString()}else l;" | "}"\n\n",e.unshift("Oktell-Voice.js "+s+" |");try{return console[i].apply(console,e||[])}catch(e){e}}},d=function(){var e;return e=1<=arguments.length?o.call(arguments,0):[],c.apply(this,["error"].concat(e))},a=/\s+/,(l=function(){var e,t,n,r,a,s,l,u;for(r=arguments[0],t=s=l=(e=2<=arguments.length?o.call(arguments,1):[]).length-1;l<=0?s<=0:s>=0;t=l<=0?++s:--s)if("object"==typeof e[t])for(n in u=e[t])i.call(u,n)&&(a=u[n],r[n]=a);return r})(f={isOktellVoice:!0},s={on:function(e,t,n){var r,o,i,s;if(!e||"function"!=typeof t)return!1;for(e=e.split(a),r=this.__eventCallbacks||(this.__eventCallbacks={}),i=0,s=e.length;i<s;i++)(r[o=e[i]]||(r[o]=[])).push({fn:t,context:n});return!0},off:function(e,t){var n,r,o,i,s,l,u,c,d,p;if(null==e)this.__eventCallbacks={};else if(n=this.__eventCallbacks||(this.__eventCallbacks={}),e=e.split(a),null==t)for(s=0,c=e.length;s<c;s++)delete n[r=e[s]];else for(l=0,d=e.length;l<d;l++)for(i=u=0,p=(o=n[r=e[l]]||(n[r]=[])).length;u<p;i=++u)o[i].fn===t&&(o[i]=!1);return!0},trigger:function(){var e,t,n,r,i,s,l,u,c,d,p;if(s=arguments[0],e=2<=arguments.length?o.call(arguments,1):[],!s)return!1;for(s=s.split(a),t=this.__eventCallbacks||(this.__eventCallbacks={}),p=[],l=0,c=s.length;l<c;l++){for(n=s[l],u=0,d=(r=t[n]||(t[n]=[])).length;u<d;u++)null!=(i=r[u]).fn&&i.fn.apply(i.context||window,e);e.unshift(n),p.push(function(){var n,r,o,a;for(a=[],n=0,r=(o=t.all||[]).length;n<r;n++)null!=(i=o[n]).fn?a.push(i.fn.apply(i.context||window,e)):a.push(void 0);return a}())}return p}}),e=function(){function e(e,t,n,r,i){var a=this;this.sip=e,this.login=t,this.pass=n||"",this.server=null!=r?r.split(":")[0]:void 0,this.port=(null!=r?r.split(":")[1]:void 0)||"5060",this.useWSS=i,this.sip&&this.login&&this.server&&this.port&&(this.constructed=!0),this.name="Common account",this.on("all",function(){var e,t;return t=arguments[0],e=2<=arguments.length?o.call(arguments,1):[],c("EVENT "+t+" on "+a.getName(),e)})}return e.prototype.id="",e.prototype.connected=!1,e.prototype.getName=function(){return this.name+" #"+this.id},e.prototype.connect=function(){return this.constructed?(c(this.getName()+" connect",arguments),!0):(d("error while consctruct "+this.getName()),!1)},e.prototype.call=function(e){return!!e&&(c(this.getName()+" call",arguments),!0)},e.prototype.answer=function(){return c(this.getName()+" answer",arguments)},e.prototype.transfer=function(e){return!!e&&(c(this.getName()+" transfer",arguments),!0)},e.prototype.hangup=function(){return c(this.getName()+" hangup",arguments)},e.prototype.dtmf=function(){return c(this.getName()+" dtmf",arguments)},e.prototype.hold=function(){return c(this.getName()+" hold",arguments)},e.prototype.isOnHold=function(){return c(this.getName()+" isOnHold",arguments)},e.prototype.resume=function(){return c(this.getName()+" resume",arguments)},e.prototype.reject=function(){return c(this.getName()+" reject",arguments)},e.prototype.disconnect=function(){return c(this.getName()+" disconnect",arguments)},e.prototype.isConnected=function(){return this.connected},e}(),l(e.prototype,s),t=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.name="JsSIP account"}return function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(n,e),n.prototype.createFantomAbonent=function(e){var t;return[{phone:(t="string"==typeof e||"number"==typeof e?e:e.getRemoteFriendlyName()).toString(),name:t.toString()}]},n.prototype.currentSession=!1,n.prototype.connectedFired=!1,n.prototype.createAudioElements=function(){return this.elLocal=document.createElement("audio"),this.elRemote=document.createElement("audio"),this.elLocalId="oktellVoice_jssip_local_"+Date.now(),this.elRemoteId="oktellVoice_jssip_remote_"+Date.now(),this.elLocal.setAttribute("id",this.elLocalId),this.elRemote.setAttribute("id",this.elRemoteId),document.body.appendChild(this.elLocal),document.body.appendChild(this.elRemote)},n.prototype.connect=function(){var e,t=this;return!!n.__super__.connect.apply(this,arguments)&&(this.elLocal||this.createAudioElements(),e={ws_servers:(this.useWSS?"wss":"ws")+"://"+this.server+":"+this.port,uri:"sip:"+this.login+"@"+this.server,password:this.pass,trace_sip:r,register_expires:this.register_expires,via_host:this.server},this.UA=new this.sip.UA(e),window.sipua=this.UA,this.UA.on("connected",function(e){if(c("connected",e),t.connected=!0,!t.connectedFired)return t.connectedFired=!0,t.trigger("connect")}),this.UA.on("disconnected",function(e){return t.connectedFired=!1,c("disconnected",e)}),this.UA.on("registered",function(e){if(c("registered",e),t.connected=!0,!t.connectedFired)return t.connectedFired=!0,t.trigger("connect")}),this.UA.on("unregistered",function(e){return c("unregistered",e),t.connected=!1,t.trigger("disconnect")}),this.UA.on("registrationFailed",function(e){return c("registration failed",e),t.connected=!1,t.trigger("disconnect")}),this.UA.on("mediaPermissionsRequest",function(e){return c("media permissions request",e),t.trigger("mediaPermissionsRequest")}),this.UA.on("mediaPermissionsAccept",function(e){return c("media permissions accept",e),t.trigger("mediaPermissionsAccept")}),this.UA.on("mediaPermissionsRefuse",function(e){return c("media permissions refuse",e),t.trigger("mediaPermissionsRefuse")}),this.UA.on("newRTCSession",function(e){var n;return c("new RTC session",e),t.currentSession=e.data.session,n=function(e){var n,r,o,i,a,s;if(c("currentSession started",e),t.trigger("RTCSessionStarted",null!=(n=t.currentSession.remote_identity)?n.display_name:void 0),"incoming"===(null!=(r=t.currentSession)?r.direction:void 0)&&t.trigger("ringStart",null!=(o=t.currentSession)&&null!=(i=o.remote_identity)?i.display_name:void 0,null!=(a=t.currentSession)&&null!=(s=a.remote_identity)&&"function"==typeof s.toString?s.toString():void 0),t.currentSession.getLocalStreams().length>0){c("currentSession local stream > 0",t.currentSession.getRemoteStreams()[0].getAudioTracks());try{t.elLocal.srcObject=t.currentSession.getLocalStreams()[0]}catch(e){t.elLocal.src=URL.createObjectURL(t.currentSession.getLocalStreams()[0])}}else c("currentSession local stream == 0");if(t.currentSession.getRemoteStreams().length>0){c("currentSession remote stream > 0",t.currentSession.getRemoteStreams()[0].getAudioTracks());try{t.elRemote.srcObject=t.currentSession.getRemoteStreams()[0]}catch(e){t.elRemote.src=URL.createObjectURL(t.currentSession.getRemoteStreams()[0])}return t.elRemote.play()}return c("currentSession remote stream == 0")},"incoming"===t.currentSession.direction?n():t.currentSession.on("started",n),t.currentSession.on("progress",function(e){return c("currentSession progress",e)}),t.currentSession.on("failed",function(e){var n;return c("currentSession failed",e),t.trigger("RTCSessionFailed",null!=(n=t.currentSession.remote_identity)?n.display_name:void 0)}),t.currentSession.on("ended",function(e){var n;return c("currentSession ended"),t.trigger("RTCSessionEnded",null!=(n=t.currentSession.remote_identity)?n.display_name:void 0)}),t.currentSession.on("hold",function(e){return t.holdedSession=t.currentSession})}),this.UA.start())},n.prototype.call=function(e){var t;return!!n.__super__.call.apply(this,arguments)&&(!!this.connected&&(e=e.toString(),t={mediaConstraints:{audio:!0,video:!1}},this.UA.call(e,t)))},n.prototype.answer=function(){var e;return n.__super__.answer.apply(this,arguments),null!=(e=this.currentSession)&&"function"==typeof e.answer?e.answer({audio:!0,video:!1}):void 0},n.prototype.hangup=function(){var e;return n.__super__.hangup.apply(this,arguments),null!=(e=this.currentSession)&&"function"==typeof e.terminate?e.terminate():void 0},n.prototype.reject=function(){var e;return n.__super__.reject.apply(this,arguments),null!=(e=this.currentSession)&&"function"==typeof e.terminate?e.terminate():void 0},n.prototype.hold=function(){var e;return n.__super__.hold.apply(this,arguments),null!=(e=this.currentSession)&&"function"==typeof e.hold?e.hold():void 0},n.prototype.isOnHold=function(){var e;return n.__super__.isOnHold.apply(this,arguments),null!=(e=this.holdedSession)&&"function"==typeof e.isOnHold?e.isOnHold():void 0},n.prototype.resume=function(){var e;return n.__super__.resume.apply(this,arguments),null!=(e=this.holdedSession)&&"function"==typeof e.unhold?e.unhold():void 0},n.prototype.dtmf=function(e){var t;return n.__super__.dtmf.apply(this,arguments),null!=(t=this.currentSession)&&"function"==typeof t.sendDTMF?t.sendDTMF(e):void 0},n.prototype.transfer=function(e){var t;return!!n.__super__.transfer.apply(this,arguments)&&(null!=(t=this.currentSession)&&"function"==typeof t.transfer?t.transfer(e.toString()):void 0)},n.prototype.disconnect=function(){return this.UA.stop()},n}(),h=!1,f.isSupported=function(){var e,t,n,r,o,i;return e=Boolean(navigator.userAgent.match(/Chrome\/[0-9\.]+? Safari\/[0-9\.]+$/)),r=parseInt(null!=(o=navigator.userAgent.match(/Chrome\/[0-9\.]+? YaBrowser\/([0-9]+)/))?o[1]:void 0)>=14,n=parseInt(null!=(i=navigator.userAgent.match(/Chrome\/[0-9\.]+? Safari\/[0-9\.]+ OPR\/([0-9]+)/))?i[1]:void 0)>=20,t=Boolean(navigator.userAgent.match(/Firefox\/[0-9\.]+/)),e||r||n||t},f.createUserMedia=function(e,t,n){var r,o,i;return h?"function"==typeof e?e(h):void 0:(o=!1,i=function(e){return o=!0,f.trigger("mediaPermissionsRefuse"),"function"==typeof t?t(e):void 0},r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,f.isSupported()&&"function"==typeof r?(setTimeout(function(){if(!o)return f.trigger("mediaPermissionsRequest")},500),r.call(navigator,{audio:!0,video:n},function(t){return o=!0,h=t,f.trigger("mediaPermissionsAccept"),"function"==typeof e?e(h):void 0},function(e){return i(e)})):(i(),!1))},f.getUserMediaStream=function(){return h},p={accounts:[],defaultAcc:null,defaultOptions:{typeName:"jssip",debugMode:!1},getSipObject:function(e){switch(e){case"jssip":return window.JsSIP}},getClassByTypeName:function(e){switch(e){case"jssip":return t}},exportKeys:["call","answer","hangup","transfer","hold","isOnHold","resume","dtmf","reject","disconnect","isConnected"],createExportAccount:function(e){var t,n,r,i,a;if(null==e)return!1;for(t={},r=0,i=(a=this.exportKeys).length;r<i;r++)n=a[r],null!=e[n]&&function(){var r;r=e[n],t[n]=function(){return r.apply(e,arguments)}}();return l(t,s),e.on("all",function(){var e;return e=1<=arguments.length?o.call(arguments,0):[],t.trigger.apply(t,e)}),t},createAccount:function(e){var t,n,o;return o=(e=l({},e||{},this.defaultOptions)).type||this.getSipObject(e.typeName),n=this.getClassByTypeName(e.typeName),!(!o||!n)&&(r=Boolean(e.debugMode),t=new n(o,e.login,e.password,e.server,e.useWSS),null==this.defaultAcc&&(this.defaultAcc=t),t.id=this.accounts.length+1,t.register_expires=e.register_expires,this.accounts.push(t),t.connect(),t)}},m=0,g=(v=p.exportKeys).length;m<g;m++)u=v[m],f[u]=function(){return!1};return n=null,f.connect=function(){var e;return null!=n&&"function"==typeof n.disconnect&&n.disconnect(),e=p.createAccount.apply(p,arguments),n=p.createExportAccount(e),e===p.defaultAcc&&(l(f,n),n.on("all",function(){var e;return e=1<=arguments.length?o.call(arguments,0):[],f.trigger.apply(f,e)}),f.on("all",function(){arguments[0],2<=arguments.length&&o.call(arguments,1)})),n},f.disconnect=function(){},f.version="0.2.3",f}()}).call(this,n(353)(e))},,,,function(e,t,n){e.exports=n.p+"ringing-c644bf92cbb2acfc0237fdbf6060e7a1.mp3"},function(e,t,n){var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(54),s=n(50),l=n(36),u=n(48),c=n(142),d=n(1191),p=n(306),f=n(165),h=n(8),m=n(99),g=n(247),v=n(44),y=n(27);t.translations=y.Translations.fromPO(n(1194)),t.init={initial:{login:"",password:"",email:""},modified:null,pending:!1,showReset:!1},t.update=function(e,n,r){var i=t.translations.__;switch(n.tag){case"Reset":return[o({},r,{modified:null}),l.noop];case"ToggleReset":return[o({},r,{showReset:!r.showReset}),l.noop];case"Pending":return[o({},r,{pending:n.pending}),l.noop];case"Submit":var a=b.get(r),s=a.login,u=a.password;return[r,v.pending(g.post(e,s,u).perform(function(e){return{tag:"Submit/failure",error:e}},function(e){return{tag:"Submit/success",payload:e}}))];case"Submit/success":return[r,l.noop];case"Change":return[b.modify(r,function(e){var t;return o({},e,((t={})[n.key]=n.value,t))}),l.noop];case"ResetPassword":return[r,l.noop];case"ResetPassword/success":return[o({},b.modify(r,function(e){return o({},e,{email:""})}),{showReset:!1}),m.notifySuccess(i("Check your inbox. An email letter with further instructions was sent to your address"))];case"Submit/failure":return[r,m.notifyError(n.error)]}};var _=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.handleSubmit=function(e){e.preventDefault();var r=n.props,o=r.model,i=r.dispatch,a=function(e){var n=t.translations.__,r={};0===e.login.length&&(r.login=n("Enter login"));0===e.password.length&&(r.password=n("Enter password"));return r}(b.get(o));s.isEmpty(a)&&i({tag:"Submit"})},n}return r(n,e),n.prototype.componentDidMount=function(){var e=this;setTimeout(function(){var t=a.findDOMNode(e);if(t instanceof Element){var n=t.querySelector("input");n&&n.focus()}},500)},n.prototype.renderReset=function(e){return null},n.prototype.render=function(){var e=this.props,t=e.__,n=e.model,r=e.dispatch,o=e.ctx,a=e.classes,s=b.get(n);return i.createElement("div",{className:a.root},i.createElement(p.Helmet,null,i.createElement("title",null,t("Sign in"))),i.createElement("div",{className:a.container},i.createElement("h1",{className:a.heading},t("Operator Workstation")),i.createElement("div",{className:a.formCard},i.createElement("form",{onSubmit:this.handleSubmit},i.createElement(u.TextField,{fullWidth:!0,required:!0,name:"login",label:t("Login"),value:s.login,onChange:function(e){return r({tag:"Change",key:"login",value:e.target.value})}}),i.createElement(u.TextField,{fullWidth:!0,required:!0,name:"password",type:"password",label:t("Password"),value:s.password,onChange:function(e){return r({tag:"Change",key:"password",value:e.target.value})}}),i.createElement(u.Button,{type:"submit",className:a.submit,variant:"raised",color:"primary",disabled:n.pending},i.createElement(u.Icon,null,"arrow_forward"),"  ",t("Sign in"))),this.renderReset(t)),i.createElement(d.default,{ctx:o,className:a.logo})),i.createElement(f.default,{pending:n.pending}))},n}(i.Component);t.View=h.default(C)(y.withGettext(t.translations)(_));var b=new l.Lens(function(e){var t=e.initial;return e.modified||t},function(e,t){return o({},e,{modified:s.isEqual(e.initial,t)?null:t})});function C(e){var t,n=e.spacing.unit;return{root:{width:"100%",minHeight:"100%",position:"absolute",background:c.grey[50],margin:"0 auto","& > *":{fontFamily:'Roboto, "Helvetica", "Arial", sans-serif'}},title:o({},e.typography.subheading,{textAlign:"center",margin:"0 0 "+2*n+"px 0"}),heading:o({},e.typography.display2,{textAlign:"center",marginBottom:3*n*3}),field:{"&:first-child":{marginTop:0}},submit:{width:"100%",marginTop:3*n},formCard:(t={padding:2*n,textAlign:"center",maxWidth:350,margin:"0 auto",boxSizing:"border-box"},t[e.breakpoints.down("sm")]={marginLeft:n,marginRight:n,maxWidth:"calc(100% - "+2*n+"px)"},t),container:{width:"100%",position:"absolute",top:"50%",transform:"translateY(-50%)",marginTop:-3*n*2},logo:{margin:3*n*2+"px auto 0 auto"},reset:{marginTop:2*n,"& > *":{marginBottom:2*n},"& a":{color:e.palette.primary.main,textDecoration:"none",borderBottom:"dotted 1px "+e.palette.primary.main,"&:active":{color:e.palette.secondary.main,borderBottom:"dotted 1px "+e.palette.secondary.main}}},"@global":{"html, body":{height:"100%",margin:0,fontSize:16},"body, body *":{fontFamily:"Roboto, serif"}}}}t.styles=C},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(11),i=n(8);t.localeLogo={en:n(1192),ru:n(1193)};var a=(new Date).getFullYear();function s(e){var n=e.classes,i=e.className,s=e.ctx.locale,l=o(n.root,i);return r.createElement("div",{className:l},r.createElement("div",null,r.createElement("a",{className:n.logoLink,href:"http://www.bitmaster.ru/",target:"_blank"},r.createElement("img",{className:n.image,src:function(e,t,n){if(e in t)return t[e];var r=e.split("-")[0];if(r in t)return t[r];if(n&&n in t)return t[n];for(var o in t)return t[o];throw new Error("lookupLocale: empty second argument")}(s,t.localeLogo,"en"),alt:"Bitmaster logo"}))),r.createElement("span",{className:n.claim},"2003—",a))}function l(e){return{root:{textAlign:"center"},logoLink:{display:"inline-block",position:"relative","&:after":{position:"absolute",cursor:"pointer",content:'""',width:"100%",height:"100%",display:"block",top:0,left:0},"&:hover":{"&:after":{background:"rgba(255,255,255,0.2)"}}},image:{width:200,"&:hover":{}},claim:{fontSize:16}}}t.Logo=s,t.default=i.default(l)(s),t.styles=l},function(e,t,n){e.exports=n.p+"en-US-ab61c2c82f2a20d28baa89642338f4b7.png"},function(e,t,n){e.exports=n.p+"ru-RU-7b3ee0844c2e917d3a549ebcff528737.png"},function(e,t,n){"use strict";n.r(t),t.default=function(e){return e.keys().map(e)}(n(1195))},function(e,t,n){var r={"./de.po":1196,"./lt.po":1197,"./ru.po":1198};function o(e){var t=i(e);return n(t)}function i(e){var t=r[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}o.keys=function(){return Object.keys(r)},o.resolve=i,e.exports=o,o.id=1195},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"de_DE"},"Operator Workstation":["Kabinett des Operators"],Login:["Benutzername"],"Sign in":["Eingang in den Account"],Password:["Passwort"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"lt_LT"},"Operator workstation":["Operatoriaus kabinetas"],Login:["Prisijungimas"],"Sign in":["Prisijungimas prie paskyros"],Password:["Slaptažodis"]}}}},function(e,t){e.exports={domain:"messages",locale_data:{messages:{"":{domain:"messages",lang:"ru_RU"},"Operator Workstation":["Кабинет Оператора"],Login:["Логин"],"Sign in":["Вход в аккаунт"],Password:["Пароль"]}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(1247);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(251)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){var r=n(698);(e.exports=n(250)(!1)).push([e.i,"@font-face {\n  font-family: 'Material Icons';\n  font-style: normal;\n  font-weight: 400;\n  src: url("+r(n(1248))+"); /* For IE6-8 */\n  src: local('Material Icons'),\n       local('MaterialIcons-Regular'),\n       url("+r(n(1249))+") format('woff2'),\n       url("+r(n(1250))+") format('woff'),\n       url("+r(n(1251))+") format('truetype');\n}\n\n.material-icons {\n  font-family: 'Material Icons';\n  font-weight: normal;\n  font-style: normal;\n  font-size: 24px;  /* Preferred icon size */\n  display: inline-block;\n  width: 1em;\n  height: 1em;\n  line-height: 1;\n  text-transform: none;\n  letter-spacing: normal;\n  word-wrap: normal;\n  white-space: nowrap;\n  direction: ltr;\n\n  /* Support for all WebKit browsers. */\n  -webkit-font-smoothing: antialiased;\n  /* Support for Safari and Chrome. */\n  text-rendering: optimizeLegibility;\n\n  /* Support for Firefox. */\n  -moz-osx-font-smoothing: grayscale;\n\n  /* Support for IE. */\n  font-feature-settings: 'liga';\n}\n",""])},function(e,t,n){e.exports=n.p+"MaterialIcons-Regular-e79bfd88537def476913f3ed52f4f4b3.eot"},function(e,t,n){e.exports=n.p+"MaterialIcons-Regular-570eb83859dc23dd0eec423a49e147fe.woff2"},function(e,t,n){e.exports=n.p+"MaterialIcons-Regular-012cf6a10129e2275d79d6adac7f3b02.woff"},function(e,t,n){e.exports=n.p+"MaterialIcons-Regular-a37b0c01c0baf1888ca812cc0508f6e2.ttf"},function(e,t,n){var r=n(1253);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(251)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(250)(!1)).push([e.i,".react-hint {\n\tpadding: 5px;\n\tposition: absolute;\n\tz-index: 9999;\n\tcursor: default;\n\tanimation: .5s fadeIn;\n}\n\n.react-hint__content {\n  font-size: 14px;\n        padding: 4px 6px;\n\tborder-radius: 3px;\n\tbackground: rgba(0,0,0, 0.82);\n\tcolor: rgba(255, 255, 255, 1);\n}\n\n.react-hint:after {\n\tcontent: '';\n\twidth: 0;\n\theight: 0;\n\tmargin: auto;\n\tdisplay: block;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tborder: 5px solid transparent;\n}\n\n.react-hint--top:after {\n\ttop: auto;\n\tborder-bottom: none;\n\tborder-top-color: #000;\n}\n\n.react-hint--left:after {\n\tleft: auto;\n\tborder-right: none;\n\tborder-left-color: #000;\n}\n\n.react-hint--right:after {\n\tright: auto;\n\tborder-left: none;\n\tborder-right-color: #000;\n}\n\n.react-hint--bottom:after {\n\tbottom: auto;\n\tborder-top: none;\n\tborder-bottom-color: #000;\n}\n\n@keyframes fadeIn {\n\tfrom {\n\t\topacity: 0;\n\t}\n\n\tto {\n\t\topacity: 1;\n\t}\n}\n",""])}]));